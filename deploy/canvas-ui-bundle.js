(()=>{var xc=Object.defineProperty;var is=e=>xc(e,"__esModule",{value:!0});var wo=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(i,r)=>(typeof require!="undefined"?require:i)[r]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var He=(e,i)=>()=>(e&&(i=e(e=0)),i);var Zn=(e,i)=>()=>(i||e((i={exports:{}}).exports,i),i.exports),Sr=(e,i)=>{is(e);for(var r in i)xc(e,r,{get:i[r],enumerable:!0})};var wc=Zn(()=>{WL.registerComponent("controller-teleport-component",{teleportIndicatorMeshObject:{type:WL.Type.Object,default:null},camRoot:{type:WL.Type.Object,default:null},cam:{type:WL.Type.Object,default:null},floorGroup:{type:WL.Type.Int,default:1},thumbstickActivationThreshhold:{type:WL.Type.Float,default:-.7},thumbstickDeactivationThreshhold:{type:WL.Type.Float,default:.3},indicatorYOffset:{type:WL.Type.Float,default:0},snapTurnAmount:{type:WL.Type.Float,default:.6}},{init:function(){if(this.thumbstickActivationThreshhold=-.7,this.prevThumbstickYAxisInput=0,this.prevThumbstickXAxisInput=0,this.input=this.object.getComponent("input"),this._tempVec=[0,0,0],this._camRotation=0,this._currentIndicatorRotation=0,!this.input){console.error(this.object.name,"controller-teleport-component.js: input component is required on the object.");return}this.teleportIndicatorMeshObject?(this.isIndicating=!1,this.indicatorHidden=!0,this.hitSpot=void 0):console.error(this.object.name,"controller-teleport-component.js: Teleport indicator mesh is missing.")},start:function(){WL.onXRSessionStart.push(this.setupVREvents.bind(this))},update:function(){let e=0,i=0,r=0;if(this.gamepadLeft&&this.gamepadLeft.axes&&(e=this.gamepadLeft.axes[2],i=this.gamepadLeft.axes[3],r=Math.abs(e)+Math.abs(i)),!this.isIndicating&&this.prevThumbstickYAxisInput>=this.thumbstickActivationThreshhold&&i<this.thumbstickActivationThreshhold?(this.isIndicating=!0,this.cam.getForward(this._tempVec),this._tempVec[1]=0,glMatrix.vec3.normalize(this._tempVec,this._tempVec),this._camRotation=Math.atan2(this._tempVec[0],this._tempVec[2])):this.isIndicating&&r<this.thumbstickDeactivationThreshhold&&(this.isIndicating=!1,this.teleportIndicatorMeshObject.translate([1e3,1e3,1e3]),this.hitSpot&&this.camRoot?(this.camRoot.resetTransform(),this.hitSpot[1]=0,this.cam.getForward(this._tempVec),this._tempVec[1]=0,glMatrix.vec3.normalize(this._tempVec,this._tempVec),this._camRotation=Math.atan2(this._tempVec[0],this._tempVec[2]),this._camRotation=this._currentIndicatorRotation-this._camRotation,this.camRoot.rotateAxisAngleRad([0,1,0],this._camRotation),this.camRoot.translate(this.hitSpot)):this.camRoot||console.error(this.object.name,"controller-teleport-component.js: Cam Root reference is missing.")),this.isIndicating&&this.teleportIndicatorMeshObject&&this.input){let c=[0,0,0];glMatrix.quat2.getTranslation(c,this.object.transformWorld);let h=this.object.transformWorld,p=[0,0,0];glMatrix.vec3.transformQuat(p,[0,0,-1],h);let f=WL.scene.rayCast(c,p,1<<this.floorGroup);f.hitCount>0?(this.indicatorHidden&&(this.indicatorHidden=!1),this._currentIndicatorRotation=this._camRotation+(Math.PI+Math.atan2(e,i)),this.teleportIndicatorMeshObject.resetTranslationRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(f.locations[0]),this.hitSpot=f.locations[0],this.indicatorYOffset&&(this.hitSpot[2]+=this.indicatorYOffset)):(this.indicatorHidden||(this.teleportIndicatorMeshObject.translate([1e3,1e3,1e3]),this.indicatorHidden=!0),this.hitSpot=void 0)}else Math.abs(this.prevThumbstickXAxisInput)<=Math.abs(this.thumbstickActivationThreshhold)&&Math.abs(e)>Math.abs(this.thumbstickActivationThreshhold)&&(this.camRoot.getTranslationWorld(this._tempVec),this._camRotation-=Math.sign(e)*this.snapTurnAmount,this.camRoot.resetTranslationRotation(),this.camRoot.rotateAxisAngleRad([0,1,0],this._camRotation),this.camRoot.translate(this._tempVec));this.prevThumbstickXAxisInput=e,this.prevThumbstickYAxisInput=i},setupVREvents:function(e){if(this.session=e,e.addEventListener("end",function(r){this.gamepad=null,this.session=null}.bind(this)),e.inputSources&&e.inputSources.length)for(var i=0;i<e.inputSources.length;i++){let r=e.inputSources[i];r.handedness=="right"?this.gamepadRight=r.gamepad:this.gamepadLeft=r.gamepad}e.addEventListener("inputsourceschange",function(r){if(r.added&&r.added.length)for(var c=0;c<r.added.length;c++){let h=r.added[c];h.handedness=="right"?this.gamepadRight=h.gamepad:this.gamepadLeft=h.gamepad}}.bind(this))}})});var Tc=Zn(()=>{WL.registerComponent("drum",{networkObject:{type:WL.Type.Object}},{start:function(){this.networkComponent=this.networkObject.getComponent("peer-manager"),this.networkComponent.addNetworkDataRecievedCallback("drumPlay",this.playSound.bind(this)),this.sound=this.object.getComponent("howler-audio-source"),this.collision=this.object.getComponent("collision"),this.lastOverlaps=[],this.tempVec=new Float32Array(3),this.synth=new Tone.MembraneSynth().toDestination(),this.notes=["A","B","C","D","E","F","G"],this.amountOctaves=2,this.baseNum=1/(this.notes.length*this.amountOctaves)},playSound:function(e){e instanceof ArrayBuffer&&(e=new Float32Array(e));let i=Math.floor(e[1]/this.baseNum);i=Math.min(i,this.notes.length*this.amountOctaves);let r=i/this.notes.length,c=i%this.notes.length,h=this.notes[c]+""+r;this.synth.triggerAttackRelease(h,"2n")},update:function(e){if(this.overlaps=this.collision.queryOverlaps(),this.overlapNames=[],this.overlaps.length)for(let i=0;i<this.overlaps.length;i++){let r=this.overlaps[i].object.name;this.lastOverlaps.includes(r)||(this.overlaps[i].object.getTranslationWorld(this.tempVec),this.onEnter(this.tempVec)),this.overlapNames.push(r)}this.lastOverlaps=this.overlapNames},onEnter:function(e){this.playSound(e),this.networkComponent.sendPackage("drumPlay",e)},onLeave:function(){}})});var Sc=Zn(()=>{WL.registerComponent("network-buttons",{peerManagerObject:{type:WL.Type.Object},cursor:{type:WL.Type.Object},hostButton:{type:WL.Type.Object},joinButton:{type:WL.Type.Object}},{start:function(){this.pm=this.peerManagerObject.getComponent("peer-manager");for(let e of this.object.children)e.name=="HostButton"&&(this.hostButton=this.hostButton||e),e.name=="JoinButton"&&(this.joinButton=this.joinButton||e);this.hostButtonCollider=this.hostButton.getComponent("collision"),this.hostButton.getComponent("cursor-target").addClickFunction(this.pm.host.bind(this.pm)),this.joinButtonCollider=this.joinButton.getComponent("collision"),this.joinButton.getComponent("cursor-target").addClickFunction(this.pm.join.bind(this.pm)),this.pm.addConnectionEstablishedCallback(this.hide.bind(this)),this.pm.addDisconnectCallback(this.show.bind(this))},show:function(){this.cursor.getComponent("cursor").setEnabled&&this.cursor.getComponent("cursor").setEnabled(!0),this.hostButtonCollider.active=!0,this.joinButtonCollider.active=!0,this.object.setTranslationLocal([0,0,-3])},hide:function(){this.cursor.getComponent("cursor").setEnabled&&this.cursor.getComponent("cursor").setEnabled(!1),this.hostButtonCollider.active=!1,this.joinButtonCollider.active=!1,this.object.setTranslationLocal([0,-300,0])}})});var kc=Zn(()=>{var Cc=!1;WL.registerComponent("peer-manager",{serverId:{type:WL.Type.String,default:"THISISAWONDERLANDENGINEPLACEHOLDER"},networkSendFrequencyInS:{type:WL.Type.Float,default:.01},playerHead:{type:WL.Type.Object},playerRightHand:{type:WL.Type.Object},playerLeftHand:{type:WL.Type.Object},networkPlayerPool:{type:WL.Type.Object},voiceEnabled:{type:WL.Type.Bool,default:!0}},{init:function(){this.streams={},this.activePlayers={},this.currentDataPackage={},this.calls={},this.connections=[],this.currentTime=0,this.headDualQuat=new Float32Array(8),this.rightHandDualQuat=new Float32Array(8),this.leftHandDualQuat=new Float32Array(8),this.audio=document.createElement("AUDIO"),this.audio.id="localAudio",document.body.appendChild(this.audio),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(e=>{this.localStream=e}).catch(e=>console.error("User denied audio access.",e)),this.connectionEstablishedCallbacks=this.connectionEstablishedCallbacks||[],this.clientJoinedCallbacks=this.clientJoinedCallbacks||[],this.disconnectCallbacks=this.disconnectCallbacks||[],this.registeredNetworkCallbacks=this.registeredNetworkCallbacks||{}},start:function(){this.networkPlayerSpawner=this.networkPlayerPool.getComponent("peer-networked-player-pool")||this.networkPlayerPool.getComponent("peer-networked-player-spawner")},host:function(){this.peer=new Peer(this.serverId),this.peer.on("open",this._onHostOpen.bind(this)),this.peer.on("connection",this._onHostConnected.bind(this)),this.peer.on("disconnected",this._onDisconnected.bind(this)),this.peer.on("call",e=>{this.calls[e.peer]=e,e.answer(this.localStream),e.on("stream",i=>{let r=document.createElement("AUDIO");r.id="remoteAudio"+e.peer,document.body.appendChild(r),r.srcObject=i,r.autoplay=!0,this.streams[e.peer]=i})})},kick:function(e){this.currentDataPackage.disconnect=this.currentDataPackage.disconnect||[],this.currentDataPackage.disconnect.push(e),this._removePlayer(e)},_onHostOpen:function(e){Cc=!0,this.serverId=e,this.activePlayers[this.serverId]={};for(let i of this.connectionEstablishedCallbacks)i()},_onHostConnected:function(e){this._hostPlayerJoined(e.peer,e.metadata.username),this.connections.push(e),e.on("open",()=>{e.send({joinedPlayers:Object.keys(this.activePlayers),joined:!0})}),e.on("close",()=>this._onHostConnectionClose(e)),e.on("data",i=>this._onHostDataRecieved(i,e)),this.object.setTranslationWorld([0,0,0])},_onHostDataRecieved:function(e,i){e.transforms&&this.activePlayers[i.peer]&&this.activePlayers[i.peer].setTransforms(e.transforms);for(let r of Object.keys(e))r!="transforms"&&this.registeredNetworkCallbacks[r]&&this.registeredNetworkCallbacks[r](e[r]);this.currentDataPackage[i.peer]=e},_onHostConnectionClose:function(e){this._removePlayer(e.peer),this.object.setTranslationWorld([0,-1,0]),this.disconnect(),this.currentDataPackage.disconnect=this.currentDataPackage.disconnect||[],this.currentDataPackage.disconnect.push(e.peer)},_hostPlayerJoined:function(e){let i=this.networkPlayerSpawner.getEntity();this.activePlayers[e]=i,this.currentDataPackage.joinedPlayers=this.currentDataPackage.joinedPlayers||[],this.currentDataPackage.joinedPlayers.push(e);for(let r of this.clientJoinedCallbacks)r(e,i)},join:function(){this.connect(this.serverId)},connect:function(e){if(!e)return console.error("peer-manager: Connection id parameter missing");this.peer||(this.peer=new Peer,this.peer.on("open",this._clientOnOpen.bind(this)),this.peer.on("disconnected",this._onDisconnected.bind(this)),this.connectionId=e,this.peer.on("call",i=>{!this.voiceEnabled||(this.calls[i.peer]=i,i.answer(this.localStream),i.on("stream",r=>{let c=document.createElement("AUDIO");c.id="remoteAudio"+e,document.body.appendChild(c),c.srcObject=r,c.autoplay=!0,this.streams[e]=r}))}))},disconnect:function(){!this.peer||(this.peer.destroy(),this.peer=null,this.connections=[],delete this.connection)},_onClientConnected:function(){this.call(this.serverId),Cc=!1;for(let e of this.connectionEstablishedCallbacks)e()},_onClientDataRecieved:function(e){let i=Object.keys(this.registeredNetworkCallbacks),r="joined"in e;for(let c of Object.keys(e)){let h=e[c];if(c=="joinedPlayers"){for(let f=0;f<e.joinedPlayers.length;f++){let g=e.joinedPlayers[f];if(g==this.peer.id||this.activePlayers[g])continue;!r&&g!=this.serverId&&setTimeout(()=>{this.call(g)},Math.floor(500*f));let y=this.networkPlayerSpawner.getEntity();this.activePlayers[g]=y;for(let S of this.clientJoinedCallbacks)S(g,y)}continue}if(c=="call")continue;if(c=="disconnect")for(let f of h)this._removePlayer(f);if(this.activePlayers[c]){let f=Object.keys(h);for(let g of f){if(g=="transforms"){this.activePlayers[c].setTransforms(h.transforms);continue}i.includes(g)&&this.registeredNetworkCallbacks[g](h[g])}continue}i.includes(c)&&this.registeredNetworkCallbacks[c](h)}},_removeAllPlayers:function(){let e=Object.keys(this.activePlayers);for(let i of e)this._removePlayer(i)},_removePlayer:function(e){if(!!this.activePlayers[e]){if(this.calls[e]&&(this.calls[e].close(),delete this.calls[e]),this.connections.length){let i=this.connections.find(r=>r.peer===e);if(i){i.close();let r=this.connections.indexOf(i);r>-1&&this.connections.splice(r,1)}}!this.activePlayers[e]||(Object.keys(this.activePlayers[e]).length!==0&&(this.activePlayers[e].reset(),this.networkPlayerSpawner.returnEntity(this.activePlayers[e])),delete this.activePlayers[e])}},_onDisconnected:function(e){this._removeAllPlayers(),this.disconnect();for(let i of this.disconnectCallbacks)i(e.peer)},call:function(e){if(!this.voiceEnabled)return;if(!this.localStream){console.error("Cannot call: no audio stream");return}let i=this.peer.call(e,this.localStream);this.calls[e]=i,i.on("stream",r=>{let c=document.createElement("AUDIO");c.id=e,document.body.appendChild(c),c.srcObject=r,c.autoplay=!0,this.streams[e]=r})},_clientOnOpen:function(){this.connection=this.peer.connect(this.connectionId,{metadata:{username:"TestName"}}),this.connection.on("open",this._onClientConnected.bind(this)),this.connection.on("data",this._onClientDataRecieved.bind(this)),this.connection.on("close",this._onClientClose.bind(this))},_onClientClose:function(){this.peer&&this.peer.destroy()},addConnectionEstablishedCallback:function(e){this.connectionEstablishedCallbacks=this.connectionEstablishedCallbacks||[],this.connectionEstablishedCallbacks.push(e)},removeConnectionEstablishedCallback:function(e){let i=this.connectionEstablishedCallbacks.indexOf(e);i<=-1||this.connectionEstablishedCallbacks.splice(i,1)},addClientJoinedCallback:function(e){this.clientJoinedCallbacks=this.clientJoinedCallbacks||[],this.clientJoinedCallbacks.push(e)},removeClientJoinedCallback:function(e){let i=this.clientJoinedCallbacks.indexOf(e);i<=-1||this.clientJoinedCallbacks.splice(i,1)},addDisconnectCallback:function(e){this.disconnectCallbacks=this.disconnectCallbacks||[],this.disconnectCallbacks.push(e)},removeDisconnectCallback:function(e){let i=this.disconnectCallbacks.indexOf(e);i<=-1||this.disconnectCallbacks.splice(i,1)},addNetworkDataRecievedCallback:function(e,i){this.registeredNetworkCallbacks=this.registeredNetworkCallbacks||{},this.registeredNetworkCallbacks[e]=i},removeNetworkDataRecievedCallback:function(e){delete this.registeredNetworkCallbacks[e]},sendPackage:function(e,i){this.currentDataPackage[e]=i},sendPackageImmediately:function(e,i){let r={};if(r[e]=i,this.connection){this.connection.send(r);return}for(let c of this.connections)c.send(r)},toggleMute:function(){this.localStream.getTracks()[0].enabled=!this.localStream.getTracks()[0].enabled},setOwnMute:function(e){this.localStream.getTracks()[0].enabled=!e},setOtherMute:function(e,i){this.streams[e]&&(this.streams[e].getTracks()[0].enabled=!i)},update:function(e){if(!(!this.connection&&this.connections.length==0)&&(this.currentTime+=e,!(this.currentTime<this.networkSendFrequencyInS))){if(this.currentTime=0,this.headDualQuat.set(this.playerHead.transformWorld),this.rightHandDualQuat.set(this.playerRightHand.transformWorld),this.leftHandDualQuat.set(this.playerLeftHand.transformWorld),this.connections.length){if(this.currentDataPackage[this.serverId]={transforms:{head:this.headDualQuat,rightHand:this.rightHandDualQuat,leftHand:this.leftHandDualQuat}},Object.keys(this.currentDataPackage).length==0)return;for(let i of this.connections){let r=i.peer,c=Object.fromEntries(Object.entries(this.currentDataPackage).filter(h=>h[0]!=r));Object.keys(c).length&&i.send(c)}}else this.currentDataPackage.transforms={head:this.headDualQuat,rightHand:this.rightHandDualQuat,leftHand:this.leftHandDualQuat},this.connection.send(this.currentDataPackage);this.currentDataPackage={}}}});WL.registerComponent("peer-networked-player-pool",{},{init:function(){this.inactivePool=[];for(let e of this.object.children)this.inactivePool.push(e.getComponent("peer-networked-player"))},getEntity:function(){if(this.inactivePool.length)return this.inactivePool.shift();console.error("peer-networked-player-pool: No more inactive entities")},returnEntity:function(e){this.inactivePool.push(e)}});WL.registerComponent("peer-networked-player",{nameTextObject:{type:WL.Type.Object}},{init:function(){for(let e of this.object.children)e.name=="Head"&&(this.head=e),e.name=="LeftHand"&&(this.leftHand=e),e.name=="RightHand"&&(this.rightHand=e)},setName:function(e){this.nameTextObject&&(this.nameTextObject.getComponent("text").text=e)},reset:function(){this.head.resetTranslationRotation(),this.rightHand.resetTranslationRotation(),this.leftHand.resetTranslationRotation()},setTransforms:function(e){this.head.transformLocal.set(new Float32Array(e.head)),this.head.setDirty(),this.rightHand.transformLocal.set(new Float32Array(e.rightHand)),this.rightHand.setDirty(),this.leftHand.transformLocal.set(new Float32Array(e.leftHand)),this.leftHand.setDirty()}});WL.registerComponent("peer-networked-player-spawner",{headMesh:{type:WL.Type.Mesh},headMaterial:{type:WL.Type.Material},leftHandMesh:{type:WL.Type.Mesh},leftHandMaterial:{type:WL.Type.Material},rightHandMesh:{type:WL.Type.Mesh},rightHandMaterial:{type:WL.Type.Material}},{init:function(){this.count=0},getEntity:function(){let e=WL.scene.addObject(1),i=WL.scene.addObjects(3,e);return i[0].name="Head",i[0].addComponent("mesh",{mesh:this.headMesh,material:this.headMaterial}),i[1].name="LeftHand",i[1].addComponent("mesh",{mesh:this.leftHandMesh,material:this.leftHandMaterial}),i[2].name="RightHand",i[2].addComponent("mesh",{mesh:this.rightHandMesh,material:this.rightHandMaterial}),e.name=`Player ${this.count++}`,e.addComponent("peer-networked-player")},returnEntity:function(e){console.log("returning:",e),e.children.forEach(i=>{i.active=!1}),e.active=!1}})});var Ec=Zn((ss,To)=>{(function(e,i){typeof ss=="object"&&typeof To=="object"?To.exports=i():typeof define=="function"&&define.amd?define([],i):typeof ss=="object"?ss.Tone=i():e.Tone=i()})(typeof self!="undefined"?self:ss,function(){return function(e){var i={};function r(c){if(i[c])return i[c].exports;var h=i[c]={i:c,l:!1,exports:{}};return e[c].call(h.exports,h,h.exports,r),h.l=!0,h.exports}return r.m=e,r.c=i,r.d=function(c,h,p){r.o(c,h)||Object.defineProperty(c,h,{enumerable:!0,get:p})},r.r=function(c){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},r.t=function(c,h){if(1&h&&(c=r(c)),8&h||4&h&&typeof c=="object"&&c&&c.__esModule)return c;var p=Object.create(null);if(r.r(p),Object.defineProperty(p,"default",{enumerable:!0,value:c}),2&h&&typeof c!="string")for(var f in c)r.d(p,f,function(g){return c[g]}.bind(null,f));return p},r.n=function(c){var h=c&&c.__esModule?function(){return c.default}:function(){return c};return r.d(h,"a",h),h},r.o=function(c,h){return Object.prototype.hasOwnProperty.call(c,h)},r.p="",r(r.s=9)}([function(e,i,r){(function(c,h,p,f){"use strict";function g($){return $&&typeof $=="object"&&"default"in $?$:{default:$}}var y=g(h),S=g(p),u=g(f),x=function($,ot,st){return{endTime:ot,insertTime:st,type:"exponentialRampToValue",value:$}},w=function($,ot,st){return{endTime:ot,insertTime:st,type:"linearRampToValue",value:$}},M=function($,ot){return{startTime:ot,type:"setValue",value:$}},k=function($,ot,st){return{duration:st,startTime:ot,type:"setValueCurve",values:$}},b=function($,ot,st){var Rt=st.startTime,ut=st.target,pt=st.timeConstant;return ut+(ot-ut)*Math.exp((Rt-$)/pt)},T=function($){return $.type==="exponentialRampToValue"},m=function($){return $.type==="linearRampToValue"},v=function($){return T($)||m($)},l=function($){return $.type==="setValue"},C=function($){return $.type==="setValueCurve"},R=function $(ot,st,Rt,ut){var pt=ot[st];return pt===void 0?ut:v(pt)||l(pt)?pt.value:C(pt)?pt.values[pt.values.length-1]:b(Rt,$(ot,st-1,pt.startTime,ut),pt)},j=function($,ot,st,Rt,ut){return st===void 0?[Rt.insertTime,ut]:v(st)?[st.endTime,st.value]:l(st)?[st.startTime,st.value]:C(st)?[st.startTime+st.duration,st.values[st.values.length-1]]:[st.startTime,R($,ot-1,st.startTime,ut)]},L=function($){return $.type==="cancelAndHold"},z=function($){return $.type==="cancelScheduledValues"},W=function($){return L($)||z($)?$.cancelTime:T($)||m($)?$.endTime:$.startTime},U=function($,ot,st,Rt){var ut=Rt.endTime,pt=Rt.value;return st===pt?pt:0<st&&0<pt||st<0&&pt<0?st*Math.pow(pt/st,($-ot)/(ut-ot)):0},G=function($,ot,st,Rt){return st+($-ot)/(Rt.endTime-ot)*(Rt.value-st)},et=function($,ot){var st=ot.duration,Rt=ot.startTime,ut=ot.values;return function(pt,Ft){var Ht=Math.floor(Ft),ne=Math.ceil(Ft);return Ht===ne?pt[Ht]:(1-(Ft-Ht))*pt[Ht]+(1-(ne-Ft))*pt[ne]}(ut,($-Rt)/st*(ut.length-1))},at=function($){return $.type==="setTarget"},lt=function(){function $(ot){S.default(this,$),this._automationEvents=[],this._currenTime=0,this._defaultValue=ot}return u.default($,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(ot){var st=W(ot);if(L(ot)||z(ot)){var Rt=this._automationEvents.findIndex(function(Pe){return z(ot)&&C(Pe)?Pe.startTime+Pe.duration>=st:W(Pe)>=st}),ut=this._automationEvents[Rt];if(Rt!==-1&&(this._automationEvents=this._automationEvents.slice(0,Rt)),L(ot)){var pt=this._automationEvents[this._automationEvents.length-1];if(ut!==void 0&&v(ut)){if(at(pt))throw new Error("The internal list is malformed.");var Ft=C(pt)?pt.startTime+pt.duration:W(pt),Ht=C(pt)?pt.values[pt.values.length-1]:pt.value,ne=T(ut)?U(st,Ft,Ht,ut):G(st,Ft,Ht,ut),Zt=T(ut)?x(ne,st,this._currenTime):w(ne,st,this._currenTime);this._automationEvents.push(Zt)}pt!==void 0&&at(pt)&&this._automationEvents.push(M(this.getValue(st),st)),pt!==void 0&&C(pt)&&pt.startTime+pt.duration>st&&(this._automationEvents[this._automationEvents.length-1]=k(new Float32Array([6,7]),pt.startTime,st-pt.startTime))}}else{var pe=this._automationEvents.findIndex(function(Pe){return W(Pe)>st}),de=pe===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[pe-1];if(de!==void 0&&C(de)&&W(de)+de.duration>st)return!1;var fe=T(ot)?x(ot.value,ot.endTime,this._currenTime):m(ot)?w(ot.value,st,this._currenTime):ot;if(pe===-1)this._automationEvents.push(fe);else{if(C(ot)&&st+ot.duration>W(this._automationEvents[pe]))return!1;this._automationEvents.splice(pe,0,fe)}}return!0}},{key:"flush",value:function(ot){var st=this._automationEvents.findIndex(function(pt){return W(pt)>ot});if(st>1){var Rt=this._automationEvents.slice(st-1),ut=Rt[0];at(ut)&&Rt.unshift(M(R(this._automationEvents,st-2,ut.startTime,this._defaultValue),ut.startTime)),this._automationEvents=Rt}}},{key:"getValue",value:function(ot){if(this._automationEvents.length===0)return this._defaultValue;var st=this._automationEvents[this._automationEvents.length-1],Rt=this._automationEvents.findIndex(function(ln){return W(ln)>ot}),ut=this._automationEvents[Rt],pt=W(st)<=ot?st:this._automationEvents[Rt-1];if(pt!==void 0&&at(pt)&&(ut===void 0||!v(ut)||ut.insertTime>ot))return b(ot,R(this._automationEvents,Rt-2,pt.startTime,this._defaultValue),pt);if(pt!==void 0&&l(pt)&&(ut===void 0||!v(ut)))return pt.value;if(pt!==void 0&&C(pt)&&(ut===void 0||!v(ut)||pt.startTime+pt.duration>ot))return ot<pt.startTime+pt.duration?et(ot,pt):pt.values[pt.values.length-1];if(pt!==void 0&&v(pt)&&(ut===void 0||!v(ut)))return pt.value;if(ut!==void 0&&T(ut)){var Ft=j(this._automationEvents,Rt-1,pt,ut,this._defaultValue),Ht=y.default(Ft,2),ne=Ht[0],Zt=Ht[1];return U(ot,ne,Zt,ut)}if(ut!==void 0&&m(ut)){var pe=j(this._automationEvents,Rt-1,pt,ut,this._defaultValue),de=y.default(pe,2),fe=de[0],Pe=de[1];return G(ot,fe,Pe,ut)}return this._defaultValue}}]),$}();c.AutomationEventList=lt,c.createCancelAndHoldAutomationEvent=function($){return{cancelTime:$,type:"cancelAndHold"}},c.createCancelScheduledValuesAutomationEvent=function($){return{cancelTime:$,type:"cancelScheduledValues"}},c.createExponentialRampToValueAutomationEvent=function($,ot){return{endTime:ot,type:"exponentialRampToValue",value:$}},c.createLinearRampToValueAutomationEvent=function($,ot){return{endTime:ot,type:"linearRampToValue",value:$}},c.createSetTargetAutomationEvent=function($,ot,st){return{startTime:ot,target:$,timeConstant:st,type:"setTarget"}},c.createSetValueAutomationEvent=M,c.createSetValueCurveAutomationEvent=k,Object.defineProperty(c,"__esModule",{value:!0})})(i,r(1),r(7),r(8))},function(e,i,r){var c=r(2),h=r(3),p=r(4),f=r(6);e.exports=function(g,y){return c(g)||h(g,y)||p(g,y)||f()}},function(e,i){e.exports=function(r){if(Array.isArray(r))return r}},function(e,i){e.exports=function(r,c){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(r)){var h=[],p=!0,f=!1,g=void 0;try{for(var y,S=r[Symbol.iterator]();!(p=(y=S.next()).done)&&(h.push(y.value),!c||h.length!==c);p=!0);}catch(u){f=!0,g=u}finally{try{p||S.return==null||S.return()}finally{if(f)throw g}}return h}}},function(e,i,r){var c=r(5);e.exports=function(h,p){if(h){if(typeof h=="string")return c(h,p);var f=Object.prototype.toString.call(h).slice(8,-1);return f==="Object"&&h.constructor&&(f=h.constructor.name),f==="Map"||f==="Set"?Array.from(h):f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f)?c(h,p):void 0}}},function(e,i){e.exports=function(r,c){(c==null||c>r.length)&&(c=r.length);for(var h=0,p=new Array(c);h<c;h++)p[h]=r[h];return p}},function(e,i){e.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}},function(e,i){e.exports=function(r,c){if(!(r instanceof c))throw new TypeError("Cannot call a class as a function")}},function(e,i){function r(c,h){for(var p=0;p<h.length;p++){var f=h[p];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}e.exports=function(c,h,p){return h&&r(c.prototype,h),p&&r(c,p),c}},function(e,i,r){"use strict";r.r(i),r.d(i,"getContext",function(){return Wt}),r.d(i,"setContext",function(){return Ms}),r.d(i,"Clock",function(){return Bn}),r.d(i,"Context",function(){return ri}),r.d(i,"BaseContext",function(){return co}),r.d(i,"Delay",function(){return Ee}),r.d(i,"Gain",function(){return ft}),r.d(i,"Offline",function(){return hu}),r.d(i,"OfflineContext",function(){return oi}),r.d(i,"Param",function(){return xt}),r.d(i,"ToneAudioBuffer",function(){return Dt}),r.d(i,"ToneAudioBuffers",function(){return ui}),r.d(i,"ToneAudioNode",function(){return rt}),r.d(i,"connectSeries",function(){return qe}),r.d(i,"connect",function(){return Oe}),r.d(i,"disconnect",function(){return uo}),r.d(i,"FrequencyClass",function(){return Ce}),r.d(i,"Frequency",function(){return au}),r.d(i,"MidiClass",function(){return pi}),r.d(i,"Midi",function(){return lu}),r.d(i,"TimeClass",function(){return Le}),r.d(i,"Time",function(){return su}),r.d(i,"TicksClass",function(){return zt}),r.d(i,"Ticks",function(){return uu}),r.d(i,"TransportTimeClass",function(){return se}),r.d(i,"TransportTime",function(){return cu}),r.d(i,"Emitter",function(){return si}),r.d(i,"IntervalTimeline",function(){return sc}),r.d(i,"StateTimeline",function(){return hi}),r.d(i,"Timeline",function(){return $e}),r.d(i,"isUndef",function(){return Me}),r.d(i,"isDefined",function(){return Ct}),r.d(i,"isFunction",function(){return Za}),r.d(i,"isNumber",function(){return Fe}),r.d(i,"isObject",function(){return dn}),r.d(i,"isBoolean",function(){return oo}),r.d(i,"isArray",function(){return _e}),r.d(i,"isString",function(){return Be}),r.d(i,"isNote",function(){return Ui}),r.d(i,"dbToGain",function(){return ai}),r.d(i,"gainToDb",function(){return Yi}),r.d(i,"intervalToFrequencyRatio",function(){return ci}),r.d(i,"ftom",function(){return Mn}),r.d(i,"mtof",function(){return ho}),r.d(i,"optionsFromArguments",function(){return V}),r.d(i,"defaultArg",function(){return Ue}),r.d(i,"Unit",function(){return h}),r.d(i,"debug",function(){return c}),r.d(i,"Noise",function(){return vn}),r.d(i,"UserMedia",function(){return di}),r.d(i,"Oscillator",function(){return Ut}),r.d(i,"AMOscillator",function(){return mi}),r.d(i,"FMOscillator",function(){return Un}),r.d(i,"PulseOscillator",function(){return Gn}),r.d(i,"FatOscillator",function(){return gi}),r.d(i,"PWMOscillator",function(){return vi}),r.d(i,"OmniOscillator",function(){return rn}),r.d(i,"ToneOscillatorNode",function(){return fi}),r.d(i,"LFO",function(){return Te}),r.d(i,"ToneBufferSource",function(){return gn}),r.d(i,"Player",function(){return Hn}),r.d(i,"Players",function(){return js}),r.d(i,"GrainPlayer",function(){return Fs}),r.d(i,"Add",function(){return Yn}),r.d(i,"Abs",function(){return cc}),r.d(i,"AudioToGain",function(){return Ps}),r.d(i,"GainToAudio",function(){return hc}),r.d(i,"GreaterThan",function(){return Zi}),r.d(i,"GreaterThanZero",function(){return Ls}),r.d(i,"Multiply",function(){return Gt}),r.d(i,"Negate",function(){return fo}),r.d(i,"Pow",function(){return _i}),r.d(i,"Signal",function(){return bt}),r.d(i,"connectSignal",function(){return Qi}),r.d(i,"Scale",function(){return on}),r.d(i,"ScaleExp",function(){return Ji}),r.d(i,"Subtract",function(){return Qn}),r.d(i,"SyncedSignal",function(){return mu}),r.d(i,"WaveShaper",function(){return Ge}),r.d(i,"Zero",function(){return Is}),r.d(i,"AMSynth",function(){return mo}),r.d(i,"DuoSynth",function(){return Ns}),r.d(i,"FMSynth",function(){return Vs}),r.d(i,"MetalSynth",function(){return zs}),r.d(i,"MembraneSynth",function(){return Ti}),r.d(i,"MonoSynth",function(){return En}),r.d(i,"NoiseSynth",function(){return Bs}),r.d(i,"PluckSynth",function(){return Ws}),r.d(i,"PolySynth",function(){return Us}),r.d(i,"Sampler",function(){return Mi}),r.d(i,"Synth",function(){return bn}),r.d(i,"Loop",function(){return Oi}),r.d(i,"Part",function(){return Ei}),r.d(i,"Pattern",function(){return Gs}),r.d(i,"Sequence",function(){return Ys}),r.d(i,"ToneEvent",function(){return Ke}),r.d(i,"AutoFilter",function(){return Qs}),r.d(i,"AutoPanner",function(){return Xs}),r.d(i,"AutoWah",function(){return Zs}),r.d(i,"BitCrusher",function(){return Js}),r.d(i,"Chebyshev",function(){return Ks}),r.d(i,"Chorus",function(){return tr}),r.d(i,"Distortion",function(){return er}),r.d(i,"FeedbackDelay",function(){return ir}),r.d(i,"FrequencyShifter",function(){return sr}),r.d(i,"Freeverb",function(){return rr}),r.d(i,"JCReverb",function(){return or}),r.d(i,"PingPongDelay",function(){return ar}),r.d(i,"PitchShift",function(){return cr}),r.d(i,"Phaser",function(){return hr}),r.d(i,"Reverb",function(){return lr}),r.d(i,"StereoWidener",function(){return ur}),r.d(i,"Tremolo",function(){return pr}),r.d(i,"Vibrato",function(){return dr}),r.d(i,"Analyser",function(){return Pi}),r.d(i,"Meter",function(){return fr}),r.d(i,"FFT",function(){return mr}),r.d(i,"DCMeter",function(){return bo}),r.d(i,"Waveform",function(){return gr}),r.d(i,"Follower",function(){return Ai}),r.d(i,"Channel",function(){return An}),r.d(i,"CrossFade",function(){return Xn}),r.d(i,"Merge",function(){return xn}),r.d(i,"MidSideMerge",function(){return ts}),r.d(i,"MidSideSplit",function(){return Ki}),r.d(i,"Mono",function(){return xo}),r.d(i,"MultibandSplit",function(){return Ii}),r.d(i,"Panner",function(){return Di}),r.d(i,"Panner3D",function(){return vr}),r.d(i,"PanVol",function(){return es}),r.d(i,"Recorder",function(){return ns}),r.d(i,"Solo",function(){return Kt}),r.d(i,"Split",function(){return Rn}),r.d(i,"Volume",function(){return sn}),r.d(i,"Compressor",function(){return cn}),r.d(i,"Gate",function(){return _r}),r.d(i,"Limiter",function(){return yr}),r.d(i,"MidSideCompressor",function(){return br}),r.d(i,"MultibandCompressor",function(){return xr}),r.d(i,"AmplitudeEnvelope",function(){return yi}),r.d(i,"Envelope",function(){return ue}),r.d(i,"FrequencyEnvelope",function(){return wi}),r.d(i,"EQ3",function(){return wr}),r.d(i,"Filter",function(){return Re}),r.d(i,"OnePoleFilter",function(){return Ci}),r.d(i,"FeedbackCombFilter",function(){return Si}),r.d(i,"LowpassCombFilter",function(){return ki}),r.d(i,"Convolver",function(){return Tr}),r.d(i,"BiquadFilter",function(){return xi}),r.d(i,"version",function(){return p}),r.d(i,"start",function(){return iu}),r.d(i,"supported",function(){return $l}),r.d(i,"now",function(){return Cu}),r.d(i,"immediate",function(){return ku}),r.d(i,"Transport",function(){return Mu}),r.d(i,"getTransport",function(){return Ou}),r.d(i,"Destination",function(){return Eu}),r.d(i,"Master",function(){return Ru}),r.d(i,"getDestination",function(){return Du}),r.d(i,"Listener",function(){return Au}),r.d(i,"getListener",function(){return Pu}),r.d(i,"Draw",function(){return Iu}),r.d(i,"getDraw",function(){return ju}),r.d(i,"context",function(){return Fu}),r.d(i,"loaded",function(){return Lu}),r.d(i,"Buffer",function(){return qu}),r.d(i,"Buffers",function(){return Nu}),r.d(i,"BufferSource",function(){return Vu});var c={};r.r(c),r.d(c,"assert",function(){return mt}),r.d(c,"assertRange",function(){return ve}),r.d(c,"assertContextRunning",function(){return so}),r.d(c,"setLogger",function(){return Kl}),r.d(c,"log",function(){return Xa}),r.d(c,"warn",function(){return Wi});var h={};r.r(h);let p="14.7.77";var f=r(0);let g=new WeakSet,y=new WeakMap,S=new WeakMap,u=new WeakMap,x=new WeakMap,w=new WeakMap,M=new WeakMap,k=new WeakMap,b=new WeakMap,T=new WeakMap,m={construct:()=>m},v=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,l=(o,t)=>{let n=[],s=o.replace(/^[\s]+/,""),a=s.match(v);for(;a!==null;){let d=a[1].slice(1,-1),_=a[0].replace(/([\s]+)?;?$/,"").replace(d,new URL(d,t).toString());n.push(_),s=s.slice(a[0].length).replace(/^[\s]+/,""),a=s.match(v)}return[n.join(";"),s]},C=o=>{if(o!==void 0&&!Array.isArray(o))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},R=o=>{if(!(t=>{try{new new Proxy(t,m)}catch{return!1}return!0})(o))throw new TypeError("The given value for processorCtor should be a constructor.");if(o.prototype===null||typeof o.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},j=(o,t)=>{let n=o.get(t);if(n===void 0)throw new Error("A value with the given key could not be found.");return n},L=(o,t)=>{let n=Array.from(o).filter(t);if(n.length>1)throw Error("More than one element was found.");if(n.length===0)throw Error("No element was found.");let[s]=n;return o.delete(s),s},z=(o,t,n,s)=>{let a=j(o,t),d=L(a,_=>_[0]===n&&_[1]===s);return a.size===0&&o.delete(t),d},W=o=>j(M,o),U=o=>{if(g.has(o))throw new Error("The AudioNode is already stored.");g.add(o),W(o).forEach(t=>t(!0))},G=o=>"port"in o,et=o=>{if(!g.has(o))throw new Error("The AudioNode is not stored.");g.delete(o),W(o).forEach(t=>t(!1))},at=(o,t)=>{!G(o)&&t.every(n=>n.size===0)&&et(o)},lt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},$=(o,t)=>o.context===t,ot=o=>{try{o.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},st=()=>new DOMException("","IndexSizeError"),Rt=o=>{var t;o.getChannelData=(t=o.getChannelData,n=>{try{return t.call(o,n)}catch(s){throw s.code===12?st():s}})},ut={numberOfChannels:1},pt=-34028234663852886e22,Ft=-pt,Ht=o=>g.has(o),ne={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Zt=o=>j(y,o),pe=o=>j(u,o),de=(o,t)=>{let{activeInputs:n}=Zt(o);n.forEach(a=>a.forEach(([d])=>{t.includes(o)||de(d,[...t,o])}));let s=(a=>"playbackRate"in a)(o)?[o.playbackRate]:G(o)?Array.from(o.parameters.values()):(a=>"frequency"in a&&"gain"in a)(o)?[o.Q,o.detune,o.frequency,o.gain]:(a=>"offset"in a)(o)?[o.offset]:(a=>!("frequency"in a)&&"gain"in a)(o)?[o.gain]:(a=>"detune"in a&&"frequency"in a)(o)?[o.detune,o.frequency]:(a=>"pan"in a)(o)?[o.pan]:[];for(let a of s){let d=pe(a);d!==void 0&&d.activeInputs.forEach(([_])=>de(_,t))}Ht(o)&&et(o)},fe=o=>{de(o.destination,[])},Pe=o=>o===void 0||typeof o=="number"||typeof o=="string"&&(o==="balanced"||o==="interactive"||o==="playback"),ln=o=>"context"in o,wn=o=>ln(o[0]),tn=(o,t,n,s)=>{for(let a of o)if(n(a)){if(s)return!1;throw Error("The set contains at least one similar element.")}return o.add(t),!0},ji=(o,t,[n,s],a)=>{tn(o,[t,n,s],d=>d[0]===t&&d[1]===n,a)},un=(o,[t,n,s],a)=>{let d=o.get(t);d===void 0?o.set(t,new Set([[n,s]])):tn(d,[n,s],_=>_[0]===n,a)},Ie=o=>"inputs"in o,Tn=(o,t,n,s)=>{if(Ie(t)){let a=t.inputs[s];return o.connect(a,n,0),[a,n,0]}return o.connect(t,n,s),[t,n,s]},me=(o,t,n)=>{for(let s of o)if(s[0]===t&&s[1]===n)return o.delete(s),s;return null},$n=(o,t)=>{if(!W(o).delete(t))throw new Error("Missing the expected event listener.")},Fi=(o,t,n)=>{let s=j(o,t),a=L(s,d=>d[0]===n);return s.size===0&&o.delete(t),a},qn=(o,t,n,s)=>{Ie(t)?o.disconnect(t.inputs[s],n,0):o.disconnect(t,n,s)},Nt=o=>j(S,o),Li=o=>j(x,o),Nn=o=>k.has(o),ls=o=>!g.has(o),Fo=o=>new Promise(t=>{let n=o.createScriptProcessor(256,1,1),s=o.createGain(),a=o.createBuffer(1,2,44100),d=a.getChannelData(0);d[0]=1,d[1]=1;let _=o.createBufferSource();_.buffer=a,_.loop=!0,_.connect(n).connect(o.destination),_.connect(s),_.disconnect(s),n.onaudioprocess=O=>{let E=O.inputBuffer.getChannelData(0);Array.prototype.some.call(E,D=>D===1)?t(!0):t(!1),_.stop(),n.onaudioprocess=null,_.disconnect(n),n.disconnect(o.destination)},_.start()}),jr=(o,t)=>{let n=new Map;for(let s of o)for(let a of s){let d=n.get(a);n.set(a,d===void 0?1:d+1)}n.forEach((s,a)=>t(a,s))},us=o=>"context"in o,Eh=(o,t,n,s)=>{let{activeInputs:a,passiveInputs:d}=pe(t),{outputs:_}=Zt(o),O=W(o),E=D=>{let I=Nt(o),A=Li(t);if(D){let F=Fi(d,o,n);ji(a,o,F,!1),s||Nn(o)||I.connect(A,n)}else{let F=((P,Y,N)=>L(P,q=>q[0]===Y&&q[1]===N))(a,o,n);un(d,F,!1),s||Nn(o)||I.disconnect(A,n)}};return!!tn(_,[t,n],D=>D[0]===t&&D[1]===n,!0)&&(O.add(E),Ht(o)?ji(a,o,[n,E],!0):un(d,[o,n,E],!0),!0)},Fr=(o,t,n,s,a)=>{let[d,_]=((O,E,D,I)=>{let{activeInputs:A,passiveInputs:F}=Zt(E),P=me(A[I],O,D);return P===null?[z(F,O,D,I)[2],!1]:[P[2],!0]})(o,n,s,a);if(d!==null&&($n(o,d),!_||t||Nn(o)||qn(Nt(o),Nt(n),s,a)),Ht(n)){let{activeInputs:O}=Zt(n);at(n,O)}},Lr=(o,t,n,s)=>{let[a,d]=((_,O,E)=>{let{activeInputs:D,passiveInputs:I}=pe(O),A=me(D,_,E);return A===null?[Fi(I,_,E)[1],!1]:[A[2],!0]})(o,n,s);a!==null&&($n(o,a),!d||t||Nn(o)||Nt(o).disconnect(Li(n),s))};class Lo{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,n=null){return this._map.forEach((s,a)=>t.call(n,s,a,this))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}let Rh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function ps(o,t,n,s,a){if(typeof o.copyFromChannel=="function")t[n].byteLength===0&&(t[n]=new Float32Array(128)),o.copyFromChannel(t[n],s,a);else{let d=o.getChannelData(s);if(t[n].byteLength===0)t[n]=d.slice(a,a+128);else{let _=new Float32Array(d.buffer,a*Float32Array.BYTES_PER_ELEMENT,128);t[n].set(_)}}}let qo=(o,t,n,s,a)=>{typeof o.copyToChannel=="function"?t[n].byteLength!==0&&o.copyToChannel(t[n],s,a):t[n].byteLength!==0&&o.getChannelData(s).set(t[n],a)},ds=(o,t)=>{let n=[];for(let s=0;s<o;s+=1){let a=[],d=typeof t=="number"?t:t[s];for(let _=0;_<d;_+=1)a.push(new Float32Array(128));n.push(a)}return n},Dh=async(o,t,n,s,a,d,_)=>{let O=t===null?128*Math.ceil(o.context.length/128):t.length,E=s.channelCount*s.numberOfInputs,D=a.reduce((q,B)=>q+B,0),I=D===0?null:n.createBuffer(D,O,n.sampleRate);if(d===void 0)throw new Error("Missing the processor constructor.");let A=Zt(o),F=await((q,B)=>{let Q=j(T,q),H=Nt(B);return j(Q,H)})(n,o),P=ds(s.numberOfInputs,s.channelCount),Y=ds(s.numberOfOutputs,a),N=Array.from(o.parameters.keys()).reduce((q,B)=>({...q,[B]:new Float32Array(128)}),{});for(let q=0;q<O;q+=128){if(s.numberOfInputs>0&&t!==null)for(let B=0;B<s.numberOfInputs;B+=1)for(let Q=0;Q<s.channelCount;Q+=1)ps(t,P[B],Q,Q,q);d.parameterDescriptors!==void 0&&t!==null&&d.parameterDescriptors.forEach(({name:B},Q)=>{ps(t,N,B,E+Q,q)});for(let B=0;B<s.numberOfInputs;B+=1)for(let Q=0;Q<a[B];Q+=1)Y[B][Q].byteLength===0&&(Y[B][Q]=new Float32Array(128));try{let B=P.map((H,X)=>A.activeInputs[X].size===0?[]:H),Q=_(q/n.sampleRate,n.sampleRate,()=>F.process(B,Y,N));if(I!==null)for(let H=0,X=0;H<s.numberOfOutputs;H+=1){for(let J=0;J<a[H];J+=1)qo(I,Y[H],J,X+J,q);X+=a[H]}if(!Q)break}catch(B){o.dispatchEvent(new ErrorEvent("processorerror",{colno:B.colno,filename:B.filename,lineno:B.lineno,message:B.message}));break}}return I},Ah={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Ph={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Ih={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},jh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Fh={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Lh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},fs=(o,t,n)=>{let s=t[n];if(s===void 0)throw o();return s},qh={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Nh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},ie=()=>new DOMException("","InvalidStateError"),ms=()=>new DOMException("","InvalidAccessError"),Vh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},No=(o,t,n,s,a,d,_,O,E,D,I)=>{let A=D.length,F=O;for(let P=0;P<A;P+=1){let Y=n[0]*D[P];for(let N=1;N<a;N+=1){let q=F-N&E-1;Y+=n[N]*d[q],Y-=o[N]*_[q]}for(let N=a;N<s;N+=1)Y+=n[N]*d[F-N&E-1];for(let N=a;N<t;N+=1)Y-=o[N]*_[F-N&E-1];d[F]=D[P],_[F]=Y,F=F+1&E-1,I[P]=Y}return F},zh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},qi=o=>{let t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{let n=o.decodeAudioData(t.buffer,()=>{});return n!==void 0&&(n.catch(()=>{}),!0)}catch{}return!1},gf={numberOfChannels:1},Qt=(o,t,n)=>{let s=t[n];s!==void 0&&s!==o[n]&&(o[n]=s)},oe=(o,t)=>{Qt(o,t,"channelCount"),Qt(o,t,"channelCountMode"),Qt(o,t,"channelInterpretation")},Vo=o=>typeof o.getFloatTimeDomainData=="function",Jt=(o,t,n)=>{let s=t[n];s!==void 0&&s!==o[n].value&&(o[n].value=s)},qr=o=>{var t;o.start=(t=o.start,(n=0,s=0,a)=>{if(typeof a=="number"&&a<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");t.call(o,n,s,a)})},Nr=o=>{var t;o.stop=(t=o.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");t.call(o,n)})},zo=(o,t)=>o===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(o*t))))),Bh=async(o,t)=>new o(await(n=>new Promise((s,a)=>{let{port1:d,port2:_}=new MessageChannel;d.onmessage=({data:O})=>{d.close(),_.close(),s(O)},d.onmessageerror=({data:O})=>{d.close(),_.close(),a(O)},_.postMessage(n)}))(t)),Bo=(o,t)=>{let n=o.createBiquadFilter();return oe(n,t),Jt(n,t,"Q"),Jt(n,t,"detune"),Jt(n,t,"frequency"),Jt(n,t,"gain"),Qt(n,t,"type"),n},Ni=(o,t)=>{let n=o.createChannelSplitter(t.numberOfOutputs);return oe(n,t),(s=>{let a=s.numberOfOutputs;Object.defineProperty(s,"channelCount",{get:()=>a,set:d=>{if(d!==a)throw ie()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:d=>{if(d!=="explicit")throw ie()}}),Object.defineProperty(s,"channelInterpretation",{get:()=>"discrete",set:d=>{if(d!=="discrete")throw ie()}})})(n),n},Kn=(o,t)=>(o.connect=t.connect.bind(t),o.disconnect=t.disconnect.bind(t),o),Wo=(o,t)=>{let n=o.createDelay(t.maxDelayTime);return oe(n,t),Jt(n,t,"delayTime"),n},ke=(o,t)=>{let n=o.createGain();return oe(n,t),Jt(n,t,"gain"),n};function Wh(o,t){let n=t[0]*t[0]+t[1]*t[1];return[(o[0]*t[0]+o[1]*t[1])/n,(o[1]*t[0]-o[0]*t[1])/n]}function Uo(o,t){let n=[0,0];for(let d=o.length-1;d>=0;d-=1)a=t,n=[(s=n)[0]*a[0]-s[1]*a[1],s[0]*a[1]+s[1]*a[0]],n[0]+=o[d];var s,a;return n}let Vi=(o,t,n,s)=>o.createScriptProcessor(t,n,s),Se=()=>new DOMException("","NotSupportedError"),Uh={numberOfChannels:1},Gh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Yh={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Hh={disableNormalization:!1},Qh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Go=()=>new DOMException("","UnknownError"),Xh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Yo=o=>{if(o===null)return!1;let t=o.length;return t%2!=0?o[Math.floor(t/2)]!==0:o[t/2-1]+o[t/2]!==0},gs=(o,t,n,s)=>{let a=Object.getPrototypeOf(o);for(;!a.hasOwnProperty(t);)a=Object.getPrototypeOf(a);let{get:d,set:_}=Object.getOwnPropertyDescriptor(a,t);Object.defineProperty(o,t,{get:n(d),set:s(_)})},Ho=(o,t,n)=>{try{o.setValueAtTime(t,n)}catch(s){if(s.code!==9)throw s;Ho(o,t,n+1e-7)}},Vr=o=>{let t=o.createOscillator();try{t.start(-1)}catch(n){return n instanceof RangeError}return!1},Qo=o=>{let t=o.createBuffer(1,1,44100),n=o.createBufferSource();n.buffer=t,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},zr=o=>{let t=o.createOscillator();try{t.stop(-1)}catch(n){return n instanceof RangeError}return!1},Zh=()=>{try{new DOMException}catch{return!1}return!0},Jh=()=>new Promise(o=>{let t=new ArrayBuffer(0),{port1:n,port2:s}=new MessageChannel;n.onmessage=({data:a})=>o(a!==null),s.postMessage(t,[t])}),Xo=(o,t)=>{let n=t.createGain();o.connect(n);let s=(a=o.disconnect,()=>{a.call(o,n),o.removeEventListener("ended",s)});var a;o.addEventListener("ended",s),Kn(o,n),o.stop=(d=>{let _=!1;return(O=0)=>{if(_)try{d.call(o,O)}catch{n.gain.setValueAtTime(0,O)}else d.call(o,O),_=!0}})(o.stop)},ti=(o,t)=>n=>{let s={value:o};return Object.defineProperties(n,{currentTarget:s,target:s}),typeof t=="function"?t.call(o,n):t.handleEvent.call(o,n)},$h=(Zo=tn,(o,t,[n,s,a],d)=>{Zo(o[s],[t,n,a],_=>_[0]===t&&_[1]===n,d)});var Zo;let Kh=(o=>(t,n,[s,a,d],_)=>{let O=t.get(s);O===void 0?t.set(s,new Set([[a,n,d]])):o(O,[a,n,d],E=>E[0]===a&&E[1]===n,_)})(tn),tl=(o=>(t,n,s,a)=>o(t[a],d=>d[0]===n&&d[1]===s))(L),Jo=new WeakMap,el=(o=>t=>{var n;return(n=o.get(t))!==null&&n!==void 0?n:0})(Jo),je=(vs=new Map,zi=new WeakMap,(o,t)=>{let n=zi.get(o);if(n!==void 0)return n;let s=vs.get(o);if(s!==void 0)return s;try{let a=t();return a instanceof Promise?(vs.set(o,a),a.catch(()=>!1).then(d=>(vs.delete(o),zi.set(o,d),d))):(zi.set(o,a),a)}catch{return zi.set(o,!1),!1}});var vs,zi;let Qe=typeof window=="undefined"?null:window,$o=(Ko=je,ta=st,(o,t)=>{let n=o.createAnalyser();if(oe(n,t),!(t.maxDecibels>t.minDecibels))throw ta();return Qt(n,t,"fftSize"),Qt(n,t,"maxDecibels"),Qt(n,t,"minDecibels"),Qt(n,t,"smoothingTimeConstant"),Ko(Vo,()=>Vo(n))||(s=>{s.getFloatTimeDomainData=a=>{let d=new Uint8Array(a.length);s.getByteTimeDomainData(d);let _=Math.max(d.length,s.fftSize);for(let O=0;O<_;O+=1)a[O]=.0078125*(d[O]-128);return a}})(n),n});var Ko,ta;let Br=(ea=Zt,o=>{let t=ea(o);if(t.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer});var ea;let ge=((o,t,n)=>async(s,a,d,_)=>{let O=o(s),E=[..._,s];await Promise.all(O.activeInputs.map((D,I)=>Array.from(D).filter(([A])=>!E.includes(A)).map(async([A,F])=>{let P=t(A),Y=await P.render(A,a,E),N=s.context.destination;n(A)||s===N&&n(s)||Y.connect(d,F,I)})).reduce((D,I)=>[...D,...I],[]))})(Zt,Br,Nn),nl=(na=$o,ia=Nt,sa=ge,()=>{let o=new WeakMap;return{render(t,n,s){let a=o.get(n);return a!==void 0?Promise.resolve(a):(async(d,_,O)=>{let E=ia(d);if(!$(E,_)){let D={channelCount:E.channelCount,channelCountMode:E.channelCountMode,channelInterpretation:E.channelInterpretation,fftSize:E.fftSize,maxDecibels:E.maxDecibels,minDecibels:E.minDecibels,smoothingTimeConstant:E.smoothingTimeConstant};E=na(_,D)}return o.set(_,E),await sa(d,_,E,O),E})(t,n,s)}}});var na,ia,sa;let Bt=(ra=w,o=>{let t=ra.get(o);if(t===void 0)throw ie();return t});var ra;let he=(o=>o===null?null:o.hasOwnProperty("OfflineAudioContext")?o.OfflineAudioContext:o.hasOwnProperty("webkitOfflineAudioContext")?o.webkitOfflineAudioContext:null)(Qe),qt=(Wr=he,o=>Wr!==null&&o instanceof Wr);var Wr;let oa=new WeakMap,aa=(ca=ti,class{constructor(o){this._nativeEventTarget=o,this._listeners=new WeakMap}addEventListener(o,t,n){if(t!==null){let s=this._listeners.get(t);s===void 0&&(s=ca(this,t),typeof t=="function"&&this._listeners.set(t,s)),this._nativeEventTarget.addEventListener(o,s,n)}}dispatchEvent(o){return this._nativeEventTarget.dispatchEvent(o)}removeEventListener(o,t,n){let s=t===null?void 0:this._listeners.get(t);this._nativeEventTarget.removeEventListener(o,s===void 0?null:s,n)}});var ca;let pn=(o=>o===null?null:o.hasOwnProperty("AudioContext")?o.AudioContext:o.hasOwnProperty("webkitAudioContext")?o.webkitAudioContext:null)(Qe),Ur=(Gr=pn,o=>Gr!==null&&o instanceof Gr);var Gr;let Yr=(o=>t=>o!==null&&typeof o.AudioNode=="function"&&t instanceof o.AudioNode)(Qe),ha=(o=>t=>o!==null&&typeof o.AudioParam=="function"&&t instanceof o.AudioParam)(Qe),te=((o,t,n,s,a,d,_,O,E,D,I,A,F,P,Y)=>class extends D{constructor(N,q,B,Q){super(B),this._context=N,this._nativeAudioNode=B;let H=I(N);A(H)&&n(Fo,()=>Fo(H))!==!0&&(X=>{let J=new Map;var Z,K;X.connect=(Z=X.connect.bind(X),(ct,tt=0,nt=0)=>{let it=us(ct)?Z(ct,tt,nt):Z(ct,tt),dt=J.get(ct);return dt===void 0?J.set(ct,[{input:nt,output:tt}]):dt.every(yt=>yt.input!==nt||yt.output!==tt)&&dt.push({input:nt,output:tt}),it}),X.disconnect=(K=X.disconnect,(ct,tt,nt)=>{if(K.apply(X),ct===void 0)J.clear();else if(typeof ct=="number")for(let[it,dt]of J){let yt=dt.filter(At=>At.output!==ct);yt.length===0?J.delete(it):J.set(it,yt)}else if(J.has(ct))if(tt===void 0)J.delete(ct);else{let it=J.get(ct);if(it!==void 0){let dt=it.filter(yt=>yt.output!==tt&&(yt.input!==nt||nt===void 0));dt.length===0?J.delete(ct):J.set(ct,dt)}}for(let[it,dt]of J)dt.forEach(yt=>{us(it)?X.connect(it,yt.output,yt.input):X.connect(it,yt.output)})})})(B),S.set(this,B),M.set(this,new Set),N.state!=="closed"&&q&&U(this),o(this,Q,B)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(N){this._nativeAudioNode.channelCount=N}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(N){this._nativeAudioNode.channelCountMode=N}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(N){this._nativeAudioNode.channelInterpretation=N}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(N,q=0,B=0){if(q<0||q>=this._nativeAudioNode.numberOfOutputs)throw a();let Q=I(this._context),H=Y(Q);if(F(N)||P(N))throw d();if(ln(N)){let J=Nt(N);try{let Z=Tn(this._nativeAudioNode,J,q,B),K=ls(this);(H||K)&&this._nativeAudioNode.disconnect(...Z),this.context.state!=="closed"&&!K&&ls(N)&&U(N)}catch(Z){throw Z.code===12?d():Z}if(t(this,N,q,B,H)){let Z=E([this],N);jr(Z,s(H))}return N}let X=Li(N);if(X.name==="playbackRate")throw _();try{this._nativeAudioNode.connect(X,q),(H||ls(this))&&this._nativeAudioNode.disconnect(X,q)}catch(J){throw J.code===12?d():J}if(Eh(this,N,q,H)){let J=E([this],N);jr(J,s(H))}}disconnect(N,q,B){let Q,H=I(this._context),X=Y(H);if(N===void 0)Q=((J,Z)=>{let K=Zt(J),ct=[];for(let tt of K.outputs)wn(tt)?Fr(J,Z,...tt):Lr(J,Z,...tt),ct.push(tt[0]);return K.outputs.clear(),ct})(this,X);else if(typeof N=="number"){if(N<0||N>=this.numberOfOutputs)throw a();Q=((J,Z,K)=>{let ct=Zt(J),tt=[];for(let nt of ct.outputs)nt[1]===K&&(wn(nt)?Fr(J,Z,...nt):Lr(J,Z,...nt),tt.push(nt[0]),ct.outputs.delete(nt));return tt})(this,X,N)}else{if(q!==void 0&&(q<0||q>=this.numberOfOutputs)||ln(N)&&B!==void 0&&(B<0||B>=N.numberOfInputs))throw a();if(Q=((J,Z,K,ct,tt)=>{let nt=Zt(J);return Array.from(nt.outputs).filter(it=>!(it[0]!==K||ct!==void 0&&it[1]!==ct||tt!==void 0&&it[2]!==tt)).map(it=>(wn(it)?Fr(J,Z,...it):Lr(J,Z,...it),nt.outputs.delete(it),it[0]))})(this,X,N,q,B),Q.length===0)throw d()}for(let J of Q){let Z=E([this],J);jr(Z,O)}}})((la=y,(o,t,n)=>{let s=[];for(let a=0;a<n.numberOfInputs;a+=1)s.push(new Set);la.set(o,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:t})}),((o,t,n,s,a,d,_,O,E,D,I,A,F)=>(P,Y,N,q,B)=>{let{activeInputs:Q,passiveInputs:H}=d(Y),{outputs:X}=d(P),J=O(P),Z=K=>{let ct=E(Y),tt=E(P);if(K){let nt=z(H,P,N,q);o(Q,P,nt,!1),B||A(P)||n(tt,ct,N,q),F(Y)&&U(Y)}else{let nt=s(Q,P,N,q);t(H,q,nt,!1),B||A(P)||a(tt,ct,N,q);let it=_(Y);it===0?I(Y)&&at(Y,Q):setTimeout(()=>{I(Y)&&at(Y,Q)},1e3*it)}};return!!D(X,[Y,N,q],K=>K[0]===Y&&K[1]===N&&K[2]===q,!0)&&(J.add(Z),I(P)?o(Q,P,[N,q,Z],!0):t(H,q,[P,N,Z],!0),!0)})($h,Kh,Tn,tl,qn,Zt,el,W,Nt,tn,Ht,Nn,ls),je,((o,t,n,s,a,d)=>_=>(O,E)=>{let D=o.get(O);if(D===void 0){if(!_&&d(O)){let I=s(O),{outputs:A}=n(O);for(let F of A)if(wn(F)){let P=s(F[0]);t(I,P,F[1],F[2])}else{let P=a(F[0]);I.disconnect(P,F[1])}}o.set(O,E)}else o.set(O,D+E)})(k,qn,Zt,Nt,Li,Ht),st,ms,Se,((o,t,n,s,a,d,_,O)=>(E,D)=>{let I=t.get(E);if(I===void 0)throw new Error("Missing the expected cycle count.");let A=d(E.context),F=O(A);if(I===D){if(t.delete(E),!F&&_(E)){let P=s(E),{outputs:Y}=n(E);for(let N of Y)if(wn(N)){let q=s(N[0]);o(P,q,N[1],N[2])}else{let q=a(N[0]);P.connect(q,N[1])}}}else t.set(E,I-D)})(Tn,k,Zt,Nt,Li,Bt,Ht,qt),((o,t,n)=>function s(a,d){let _=ln(d)?d:n(o,d);if((E=>"delayTime"in E)(_))return[];if(a[0]===_)return[a];if(a.includes(_))return[];let{outputs:O}=t(_);return Array.from(O).map(E=>s([...a,_],E[0])).reduce((E,D)=>E.concat(D),[])})(oa,Zt,j),aa,Bt,Ur,Yr,ha,qt);var la;let il=((o,t,n,s,a,d)=>class extends o{constructor(_,O){let E=a(_),D={...lt,...O},I=s(E,D);super(_,!1,I,d(E)?t():null),this._nativeAnalyserNode=I}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(_){this._nativeAnalyserNode.fftSize=_}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(_){let O=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=_,!(_>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=O,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(_){let O=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=_,!(this._nativeAnalyserNode.maxDecibels>_))throw this._nativeAnalyserNode.minDecibels=O,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(_){this._nativeAnalyserNode.smoothingTimeConstant=_}getByteFrequencyData(_){this._nativeAnalyserNode.getByteFrequencyData(_)}getByteTimeDomainData(_){this._nativeAnalyserNode.getByteTimeDomainData(_)}getFloatFrequencyData(_){this._nativeAnalyserNode.getFloatFrequencyData(_)}getFloatTimeDomainData(_){this._nativeAnalyserNode.getFloatTimeDomainData(_)}})(te,nl,st,$o,Bt,qt),Hr=new WeakSet,ua=(o=>o===null?null:o.hasOwnProperty("AudioBuffer")?o.AudioBuffer:null)(Qe),pa=(Qr=new Uint32Array(1),o=>(Qr[0]=o,Qr[0]));var Qr;let Xr=((o,t)=>n=>{n.copyFromChannel=(s,a,d=0)=>{let _=o(d),O=o(a);if(O>=n.numberOfChannels)throw t();let E=n.length,D=n.getChannelData(O),I=s.length;for(let A=_<0?-_:0;A+_<E&&A<I;A+=1)s[A]=D[A+_]},n.copyToChannel=(s,a,d=0)=>{let _=o(d),O=o(a);if(O>=n.numberOfChannels)throw t();let E=n.length,D=n.getChannelData(O),I=s.length;for(let A=_<0?-_:0;A+_<E&&A<I;A+=1)D[A+_]=s[A]}})(pa,st),Zr=(o=>t=>{t.copyFromChannel=(n=>(s,a,d=0)=>{let _=o(d),O=o(a);if(_<t.length)return n.call(t,s,O,_)})(t.copyFromChannel),t.copyToChannel=(n=>(s,a,d=0)=>{let _=o(d),O=o(a);if(_<t.length)return n.call(t,s,O,_)})(t.copyToChannel)})(pa),sl=((o,t,n,s,a,d,_,O)=>{let E=null;return class Mc{constructor(I){if(a===null)throw new Error("Missing the native OfflineAudioContext constructor.");let{length:A,numberOfChannels:F,sampleRate:P}={...ut,...I};E===null&&(E=new a(1,1,44100));let Y=s!==null&&t(d,d)?new s({length:A,numberOfChannels:F,sampleRate:P}):E.createBuffer(F,A,P);if(Y.numberOfChannels===0)throw n();return typeof Y.copyFromChannel!="function"?(_(Y),Rt(Y)):t(ot,()=>ot(Y))||O(Y),o.add(Y),Y}static[Symbol.hasInstance](I){return I!==null&&typeof I=="object"&&Object.getPrototypeOf(I)===Mc.prototype||o.has(I)}}})(Hr,je,Se,ua,he,(Jr=ua,()=>{if(Jr===null)return!1;try{new Jr({length:1,sampleRate:44100})}catch{return!1}return!0}),Xr,Zr);var Jr;let _s=(da=ke,(o,t)=>{let n=da(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(o.destination);let s=()=>{t.removeEventListener("ended",s),t.disconnect(n),n.disconnect()};t.addEventListener("ended",s)});var da;let fa=((o,t,n)=>async(s,a,d,_)=>{let O=t(s);await Promise.all(Array.from(O.activeInputs).map(async([E,D])=>{let I=o(E),A=await I.render(E,a,_);n(E)||A.connect(d,D)}))})(Br,pe,Nn),en=(o=>(t,n,s,a)=>o(n,t,s,a))(fa),ei=((o,t,n,s,a,d,_,O,E,D,I)=>(A,F)=>{let P=A.createBufferSource();return oe(P,F),Jt(P,F,"playbackRate"),Qt(P,F,"buffer"),Qt(P,F,"loop"),Qt(P,F,"loopEnd"),Qt(P,F,"loopStart"),t(n,()=>n(A))||(Y=>{Y.start=(N=>{let q=!1;return(B=0,Q=0,H)=>{if(q)throw ie();N.call(Y,B,Q,H),q=!0}})(Y.start)})(P),t(s,()=>s(A))||E(P),t(a,()=>a(A))||D(P,A),t(d,()=>d(A))||qr(P),t(_,()=>_(A))||I(P,A),t(O,()=>O(A))||Nr(P),o(A,P),P})(_s,je,o=>{let t=o.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},o=>{let t=o.createBufferSource(),n=o.createBuffer(1,1,44100);t.buffer=n;try{t.start(0,1)}catch{return!1}return!0},o=>{let t=o.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},Vr,Qo,zr,o=>{var t;o.start=(t=o.start,(n=0,s=0,a)=>{let d=o.buffer,_=d===null?s:Math.min(d.duration,s);d!==null&&_>d.duration-.5/o.context.sampleRate?t.call(o,n,0,0):t.call(o,n,_,a)})},(ma=gs,(o,t)=>{let n=t.createBuffer(1,1,44100);o.buffer===null&&(o.buffer=n),ma(o,"buffer",s=>()=>{let a=s.call(o);return a===n?null:a},s=>a=>s.call(o,a===null?n:a))}),Xo);var ma;let nn=((o,t)=>(n,s,a,d)=>(o(s).replay(a),t(s,n,a,d)))((o=>t=>{let n=o(t);if(n.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(pe),fa),rl=((o,t,n,s,a)=>()=>{let d=new WeakMap,_=null,O=null;return{set start(E){_=E},set stop(E){O=E},render(E,D,I){let A=d.get(D);return A!==void 0?Promise.resolve(A):(async(F,P,Y)=>{let N=n(F),q=$(N,P);if(!q){let B={buffer:N.buffer,channelCount:N.channelCount,channelCountMode:N.channelCountMode,channelInterpretation:N.channelInterpretation,loop:N.loop,loopEnd:N.loopEnd,loopStart:N.loopStart,playbackRate:N.playbackRate.value};N=t(P,B),_!==null&&N.start(..._),O!==null&&N.stop(O)}return d.set(P,N),q?await o(P,F.playbackRate,N.playbackRate,Y):await s(P,F.playbackRate,N.playbackRate,Y),await a(F,P,N,Y),N})(E,D,I)}}})(en,ei,Nt,nn,ge),Xe=((o,t,n,s,a,d,_,O,E,D,I,A,F)=>(P,Y,N,q=null,B=null)=>{let Q=new f.AutomationEventList(N.defaultValue),H=Y?s(Q):null,X={get defaultValue(){return N.defaultValue},get maxValue(){return q===null?N.maxValue:q},get minValue(){return B===null?N.minValue:B},get value(){return N.value},set value(J){N.value=J,X.setValueAtTime(J,P.context.currentTime)},cancelAndHoldAtTime(J){if(typeof N.cancelAndHoldAtTime=="function")H===null&&Q.flush(P.context.currentTime),Q.add(a(J)),N.cancelAndHoldAtTime(J);else{let Z=Array.from(Q).pop();H===null&&Q.flush(P.context.currentTime),Q.add(a(J));let K=Array.from(Q).pop();N.cancelScheduledValues(J),Z!==K&&K!==void 0&&(K.type==="exponentialRampToValue"?N.exponentialRampToValueAtTime(K.value,K.endTime):K.type==="linearRampToValue"?N.linearRampToValueAtTime(K.value,K.endTime):K.type==="setValue"?N.setValueAtTime(K.value,K.startTime):K.type==="setValueCurve"&&N.setValueCurveAtTime(K.values,K.startTime,K.duration))}return X},cancelScheduledValues:J=>(H===null&&Q.flush(P.context.currentTime),Q.add(d(J)),N.cancelScheduledValues(J),X),exponentialRampToValueAtTime(J,Z){if(J===0)throw new RangeError;if(!Number.isFinite(Z)||Z<0)throw new RangeError;return H===null&&Q.flush(P.context.currentTime),Q.add(_(J,Z)),N.exponentialRampToValueAtTime(J,Z),X},linearRampToValueAtTime:(J,Z)=>(H===null&&Q.flush(P.context.currentTime),Q.add(O(J,Z)),N.linearRampToValueAtTime(J,Z),X),setTargetAtTime:(J,Z,K)=>(H===null&&Q.flush(P.context.currentTime),Q.add(E(J,Z,K)),N.setTargetAtTime(J,Z,K),X),setValueAtTime:(J,Z)=>(H===null&&Q.flush(P.context.currentTime),Q.add(D(J,Z)),N.setValueAtTime(J,Z),X),setValueCurveAtTime(J,Z,K){let ct=J instanceof Float32Array?J:new Float32Array(J);if(A!==null&&A.name==="webkitAudioContext"){let tt=Z+K,nt=P.context.sampleRate,it=Math.ceil(Z*nt),dt=Math.floor(tt*nt),yt=dt-it,At=new Float32Array(yt);for(let St=0;St<yt;St+=1){let Ot=(ct.length-1)/K*((it+St)/nt-Z),wt=Math.floor(Ot),kt=Math.ceil(Ot);At[St]=wt===kt?ct[wt]:(1-(Ot-wt))*ct[wt]+(1-(kt-Ot))*ct[kt]}H===null&&Q.flush(P.context.currentTime),Q.add(I(At,Z,K)),N.setValueCurveAtTime(At,Z,K);let gt=dt/nt;gt<tt&&F(X,At[At.length-1],gt),F(X,ct[ct.length-1],tt)}else H===null&&Q.flush(P.context.currentTime),Q.add(I(ct,Z,K)),N.setValueCurveAtTime(ct,Z,K);return X}};return n.set(X,N),t.set(X,P),o(X,H),X})((ga=u,(o,t)=>{ga.set(o,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})}),oa,x,o=>({replay(t){for(let n of o)if(n.type==="exponentialRampToValue"){let{endTime:s,value:a}=n;t.exponentialRampToValueAtTime(a,s)}else if(n.type==="linearRampToValue"){let{endTime:s,value:a}=n;t.linearRampToValueAtTime(a,s)}else if(n.type==="setTarget"){let{startTime:s,target:a,timeConstant:d}=n;t.setTargetAtTime(a,s,d)}else if(n.type==="setValue"){let{startTime:s,value:a}=n;t.setValueAtTime(a,s)}else{if(n.type!=="setValueCurve")throw new Error("Can't apply an unknown automation.");{let{duration:s,startTime:a,values:d}=n;t.setValueCurveAtTime(d,a,s)}}}}),f.createCancelAndHoldAutomationEvent,f.createCancelScheduledValuesAutomationEvent,f.createExponentialRampToValueAutomationEvent,f.createLinearRampToValueAutomationEvent,f.createSetTargetAutomationEvent,f.createSetValueAutomationEvent,f.createSetValueCurveAutomationEvent,pn,Ho);var ga;let ol=((o,t,n,s,a,d,_,O)=>class extends o{constructor(E,D){let I=d(E),A={...ne,...D},F=a(I,A),P=_(I),Y=P?t():null;super(E,!1,F,Y),this._audioBufferSourceNodeRenderer=Y,this._isBufferNullified=!1,this._isBufferSet=A.buffer!==null,this._nativeAudioBufferSourceNode=F,this._onended=null,this._playbackRate=n(this,P,F.playbackRate,Ft,pt)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(E){if(this._nativeAudioBufferSourceNode.buffer=E,E!==null){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(E){this._nativeAudioBufferSourceNode.loop=E}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(E){this._nativeAudioBufferSourceNode.loopEnd=E}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(E){this._nativeAudioBufferSourceNode.loopStart=E}get onended(){return this._onended}set onended(E){let D=typeof E=="function"?O(this,E):null;this._nativeAudioBufferSourceNode.onended=D;let I=this._nativeAudioBufferSourceNode.onended;this._onended=I!==null&&I===D?E:I}get playbackRate(){return this._playbackRate}start(E=0,D=0,I){if(this._nativeAudioBufferSourceNode.start(E,D,I),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=I===void 0?[E,D]:[E,D,I]),this.context.state!=="closed"){U(this);let A=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",A),Ht(this)&&et(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",A)}}stop(E=0){this._nativeAudioBufferSourceNode.stop(E),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=E)}})(te,rl,Xe,ie,ei,Bt,qt,ti),al=((o,t,n,s,a,d,_,O)=>class extends o{constructor(E,D){let I=d(E),A=_(I),F=a(I,D,A);super(E,!1,F,A?t(O):null),this._isNodeOfNativeOfflineAudioContext=A,this._nativeAudioDestinationNode=F}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(E){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(E>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=E}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(E){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=E}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(te,o=>{let t=null;return{render:(n,s,a)=>(t===null&&(t=(async(d,_,O)=>{let E=_.destination;return await o(d,_,E,O),E})(n,s,a)),t)}},st,ie,((o,t)=>(n,s,a)=>{let d=n.destination;if(d.channelCount!==s)try{d.channelCount=s}catch{}a&&d.channelCountMode!=="explicit"&&(d.channelCountMode="explicit"),d.maxChannelCount===0&&Object.defineProperty(d,"maxChannelCount",{value:s});let _=o(n,{channelCount:s,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,gain:1});return t(_,"channelCount",O=>()=>O.call(_),O=>E=>{O.call(_,E);try{d.channelCount=E}catch(D){if(E>d.maxChannelCount)throw D}}),t(_,"channelCountMode",O=>()=>O.call(_),O=>E=>{O.call(_,E),d.channelCountMode=E}),t(_,"channelInterpretation",O=>()=>O.call(_),O=>E=>{O.call(_,E),d.channelInterpretation=E}),Object.defineProperty(_,"maxChannelCount",{get:()=>d.maxChannelCount}),_.connect(d),_})(ke,gs),Bt,qt,ge),cl=((o,t,n,s,a)=>()=>{let d=new WeakMap;return{render(_,O,E){let D=d.get(O);return D!==void 0?Promise.resolve(D):(async(I,A,F)=>{let P=n(I),Y=$(P,A);if(!Y){let N={Q:P.Q.value,channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,detune:P.detune.value,frequency:P.frequency.value,gain:P.gain.value,type:P.type};P=t(A,N)}return d.set(A,P),Y?(await o(A,I.Q,P.Q,F),await o(A,I.detune,P.detune,F),await o(A,I.frequency,P.frequency,F),await o(A,I.gain,P.gain,F)):(await s(A,I.Q,P.Q,F),await s(A,I.detune,P.detune,F),await s(A,I.frequency,P.frequency,F),await s(A,I.gain,P.gain,F)),await a(I,A,P,F),P})(_,O,E)}}})(en,Bo,Nt,nn,ge),Vn=(o=>(t,n)=>o.set(t,n))(Jo),hl=(va=te,Bi=Xe,_a=cl,$r=ms,ya=Bo,ba=Bt,xa=qt,wa=Vn,class extends va{constructor(o,t){let n=ba(o),s={...Ah,...t},a=ya(n,s),d=xa(n);super(o,!1,a,d?_a():null),this._Q=Bi(this,d,a.Q,Ft,pt),this._detune=Bi(this,d,a.detune,1200*Math.log2(Ft),-1200*Math.log2(Ft)),this._frequency=Bi(this,d,a.frequency,o.sampleRate/2,0),this._gain=Bi(this,d,a.gain,40*Math.log10(Ft),pt),this._nativeBiquadFilterNode=a,wa(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(o){this._nativeBiquadFilterNode.type=o}getFrequencyResponse(o,t,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(o,t,n)}catch(s){throw s.code===11?$r():s}if(o.length!==t.length||t.length!==n.length)throw $r()}});var va,Bi,_a,$r,ya,ba,xa,wa;let Sn=((o,t)=>(n,s,a)=>{let d=new Set;var _,O;return n.connect=(_=n.connect,(E,D=0,I=0)=>{let A=d.size===0;if(t(E))return _.call(n,E,D,I),o(d,[E,D,I],F=>F[0]===E&&F[1]===D&&F[2]===I,!0),A&&s(),E;_.call(n,E,D),o(d,[E,D],F=>F[0]===E&&F[1]===D,!0),A&&s()}),n.disconnect=(O=n.disconnect,(E,D,I)=>{let A=d.size>0;if(E===void 0)O.apply(n),d.clear();else if(typeof E=="number"){O.call(n,E);for(let P of d)P[1]===E&&d.delete(P)}else{t(E)?O.call(n,E,D,I):O.call(n,E,D);for(let P of d)P[0]!==E||D!==void 0&&P[1]!==D||I!==void 0&&P[2]!==I||d.delete(P)}let F=d.size===0;A&&F&&a()}),n})(tn,Yr),ll=(Kr=ie,Ta=Sn,(o,t)=>{t.channelCount=1,t.channelCountMode="explicit",Object.defineProperty(t,"channelCount",{get:()=>1,set:()=>{throw Kr()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:()=>{throw Kr()}});let n=o.createBufferSource();Ta(t,()=>{let s=t.numberOfInputs;for(let a=0;a<s;a+=1)n.connect(t,0,a)},()=>n.disconnect(t))});var Kr,Ta;let Cn=((o,t)=>(n,s)=>{let a=n.createChannelMerger(s.numberOfInputs);return o!==null&&o.name==="webkitAudioContext"&&t(n,a),oe(a,s),a})(pn,ll),ul=((o,t,n,s,a)=>class extends o{constructor(d,_){let O=s(d),E={...Ph,..._};super(d,!1,n(O,E),a(O)?t():null)}})(te,((o,t,n)=>()=>{let s=new WeakMap;return{render(a,d,_){let O=s.get(d);return O!==void 0?Promise.resolve(O):(async(E,D,I)=>{let A=t(E);if(!$(A,D)){let F={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,numberOfInputs:A.numberOfInputs};A=o(D,F)}return s.set(D,A),await n(E,D,A,I),A})(a,d,_)}}})(Cn,Nt,ge),Cn,Bt,qt),pl=((o,t,n,s,a,d)=>class extends o{constructor(_,O){let E=s(_),D=d({...Ih,...O});super(_,!1,n(E,D),a(E)?t():null)}})(te,((o,t,n)=>()=>{let s=new WeakMap;return{render(a,d,_){let O=s.get(d);return O!==void 0?Promise.resolve(O):(async(E,D,I)=>{let A=t(E);if(!$(A,D)){let F={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,numberOfOutputs:A.numberOfOutputs};A=o(D,F)}return s.set(D,A),await n(E,D,A,I),A})(a,d,_)}}})(Ni,Nt,ge),Ni,Bt,qt,o=>({...o,channelCount:o.numberOfOutputs})),dl=((o,t,n,s)=>(a,{offset:d,..._})=>{let O=a.createBuffer(1,2,44100),E=t(a,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),D=n(a,{..._,gain:d}),I=O.getChannelData(0);I[0]=1,I[1]=1,E.buffer=O,E.loop=!0;let A={get bufferSize(){},get channelCount(){return D.channelCount},set channelCount(F){D.channelCount=F},get channelCountMode(){return D.channelCountMode},set channelCountMode(F){D.channelCountMode=F},get channelInterpretation(){return D.channelInterpretation},set channelInterpretation(F){D.channelInterpretation=F},get context(){return D.context},get inputs(){return[]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return D.numberOfOutputs},get offset(){return D.gain},get onended(){return E.onended},set onended(F){E.onended=F},addEventListener:(...F)=>E.addEventListener(F[0],F[1],F[2]),dispatchEvent:(...F)=>E.dispatchEvent(F[0]),removeEventListener:(...F)=>E.removeEventListener(F[0],F[1],F[2]),start(F=0){E.start.call(E,F)},stop(F=0){E.stop.call(E,F)}};return o(a,E),s(Kn(A,D),()=>E.connect(D),()=>E.disconnect(D))})(_s,ei,ke,Sn),ni=((o,t,n,s,a)=>(d,_)=>{if(d.createConstantSource===void 0)return n(d,_);let O=d.createConstantSource();return oe(O,_),Jt(O,_,"offset"),t(s,()=>s(d))||qr(O),t(a,()=>a(d))||Nr(O),o(d,O),O})(_s,je,dl,Vr,zr),fl=((o,t,n,s,a,d,_)=>class extends o{constructor(O,E){let D=a(O),I={...jh,...E},A=s(D,I),F=d(D),P=F?n():null;super(O,!1,A,P),this._constantSourceNodeRenderer=P,this._nativeConstantSourceNode=A,this._offset=t(this,F,A.offset,Ft,pt),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(O){let E=typeof O=="function"?_(this,O):null;this._nativeConstantSourceNode.onended=E;let D=this._nativeConstantSourceNode.onended;this._onended=D!==null&&D===E?O:D}start(O=0){if(this._nativeConstantSourceNode.start(O),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=O),this.context.state!=="closed"){U(this);let E=()=>{this._nativeConstantSourceNode.removeEventListener("ended",E),Ht(this)&&et(this)};this._nativeConstantSourceNode.addEventListener("ended",E)}}stop(O=0){this._nativeConstantSourceNode.stop(O),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=O)}})(te,Xe,((o,t,n,s,a)=>()=>{let d=new WeakMap,_=null,O=null;return{set start(E){_=E},set stop(E){O=E},render(E,D,I){let A=d.get(D);return A!==void 0?Promise.resolve(A):(async(F,P,Y)=>{let N=n(F),q=$(N,P);if(!q){let B={channelCount:N.channelCount,channelCountMode:N.channelCountMode,channelInterpretation:N.channelInterpretation,offset:N.offset.value};N=t(P,B),_!==null&&N.start(_),O!==null&&N.stop(O)}return d.set(P,N),q?await o(P,F.offset,N.offset,Y):await s(P,F.offset,N.offset,Y),await a(F,P,N,Y),N})(E,D,I)}}})(en,ni,Nt,nn,ge),ni,Bt,qt,ti),Sa=((o,t)=>(n,s)=>{let a=n.createConvolver();if(oe(a,s),s.disableNormalization===a.normalize&&(a.normalize=!s.disableNormalization),Qt(a,s,"buffer"),s.channelCount>2||(t(a,"channelCount",d=>()=>d.call(a),d=>_=>{if(_>2)throw o();return d.call(a,_)}),s.channelCountMode==="max"))throw o();return t(a,"channelCountMode",d=>()=>d.call(a),d=>_=>{if(_==="max")throw o();return d.call(a,_)}),a})(Se,gs),ml=((o,t,n,s,a,d)=>class extends o{constructor(_,O){let E=s(_),D={...Fh,...O},I=n(E,D);super(_,!1,I,a(E)?t():null),this._isBufferNullified=!1,this._nativeConvolverNode=I,D.buffer!==null&&d(this,D.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(_){if(this._nativeConvolverNode.buffer=_,_===null&&this._nativeConvolverNode.buffer!==null){let O=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=O.createBuffer(1,1,44100),this._isBufferNullified=!0,d(this,0)}else this._isBufferNullified=!1,d(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(_){this._nativeConvolverNode.normalize=_}})(te,((o,t,n)=>()=>{let s=new WeakMap;return{render(a,d,_){let O=s.get(d);return O!==void 0?Promise.resolve(O):(async(E,D,I)=>{let A=t(E);if(!$(A,D)){let F={buffer:A.buffer,channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,disableNormalization:!A.normalize};A=o(D,F)}return s.set(D,A),Ie(A)?await n(E,D,A.inputs[0],I):await n(E,D,A,I),A})(a,d,_)}}})(Sa,Nt,ge),Sa,Bt,qt,Vn),gl=((o,t,n,s,a,d,_)=>class extends o{constructor(O,E){let D=a(O),I={...Lh,...E},A=s(D,I),F=d(D);super(O,!1,A,F?n(I.maxDelayTime):null),this._delayTime=t(this,F,A.delayTime),_(this,I.maxDelayTime)}get delayTime(){return this._delayTime}})(te,Xe,((o,t,n,s,a)=>d=>{let _=new WeakMap;return{render(O,E,D){let I=_.get(E);return I!==void 0?Promise.resolve(I):(async(A,F,P)=>{let Y=n(A),N=$(Y,F);if(!N){let q={channelCount:Y.channelCount,channelCountMode:Y.channelCountMode,channelInterpretation:Y.channelInterpretation,delayTime:Y.delayTime.value,maxDelayTime:d};Y=t(F,q)}return _.set(F,Y),N?await o(F,A.delayTime,Y.delayTime,P):await s(F,A.delayTime,Y.delayTime,P),await a(A,F,Y,P),Y})(O,E,D)}}})(en,Wo,Nt,nn,ge),Wo,Bt,qt,Vn),Ca=(to=Se,(o,t)=>{let n=o.createDynamicsCompressor();if(oe(n,t),t.channelCount>2||t.channelCountMode==="max")throw to();return Jt(n,t,"attack"),Jt(n,t,"knee"),Jt(n,t,"ratio"),Jt(n,t,"release"),Jt(n,t,"threshold"),n});var to;let vl=((o,t,n,s,a,d,_,O)=>class extends o{constructor(E,D){let I=d(E),A={...qh,...D},F=s(I,A),P=_(I);super(E,!1,F,P?n():null),this._attack=t(this,P,F.attack),this._knee=t(this,P,F.knee),this._nativeDynamicsCompressorNode=F,this._ratio=t(this,P,F.ratio),this._release=t(this,P,F.release),this._threshold=t(this,P,F.threshold),O(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(E){let D=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=E,E>2)throw this._nativeDynamicsCompressorNode.channelCount=D,a()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(E){let D=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=E,E==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=D,a()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(te,Xe,((o,t,n,s,a)=>()=>{let d=new WeakMap;return{render(_,O,E){let D=d.get(O);return D!==void 0?Promise.resolve(D):(async(I,A,F)=>{let P=n(I),Y=$(P,A);if(!Y){let N={attack:P.attack.value,channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,knee:P.knee.value,ratio:P.ratio.value,release:P.release.value,threshold:P.threshold.value};P=t(A,N)}return d.set(A,P),Y?(await o(A,I.attack,P.attack,F),await o(A,I.knee,P.knee,F),await o(A,I.ratio,P.ratio,F),await o(A,I.release,P.release,F),await o(A,I.threshold,P.threshold,F)):(await s(A,I.attack,P.attack,F),await s(A,I.knee,P.knee,F),await s(A,I.ratio,P.ratio,F),await s(A,I.release,P.release,F),await s(A,I.threshold,P.threshold,F)),await a(I,A,P,F),P})(_,O,E)}}})(en,Ca,Nt,nn,ge),Ca,Se,Bt,qt,Vn),_l=((o,t,n,s,a,d)=>class extends o{constructor(_,O){let E=a(_),D={...Nh,...O},I=s(E,D),A=d(E);super(_,!1,I,A?n():null),this._gain=t(this,A,I.gain,Ft,pt)}get gain(){return this._gain}})(te,Xe,((o,t,n,s,a)=>()=>{let d=new WeakMap;return{render(_,O,E){let D=d.get(O);return D!==void 0?Promise.resolve(D):(async(I,A,F)=>{let P=n(I),Y=$(P,A);if(!Y){let N={channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,gain:P.gain.value};P=t(A,N)}return d.set(A,P),Y?await o(A,I.gain,P.gain,F):await s(A,I.gain,P.gain,F),await a(I,A,P,F),P})(_,O,E)}}})(en,ke,Nt,nn,ge),ke,Bt,qt),yl=((o,t,n,s)=>(a,d,{channelCount:_,channelCountMode:O,channelInterpretation:E,feedback:D,feedforward:I})=>{let A=zo(d,a.sampleRate),F=D instanceof Float64Array?D:new Float64Array(D),P=I instanceof Float64Array?I:new Float64Array(I),Y=F.length,N=P.length,q=Math.min(Y,N);if(Y===0||Y>20)throw s();if(F[0]===0)throw t();if(N===0||N>20)throw s();if(P[0]===0)throw t();if(F[0]!==1){for(let Z=0;Z<N;Z+=1)P[Z]/=F[0];for(let Z=1;Z<Y;Z+=1)F[Z]/=F[0]}let B=n(a,A,_,_);B.channelCount=_,B.channelCountMode=O,B.channelInterpretation=E;let Q=[],H=[],X=[];for(let Z=0;Z<_;Z+=1){Q.push(0);let K=new Float32Array(32),ct=new Float32Array(32);K.fill(0),ct.fill(0),H.push(K),X.push(ct)}B.onaudioprocess=Z=>{let K=Z.inputBuffer,ct=Z.outputBuffer,tt=K.numberOfChannels;for(let nt=0;nt<tt;nt+=1){let it=K.getChannelData(nt),dt=ct.getChannelData(nt);Q[nt]=No(F,Y,P,N,q,H[nt],X[nt],Q[nt],32,it,dt)}};let J=a.sampleRate/2;return Kn({get bufferSize(){return A},get channelCount(){return B.channelCount},set channelCount(Z){B.channelCount=Z},get channelCountMode(){return B.channelCountMode},set channelCountMode(Z){B.channelCountMode=Z},get channelInterpretation(){return B.channelInterpretation},set channelInterpretation(Z){B.channelInterpretation=Z},get context(){return B.context},get inputs(){return[B]},get numberOfInputs(){return B.numberOfInputs},get numberOfOutputs(){return B.numberOfOutputs},addEventListener:(...Z)=>B.addEventListener(Z[0],Z[1],Z[2]),dispatchEvent:(...Z)=>B.dispatchEvent(Z[0]),getFrequencyResponse(Z,K,ct){if(Z.length!==K.length||K.length!==ct.length)throw o();let tt=Z.length;for(let nt=0;nt<tt;nt+=1){let it=-Math.PI*(Z[nt]/J),dt=[Math.cos(it),Math.sin(it)],yt=Wh(Uo(P,dt),Uo(F,dt));K[nt]=Math.sqrt(yt[0]*yt[0]+yt[1]*yt[1]),ct[nt]=Math.atan2(yt[1],yt[0])}},removeEventListener:(...Z)=>B.removeEventListener(Z[0],Z[1],Z[2])},B)})(ms,ie,Vi,Se),ys=((o,t,n,s)=>a=>o(qi,()=>qi(a))?Promise.resolve(o(s,s)).then(d=>{if(!d){let _=n(a,512,0,1);a.oncomplete=()=>{_.onaudioprocess=null,_.disconnect()},_.onaudioprocess=()=>a.currentTime,_.connect(a.destination)}return a.startRendering()}):new Promise(d=>{let _=t(a,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});a.oncomplete=O=>{_.disconnect(),d(O.renderedBuffer)},_.connect(a.destination),a.startRendering()}))(je,ke,Vi,((o,t)=>()=>{if(t===null)return Promise.resolve(!1);let n=new t(1,1,44100),s=o(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(a=>{n.oncomplete=()=>{s.disconnect(),a(n.currentTime!==0)},n.startRendering()})})(ke,he)),bl=((o,t,n,s,a)=>(d,_)=>{let O=new WeakMap,E=null,D=async(I,A,F)=>{let P=null,Y=t(I),N=$(Y,A);if(A.createIIRFilter===void 0?P=o(A,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):N||(Y=A.createIIRFilter(_,d)),O.set(A,P===null?Y:P),P!==null){if(E===null){if(n===null)throw new Error("Missing the native OfflineAudioContext constructor.");let B=new n(I.context.destination.channelCount,I.context.length,A.sampleRate);E=(async()=>(await s(I,B,B.destination,F),((Q,H,X,J)=>{let Z=X instanceof Float64Array?X:new Float64Array(X),K=J instanceof Float64Array?J:new Float64Array(J),ct=Z.length,tt=K.length,nt=Math.min(ct,tt);if(Z[0]!==1){for(let gt=0;gt<ct;gt+=1)K[gt]/=Z[0];for(let gt=1;gt<tt;gt+=1)Z[gt]/=Z[0]}let it=new Float32Array(32),dt=new Float32Array(32),yt=H.createBuffer(Q.numberOfChannels,Q.length,Q.sampleRate),At=Q.numberOfChannels;for(let gt=0;gt<At;gt+=1){let St=Q.getChannelData(gt),Ot=yt.getChannelData(gt);it.fill(0),dt.fill(0),No(Z,ct,K,tt,nt,it,dt,0,32,St,Ot)}return yt})(await a(B),A,d,_)))()}let q=await E;return P.buffer=q,P.start(0),P}return await s(I,A,Y,F),Y};return{render(I,A,F){let P=O.get(A);return P!==void 0?Promise.resolve(P):D(I,A,F)}}})(ei,Nt,he,ge,ys);var ka;let xl=((o,t,n,s,a,d)=>class extends o{constructor(_,O){let E=s(_),D=a(E),I={...Vh,...O},A=t(E,D?null:_.baseLatency,I);super(_,!1,A,D?n(I.feedback,I.feedforward):null),(F=>{var P;F.getFrequencyResponse=(P=F.getFrequencyResponse,(Y,N,q)=>{if(Y.length!==N.length||N.length!==q.length)throw ms();return P.call(F,Y,N,q)})})(A),this._nativeIIRFilterNode=A,d(this,1)}getFrequencyResponse(_,O,E){return this._nativeIIRFilterNode.getFrequencyResponse(_,O,E)}})(te,(ka=yl,(o,t,n)=>{if(o.createIIRFilter===void 0)return ka(o,t,n);let s=o.createIIRFilter(n.feedforward,n.feedback);return oe(s,n),s}),bl,Bt,qt,Vn),wl=((o,t,n,s,a)=>(d,_)=>{let O=_.listener,{forwardX:E,forwardY:D,forwardZ:I,positionX:A,positionY:F,positionZ:P,upX:Y,upY:N,upZ:q}=O.forwardX===void 0?(()=>{let B=t(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),Q=a(_),H=s(_,256,9,0),X=(K,ct)=>{let tt=n(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:ct});return tt.connect(B,0,K),tt.start(),Object.defineProperty(tt.offset,"defaultValue",{get:()=>ct}),o({context:d},Q,tt.offset,Ft,pt)},J=[0,0,-1,0,1,0],Z=[0,0,0];return H.onaudioprocess=({inputBuffer:K})=>{let ct=[K.getChannelData(0)[0],K.getChannelData(1)[0],K.getChannelData(2)[0],K.getChannelData(3)[0],K.getChannelData(4)[0],K.getChannelData(5)[0]];ct.some((nt,it)=>nt!==J[it])&&(O.setOrientation(...ct),J=ct);let tt=[K.getChannelData(6)[0],K.getChannelData(7)[0],K.getChannelData(8)[0]];tt.some((nt,it)=>nt!==Z[it])&&(O.setPosition(...tt),Z=tt)},B.connect(H),{forwardX:X(0,0),forwardY:X(1,0),forwardZ:X(2,-1),positionX:X(6,0),positionY:X(7,0),positionZ:X(8,0),upX:X(3,0),upY:X(4,1),upZ:X(5,0)}})():O;return{get forwardX(){return E},get forwardY(){return D},get forwardZ(){return I},get positionX(){return A},get positionY(){return F},get positionZ(){return P},get upX(){return Y},get upY(){return N},get upZ(){return q}}})(Xe,Cn,ni,Vi,qt),Ma=new WeakMap,eo=((o,t,n,s,a,d)=>class extends n{constructor(_,O){super(_),this._nativeContext=_,w.set(this,_),s(_)&&a.set(_,new Set),this._destination=new o(this,O),this._listener=t(this,_),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(_){let O=typeof _=="function"?d(this,_):null;this._nativeContext.onstatechange=O;let E=this._nativeContext.onstatechange;this._onstatechange=E!==null&&E===O?_:E}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(al,wl,aa,qt,Ma,ti),Oa=((o,t,n,s,a,d)=>(_,O)=>{let E=_.createOscillator();return oe(E,O),Jt(E,O,"detune"),Jt(E,O,"frequency"),O.periodicWave!==void 0?E.setPeriodicWave(O.periodicWave):Qt(E,O,"type"),t(n,()=>n(_))||qr(E),t(s,()=>s(_))||d(E,_),t(a,()=>a(_))||Nr(E),o(_,E),E})(_s,je,Vr,Qo,zr,Xo),Tl=((o,t,n,s,a,d,_)=>class extends o{constructor(O,E){let D=a(O),I={...Gh,...E},A=n(D,I),F=d(D),P=F?s():null,Y=O.sampleRate/2;super(O,!1,A,P),this._detune=t(this,F,A.detune,153600,-153600),this._frequency=t(this,F,A.frequency,Y,-Y),this._nativeOscillatorNode=A,this._onended=null,this._oscillatorNodeRenderer=P,this._oscillatorNodeRenderer!==null&&I.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=I.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(O){let E=typeof O=="function"?_(this,O):null;this._nativeOscillatorNode.onended=E;let D=this._nativeOscillatorNode.onended;this._onended=D!==null&&D===E?O:D}get type(){return this._nativeOscillatorNode.type}set type(O){this._nativeOscillatorNode.type=O,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(O){this._nativeOscillatorNode.setPeriodicWave(O),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=O)}start(O=0){if(this._nativeOscillatorNode.start(O),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=O),this.context.state!=="closed"){U(this);let E=()=>{this._nativeOscillatorNode.removeEventListener("ended",E),Ht(this)&&et(this)};this._nativeOscillatorNode.addEventListener("ended",E)}}stop(O=0){this._nativeOscillatorNode.stop(O),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=O)}})(te,Xe,Oa,((o,t,n,s,a)=>()=>{let d=new WeakMap,_=null,O=null,E=null;return{set periodicWave(D){_=D},set start(D){O=D},set stop(D){E=D},render(D,I,A){let F=d.get(I);return F!==void 0?Promise.resolve(F):(async(P,Y,N)=>{let q=n(P),B=$(q,Y);if(!B){let Q={channelCount:q.channelCount,channelCountMode:q.channelCountMode,channelInterpretation:q.channelInterpretation,detune:q.detune.value,frequency:q.frequency.value,periodicWave:_===null?void 0:_,type:q.type};q=t(Y,Q),O!==null&&q.start(O),E!==null&&q.stop(E)}return d.set(Y,q),B?(await o(Y,P.detune,q.detune,N),await o(Y,P.frequency,q.frequency,N)):(await s(Y,P.detune,q.detune,N),await s(Y,P.frequency,q.frequency,N)),await a(P,Y,q,N),q})(D,I,A)}}})(en,Oa,Nt,nn,ge),Bt,qt,ti),Ea=(Ra=ei,(o,t)=>{let n=Ra(o,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),s=o.createBuffer(1,2,44100);return n.buffer=s,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}});var Ra;let Sl=((o,t,n,s,a)=>(d,{curve:_,oversample:O,...E})=>{let D=d.createWaveShaper(),I=d.createWaveShaper();oe(D,E),oe(I,E);let A=n(d,{...E,gain:1}),F=n(d,{...E,gain:-1}),P=n(d,{...E,gain:1}),Y=n(d,{...E,gain:-1}),N=null,q=!1,B=null,Q={get bufferSize(){},get channelCount(){return D.channelCount},set channelCount(H){A.channelCount=H,F.channelCount=H,D.channelCount=H,P.channelCount=H,I.channelCount=H,Y.channelCount=H},get channelCountMode(){return D.channelCountMode},set channelCountMode(H){A.channelCountMode=H,F.channelCountMode=H,D.channelCountMode=H,P.channelCountMode=H,I.channelCountMode=H,Y.channelCountMode=H},get channelInterpretation(){return D.channelInterpretation},set channelInterpretation(H){A.channelInterpretation=H,F.channelInterpretation=H,D.channelInterpretation=H,P.channelInterpretation=H,I.channelInterpretation=H,Y.channelInterpretation=H},get context(){return D.context},get curve(){return B},set curve(H){if(H!==null&&H.length<2)throw t();if(H===null)D.curve=H,I.curve=H;else{let X=H.length,J=new Float32Array(X+2-X%2),Z=new Float32Array(X+2-X%2);J[0]=H[0],Z[0]=-H[X-1];let K=Math.ceil((X+1)/2),ct=(X+1)/2-1;for(let tt=1;tt<K;tt+=1){let nt=tt/K*ct,it=Math.floor(nt),dt=Math.ceil(nt);J[tt]=it===dt?H[it]:(1-(nt-it))*H[it]+(1-(dt-nt))*H[dt],Z[tt]=it===dt?-H[X-1-it]:-(1-(nt-it))*H[X-1-it]-(1-(dt-nt))*H[X-1-dt]}J[K]=X%2==1?H[K-1]:(H[K-2]+H[K-1])/2,D.curve=J,I.curve=Z}B=H,q&&(s(B)&&N===null?N=o(d,A):N!==null&&(N(),N=null))},get inputs(){return[A]},get numberOfInputs(){return D.numberOfInputs},get numberOfOutputs(){return D.numberOfOutputs},get oversample(){return D.oversample},set oversample(H){D.oversample=H,I.oversample=H},addEventListener:(...H)=>A.addEventListener(H[0],H[1],H[2]),dispatchEvent:(...H)=>A.dispatchEvent(H[0]),removeEventListener:(...H)=>A.removeEventListener(H[0],H[1],H[2])};return _!==null&&(Q.curve=_ instanceof Float32Array?_:new Float32Array(_)),O!==Q.oversample&&(Q.oversample=O),a(Kn(Q,P),()=>{A.connect(D).connect(P),A.connect(F).connect(I).connect(Y).connect(P),q=!0,s(B)&&(N=o(d,A))},()=>{A.disconnect(D),D.disconnect(P),A.disconnect(F),F.disconnect(I),I.disconnect(Y),Y.disconnect(P),q=!1,N!==null&&(N(),N=null)})})(Ea,ie,ke,Yo,Sn),bs=((o,t,n,s,a,d,_)=>(O,E)=>{let D=O.createWaveShaper();if(d!==null&&d.name==="webkitAudioContext"&&O.createGain().gain.automationRate===void 0)return n(O,E);oe(D,E);let I=E.curve===null||E.curve instanceof Float32Array?E.curve:new Float32Array(E.curve);if(I!==null&&I.length<2)throw t();Qt(D,{curve:I},"curve"),Qt(D,E,"oversample");let A=null,F=!1;return _(D,"curve",P=>()=>P.call(D),P=>Y=>(P.call(D,Y),F&&(s(Y)&&A===null?A=o(O,D):s(Y)||A===null||(A(),A=null)),Y)),a(D,()=>{F=!0,s(D.curve)&&(A=o(O,D))},()=>{F=!1,A!==null&&(A(),A=null)})})(Ea,ie,Sl,Yo,Sn,pn,gs),Cl=((o,t,n,s,a,d,_,O,E)=>(D,{coneInnerAngle:I,coneOuterAngle:A,coneOuterGain:F,distanceModel:P,maxDistance:Y,orientationX:N,orientationY:q,orientationZ:B,panningModel:Q,positionX:H,positionY:X,positionZ:J,refDistance:Z,rolloffFactor:K,...ct})=>{let tt=D.createPanner();if(ct.channelCount>2||ct.channelCountMode==="max")throw _();oe(tt,ct);let nt={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},it=n(D,{...nt,channelInterpretation:"speakers",numberOfInputs:6}),dt=s(D,{...ct,gain:1}),yt=s(D,{...nt,gain:1}),At=s(D,{...nt,gain:0}),gt=s(D,{...nt,gain:0}),St=s(D,{...nt,gain:0}),Ot=s(D,{...nt,gain:0}),wt=s(D,{...nt,gain:0}),kt=a(D,256,6,1),Pt=d(D,{...nt,curve:new Float32Array([1,1]),oversample:"none"}),ee=[N,q,B],ce=[H,X,J];kt.onaudioprocess=({inputBuffer:vt})=>{let xe=[vt.getChannelData(0)[0],vt.getChannelData(1)[0],vt.getChannelData(2)[0]];xe.some((ze,Pn)=>ze!==ee[Pn])&&(tt.setOrientation(...xe),ee=xe);let hn=[vt.getChannelData(3)[0],vt.getChannelData(4)[0],vt.getChannelData(5)[0]];hn.some((ze,Pn)=>ze!==ce[Pn])&&(tt.setPosition(...hn),ce=hn)},Object.defineProperty(At.gain,"defaultValue",{get:()=>0}),Object.defineProperty(gt.gain,"defaultValue",{get:()=>0}),Object.defineProperty(St.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Ot.gain,"defaultValue",{get:()=>0}),Object.defineProperty(wt.gain,"defaultValue",{get:()=>0});let Et={get bufferSize(){},get channelCount(){return tt.channelCount},set channelCount(vt){if(vt>2)throw _();dt.channelCount=vt,tt.channelCount=vt},get channelCountMode(){return tt.channelCountMode},set channelCountMode(vt){if(vt==="max")throw _();dt.channelCountMode=vt,tt.channelCountMode=vt},get channelInterpretation(){return tt.channelInterpretation},set channelInterpretation(vt){dt.channelInterpretation=vt,tt.channelInterpretation=vt},get coneInnerAngle(){return tt.coneInnerAngle},set coneInnerAngle(vt){tt.coneInnerAngle=vt},get coneOuterAngle(){return tt.coneOuterAngle},set coneOuterAngle(vt){tt.coneOuterAngle=vt},get coneOuterGain(){return tt.coneOuterGain},set coneOuterGain(vt){if(vt<0||vt>1)throw t();tt.coneOuterGain=vt},get context(){return tt.context},get distanceModel(){return tt.distanceModel},set distanceModel(vt){tt.distanceModel=vt},get inputs(){return[dt]},get maxDistance(){return tt.maxDistance},set maxDistance(vt){if(vt<0)throw new RangeError;tt.maxDistance=vt},get numberOfInputs(){return tt.numberOfInputs},get numberOfOutputs(){return tt.numberOfOutputs},get orientationX(){return yt.gain},get orientationY(){return At.gain},get orientationZ(){return gt.gain},get panningModel(){return tt.panningModel},set panningModel(vt){tt.panningModel=vt},get positionX(){return St.gain},get positionY(){return Ot.gain},get positionZ(){return wt.gain},get refDistance(){return tt.refDistance},set refDistance(vt){if(vt<0)throw new RangeError;tt.refDistance=vt},get rolloffFactor(){return tt.rolloffFactor},set rolloffFactor(vt){if(vt<0)throw new RangeError;tt.rolloffFactor=vt},addEventListener:(...vt)=>dt.addEventListener(vt[0],vt[1],vt[2]),dispatchEvent:(...vt)=>dt.dispatchEvent(vt[0]),removeEventListener:(...vt)=>dt.removeEventListener(vt[0],vt[1],vt[2])};return I!==Et.coneInnerAngle&&(Et.coneInnerAngle=I),A!==Et.coneOuterAngle&&(Et.coneOuterAngle=A),F!==Et.coneOuterGain&&(Et.coneOuterGain=F),P!==Et.distanceModel&&(Et.distanceModel=P),Y!==Et.maxDistance&&(Et.maxDistance=Y),N!==Et.orientationX.value&&(Et.orientationX.value=N),q!==Et.orientationY.value&&(Et.orientationY.value=q),B!==Et.orientationZ.value&&(Et.orientationZ.value=B),Q!==Et.panningModel&&(Et.panningModel=Q),H!==Et.positionX.value&&(Et.positionX.value=H),X!==Et.positionY.value&&(Et.positionY.value=X),J!==Et.positionZ.value&&(Et.positionZ.value=J),Z!==Et.refDistance&&(Et.refDistance=Z),K!==Et.rolloffFactor&&(Et.rolloffFactor=K),ee[0]===1&&ee[1]===0&&ee[2]===0||tt.setOrientation(...ee),ce[0]===0&&ce[1]===0&&ce[2]===0||tt.setPosition(...ce),E(Kn(Et,tt),()=>{dt.connect(tt),o(dt,Pt,0,0),Pt.connect(yt).connect(it,0,0),Pt.connect(At).connect(it,0,1),Pt.connect(gt).connect(it,0,2),Pt.connect(St).connect(it,0,3),Pt.connect(Ot).connect(it,0,4),Pt.connect(wt).connect(it,0,5),it.connect(kt).connect(D.destination)},()=>{dt.disconnect(tt),O(dt,Pt,0,0),Pt.disconnect(yt),yt.disconnect(it),Pt.disconnect(At),At.disconnect(it),Pt.disconnect(gt),gt.disconnect(it),Pt.disconnect(St),St.disconnect(it),Pt.disconnect(Ot),Ot.disconnect(it),Pt.disconnect(wt),wt.disconnect(it),it.disconnect(kt),kt.disconnect(D.destination)})})(Tn,ie,Cn,ke,Vi,bs,Se,qn,Sn),Da=(Aa=Cl,(o,t)=>{let n=o.createPanner();return n.orientationX===void 0?Aa(o,t):(oe(n,t),Jt(n,t,"orientationX"),Jt(n,t,"orientationY"),Jt(n,t,"orientationZ"),Jt(n,t,"positionX"),Jt(n,t,"positionY"),Jt(n,t,"positionZ"),Qt(n,t,"coneInnerAngle"),Qt(n,t,"coneOuterAngle"),Qt(n,t,"coneOuterGain"),Qt(n,t,"distanceModel"),Qt(n,t,"maxDistance"),Qt(n,t,"panningModel"),Qt(n,t,"refDistance"),Qt(n,t,"rolloffFactor"),n)});var Aa;let kl=((o,t,n,s,a,d,_)=>class extends o{constructor(O,E){let D=a(O),I={...Yh,...E},A=n(D,I),F=d(D);super(O,!1,A,F?s():null),this._nativePannerNode=A,this._orientationX=t(this,F,A.orientationX,Ft,pt),this._orientationY=t(this,F,A.orientationY,Ft,pt),this._orientationZ=t(this,F,A.orientationZ,Ft,pt),this._positionX=t(this,F,A.positionX,Ft,pt),this._positionY=t(this,F,A.positionY,Ft,pt),this._positionZ=t(this,F,A.positionZ,Ft,pt),_(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(O){this._nativePannerNode.coneInnerAngle=O}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(O){this._nativePannerNode.coneOuterAngle=O}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(O){this._nativePannerNode.coneOuterGain=O}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(O){this._nativePannerNode.distanceModel=O}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(O){this._nativePannerNode.maxDistance=O}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(O){this._nativePannerNode.panningModel=O}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(O){this._nativePannerNode.refDistance=O}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(O){this._nativePannerNode.rolloffFactor=O}})(te,Xe,Da,((o,t,n,s,a,d,_,O,E,D)=>()=>{let I=new WeakMap,A=null;return{render(F,P,Y){let N=I.get(P);return N!==void 0?Promise.resolve(N):(async(q,B,Q)=>{let H=null,X=d(q),J={channelCount:X.channelCount,channelCountMode:X.channelCountMode,channelInterpretation:X.channelInterpretation},Z={...J,coneInnerAngle:X.coneInnerAngle,coneOuterAngle:X.coneOuterAngle,coneOuterGain:X.coneOuterGain,distanceModel:X.distanceModel,maxDistance:X.maxDistance,panningModel:X.panningModel,refDistance:X.refDistance,rolloffFactor:X.rolloffFactor},K=$(X,B);if("bufferSize"in X)H=s(B,{...J,gain:1});else if(!K){let ct={...Z,orientationX:X.orientationX.value,orientationY:X.orientationY.value,orientationZ:X.orientationZ.value,positionX:X.positionX.value,positionY:X.positionY.value,positionZ:X.positionZ.value};X=a(B,ct)}if(I.set(B,H===null?X:H),H!==null){if(A===null){if(_===null)throw new Error("Missing the native OfflineAudioContext constructor.");let gt=new _(6,q.context.length,B.sampleRate),St=t(gt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});St.connect(gt.destination),A=(async()=>{let Ot=await Promise.all([q.orientationX,q.orientationY,q.orientationZ,q.positionX,q.positionY,q.positionZ].map(async(wt,kt)=>{let Pt=n(gt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:kt===0?1:0});return await O(gt,wt,Pt.offset,Q),Pt}));for(let wt=0;wt<6;wt+=1)Ot[wt].connect(St,0,wt),Ot[wt].start(0);return D(gt)})()}let ct=await A,tt=s(B,{...J,gain:1});await E(q,B,tt,Q);let nt=[];for(let gt=0;gt<ct.numberOfChannels;gt+=1)nt.push(ct.getChannelData(gt));let it=[nt[0][0],nt[1][0],nt[2][0]],dt=[nt[3][0],nt[4][0],nt[5][0]],yt=s(B,{...J,gain:1}),At=a(B,{...Z,orientationX:it[0],orientationY:it[1],orientationZ:it[2],positionX:dt[0],positionY:dt[1],positionZ:dt[2]});tt.connect(yt).connect(At.inputs[0]),At.connect(H);for(let gt=128;gt<ct.length;gt+=128){let St=[nt[0][gt],nt[1][gt],nt[2][gt]],Ot=[nt[3][gt],nt[4][gt],nt[5][gt]];if(St.some((wt,kt)=>wt!==it[kt])||Ot.some((wt,kt)=>wt!==dt[kt])){it=St,dt=Ot;let wt=gt/B.sampleRate;yt.gain.setValueAtTime(0,wt),yt=s(B,{...J,gain:0}),At=a(B,{...Z,orientationX:it[0],orientationY:it[1],orientationZ:it[2],positionX:dt[0],positionY:dt[1],positionZ:dt[2]}),yt.gain.setValueAtTime(1,wt),tt.connect(yt).connect(At.inputs[0]),At.connect(H)}}return H}return K?(await o(B,q.orientationX,X.orientationX,Q),await o(B,q.orientationY,X.orientationY,Q),await o(B,q.orientationZ,X.orientationZ,Q),await o(B,q.positionX,X.positionX,Q),await o(B,q.positionY,X.positionY,Q),await o(B,q.positionZ,X.positionZ,Q)):(await O(B,q.orientationX,X.orientationX,Q),await O(B,q.orientationY,X.orientationY,Q),await O(B,q.orientationZ,X.orientationZ,Q),await O(B,q.positionX,X.positionX,Q),await O(B,q.positionY,X.positionY,Q),await O(B,q.positionZ,X.positionZ,Q)),Ie(X)?await E(q,B,X.inputs[0],Q):await E(q,B,X,Q),X})(F,P,Y)}}})(en,Cn,ni,ke,Da,Nt,he,nn,ge,ys),Bt,qt,Vn),Ml=((o,t,n,s)=>class Oc{constructor(d,_){let O=t(d),E=s({...Hh,..._}),D=o(O,E);return n.add(D),D}static[Symbol.hasInstance](d){return d!==null&&typeof d=="object"&&Object.getPrototypeOf(d)===Oc.prototype||n.has(d)}})((o=>(t,{disableNormalization:n,imag:s,real:a})=>{let d=s instanceof Float32Array?s:new Float32Array(s),_=a instanceof Float32Array?a:new Float32Array(a),O=t.createPeriodicWave(_,d,{disableNormalization:n});if(Array.from(s).length<2)throw o();return O})(st),Bt,new WeakSet,o=>{let{imag:t,real:n}=o;return t===void 0?n===void 0?{...o,imag:[0,0],real:[0,0]}:{...o,imag:Array.from(n,()=>0),real:n}:n===void 0?{...o,imag:t,real:Array.from(t,()=>0)}:{...o,imag:t,real:n}}),Pa=((o,t)=>(n,s)=>{let a=s.channelCountMode;if(a==="clamped-max")throw t();if(n.createStereoPanner===void 0)return o(n,s);let d=n.createStereoPanner();return oe(d,s),Jt(d,s,"pan"),Object.defineProperty(d,"channelCountMode",{get:()=>a,set:_=>{if(_!==a)throw t()}}),d})(((o,t,n,s,a,d)=>{let _=new Float32Array([1,1]),O=Math.PI/2,E={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},D={...E,oversample:"none"},I=(A,F,P,Y,N)=>{if(F===1)return((q,B,Q,H)=>{let X=new Float32Array(16385),J=new Float32Array(16385);for(let it=0;it<16385;it+=1){let dt=it/16384*O;X[it]=Math.cos(dt),J[it]=Math.sin(dt)}let Z=n(q,{...E,gain:0}),K=s(q,{...D,curve:X}),ct=s(q,{...D,curve:_}),tt=n(q,{...E,gain:0}),nt=s(q,{...D,curve:J});return{connectGraph(){B.connect(Z),B.connect(ct.inputs===void 0?ct:ct.inputs[0]),B.connect(tt),ct.connect(Q),Q.connect(K.inputs===void 0?K:K.inputs[0]),Q.connect(nt.inputs===void 0?nt:nt.inputs[0]),K.connect(Z.gain),nt.connect(tt.gain),Z.connect(H,0,0),tt.connect(H,0,1)},disconnectGraph(){B.disconnect(Z),B.disconnect(ct.inputs===void 0?ct:ct.inputs[0]),B.disconnect(tt),ct.disconnect(Q),Q.disconnect(K.inputs===void 0?K:K.inputs[0]),Q.disconnect(nt.inputs===void 0?nt:nt.inputs[0]),K.disconnect(Z.gain),nt.disconnect(tt.gain),Z.disconnect(H,0,0),tt.disconnect(H,0,1)}}})(A,P,Y,N);if(F===2)return((q,B,Q,H)=>{let X=new Float32Array(16385),J=new Float32Array(16385),Z=new Float32Array(16385),K=new Float32Array(16385),ct=Math.floor(8192.5);for(let kt=0;kt<16385;kt+=1)if(kt>ct){let Pt=(kt-ct)/(16384-ct)*O;X[kt]=Math.cos(Pt),J[kt]=Math.sin(Pt),Z[kt]=0,K[kt]=1}else{let Pt=kt/(16384-ct)*O;X[kt]=1,J[kt]=0,Z[kt]=Math.cos(Pt),K[kt]=Math.sin(Pt)}let tt=t(q,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),nt=n(q,{...E,gain:0}),it=s(q,{...D,curve:X}),dt=n(q,{...E,gain:0}),yt=s(q,{...D,curve:J}),At=s(q,{...D,curve:_}),gt=n(q,{...E,gain:0}),St=s(q,{...D,curve:Z}),Ot=n(q,{...E,gain:0}),wt=s(q,{...D,curve:K});return{connectGraph(){B.connect(tt),B.connect(At.inputs===void 0?At:At.inputs[0]),tt.connect(nt,0),tt.connect(dt,0),tt.connect(gt,1),tt.connect(Ot,1),At.connect(Q),Q.connect(it.inputs===void 0?it:it.inputs[0]),Q.connect(yt.inputs===void 0?yt:yt.inputs[0]),Q.connect(St.inputs===void 0?St:St.inputs[0]),Q.connect(wt.inputs===void 0?wt:wt.inputs[0]),it.connect(nt.gain),yt.connect(dt.gain),St.connect(gt.gain),wt.connect(Ot.gain),nt.connect(H,0,0),gt.connect(H,0,0),dt.connect(H,0,1),Ot.connect(H,0,1)},disconnectGraph(){B.disconnect(tt),B.disconnect(At.inputs===void 0?At:At.inputs[0]),tt.disconnect(nt,0),tt.disconnect(dt,0),tt.disconnect(gt,1),tt.disconnect(Ot,1),At.disconnect(Q),Q.disconnect(it.inputs===void 0?it:it.inputs[0]),Q.disconnect(yt.inputs===void 0?yt:yt.inputs[0]),Q.disconnect(St.inputs===void 0?St:St.inputs[0]),Q.disconnect(wt.inputs===void 0?wt:wt.inputs[0]),it.disconnect(nt.gain),yt.disconnect(dt.gain),St.disconnect(gt.gain),wt.disconnect(Ot.gain),nt.disconnect(H,0,0),gt.disconnect(H,0,0),dt.disconnect(H,0,1),Ot.disconnect(H,0,1)}}})(A,P,Y,N);throw a()};return(A,{channelCount:F,channelCountMode:P,pan:Y,...N})=>{if(P==="max")throw a();let q=o(A,{...N,channelCount:1,channelCountMode:P,numberOfInputs:2}),B=n(A,{...N,channelCount:F,channelCountMode:P,gain:1}),Q=n(A,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:Y}),{connectGraph:H,disconnectGraph:X}=I(A,F,B,Q,q);Object.defineProperty(Q.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Q.gain,"maxValue",{get:()=>1}),Object.defineProperty(Q.gain,"minValue",{get:()=>-1});let J={get bufferSize(){},get channelCount(){return B.channelCount},set channelCount(K){B.channelCount!==K&&(Z&&X(),{connectGraph:H,disconnectGraph:X}=I(A,K,B,Q,q),Z&&H()),B.channelCount=K},get channelCountMode(){return B.channelCountMode},set channelCountMode(K){if(K==="clamped-max"||K==="max")throw a();B.channelCountMode=K},get channelInterpretation(){return B.channelInterpretation},set channelInterpretation(K){B.channelInterpretation=K},get context(){return B.context},get inputs(){return[B]},get numberOfInputs(){return B.numberOfInputs},get numberOfOutputs(){return B.numberOfOutputs},get pan(){return Q.gain},addEventListener:(...K)=>B.addEventListener(K[0],K[1],K[2]),dispatchEvent:(...K)=>B.dispatchEvent(K[0]),removeEventListener:(...K)=>B.removeEventListener(K[0],K[1],K[2])},Z=!1;return d(Kn(J,q),()=>{H(),Z=!0},()=>{X(),Z=!1})}})(Cn,Ni,ke,bs,Se,Sn),Se),Ol=((o,t,n,s,a,d)=>class extends o{constructor(_,O){let E=a(_),D={...Qh,...O},I=n(E,D),A=d(E);super(_,!1,I,A?s():null),this._pan=t(this,A,I.pan)}get pan(){return this._pan}})(te,Xe,Pa,((o,t,n,s,a)=>()=>{let d=new WeakMap;return{render(_,O,E){let D=d.get(O);return D!==void 0?Promise.resolve(D):(async(I,A,F)=>{let P=n(I),Y=$(P,A);if(!Y){let N={channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,pan:P.pan.value};P=t(A,N)}return d.set(A,P),Y?await o(A,I.pan,P.pan,F):await s(A,I.pan,P.pan,F),Ie(P)?await a(I,A,P.inputs[0],F):await a(I,A,P,F),P})(_,O,E)}}})(en,Pa,Nt,nn,ge),Bt,qt),El=((o,t,n)=>()=>{let s=new WeakMap;return{render(a,d,_){let O=s.get(d);return O!==void 0?Promise.resolve(O):(async(E,D,I)=>{let A=t(E);if(!$(A,D)){let F={channelCount:A.channelCount,channelCountMode:A.channelCountMode,channelInterpretation:A.channelInterpretation,curve:A.curve,oversample:A.oversample};A=o(D,F)}return s.set(D,A),Ie(A)?await n(E,D,A.inputs[0],I):await n(E,D,A,I),A})(a,d,_)}}})(bs,Nt,ge),Rl=((o,t,n,s,a,d,_)=>class extends o{constructor(O,E){let D=a(O),I={...Xh,...E},A=n(D,I);super(O,!0,A,d(D)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=A,_(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(O){if(O===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(O.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=O}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(O){this._nativeWaveShaperNode.oversample=O}})(te,ie,bs,El,Bt,qt,Vn),Ia=(o=>o!==null&&o.isSecureContext)(Qe),no=(o=>(t,n,s)=>{Object.defineProperties(o,{currentFrame:{configurable:!0,get:()=>Math.round(t*n)},currentTime:{configurable:!0,get:()=>t}});try{return s()}finally{o!==null&&(delete o.currentFrame,delete o.currentTime)}})(Qe),ja=new WeakMap,Dl=((o,t)=>n=>{let s=o.get(n);if(s!==void 0)return s;if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new t(1,1,8e3),o.set(n,s),s})(ja,he),xs=(o=>o===null?null:o.hasOwnProperty("AudioWorkletNode")?o.AudioWorkletNode:null)(Qe),Al=Ia?((o,t,n,s,a,d,_,O,E,D,I,A)=>(F,P,Y={credentials:"omit"})=>{let N=d(F);if(N.audioWorklet!==void 0)return Promise.all([a(P),Promise.resolve(o(I,I))]).then(([[H,X],J])=>{let[Z,K]=l(H,X),ct=J?K:K.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),tt=new Blob([`${Z};(registerProcessor=>{${ct}
})((n,p)=>registerProcessor(n,class extends p{${J?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${J?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),nt=URL.createObjectURL(tt);return N.audioWorklet.addModule(nt,Y).then(()=>{if(!O(N))return _(N).audioWorklet.addModule(nt,Y)}).finally(()=>URL.revokeObjectURL(nt))});let q=D.get(F);if(q!==void 0&&q.has(P))return Promise.resolve();let B=E.get(F);if(B!==void 0){let H=B.get(P);if(H!==void 0)return H}let Q=a(P).then(([H,X])=>{let[J,Z]=l(H,X);return n(`${J};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${Z}
})})(window,'_AWGS')`)}).then(()=>{let H=A._AWGS.pop();if(H===void 0)throw new SyntaxError;s(N.currentTime,N.sampleRate,()=>H(class{},void 0,(X,J)=>{if(X.trim()==="")throw t();let Z=b.get(N);if(Z!==void 0){if(Z.has(X))throw t();R(J),C(J.parameterDescriptors),Z.set(X,J)}else R(J),C(J.parameterDescriptors),b.set(N,new Map([[X,J]]))},N.sampleRate,void 0,void 0))});return B===void 0?E.set(F,new Map([[P,Q]])):B.set(P,Q),Q.then(()=>{let H=D.get(F);H===void 0?D.set(F,new Set([P])):H.add(P)}).finally(()=>{let H=E.get(F);H!==void 0&&H.delete(P)}),Q})(je,Se,(o=>t=>new Promise((n,s)=>{if(o===null)return void s(new SyntaxError);let a=o.document.head;if(a===null)s(new SyntaxError);else{let d=o.document.createElement("script"),_=new Blob([t],{type:"application/javascript"}),O=URL.createObjectURL(_),E=o.onerror,D=()=>{o.onerror=E,URL.revokeObjectURL(O)};o.onerror=(I,A,F,P,Y)=>A===O||A===o.location.href&&F===1&&P===1?(D(),s(Y),!1):E!==null?E(I,A,F,P,Y):void 0,d.onerror=()=>{D(),s(new SyntaxError)},d.onload=()=>{D(),n()},d.src=O,d.type="module",a.appendChild(d)}}))(Qe),no,(o=>async t=>{try{let n=await fetch(t);if(n.ok)return[await n.text(),n.url]}catch{}throw o()})(()=>new DOMException("","AbortError")),Bt,Dl,qt,new WeakMap,new WeakMap,((o,t)=>async()=>{if(o===null)return!0;if(t===null)return!1;let n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,8e3),a=URL.createObjectURL(n),d=!1,_=!1;try{await s.audioWorklet.addModule(a);let O=new o(s,"a",{numberOfOutputs:0}),E=s.createOscillator();O.port.onmessage=()=>d=!0,O.onprocessorerror=()=>_=!0,E.connect(O),await s.startRendering()}catch{}finally{URL.revokeObjectURL(a)}return d&&!_})(xs,he),Qe):void 0,Pl=((o,t)=>n=>o(n)||t(n))(Ur,qt),Fa=((o,t,n,s,a,d,_,O,E,D,I,A,F,P,Y,N,q,B,Q,H)=>class extends Y{constructor(X,J){super(X,J),this._nativeContext=X,this._audioWorklet=o===void 0?void 0:{addModule:(Z,K)=>o(this,Z,K)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new a(this)}createBuffer(X,J,Z){return new n({length:J,numberOfChannels:X,sampleRate:Z})}createBufferSource(){return new s(this)}createChannelMerger(X=6){return new d(this,{numberOfInputs:X})}createChannelSplitter(X=6){return new _(this,{numberOfOutputs:X})}createConstantSource(){return new O(this)}createConvolver(){return new E(this)}createDelay(X=1){return new I(this,{maxDelayTime:X})}createDynamicsCompressor(){return new A(this)}createGain(){return new F(this)}createIIRFilter(X,J){return new P(this,{feedback:J,feedforward:X})}createOscillator(){return new N(this)}createPanner(){return new q(this)}createPeriodicWave(X,J,Z={disableNormalization:!1}){return new B(this,{...Z,imag:J,real:X})}createStereoPanner(){return new Q(this)}createWaveShaper(){return new H(this)}decodeAudioData(X,J,Z){return D(this._nativeContext,X).then(K=>(typeof J=="function"&&J(K),K)).catch(K=>{throw typeof Z=="function"&&Z(K),K})}})(Al,il,sl,ol,hl,ul,pl,fl,ml,((o,t,n,s,a,d,_,O,E,D,I)=>(A,F)=>{let P=_(A)?A:d(A);if(a.has(F)){let Y=n();return Promise.reject(Y)}try{a.add(F)}catch{}return t(E,()=>E(P))?P.decodeAudioData(F).then(Y=>(t(O,()=>O(Y))||I(Y),o.add(Y),Y)):new Promise((Y,N)=>{let q=()=>{try{(Q=>{let{port1:H}=new MessageChannel;H.postMessage(Q,[Q])})(F)}catch{}},B=Q=>{N(Q),q()};try{P.decodeAudioData(F,Q=>{typeof Q.copyFromChannel!="function"&&(D(Q),Rt(Q)),o.add(Q),q(),Y(Q)},Q=>{B(Q===null?s():Q)})}catch(Q){B(Q)}})})(Hr,je,()=>new DOMException("","DataCloneError"),()=>new DOMException("","EncodingError"),new WeakSet,Bt,Pl,ot,qi,Xr,Zr),gl,vl,_l,xl,eo,Tl,kl,Ml,Ol,Rl),Il=((o,t,n,s)=>class extends o{constructor(a,d){let _=n(a),O=t(_,d);if(s(_))throw TypeError();super(a,!0,O,null),this._nativeMediaElementAudioSourceNode=O}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(te,(o,t)=>o.createMediaElementSource(t.mediaElement),Bt,qt),jl=((o,t,n,s)=>class extends o{constructor(a,d){let _=n(a);if(s(_))throw new TypeError;let O={...zh,...d},E=t(_,O);super(a,!1,E,null),this._nativeMediaStreamAudioDestinationNode=E}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(te,(o,t)=>{let n=o.createMediaStreamDestination();return oe(n,t),n.numberOfOutputs===1&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},Bt,qt),Fl=((o,t,n,s)=>class extends o{constructor(a,d){let _=n(a),O=t(_,d);if(s(_))throw new TypeError;super(a,!0,O,null),this._nativeMediaStreamAudioSourceNode=O}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(te,(o,{mediaStream:t})=>{let n=t.getAudioTracks();n.sort((d,_)=>d.id<_.id?-1:d.id>_.id?1:0);let s=n.slice(0,1),a=o.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(a,"mediaStream",{value:t}),a},Bt,qt),Ll=((o,t,n)=>class extends o{constructor(s,a){let d=n(s);super(s,!0,t(d,a),null)}})(te,((o,t)=>(n,{mediaStreamTrack:s})=>{if(typeof n.createMediaStreamTrackSource=="function")return n.createMediaStreamTrackSource(s);let a=new MediaStream([s]),d=n.createMediaStreamSource(a);if(s.kind!=="audio")throw o();if(t(n))throw new TypeError;return d})(ie,qt),Bt),ql=((o,t,n,s,a,d,_,O,E)=>class extends o{constructor(D={}){if(E===null)throw new Error("Missing the native AudioContext constructor.");let I=new E(D);if(I===null)throw s();if(!Pe(D.latencyHint))throw new TypeError(`The provided value '${D.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(D.sampleRate!==void 0&&I.sampleRate!==D.sampleRate)throw n();super(I,2);let{latencyHint:A}=D,{sampleRate:F}=I;if(this._baseLatency=typeof I.baseLatency=="number"?I.baseLatency:A==="balanced"?512/F:A==="interactive"||A===void 0?256/F:A==="playback"?1024/F:128*Math.max(2,Math.min(128,Math.round(A*F/128)))/F,this._nativeAudioContext=I,E.name==="webkitAudioContext"?(this._nativeGainNode=I.createGain(),this._nativeOscillatorNode=I.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(I.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,I.state==="running"){this._state="suspended";let P=()=>{this._state==="suspended"&&(this._state=null),I.removeEventListener("statechange",P)};I.addEventListener("statechange",P)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw t()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),fe(this)}))}createMediaElementSource(D){return new a(this,{mediaElement:D})}createMediaStreamDestination(){return new d(this)}createMediaStreamSource(D){return new _(this,{mediaStream:D})}createMediaStreamTrackSource(D){return new O(this,{mediaStreamTrack:D})}resume(){return this._state==="suspended"?new Promise((D,I)=>{let A=()=>{this._nativeAudioContext.removeEventListener("statechange",A),this._nativeAudioContext.state==="running"?D():this.resume().then(D,I)};this._nativeAudioContext.addEventListener("statechange",A)}):this._nativeAudioContext.resume().catch(D=>{throw D===void 0||D.code===15?t():D})}suspend(){return this._nativeAudioContext.suspend().catch(D=>{throw D===void 0?t():D})}})(Fa,ie,Se,Go,Il,jl,Fl,Ll,pn),io=(La=Ma,o=>{let t=La.get(o);if(t===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return t});var La;let Nl=(qa=io,(o,t)=>{qa(o).add(t)});var qa;let Na=(o=>(t,n,s=0,a=0)=>{let d=t[s];if(d===void 0)throw o();return us(n)?d.connect(n,0,a):d.connect(n,0)})(st),Vl=(o=>(t,n)=>{o(t).delete(n)})(io),Va=(o=>(t,n,s,a=0)=>n===void 0?t.forEach(d=>d.disconnect()):typeof n=="number"?fs(o,t,n).disconnect():us(n)?s===void 0?t.forEach(d=>d.disconnect(n)):a===void 0?fs(o,t,s).disconnect(n,0):fs(o,t,s).disconnect(n,0,a):s===void 0?t.forEach(d=>d.disconnect(n)):fs(o,t,s).disconnect(n,0))(st),za=new WeakMap,zl=((o,t)=>n=>t(o,n))(za,j),Bl=((o,t,n,s,a,d,_,O,E,D,I,A,F)=>(P,Y,N,q)=>{if(q.numberOfInputs===0&&q.numberOfOutputs===0)throw E();let B=Array.isArray(q.outputChannelCount)?q.outputChannelCount:Array.from(q.outputChannelCount);if(B.some(ht=>ht<1))throw E();if(B.length!==q.numberOfOutputs)throw t();if(q.channelCountMode!=="explicit")throw E();let Q=q.channelCount*q.numberOfInputs,H=B.reduce((ht,jt)=>ht+jt,0),X=N.parameterDescriptors===void 0?0:N.parameterDescriptors.length;if(Q+X>6||H>6)throw E();let J=new MessageChannel,Z=[],K=[];for(let ht=0;ht<q.numberOfInputs;ht+=1)Z.push(_(P,{channelCount:q.channelCount,channelCountMode:q.channelCountMode,channelInterpretation:q.channelInterpretation,gain:1})),K.push(a(P,{channelCount:q.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:q.channelCount}));let ct=[];if(N.parameterDescriptors!==void 0)for(let{defaultValue:ht,maxValue:jt,minValue:we,name:Xt}of N.parameterDescriptors){let It=d(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:q.parameterData[Xt]!==void 0?q.parameterData[Xt]:ht===void 0?0:ht});Object.defineProperties(It.offset,{defaultValue:{get:()=>ht===void 0?0:ht},maxValue:{get:()=>jt===void 0?Ft:jt},minValue:{get:()=>we===void 0?pt:we}}),ct.push(It)}let tt=s(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,Q+X)}),nt=zo(Y,P.sampleRate),it=O(P,nt,Q+X,Math.max(1,H)),dt=a(P,{channelCount:Math.max(1,H),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,H)}),yt=[];for(let ht=0;ht<q.numberOfOutputs;ht+=1)yt.push(s(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:B[ht]}));for(let ht=0;ht<q.numberOfInputs;ht+=1){Z[ht].connect(K[ht]);for(let jt=0;jt<q.channelCount;jt+=1)K[ht].connect(tt,jt,ht*q.channelCount+jt)}let At=new Lo(N.parameterDescriptors===void 0?[]:N.parameterDescriptors.map(({name:ht},jt)=>{let we=ct[jt];return we.connect(tt,0,Q+jt),we.start(0),[ht,we.offset]}));tt.connect(it);let gt=q.channelInterpretation,St=null,Ot=q.numberOfOutputs===0?[it]:yt,wt={get bufferSize(){return nt},get channelCount(){return q.channelCount},set channelCount(ht){throw n()},get channelCountMode(){return q.channelCountMode},set channelCountMode(ht){throw n()},get channelInterpretation(){return gt},set channelInterpretation(ht){for(let jt of Z)jt.channelInterpretation=ht;gt=ht},get context(){return it.context},get inputs(){return Z},get numberOfInputs(){return q.numberOfInputs},get numberOfOutputs(){return q.numberOfOutputs},get onprocessorerror(){return St},set onprocessorerror(ht){typeof St=="function"&&wt.removeEventListener("processorerror",St),St=typeof ht=="function"?ht:null,typeof St=="function"&&wt.addEventListener("processorerror",St)},get parameters(){return At},get port(){return J.port2},addEventListener:(...ht)=>it.addEventListener(ht[0],ht[1],ht[2]),connect:o.bind(null,Ot),disconnect:D.bind(null,Ot),dispatchEvent:(...ht)=>it.dispatchEvent(ht[0]),removeEventListener:(...ht)=>it.removeEventListener(ht[0],ht[1],ht[2])},kt=new Map;var Pt,ee;J.port1.addEventListener=(Pt=J.port1.addEventListener,(...ht)=>{if(ht[0]==="message"){let jt=typeof ht[1]=="function"?ht[1]:typeof ht[1]=="object"&&ht[1]!==null&&typeof ht[1].handleEvent=="function"?ht[1].handleEvent:null;if(jt!==null){let we=kt.get(ht[1]);we!==void 0?ht[1]=we:(ht[1]=Xt=>{I(P.currentTime,P.sampleRate,()=>jt(Xt))},kt.set(jt,ht[1]))}}return Pt.call(J.port1,ht[0],ht[1],ht[2])}),J.port1.removeEventListener=(ee=J.port1.removeEventListener,(...ht)=>{if(ht[0]==="message"){let jt=kt.get(ht[1]);jt!==void 0&&(kt.delete(ht[1]),ht[1]=jt)}return ee.call(J.port1,ht[0],ht[1],ht[2])});let ce=null;Object.defineProperty(J.port1,"onmessage",{get:()=>ce,set:ht=>{typeof ce=="function"&&J.port1.removeEventListener("message",ce),ce=typeof ht=="function"?ht:null,typeof ce=="function"&&(J.port1.addEventListener("message",ce),J.port1.start())}}),N.prototype.port=J.port1;let Et=null;((ht,jt,we,Xt)=>{let It=T.get(ht);It===void 0&&(It=new WeakMap,T.set(ht,It));let Yt=Bh(we,Xt);return It.set(jt,Yt),Yt})(P,wt,N,q).then(ht=>Et=ht);let vt=ds(q.numberOfInputs,q.channelCount),xe=ds(q.numberOfOutputs,B),hn=N.parameterDescriptors===void 0?[]:N.parameterDescriptors.reduce((ht,{name:jt})=>({...ht,[jt]:new Float32Array(128)}),{}),ze=!0,Pn=()=>{q.numberOfOutputs>0&&it.disconnect(dt);for(let ht=0,jt=0;ht<q.numberOfOutputs;ht+=1){let we=yt[ht];for(let Xt=0;Xt<B[ht];Xt+=1)dt.disconnect(we,jt+Xt,Xt);jt+=B[ht]}},In=new Map;it.onaudioprocess=({inputBuffer:ht,outputBuffer:jt})=>{if(Et!==null){let we=A(wt);for(let Xt=0;Xt<nt;Xt+=128){for(let It=0;It<q.numberOfInputs;It+=1)for(let Yt=0;Yt<q.channelCount;Yt+=1)ps(ht,vt[It],Yt,Yt,Xt);N.parameterDescriptors!==void 0&&N.parameterDescriptors.forEach(({name:It},Yt)=>{ps(ht,hn,It,Q+Yt,Xt)});for(let It=0;It<q.numberOfInputs;It+=1)for(let Yt=0;Yt<B[It];Yt+=1)xe[It][Yt].byteLength===0&&(xe[It][Yt]=new Float32Array(128));try{let It=vt.map((Ye,jn)=>{if(we[jn].size>0)return In.set(jn,nt/128),Ye;let Fn=In.get(jn);return Fn===void 0?[]:(Ye.every(zu=>zu.every(Bu=>Bu===0))&&(Fn===1?In.delete(jn):In.set(jn,Fn-1)),Ye)});ze=I(P.currentTime+Xt/P.sampleRate,P.sampleRate,()=>Et.process(It,xe,hn));for(let Ye=0,jn=0;Ye<q.numberOfOutputs;Ye+=1){for(let Fn=0;Fn<B[Ye];Fn+=1)qo(jt,xe[Ye],Fn,jn+Fn,Xt);jn+=B[Ye]}}catch(It){ze=!1,wt.dispatchEvent(new ErrorEvent("processorerror",{colno:It.colno,filename:It.filename,lineno:It.lineno,message:It.message}))}if(!ze){for(let It=0;It<q.numberOfInputs;It+=1){Z[It].disconnect(K[It]);for(let Yt=0;Yt<q.channelCount;Yt+=1)K[Xt].disconnect(tt,Yt,It*q.channelCount+Yt)}if(N.parameterDescriptors!==void 0){let It=N.parameterDescriptors.length;for(let Yt=0;Yt<It;Yt+=1){let Ye=ct[Yt];Ye.disconnect(tt,0,Q+Yt),Ye.stop()}}tt.disconnect(it),it.onaudioprocess=null,re?Pn():bc();break}}}};let re=!1,De=_(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),yc=()=>it.connect(De).connect(P.destination),bc=()=>{it.disconnect(De),De.disconnect()};return yc(),F(wt,()=>{if(ze){bc(),q.numberOfOutputs>0&&it.connect(dt);for(let ht=0,jt=0;ht<q.numberOfOutputs;ht+=1){let we=yt[ht];for(let Xt=0;Xt<B[ht];Xt+=1)dt.connect(we,jt+Xt,Xt);jt+=B[ht]}}re=!0},()=>{ze&&(yc(),Pn()),re=!1})})(Na,st,ie,Cn,Ni,ni,ke,Vi,Se,Va,no,zl,Sn),Wl=((o,t,n,s,a)=>(d,_,O,E,D,I)=>{if(O!==null)try{let P=new O(d,E,I),Y=new Map,N=null;if(Object.defineProperties(P,{channelCount:{get:()=>I.channelCount,set:()=>{throw o()}},channelCountMode:{get:()=>"explicit",set:()=>{throw o()}},onprocessorerror:{get:()=>N,set:q=>{typeof N=="function"&&P.removeEventListener("processorerror",N),N=typeof q=="function"?q:null,typeof N=="function"&&P.addEventListener("processorerror",N)}}}),P.addEventListener=(F=P.addEventListener,(...q)=>{if(q[0]==="processorerror"){let B=typeof q[1]=="function"?q[1]:typeof q[1]=="object"&&q[1]!==null&&typeof q[1].handleEvent=="function"?q[1].handleEvent:null;if(B!==null){let Q=Y.get(q[1]);Q!==void 0?q[1]=Q:(q[1]=H=>{H.type==="error"?(Object.defineProperties(H,{type:{value:"processorerror"}}),B(H)):B(new ErrorEvent(q[0],{...H}))},Y.set(B,q[1]))}}return F.call(P,"error",q[1],q[2]),F.call(P,...q)}),P.removeEventListener=(A=P.removeEventListener,(...q)=>{if(q[0]==="processorerror"){let B=Y.get(q[1]);B!==void 0&&(Y.delete(q[1]),q[1]=B)}return A.call(P,"error",q[1],q[2]),A.call(P,q[0],q[1],q[2])}),I.numberOfOutputs!==0){let q=n(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return P.connect(q).connect(d.destination),a(P,()=>q.disconnect(),()=>q.connect(d.destination))}return P}catch(P){throw P.code===11?s():P}var A,F;if(D===void 0)throw s();return(P=>{let{port1:Y}=new MessageChannel;try{Y.postMessage(P)}finally{Y.close()}})(I),t(d,_,D,I)})(ie,Bl,ke,Se,Sn),Ul=((o,t,n,s,a,d,_,O,E,D,I,A,F,P,Y,N)=>(q,B,Q)=>{let H=new WeakMap,X=null;return{render(J,Z,K){O(Z,J);let ct=H.get(Z);return ct!==void 0?Promise.resolve(ct):(async(tt,nt,it)=>{let dt=I(tt),yt=null,At=$(dt,nt),gt=Array.isArray(B.outputChannelCount)?B.outputChannelCount:Array.from(B.outputChannelCount);if(A===null){let St=gt.reduce((Pt,ee)=>Pt+ee,0),Ot=a(nt,{channelCount:Math.max(1,St),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,St)}),wt=[];for(let Pt=0;Pt<tt.numberOfOutputs;Pt+=1)wt.push(s(nt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:gt[Pt]}));let kt=_(nt,{channelCount:B.channelCount,channelCountMode:B.channelCountMode,channelInterpretation:B.channelInterpretation,gain:1});kt.connect=t.bind(null,wt),kt.disconnect=E.bind(null,wt),yt=[Ot,wt,kt]}else At||(dt=new A(nt,q));if(H.set(nt,yt===null?dt:yt[2]),yt!==null){if(X===null){if(Q===void 0)throw new Error("Missing the processor constructor.");if(F===null)throw new Error("Missing the native OfflineAudioContext constructor.");let ee=tt.channelCount*tt.numberOfInputs,ce=Q.parameterDescriptors===void 0?0:Q.parameterDescriptors.length,Et=ee+ce;X=Dh(tt,Et===0?null:await(async()=>{let xe=new F(Et,128*Math.ceil(tt.context.length/128),nt.sampleRate),hn=[],ze=[];for(let re=0;re<B.numberOfInputs;re+=1)hn.push(_(xe,{channelCount:B.channelCount,channelCountMode:B.channelCountMode,channelInterpretation:B.channelInterpretation,gain:1})),ze.push(a(xe,{channelCount:B.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:B.channelCount}));let Pn=await Promise.all(Array.from(tt.parameters.values()).map(async re=>{let De=d(xe,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:re.value});return await P(xe,re,De.offset,it),De})),In=s(xe,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,ee+ce)});for(let re=0;re<B.numberOfInputs;re+=1){hn[re].connect(ze[re]);for(let De=0;De<B.channelCount;De+=1)ze[re].connect(In,De,re*B.channelCount+De)}for(let[re,De]of Pn.entries())De.connect(In,0,ee+re),De.start(0);return In.connect(xe.destination),await Promise.all(hn.map(re=>Y(tt,xe,re,it))),N(xe)})(),nt,B,gt,Q,D)}let St=await X,Ot=n(nt,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[wt,kt,Pt]=yt;St!==null&&(Ot.buffer=St,Ot.start(0)),Ot.connect(wt);for(let ee=0,ce=0;ee<tt.numberOfOutputs;ee+=1){let Et=kt[ee];for(let vt=0;vt<gt[ee];vt+=1)wt.connect(Et,ce+vt,vt);ce+=gt[ee]}return Pt}if(At)for(let[St,Ot]of tt.parameters.entries())await o(nt,Ot,dt.parameters.get(St),it);else for(let[St,Ot]of tt.parameters.entries())await P(nt,Ot,dt.parameters.get(St),it);return await Y(tt,nt,dt,it),dt})(J,Z,K)}}})(en,Na,ei,Cn,Ni,ni,ke,Vl,Va,no,Nt,xs,he,nn,ge,ys),Gl=(o=>t=>o.get(t))(ja),Yl=(o=>(t,n)=>{o.set(t,n)})(za),Ba=Ia?((o,t,n,s,a,d,_,O,E,D,I,A,F)=>class extends t{constructor(P,Y,N){var q;let B=O(P),Q=E(B),H=I({...Rh,...N}),X=b.get(B),J=X==null?void 0:X.get(Y),Z=Q||B.state!=="closed"?B:(q=_(B))!==null&&q!==void 0?q:B,K=a(Z,Q?null:P.baseLatency,D,Y,J,H);super(P,!0,K,Q?s(Y,H,J):null);let ct=[];K.parameters.forEach((nt,it)=>{let dt=n(this,Q,nt);ct.push([it,dt])}),this._nativeAudioWorkletNode=K,this._onprocessorerror=null,this._parameters=new Lo(ct),Q&&o(B,this);let{activeInputs:tt}=d(this);A(K,tt)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(P){let Y=typeof P=="function"?F(this,P):null;this._nativeAudioWorkletNode.onprocessorerror=Y;let N=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=N!==null&&N===Y?P:N}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(Nl,te,Xe,Ul,Wl,Zt,Gl,Bt,qt,xs,o=>({...o,outputChannelCount:o.outputChannelCount!==void 0?o.outputChannelCount:o.numberOfInputs===1&&o.numberOfOutputs===1?[o.channelCount]:Array.from({length:o.numberOfOutputs},()=>1)}),Yl,ti):void 0,Wa=(((o,t,n,s,a)=>{})(ie,Se,Go,eo,pn),((o,t)=>(n,s,a)=>{if(t===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(n,s,a)}catch(d){throw d.name==="SyntaxError"?o():d}})(Se,he)),Ua=((o,t,n,s,a,d,_,O)=>{let E=[];return(D,I)=>n(D).render(D,I,E).then(()=>Promise.all(Array.from(s(I)).map(A=>n(A).render(A,I,E)))).then(()=>a(I)).then(A=>(typeof A.copyFromChannel!="function"?(_(A),Rt(A)):t(d,()=>d(A))||O(A),o.add(A),A))})(Hr,je,Br,io,ys,ot,Xr,Zr),Hl=(((o,t,n,s,a)=>{})(je,ie,Wa,eo,Ua),((o,t,n,s,a)=>class extends o{constructor(d,_,O){let E;if(typeof d=="number"&&_!==void 0&&O!==void 0)E={length:_,numberOfChannels:d,sampleRate:O};else{if(typeof d!="object")throw new Error("The given parameters are not valid.");E=d}let{length:D,numberOfChannels:I,sampleRate:A}={...Uh,...E},F=s(I,D,A);t(qi,()=>qi(F))||F.addEventListener("statechange",(()=>{let P=0,Y=N=>{this._state==="running"&&(P>0?(F.removeEventListener("statechange",Y),N.stopImmediatePropagation(),this._waitForThePromiseToSettle(N)):P+=1)};return Y})()),super(F,I),this._length=D,this._nativeOfflineAudioContext=F,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(n()):(this._state="running",a(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,fe(this)}))}_waitForThePromiseToSettle(d){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(d):setTimeout(()=>this._waitForThePromiseToSettle(d))}})(Fa,je,ie,Wa,Ua)),Ql=((o,t)=>n=>{let s=o.get(n);return t(s)||t(n)})(w,Ur),Xl=(Ga=S,Ya=Yr,o=>Ga.has(o)||Ya(o));var Ga,Ya;let Zl=(Ha=x,Qa=ha,o=>Ha.has(o)||Qa(o));var Ha,Qa;let Jl=((o,t)=>n=>{let s=o.get(n);return t(s)||t(n)})(w,qt),$l=()=>(async(o,t,n,s,a,d,_,O,E,D,I,A,F,P,Y,N)=>o(t,t)&&o(n,n)&&o(a,a)&&o(d,d)&&o(O,O)&&o(E,E)&&o(D,D)&&o(I,I)&&o(A,A)&&o(F,F)&&o(P,P)?(await Promise.all([o(s,s),o(_,_),o(Y,Y),o(N,N)])).every(q=>q):!1)(je,(o=>()=>{if(o===null)return!1;let t=new o(1,1,44100).createBuffer(1,1,44100);if(t.copyToChannel===void 0)return!0;let n=new Float32Array(2);try{t.copyFromChannel(n,0,0)}catch{return!1}return!0})(he),(o=>()=>{if(o===null)return!1;if(o.prototype!==void 0&&o.prototype.close!==void 0)return!0;let t=new o,n=t.close!==void 0;try{t.close()}catch{}return n})(pn),(o=>()=>{if(o===null)return Promise.resolve(!1);let t=new o(1,1,44100);return new Promise(n=>{let s=!0,a=_=>{s&&(s=!1,t.startRendering(),n(_ instanceof TypeError))},d;try{d=t.decodeAudioData(null,()=>{},a)}catch(_){a(_)}d!==void 0&&d.catch(a)})})(he),(o=>()=>{if(o===null)return!1;let t;try{t=new o({latencyHint:"balanced"})}catch{return!1}return t.close(),!0})(pn),(o=>()=>{if(o===null)return!1;let t=new o(1,1,44100).createGain(),n=t.connect(t)===t;return t.disconnect(t),n})(he),((o,t)=>async()=>{if(o===null)return!0;if(t===null)return!1;let n=new Blob(['class A extends AudioWorkletProcessor{process(){this.port.postMessage(0)}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,8e3),a=URL.createObjectURL(n),d=!1;try{await s.audioWorklet.addModule(a);let _=new o(s,"a",{numberOfOutputs:0}),O=s.createOscillator();_.port.onmessage=()=>d=!0,O.connect(_),O.start(0),await s.startRendering(),d||await new Promise(E=>setTimeout(E,5))}catch{}finally{URL.revokeObjectURL(a)}return d})(xs,he),(o=>()=>{if(o===null)return!1;let t=new o(1,1,44100).createChannelMerger();if(t.channelCountMode==="max")return!0;try{t.channelCount=2}catch{return!0}return!1})(he),(o=>()=>{if(o===null)return!1;let t=new o(1,1,44100);return t.createConstantSource===void 0?!0:t.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(he),(o=>()=>{if(o===null)return!1;let t=new o(1,1,44100),n=t.createConvolver();n.buffer=t.createBuffer(1,1,t.sampleRate);try{n.buffer=t.createBuffer(1,1,t.sampleRate)}catch{return!1}return!0})(he),(o=>()=>{if(o===null)return!1;let t=new o(1,1,44100).createConvolver();try{t.channelCount=1}catch{return!1}return!0})(he),Zh,(o=>()=>o!==null&&o.hasOwnProperty("isSecureContext"))(Qe),(o=>()=>{if(o===null)return!1;let t=new o;try{return t.createMediaStreamSource(new MediaStream),!1}catch(n){return!0}})(pn),(o=>()=>{if(o===null)return Promise.resolve(!1);let t=new o(1,1,44100);if(t.createStereoPanner===void 0||t.createConstantSource===void 0)return Promise.resolve(!0);let n=t.createConstantSource(),s=t.createStereoPanner();return n.channelCount=1,n.offset.value=1,s.channelCount=1,n.start(),n.connect(s).connect(t.destination),t.startRendering().then(a=>a.getChannelData(0)[0]!==1)})(he),Jh);function mt(o,t){if(!o)throw new Error(t)}function ve(o,t,n=1/0){if(!(t<=o&&o<=n))throw new RangeError(`Value must be within [${t}, ${n}], got: ${o}`)}function so(o){o.isOffline||o.state==="running"||Wi('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let ro=console;function Kl(o){ro=o}function Xa(...o){ro.log(...o)}function Wi(...o){ro.warn(...o)}function Me(o){return o===void 0}function Ct(o){return!Me(o)}function Za(o){return typeof o=="function"}function Fe(o){return typeof o=="number"}function dn(o){return Object.prototype.toString.call(o)==="[object Object]"&&o.constructor===Object}function oo(o){return typeof o=="boolean"}function _e(o){return Array.isArray(o)}function Be(o){return typeof o=="string"}function Ui(o){return Be(o)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(o)}let fn=typeof self=="object"?self:null,tu=fn&&(fn.hasOwnProperty("AudioContext")||fn.hasOwnProperty("webkitAudioContext"));function Ze(o,t,n,s){var a,d=arguments.length,_=d<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,n):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(o,t,n,s);else for(var O=o.length-1;O>=0;O--)(a=o[O])&&(_=(d<3?a(_):d>3?a(t,n,_):a(t,n))||_);return d>3&&_&&Object.defineProperty(t,n,_),_}function Vt(o,t,n,s){return new(n||(n=Promise))(function(a,d){function _(D){try{E(s.next(D))}catch(I){d(I)}}function O(D){try{E(s.throw(D))}catch(I){d(I)}}function E(D){var I;D.done?a(D.value):(I=D.value,I instanceof n?I:new n(function(A){A(I)})).then(_,O)}E((s=s.apply(o,t||[])).next())})}class eu{constructor(t,n,s){this._callback=t,this._type=n,this._updateInterval=s,this._createClock()}_createWorker(){let t=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),n=URL.createObjectURL(t),s=new Worker(n);s.onmessage=this._callback.bind(this),this._worker=s}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function zn(o){return Zl(o)}function kn(o){return Xl(o)}function ws(o){return Jl(o)}function ii(o){return Ql(o)}function Ja(o){return o instanceof AudioBuffer}function nu(o,t){return o==="value"||zn(t)||kn(t)||Ja(t)}function We(o,...t){if(!t.length)return o;let n=t.shift();if(dn(o)&&dn(n))for(let s in n)nu(s,n[s])?o[s]=n[s]:dn(n[s])?(o[s]||Object.assign(o,{[s]:{}}),We(o[s],n[s])):Object.assign(o,{[s]:n[s]});return We(o,...t)}function V(o,t,n=[],s){let a={},d=Array.from(t);if(dn(d[0])&&s&&!Reflect.has(d[0],s)&&(Object.keys(d[0]).some(_=>Reflect.has(o,_))||(We(a,{[s]:d[0]}),n.splice(n.indexOf(s),1),d.shift())),d.length===1&&dn(d[0]))We(a,d[0]);else for(let _=0;_<n.length;_++)Ct(d[_])&&(a[n[_]]=d[_]);return We(o,a)}function Ue(o,t){return Me(o)?t:o}function ye(o,t){return t.forEach(n=>{Reflect.has(o,n)&&delete o[n]}),o}class mn{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||fn&&this.toString()===fn.TONE_DEBUG_CLASS)&&Xa(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}mn.version=p;function Ts(o,t){return o>t+1e-6}function ao(o,t){return Ts(o,t)||Je(o,t)}function $a(o,t){return o+1e-6<t}function Je(o,t){return Math.abs(o-t)<1e-6}function Ka(o,t,n){return Math.max(Math.min(o,n),t)}class $e extends mn{constructor(){super(),this.name="Timeline",this._timeline=[];let t=V($e.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(mt(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){let n=this._timeline[this.length-1];mt(ao(t.time,n.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{let n=this._search(t.time);this._timeline.splice(n+1,0,t)}if(this.length>this.memory){let n=this.length-this.memory;this._timeline.splice(0,n)}return this}remove(t){let n=this._timeline.indexOf(t);return n!==-1&&this._timeline.splice(n,1),this}get(t,n="time"){let s=this._search(t,n);return s!==-1?this._timeline[s]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,n="time"){let s=this._search(t,n);return s+1<this._timeline.length?this._timeline[s+1]:null}getBefore(t){let n=this._timeline.length;if(n>0&&this._timeline[n-1].time<t)return this._timeline[n-1];let s=this._search(t);return s-1>=0?this._timeline[s-1]:null}cancel(t){if(this._timeline.length>1){let n=this._search(t);if(n>=0)if(Je(this._timeline[n].time,t)){for(let s=n;s>=0&&Je(this._timeline[s].time,t);s--)n=s;this._timeline=this._timeline.slice(0,n)}else this._timeline=this._timeline.slice(0,n+1);else this._timeline=[]}else this._timeline.length===1&&ao(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){let n=this._search(t);return n>=0&&(this._timeline=this._timeline.slice(n+1)),this}previousEvent(t){let n=this._timeline.indexOf(t);return n>0?this._timeline[n-1]:null}_search(t,n="time"){if(this._timeline.length===0)return-1;let s=0,a=this._timeline.length,d=a;if(a>0&&this._timeline[a-1][n]<=t)return a-1;for(;s<d;){let _=Math.floor(s+(d-s)/2),O=this._timeline[_],E=this._timeline[_+1];if(Je(O[n],t)){for(let D=_;D<this._timeline.length&&Je(this._timeline[D][n],t);D++)_=D;return _}if($a(O[n],t)&&Ts(E[n],t))return _;Ts(O[n],t)?d=_:s=_+1}return-1}_iterate(t,n=0,s=this._timeline.length-1){this._timeline.slice(n,s+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,n){let s=this._search(t);return s!==-1&&this._iterate(n,0,s),this}forEachAfter(t,n){let s=this._search(t);return this._iterate(n,s+1),this}forEachBetween(t,n,s){let a=this._search(t),d=this._search(n);return a!==-1&&d!==-1?(this._timeline[a].time!==t&&(a+=1),this._timeline[d].time===n&&(d-=1),this._iterate(s,a,d)):a===-1&&this._iterate(s,0,d),this}forEachFrom(t,n){let s=this._search(t);for(;s>=0&&this._timeline[s].time>=t;)s--;return this._iterate(n,s+1),this}forEachAtTime(t,n){let s=this._search(t);if(s!==-1&&Je(this._timeline[s].time,t)){let a=s;for(let d=s;d>=0&&Je(this._timeline[d].time,t);d--)a=d;this._iterate(d=>{n(d)},a,s)}return this}dispose(){return super.dispose(),this._timeline=[],this}}let tc=[];function Ss(o){tc.push(o)}let ec=[];function Cs(o){ec.push(o)}class si extends mn{constructor(){super(...arguments),this.name="Emitter"}on(t,n){return t.split(/\W+/).forEach(s=>{Me(this._events)&&(this._events={}),this._events.hasOwnProperty(s)||(this._events[s]=[]),this._events[s].push(n)}),this}once(t,n){let s=(...a)=>{n(...a),this.off(t,s)};return this.on(t,s),this}off(t,n){return t.split(/\W+/).forEach(s=>{if(Me(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Me(n))this._events[t]=[];else{let a=this._events[t];for(let d=a.length-1;d>=0;d--)a[d]===n&&a.splice(d,1)}}),this}emit(t,...n){if(this._events&&this._events.hasOwnProperty(t)){let s=this._events[t].slice(0);for(let a=0,d=s.length;a<d;a++)s[a].apply(this,n)}return this}static mixin(t){["on","once","off","emit"].forEach(n=>{let s=Object.getOwnPropertyDescriptor(si.prototype,n);Object.defineProperty(t.prototype,n,s)})}dispose(){return super.dispose(),this._events=void 0,this}}class co extends si{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class ri extends co{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new $e,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;let t=V(ri.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(n){return new ql(n)}({latencyHint:t.latencyHint}),this._ticker=new eu(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,tc.forEach(n=>n(t)),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,n,s){return this._context.createBuffer(t,n,s)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,n){return this._context.createIIRFilter(t,n)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,n,s){return this._context.createPeriodicWave(t,n,s)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){return mt(ii(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(t)}createMediaElementSource(t){return mt(ii(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(t)}createMediaStreamDestination(){return mt(ii(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){mt(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){mt(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){mt(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){mt(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,n){return function(s,a,d){return mt(Ct(Ba),"This node only works in a secure context (https or localhost)"),new Ba(s,a,d)}(this.rawContext,t,n)}addAudioWorkletModule(t,n){return Vt(this,void 0,void 0,function*(){mt(Ct(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(n)||this._workletModules.set(n,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(n)})}workletsAreReady(){return Vt(this,void 0,void 0,function*(){let t=[];this._workletModules.forEach(n=>t.push(n)),yield Promise.all(t)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let n=0;if(this._latencyHint=t,Be(t))switch(t){case"interactive":n=.1;break;case"playback":n=.5;break;case"balanced":n=.25}this.lookAhead=n,this.updateInterval=n/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return ii(this._context)?this._context.resume():Promise.resolve()}close(){return Vt(this,void 0,void 0,function*(){var t;ii(this._context)&&(yield this._context.close()),this._initialized&&(t=this,ec.forEach(n=>n(t)))})}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{let n=this._context.createBuffer(1,128,this._context.sampleRate),s=n.getChannelData(0);for(let d=0;d<s.length;d++)s[d]=t;let a=this._context.createBufferSource();return a.channelCount=1,a.channelCountMode="explicit",a.buffer=n,a.loop=!0,a.start(0),this._constants.set(t,a),a}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(t=>this._constants[t].disconnect()),this}_timeoutLoop(){let t=this.now(),n=this._timeouts.peek();for(;this._timeouts.length&&n&&n.time<=t;)n.callback(),this._timeouts.shift(),n=this._timeouts.peek()}setTimeout(t,n){this._timeoutIds++;let s=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:s+n}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach(n=>{n.id===t&&this._timeouts.remove(n)}),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,n){let s=++this._timeoutIds,a=()=>{let d=this.now();this._timeouts.add({callback:()=>{t(),a()},id:s,time:d+n})};return a(),s}}function _t(o,t){_e(t)?t.forEach(n=>_t(o,n)):Object.defineProperty(o,t,{enumerable:!0,writable:!1})}function Gi(o,t){_e(t)?t.forEach(n=>Gi(o,n)):Object.defineProperty(o,t,{writable:!0})}let Mt=()=>{};class Dt extends mn{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Mt;let t=V(Dt.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Ja(t.url)||t.url instanceof Dt?this.set(t.url):Be(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:Mt,onload:Mt,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Wt().sampleRate}set(t){return t instanceof Dt?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Vt(this,void 0,void 0,function*(){let n=Dt.load(t).then(s=>{this.set(s),this.onload(this)});Dt.downloads.push(n);try{yield n}finally{let s=Dt.downloads.indexOf(n);Dt.downloads.splice(s,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){let n=_e(t)&&t[0].length>0,s=n?t.length:1,a=n?t[0].length:t.length,d=Wt(),_=d.createBuffer(s,a,d.sampleRate),O=n||s!==1?t:[t];for(let E=0;E<s;E++)_.copyToChannel(O[E],E);return this._buffer=_,this}toMono(t){if(Fe(t))this.fromArray(this.toArray(t));else{let n=new Float32Array(this.length),s=this.numberOfChannels;for(let a=0;a<s;a++){let d=this.toArray(a);for(let _=0;_<d.length;_++)n[_]+=d[_]}n=n.map(a=>a/s),this.fromArray(n)}return this}toArray(t){if(Fe(t))return this.getChannelData(t);if(this.numberOfChannels===1)return this.toArray(0);{let n=[];for(let s=0;s<this.numberOfChannels;s++)n[s]=this.getChannelData(s);return n}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,n=this.duration){let s=Math.floor(t*this.sampleRate),a=Math.floor(n*this.sampleRate);mt(s<a,"The start time must be less than the end time");let d=a-s,_=Wt().createBuffer(this.numberOfChannels,d,this.sampleRate);for(let O=0;O<this.numberOfChannels;O++)_.copyToChannel(this.getChannelData(O).subarray(s,a),O);return new Dt(_)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return new Dt().fromArray(t)}static fromUrl(t){return Vt(this,void 0,void 0,function*(){return yield new Dt().load(t)})}static load(t){return Vt(this,void 0,void 0,function*(){let n=t.match(/\[([^\]\[]+\|.+)\]$/);if(n){let _=n[1].split("|"),O=_[0];for(let E of _)if(Dt.supportsType(E)){O=E;break}t=t.replace(n[0],O)}let s=Dt.baseUrl===""||Dt.baseUrl.endsWith("/")?Dt.baseUrl:Dt.baseUrl+"/",a=yield fetch(s+t);if(!a.ok)throw new Error("could not load url: "+t);let d=yield a.arrayBuffer();return yield Wt().decodeAudioData(d)})}static supportsType(t){let n=t.split("."),s=n[n.length-1];return document.createElement("audio").canPlayType("audio/"+s)!==""}static loaded(){return Vt(this,void 0,void 0,function*(){for(yield Promise.resolve();Dt.downloads.length;)yield Dt.downloads[0]})}}Dt.baseUrl="",Dt.downloads=[];class oi extends ri{constructor(){var t,n,s;super({clockSource:"offline",context:ws(arguments[0])?arguments[0]:(t=arguments[0],n=arguments[1]*arguments[2],s=arguments[2],new Hl(t,n,s)),lookAhead:0,updateInterval:ws(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ws(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Vt(this,void 0,void 0,function*(){let n=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,n++;let s=Math.floor(this.sampleRate/128);t&&n%s==0&&(yield new Promise(a=>setTimeout(a,1)))}})}render(t=!0){return Vt(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(t);let n=yield this._context.startRendering();return new Dt(n)})}close(){return Promise.resolve()}}let nc=new class extends co{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(o,t,n){return{}}createChannelMerger(o){return{}}createChannelSplitter(o){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(o){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(o,t){return{}}createPanner(){return{}}createPeriodicWave(o,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(o){return{}}createMediaElementSource(o){return{}}createMediaStreamDestination(){return{}}decodeAudioData(o){return Promise.resolve({})}createAudioWorkletNode(o,t){return{}}get rawContext(){return{}}addAudioWorkletModule(o,t){return Vt(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(o,t){return 0}clearTimeout(o){return this}setInterval(o,t){return 0}clearInterval(o){return this}getConstant(o){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(o){}get destination(){return{}}set destination(o){}now(){return 0}immediate(){return 0}},ks=nc;function Wt(){return ks===nc&&tu&&Ms(new ri),ks}function Ms(o){ks=ii(o)?new ri(o):ws(o)?new oi(o):o}function iu(){return ks.resume()}if(fn&&!fn.TONE_SILENCE_LOGGING){let o="v";p==="dev"&&(o="");let t=` * Tone.js ${o}${p} * `;console.log("%c"+t,"background: #000; color: #fff")}function ai(o){return Math.pow(10,o/20)}function Yi(o){return Math.log(o)/Math.LN10*20}function ci(o){return Math.pow(2,o/12)}let Os=440;function Mn(o){return Math.round(ic(o))}function ic(o){return 69+12*Math.log2(o/Os)}function ho(o){return Os*Math.pow(2,(o-69)/12)}class lo extends mn{constructor(t,n,s){super(),this.defaultUnits="s",this._val=n,this._units=s,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,n)=>{let s=parseInt(t,10),a=n==="."?1.5:1;return s===1?this._beatsToUnits(this._getTimeSignature())*a:this._beatsToUnits(4/s)*a},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{let n=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(n)))},regexp:/^(\d+)t$/i},tr:{method:(t,n,s)=>{let a=0;return t&&t!=="0"&&(a+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),n&&n!=="0"&&(a+=this._beatsToUnits(parseFloat(n))),s&&s!=="0"&&(a+=this._beatsToUnits(parseFloat(s)/4)),a},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof lo&&this.fromType(this._val),Me(this._val))return this._noArg();if(Be(this._val)&&Me(this._units)){for(let t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(dn(this._val)){let t=0;for(let n in this._val)if(Ct(this._val[n])){let s=this._val[n];t+=new this.constructor(this.context,n).valueOf()*s}return t}if(Ct(this._units)){let t=this._expressions[this._units],n=this._val.toString().trim().match(t.regexp);return n?t.method.apply(this,n.slice(1)):t.method.call(this,this._val)}return Be(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Le extends lo{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{let n=new Le(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(n))},regexp:/^@(.+)/}})}quantize(t,n=1){let s=new this.constructor(this.context,t).valueOf(),a=this.valueOf();return a+(Math.round(a/s)*s-a)*n}toNotation(){let t=this.toSeconds(),n=["1m"];for(let d=1;d<9;d++){let _=Math.pow(2,d);n.push(_+"n."),n.push(_+"n"),n.push(_+"t")}n.push("0");let s=n[0],a=new Le(this.context,n[0]).toSeconds();return n.forEach(d=>{let _=new Le(this.context,d).toSeconds();Math.abs(_-t)<Math.abs(a-t)&&(s=d,a=_)}),s}toBarsBeatsSixteenths(){let t=this._beatsToUnits(1),n=this.valueOf()/t;n=parseFloat(n.toFixed(4));let s=Math.floor(n/this._getTimeSignature()),a=n%1*4;n=Math.floor(n)%this._getTimeSignature();let d=a.toString();return d.length>3&&(a=parseFloat(parseFloat(d).toFixed(3))),[s,n,a].join(":")}toTicks(){let t=this._beatsToUnits(1),n=this.valueOf()/t;return Math.round(n*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Mn(this.toFrequency())}_now(){return this.context.now()}}function su(o,t){return new Le(Wt(),o,t)}class Ce extends Le{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Os}static set A4(t){(function(n){Os=n})(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return this.defaultUnits==="midi"?t:Ce.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,n){let s=ru[t.toLowerCase()]+12*(parseInt(n,10)+1);return this.defaultUnits==="midi"?s:Ce.mtof(s)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,n,s){let a=1;return t&&t!=="0"&&(a*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),n&&n!=="0"&&(a*=this._beatsToUnits(parseFloat(n))),s&&s!=="0"&&(a*=this._beatsToUnits(parseFloat(s)/4)),a}}})}transpose(t){return new Ce(this.context,this.valueOf()*ci(t))}harmonize(t){return t.map(n=>this.transpose(n))}toMidi(){return Mn(this.valueOf())}toNote(){let t=this.toFrequency(),n=Math.log2(t/Ce.A4),s=Math.round(12*n)+57,a=Math.floor(s/12);return a<0&&(s+=-12*a),ou[s%12]+a.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){let t=this._beatsToUnits(1),n=this.valueOf()/t;return Math.floor(n*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return ho(t)}static ftom(t){return Mn(t)}}let ru={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},ou=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function au(o,t){return new Ce(Wt(),o,t)}class se extends Le{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function cu(o,t){return new se(Wt(),o,t)}class le extends mn{constructor(){super();let t=V(le.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:Wt()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new Le(this.context,t).toSeconds()}toFrequency(t){return new Ce(this.context,t).toFrequency()}toTicks(t){return new se(this.context,t).toTicks()}_getPartialProperties(t){let n=this.get();return Object.keys(n).forEach(s=>{Me(t[s])&&delete n[s]}),n}get(){let t=this.constructor.getDefaults();return Object.keys(t).forEach(n=>{if(Reflect.has(this,n)){let s=this[n];Ct(s)&&Ct(s.value)&&Ct(s.setValueAtTime)?t[n]=s.value:s instanceof le?t[n]=s._getPartialProperties(t[n]):_e(s)||Fe(s)||Be(s)||oo(s)?t[n]=s:delete t[n]}}),t}set(t){return Object.keys(t).forEach(n=>{Reflect.has(this,n)&&Ct(this[n])&&(this[n]&&Ct(this[n].value)&&Ct(this[n].setValueAtTime)?this[n].value!==t[n]&&(this[n].value=t[n]):this[n]instanceof le?this[n].set(t[n]):this[n]=t[n])}),this}}class hi extends $e{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){let n=this.get(t);return n!==null?n.state:this._initial}setStateAtTime(t,n,s){return ve(n,0),this.add(Object.assign({},s,{state:t,time:n})),this}getLastState(t,n){for(let s=this._search(n);s>=0;s--){let a=this._timeline[s];if(a.state===t)return a}}getNextState(t,n){let s=this._search(n);if(s!==-1)for(let a=s;a<this._timeline.length;a++){let d=this._timeline[a];if(d.state===t)return d}}}class xt extends le{constructor(){super(V(xt.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;let t=V(xt.getDefaults(),arguments,["param","units","convert"]);for(mt(Ct(t.param)&&(zn(t.param)||t.param instanceof xt),"param must be an AudioParam");!zn(t.param);)t.param=t.param._param;this._swappable=!!Ct(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new $e(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Ct(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(le.getDefaults(),{convert:!0,units:"number"})}get value(){let t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Ct(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Ct(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(t,n){return this.units===n}_assertRange(t){return Ct(this.maxValue)&&Ct(this.minValue)&&ve(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?ai(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&this.units==="decibels"?Yi(t):t}setValueAtTime(t,n){let s=this.toSeconds(n),a=this._fromType(t);return mt(isFinite(a)&&isFinite(s),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(n)}`),this._assertRange(a),this.log(this.units,"setValueAtTime",t,s),this._events.add({time:s,type:"setValueAtTime",value:a}),this._param.setValueAtTime(a,s),this}getValueAtTime(t){let n=Math.max(this.toSeconds(t),0),s=this._events.getAfter(n),a=this._events.get(n),d=this._initialValue;if(a===null)d=this._initialValue;else if(a.type!=="setTargetAtTime"||s!==null&&s.type!=="setValueAtTime")if(s===null)d=a.value;else if(s.type==="linearRampToValueAtTime"||s.type==="exponentialRampToValueAtTime"){let _=a.value;if(a.type==="setTargetAtTime"){let O=this._events.getBefore(a.time);_=O===null?this._initialValue:O.value}d=s.type==="linearRampToValueAtTime"?this._linearInterpolate(a.time,_,s.time,s.value,n):this._exponentialInterpolate(a.time,_,s.time,s.value,n)}else d=a.value;else{let _=this._events.getBefore(a.time),O;O=_===null?this._initialValue:_.value,a.type==="setTargetAtTime"&&(d=this._exponentialApproach(a.time,O,a.value,a.constant,n))}return this._toType(d)}setRampPoint(t){t=this.toSeconds(t);let n=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),this._fromType(n)===0&&(n=this._toType(this._minOutput)),this.setValueAtTime(n,t),this}linearRampToValueAtTime(t,n){let s=this._fromType(t),a=this.toSeconds(n);return mt(isFinite(s)&&isFinite(a),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(n)}`),this._assertRange(s),this._events.add({time:a,type:"linearRampToValueAtTime",value:s}),this.log(this.units,"linearRampToValueAtTime",t,a),this._param.linearRampToValueAtTime(s,a),this}exponentialRampToValueAtTime(t,n){let s=this._fromType(t);s=Je(s,0)?this._minOutput:s,this._assertRange(s);let a=this.toSeconds(n);return mt(isFinite(s)&&isFinite(a),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(n)}`),this._events.add({time:a,type:"exponentialRampToValueAtTime",value:s}),this.log(this.units,"exponentialRampToValueAtTime",t,a),this._param.exponentialRampToValueAtTime(s,a),this}exponentialRampTo(t,n,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialRampToValueAtTime(t,s+this.toSeconds(n)),this}linearRampTo(t,n,s){return s=this.toSeconds(s),this.setRampPoint(s),this.linearRampToValueAtTime(t,s+this.toSeconds(n)),this}targetRampTo(t,n,s){return s=this.toSeconds(s),this.setRampPoint(s),this.exponentialApproachValueAtTime(t,s,n),this}exponentialApproachValueAtTime(t,n,s){n=this.toSeconds(n),s=this.toSeconds(s);let a=Math.log(s+1)/Math.log(200);return this.setTargetAtTime(t,n,a),this.cancelAndHoldAtTime(n+.9*s),this.linearRampToValueAtTime(t,n+s),this}setTargetAtTime(t,n,s){let a=this._fromType(t);mt(isFinite(s)&&s>0,"timeConstant must be a number greater than 0");let d=this.toSeconds(n);return this._assertRange(a),mt(isFinite(a)&&isFinite(d),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(n)}`),this._events.add({constant:s,time:d,type:"setTargetAtTime",value:a}),this.log(this.units,"setTargetAtTime",t,d,s),this._param.setTargetAtTime(a,d,s),this}setValueCurveAtTime(t,n,s,a=1){s=this.toSeconds(s),n=this.toSeconds(n);let d=this._fromType(t[0])*a;this.setValueAtTime(this._toType(d),n);let _=s/(t.length-1);for(let O=1;O<t.length;O++){let E=this._fromType(t[O])*a;this.linearRampToValueAtTime(this._toType(E),n+O*_)}return this}cancelScheduledValues(t){let n=this.toSeconds(t);return mt(isFinite(n),"Invalid argument to cancelScheduledValues: "+JSON.stringify(t)),this._events.cancel(n),this._param.cancelScheduledValues(n),this.log(this.units,"cancelScheduledValues",n),this}cancelAndHoldAtTime(t){let n=this.toSeconds(t),s=this._fromType(this.getValueAtTime(n));mt(isFinite(n),"Invalid argument to cancelAndHoldAtTime: "+JSON.stringify(t)),this.log(this.units,"cancelAndHoldAtTime",n,"value="+s);let a=this._events.get(n),d=this._events.getAfter(n);return a&&Je(a.time,n)?d?(this._param.cancelScheduledValues(d.time),this._events.cancel(d.time)):(this._param.cancelAndHoldAtTime(n),this._events.cancel(n+this.sampleTime)):d&&(this._param.cancelScheduledValues(d.time),this._events.cancel(d.time),d.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(s),n):d.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(s),n)),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}rampTo(t,n=.1,s){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(t,n,s):this.linearRampTo(t,n,s),this}apply(t){let n=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(n),n);let s=this._events.get(n);if(s&&s.type==="setTargetAtTime"){let a=this._events.getAfter(s.time),d=a?a.time:n+2,_=(d-n)/10;for(let O=n;O<d;O+=_)t.linearRampToValueAtTime(this.getValueAtTime(O),O)}return this._events.forEachAfter(this.context.currentTime,a=>{a.type==="cancelScheduledValues"?t.cancelScheduledValues(a.time):a.type==="setTargetAtTime"?t.setTargetAtTime(a.value,a.time,a.constant):t[a.type](a.value,a.time)}),this}setParam(t){mt(this._swappable,"The Param must be assigned as 'swappable' in the constructor");let n=this.input;return n.disconnect(this._param),this.apply(t),this._param=t,n.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,n,s,a,d){return s+(n-s)*Math.exp(-(d-t)/a)}_linearInterpolate(t,n,s,a,d){return n+(d-t)/(s-t)*(a-n)}_exponentialInterpolate(t,n,s,a,d){return n*Math.pow(a/n,(d-t)/(s-t))}}class rt extends le{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Ct(this.input)?zn(this.input)||this.input instanceof xt?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ct(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Ct(t)&&(t instanceof rt||kn(t))}_getInternalNodes(){let t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach(n=>{n.channelCount=t.channelCount,n.channelCountMode=t.channelCountMode,n.channelInterpretation=t.channelInterpretation})}_getChannelProperties(){let t=this._getInternalNodes();mt(t.length>0,"ToneAudioNode does not have any internal nodes");let n=t[0];return{channelCount:n.channelCount,channelCountMode:n.channelCountMode,channelInterpretation:n.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){let n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){let n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){let n=this._getChannelProperties();this._setChannelProperties(Object.assign(n,{channelInterpretation:t}))}connect(t,n=0,s=0){return Oe(this,t,n,s),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Wi("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,n=0,s=0){return uo(this,t,n,s),this}chain(...t){return qe(this,...t),this}fan(...t){return t.forEach(n=>this.connect(n)),this}dispose(){return super.dispose(),Ct(this.input)&&(this.input instanceof rt?this.input.dispose():kn(this.input)&&this.input.disconnect()),Ct(this.output)&&(this.output instanceof rt?this.output.dispose():kn(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function qe(...o){let t=o.shift();o.reduce((n,s)=>(n instanceof rt?n.connect(s):kn(n)&&Oe(n,s),s),t)}function Oe(o,t,n=0,s=0){for(mt(Ct(o),"Cannot connect from undefined node"),mt(Ct(t),"Cannot connect to undefined node"),(t instanceof rt||kn(t))&&mt(t.numberOfInputs>0,"Cannot connect to node with no inputs"),mt(o.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof rt||t instanceof xt;)Ct(t.input)&&(t=t.input);for(;o instanceof rt;)Ct(o.output)&&(o=o.output);zn(t)?o.connect(t,n):o.connect(t,n,s)}function uo(o,t,n=0,s=0){if(Ct(t))for(;t instanceof rt;)t=t.input;for(;!kn(o);)Ct(o.output)&&(o=o.output);zn(t)?o.disconnect(t,n):kn(t)?o.disconnect(t,n,s):o.disconnect()}class ft extends rt{constructor(){super(V(ft.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;let t=V(ft.getDefaults(),arguments,["gain","units"]);this.gain=new xt({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),_t(this,"gain")}static getDefaults(){return Object.assign(rt.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class li extends rt{constructor(t){super(t),this.onended=Mt,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ft({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(n){let s=this.toSeconds(n);return this._startTime!==-1&&s>=this._startTime&&(this._stopTime===-1||s<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(rt.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Mt})}_startGain(t,n=1){mt(this._startTime===-1,"Source cannot be started more than once");let s=this.toSeconds(this._fadeIn);return this._startTime=t+s,this._startTime=Math.max(this._startTime,this.context.currentTime),s>0?(this._gainNode.gain.setValueAtTime(0,t),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(n,t+s):this._gainNode.gain.exponentialApproachValueAtTime(n,t,s)):this._gainNode.gain.setValueAtTime(n,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){mt(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();let n=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+n,this._stopTime=Math.max(this._stopTime,this.context.currentTime),n>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,n,t):this._gainNode.gain.targetRampTo(0,n,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{let s=this._curve==="exponential"?2*n:0;this._stopSource(this.now()+s),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Mt&&(this.onended(this),this.onended=Mt,!this.context.isOffline)){let t=()=>this.dispose();window.requestIdleCallback!==void 0?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),mt(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Hi extends li{constructor(){super(V(Hi.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();let t=V(Hi.getDefaults(),arguments,["offset"]);Oe(this._source,this._gainNode),this.offset=new xt({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(li.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){let n=this.toSeconds(t);return this.log("start",n),this._startGain(n),this._source.start(n),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class bt extends rt{constructor(){super(V(bt.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;let t=V(bt.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Hi({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(rt.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,n=0,s=0){return Qi(this,t,n,s),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,n){return this._param.setValueAtTime(t,n),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,n){return this._param.linearRampToValueAtTime(t,n),this}exponentialRampToValueAtTime(t,n){return this._param.exponentialRampToValueAtTime(t,n),this}exponentialRampTo(t,n,s){return this._param.exponentialRampTo(t,n,s),this}linearRampTo(t,n,s){return this._param.linearRampTo(t,n,s),this}targetRampTo(t,n,s){return this._param.targetRampTo(t,n,s),this}exponentialApproachValueAtTime(t,n,s){return this._param.exponentialApproachValueAtTime(t,n,s),this}setTargetAtTime(t,n,s){return this._param.setTargetAtTime(t,n,s),this}setValueCurveAtTime(t,n,s,a){return this._param.setValueCurveAtTime(t,n,s,a),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,n,s){return this._param.rampTo(t,n,s),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Qi(o,t,n,s){(t instanceof xt||zn(t)||t instanceof bt&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof bt&&(t.overridden=!0)),Oe(o,t,n,s)}class Es extends xt{constructor(){super(V(Es.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new $e(1/0),this._multiplier=1;let t=V(Es.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(xt.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,n,s){n=this.toSeconds(n),this.setRampPoint(n);let a=this._fromType(t),d=this._events.get(n),_=Math.round(Math.max(1/s,1));for(let O=0;O<=_;O++){let E=s*O+n,D=this._exponentialApproach(d.time,d.value,a,s,E);this.linearRampToValueAtTime(this._toType(D),E)}return this}setValueAtTime(t,n){let s=this.toSeconds(n);super.setValueAtTime(t,n);let a=this._events.get(s),d=this._events.previousEvent(a),_=this._getTicksUntilEvent(d,s);return a.ticks=Math.max(_,0),this}linearRampToValueAtTime(t,n){let s=this.toSeconds(n);super.linearRampToValueAtTime(t,n);let a=this._events.get(s),d=this._events.previousEvent(a),_=this._getTicksUntilEvent(d,s);return a.ticks=Math.max(_,0),this}exponentialRampToValueAtTime(t,n){n=this.toSeconds(n);let s=this._fromType(t),a=this._events.get(n),d=Math.round(Math.max(10*(n-a.time),1)),_=(n-a.time)/d;for(let O=0;O<=d;O++){let E=_*O+a.time,D=this._exponentialInterpolate(a.time,a.value,n,s,E);this.linearRampToValueAtTime(this._toType(D),E)}return this}_getTicksUntilEvent(t,n){if(t===null)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Me(t.ticks)){let _=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(_,t.time)}let s=this._fromType(this.getValueAtTime(t.time)),a=this._fromType(this.getValueAtTime(n)),d=this._events.get(n);return d&&d.time===n&&d.type==="setValueAtTime"&&(a=this._fromType(this.getValueAtTime(n-this.sampleTime))),.5*(n-t.time)*(s+a)+t.ticks}getTicksAtTime(t){let n=this.toSeconds(t),s=this._events.get(n);return Math.max(this._getTicksUntilEvent(s,n),0)}getDurationOfTicks(t,n){let s=this.toSeconds(n),a=this.getTicksAtTime(n);return this.getTimeOfTick(a+t)-s}getTimeOfTick(t){let n=this._events.get(t,"ticks"),s=this._events.getAfter(t,"ticks");if(n&&n.ticks===t)return n.time;if(n&&s&&s.type==="linearRampToValueAtTime"&&n.value!==s.value){let a=this._fromType(this.getValueAtTime(n.time)),d=(this._fromType(this.getValueAtTime(s.time))-a)/(s.time-n.time),_=Math.sqrt(Math.pow(a,2)-2*d*(n.ticks-t)),O=(-a+_)/d,E=(-a-_)/d;return(O>0?O:E)+n.time}return n?n.value===0?1/0:n.time+(t-n.ticks)/n.value:t/this._initialValue}ticksToTime(t,n){return this.getDurationOfTicks(t,n)}timeToTicks(t,n){let s=this.toSeconds(n),a=this.toSeconds(t),d=this.getTicksAtTime(s);return this.getTicksAtTime(s+a)-d}_fromType(t){return this.units==="bpm"&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return this.units==="bpm"&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){let n=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(n,0)}}class Rs extends bt{constructor(){super(V(Rs.getDefaults(),arguments,["value"])),this.name="TickSignal";let t=V(Rs.getDefaults(),arguments,["value"]);this.input=this._param=new Es({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(bt.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,n){return this._param.ticksToTime(t,n)}timeToTicks(t,n){return this._param.timeToTicks(t,n)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,n){return this._param.getDurationOfTicks(t,n)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class Ds extends le{constructor(){super(V(Ds.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new hi,this._tickOffset=new $e;let t=V(Ds.getDefaults(),arguments,["frequency"]);this.frequency=new Rs({context:this.context,units:t.units,value:t.frequency}),_t(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},le.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,n){let s=this.toSeconds(t);return this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),Ct(n)&&this.setTicksAtTime(n,s)),this}stop(t){let n=this.toSeconds(t);if(this._state.getValueAtTime(n)==="stopped"){let s=this._state.get(n);s&&s.time>0&&(this._tickOffset.cancel(s.time),this._state.cancel(s.time))}return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this.setTicksAtTime(0,n),this}pause(t){let n=this.toSeconds(t);return this._state.getValueAtTime(n)==="started"&&this._state.setStateAtTime("paused",n),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){let n=this.toSeconds(t),s=this._state.getLastState("stopped",n),a={state:"paused",time:n};this._state.add(a);let d=s,_=0;return this._state.forEachBetween(s.time,n+this.sampleTime,O=>{let E=d.time,D=this._tickOffset.get(O.time);D&&D.time>=d.time&&(_=D.ticks,E=D.time),d.state==="started"&&O.state!=="started"&&(_+=this.frequency.getTicksAtTime(O.time)-this.frequency.getTicksAtTime(E)),d=O}),this._state.remove(a),_}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){let n=this.now(),s=this.frequency.timeToTicks(t,n);this.setTicksAtTime(s,n)}getSecondsAtTime(t){t=this.toSeconds(t);let n=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);let a=n,d=0;return this._state.forEachBetween(n.time,t+this.sampleTime,_=>{let O=a.time,E=this._tickOffset.get(_.time);E&&E.time>=a.time&&(d=E.seconds,O=E.time),a.state==="started"&&_.state!=="started"&&(d+=_.time-O),a=_}),this._state.remove(s),d}setTicksAtTime(t,n){return n=this.toSeconds(n),this._tickOffset.cancel(n),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,n),ticks:t,time:n}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,n=this.now()){let s=this._tickOffset.get(n),a=this._state.get(n),d=Math.max(s.time,a.time),_=this.frequency.getTicksAtTime(d)+t-s.ticks;return this.frequency.getTimeOfTick(_)}forEachTickBetween(t,n,s){let a=this._state.get(t);this._state.forEachBetween(t,n,_=>{a&&a.state==="started"&&_.state!=="started"&&this.forEachTickBetween(Math.max(a.time,t),_.time-this.sampleTime,s),a=_});let d=null;if(a&&a.state==="started"){let _=Math.max(a.time,t),O=this.frequency.getTicksAtTime(_),E=O-this.frequency.getTicksAtTime(a.time),D=Math.ceil(E)-E;D=Je(D,1)?0:D;let I=this.frequency.getTimeOfTick(O+D);for(;I<n;){try{s(I,Math.round(this.getTicksAtTime(I)))}catch(A){d=A;break}I+=this.frequency.getDurationOfTicks(1,I)}}if(d)throw d;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Bn extends le{constructor(){super(V(Bn.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Mt,this._lastUpdate=0,this._state=new hi("stopped"),this._boundLoop=this._loop.bind(this);let t=V(Bn.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new Ds({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,_t(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(le.getDefaults(),{callback:Mt,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,n){so(this.context);let s=this.toSeconds(t);return this.log("start",s),this._state.getValueAtTime(s)!=="started"&&(this._state.setStateAtTime("started",s),this._tickSource.start(s,n),s<this._lastUpdate&&this.emit("start",s,n)),this}stop(t){let n=this.toSeconds(t);return this.log("stop",n),this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._tickSource.stop(n),n<this._lastUpdate&&this.emit("stop",n),this}pause(t){let n=this.toSeconds(t);return this._state.getValueAtTime(n)==="started"&&(this._state.setStateAtTime("paused",n),this._tickSource.pause(n),n<this._lastUpdate&&this.emit("pause",n)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,n){return this._tickSource.setTicksAtTime(t,n),this}getTimeOfTick(t,n=this.now()){return this._tickSource.getTimeOfTick(t,n)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,n){let s=this.toSeconds(n),a=this.getTicksAtTime(s);return this._tickSource.getTimeOfTick(a+t,s)}_loop(){let t=this._lastUpdate,n=this.now();this._lastUpdate=n,this.log("loop",t,n),t!==n&&(this._state.forEachBetween(t,n,s=>{switch(s.state){case"started":let a=this._tickSource.getTicksAtTime(s.time);this.emit("start",s.time,a);break;case"stopped":s.time!==0&&this.emit("stop",s.time);break;case"paused":this.emit("pause",s.time)}}),this._tickSource.forEachTickBetween(t,n,(s,a)=>{this.callback(s,a)}))}getStateAtTime(t){let n=this.toSeconds(t);return this._state.getValueAtTime(n)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}si.mixin(Bn);class Ee extends rt{constructor(){super(V(Ee.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";let t=V(Ee.getDefaults(),arguments,["delayTime","maxDelay"]),n=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(n,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(n),this.delayTime=new xt({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),_t(this,"delayTime")}static getDefaults(){return Object.assign(rt.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}function hu(o,t,n=2,s=Wt().sampleRate){return Vt(this,void 0,void 0,function*(){let a=Wt(),d=new oi(n,t,s);Ms(d),yield o(d);let _=d.render();Ms(a);let O=yield _;return new Dt(O)})}class ui extends mn{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let t=V(ui.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach(n=>{this._loadingCount++;let s=t.urls[n];this.add(n,s,this._bufferLoaded.bind(this,t.onload),t.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Mt,onload:Mt,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return mt(this.has(t),"ToneAudioBuffers has no buffer named: "+t),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,this._loadingCount===0&&t&&t()}get loaded(){return Array.from(this._buffers).every(([t,n])=>n.loaded)}add(t,n,s=Mt,a=Mt){return Be(n)?this._buffers.set(t.toString(),new Dt(this.baseUrl+n,s,a)):this._buffers.set(t.toString(),new Dt(n,s,a)),this}dispose(){return super.dispose(),this._buffers.forEach(t=>t.dispose()),this._buffers.clear(),this}}class pi extends Ce{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return Mn(super._frequencyToUnits(t))}_ticksToUnits(t){return Mn(super._ticksToUnits(t))}_beatsToUnits(t){return Mn(super._beatsToUnits(t))}_secondsToUnits(t){return Mn(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return ho(this.toMidi())}transpose(t){return new pi(this.context,this.toMidi()+t)}}function lu(o,t){return new pi(Wt(),o,t)}class zt extends se{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function uu(o,t){return new zt(Wt(),o,t)}class pu extends le{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new $e,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,n){return this._events.add({callback:t,time:this.toSeconds(n)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){let t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){let n=this._events.shift();n&&t-n.time<=this.expiration&&n.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Ss(o=>{o.draw=new pu({context:o})}),Cs(o=>{o.draw.dispose()});class sc extends mn{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){mt(Ct(t.time),"Events must have a time property"),mt(Ct(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let n=new du(t.time,t.time+t.duration,t);for(this._root===null?this._root=n:this._root.insert(n),this._length++;n!==null;)n.updateHeight(),n.updateMax(),this._rebalance(n),n=n.parent;return this}remove(t){if(this._root!==null){let n=[];this._root.search(t.time,n);for(let s of n)if(s.event===t){this._removeNode(s),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,n=>this.remove(n)),this}_setRoot(t){this._root=t,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(t,n){t.parent!==null?(t.isLeftChild()?t.parent.left=n:t.parent.right=n,this._rebalance(t.parent)):this._setRoot(n)}_removeNode(t){if(t.left===null&&t.right===null)this._replaceNodeInParent(t,null);else if(t.right===null)this._replaceNodeInParent(t,t.left);else if(t.left===null)this._replaceNodeInParent(t,t.right);else{let n,s=null;if(t.getBalance()>0)if(t.left.right===null)n=t.left,n.right=t.right,s=n;else{for(n=t.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,s=n.parent,n.left=t.left,n.right=t.right)}else if(t.right.left===null)n=t.right,n.left=t.left,s=n;else{for(n=t.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,s=n.parent,n.left=t.left,n.right=t.right)}t.parent!==null?t.isLeftChild()?t.parent.left=n:t.parent.right=n:this._setRoot(n),s&&this._rebalance(s)}t.dispose()}_rotateLeft(t){let n=t.parent,s=t.isLeftChild(),a=t.right;a&&(t.right=a.left,a.left=t),n!==null?s?n.left=a:n.right=a:this._setRoot(a)}_rotateRight(t){let n=t.parent,s=t.isLeftChild(),a=t.left;a&&(t.left=a.right,a.right=t),n!==null?s?n.left=a:n.right=a:this._setRoot(a)}_rebalance(t){let n=t.getBalance();n>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):n<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(this._root!==null){let n=[];if(this._root.search(t,n),n.length>0){let s=n[0];for(let a=1;a<n.length;a++)n[a].low>s.low&&(s=n[a]);return s.event}}return null}forEach(t){if(this._root!==null){let n=[];this._root.traverse(s=>n.push(s)),n.forEach(s=>{s.event&&t(s.event)})}return this}forEachAtTime(t,n){if(this._root!==null){let s=[];this._root.search(t,s),s.forEach(a=>{a.event&&n(a.event)})}return this}forEachFrom(t,n){if(this._root!==null){let s=[];this._root.searchAfter(t,s),s.forEach(a=>{a.event&&n(a.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(t=>t.dispose()),this._root=null,this}}class du{constructor(t,n,s){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=s,this.low=t,this.high=n,this.max=this.high}insert(t){t.low<=this.low?this.left===null?this.left=t:this.left.insert(t):this.right===null?this.right=t:this.right.insert(t)}search(t,n){t>this.max||(this.left!==null&&this.left.search(t,n),this.low<=t&&this.high>t&&n.push(this),this.low>t||this.right!==null&&this.right.search(t,n))}searchAfter(t,n){this.low>=t&&(n.push(this),this.left!==null&&this.left.searchAfter(t,n)),this.right!==null&&this.right.searchAfter(t,n)}traverse(t){t(this),this.left!==null&&this.left.traverse(t),this.right!==null&&this.right.traverse(t)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return this.left!==null&&this.right!==null?t=this.left.height-this.right.height:this.left!==null?t=this.left.height+1:this.right!==null&&(t=-(this.right.height+1)),t}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,t!==null&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class sn extends rt{constructor(){super(V(sn.getDefaults(),arguments,["volume"])),this.name="Volume";let t=V(sn.getDefaults(),arguments,["volume"]);this.input=this.output=new ft({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,_t(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(rt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class As extends rt{constructor(){super(V(As.getDefaults(),arguments)),this.name="Destination",this.input=new sn({context:this.context}),this.output=new ft({context:this.context}),this.volume=this.input.volume;let t=V(As.getDefaults(),arguments);qe(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(rt.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),qe(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Ss(o=>{o.destination=new As({context:o})}),Cs(o=>{o.destination.dispose()});class fu extends mn{constructor(t){super(),this.name="TimelineValue",this._timeline=new $e({memory:10}),this._initialValue=t}set(t,n){return this._timeline.add({value:t,time:n}),this}get(t){let n=this._timeline.get(t);return n?n.value:this._initialValue}}class On{constructor(t,n){this.id=On._eventId++;let s=Object.assign(On.getDefaults(),n);this.transport=t,this.callback=s.callback,this._once=s.once,this.time=s.time}static getDefaults(){return{callback:Mt,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}On._eventId=0;class po extends On{constructor(t,n){super(t,n),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);let s=Object.assign(po.getDefaults(),n);this.duration=new zt(t.context,s.duration).valueOf(),this._interval=new zt(t.context,s.interval).valueOf(),this._nextTick=s.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},On.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){let n=this.transport.getTicksAtTime(t);n>=this.time&&n>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new zt(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;let n=this.transport.getTicksAtTime(t);n>this.time&&(this._nextTick=this.time+Math.ceil((n-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new zt(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new zt(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Xi extends le{constructor(){super(V(Xi.getDefaults(),arguments)),this.name="Transport",this._loop=new fu(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new $e,this._repeatedEvents=new sc,this._syncedSignals=[],this._swingAmount=0;let t=V(Xi.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new Bn({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),_t(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(le.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,n){if(this._loop.get(t)&&n>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),n=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&n%this._ppq!=0&&n%(2*this._swingTicks)!=0){let s=n%(2*this._swingTicks)/(2*this._swingTicks),a=Math.sin(s*Math.PI)*this._swingAmount;t+=new zt(this.context,2*this._swingTicks/3).toSeconds()*a}this._timeline.forEachAtTime(n,s=>s.invoke(t))}schedule(t,n){let s=new On(this,{callback:t,time:new se(this.context,n).toTicks()});return this._addEvent(s,this._timeline)}scheduleRepeat(t,n,s,a=1/0){let d=new po(this,{callback:t,duration:new Le(this.context,a).toTicks(),interval:new Le(this.context,n).toTicks(),time:new se(this.context,s).toTicks()});return this._addEvent(d,this._repeatedEvents)}scheduleOnce(t,n){let s=new On(this,{callback:t,once:!0,time:new se(this.context,n).toTicks()});return this._addEvent(s,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){let n=this._scheduledEvents[t.toString()];n.timeline.remove(n.event),n.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,n){return this._scheduledEvents[t.id.toString()]={event:t,timeline:n},n.add(t),t.id}cancel(t=0){let n=this.toTicks(t);return this._timeline.forEachFrom(n,s=>this.clear(s.id)),this._repeatedEvents.forEachFrom(n,s=>this.clear(s.id)),this}_bindClockEvents(){this._clock.on("start",(t,n)=>{n=new zt(this.context,n).toSeconds(),this.emit("start",t,n)}),this._clock.on("stop",t=>{this.emit("stop",t)}),this._clock.on("pause",t=>{this.emit("pause",t)})}get state(){return this._clock.getStateAtTime(this.now())}start(t,n){let s;return Ct(n)&&(s=this.toTicks(n)),this._clock.start(t,s),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),this._clock.getStateAtTime(t)!=="started"?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){_e(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new Le(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new Le(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,n){return this.loopStart=t,this.loopEnd=n,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new zt(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){let t=this.now(),n=this._clock.getTicksAtTime(t);return new zt(this.context,n).toBarsBeatsSixteenths()}set position(t){let n=this.toTicks(t);this.ticks=n}get seconds(){return this._clock.seconds}set seconds(t){let n=this.now(),s=this._clock.frequency.timeToTicks(t,n);this.ticks=s}get progress(){if(this.loop){let t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){let n=this.now();if(this.state==="started"){let s=this._clock.getTicksAtTime(n),a=n+this._clock.frequency.getDurationOfTicks(Math.ceil(s)-s,n);this.emit("stop",a),this._clock.setTicksAtTime(t,a),this.emit("start",a,this._clock.getSecondsAtTime(a))}else this._clock.setTicksAtTime(t,n)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),this.state!=="started")return 0;{let n=this.now(),s=t-this.getTicksAtTime(n)%t;return this._clock.nextTickTime(s,n)}}syncSignal(t,n){if(!n){let a=this.now();if(t.getValueAtTime(a)!==0){let d=1/(60/this.bpm.getValueAtTime(a)/this.PPQ);n=t.getValueAtTime(a)/d}else n=0}let s=new ft(n);return this.bpm.connect(s),s.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:s,signal:t}),t.value=0,this}unsyncSignal(t){for(let n=this._syncedSignals.length-1;n>=0;n--){let s=this._syncedSignals[n];s.signal===t&&(s.ratio.dispose(),s.signal.value=s.initial,this._syncedSignals.splice(n,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Gi(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}si.mixin(Xi),Ss(o=>{o.transport=new Xi({context:o})}),Cs(o=>{o.transport.dispose()});class $t extends rt{constructor(t){super(t),this.input=void 0,this._state=new hi("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Mt,this._syncedStop=Mt,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new sn({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,_t(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(rt.getDefaults(),{mute:!1,onstop:Mt,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,n,s){let a=Me(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(a=this._clampToCurrentTime(a),this._synced||this._state.getValueAtTime(a)!=="started")if(this.log("start",a),this._state.setStateAtTime("started",a),this._synced){let d=this._state.get(a);d&&(d.offset=this.toSeconds(Ue(n,0)),d.duration=s?this.toSeconds(s):void 0);let _=this.context.transport.schedule(O=>{this._start(O,n,s)},a);this._scheduled.push(_),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>a&&this._syncedStart(this.now(),this.context.transport.seconds)}else so(this.context),this._start(a,n,s);else mt(Ts(a,this._state.get(a).time),"Start time must be strictly greater than previous start time"),this._state.cancel(a),this._state.setStateAtTime("started",a),this.log("restart",a),this.restart(a,n,s);return this}stop(t){let n=Me(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(n=this._clampToCurrentTime(n),this._state.getValueAtTime(n)==="started"||Ct(this._state.getNextState("started",n))){if(this.log("stop",n),this._synced){let s=this.context.transport.schedule(this._stop.bind(this),n);this._scheduled.push(s)}else this._stop(n);this._state.cancel(n),this._state.setStateAtTime("stopped",n)}return this}restart(t,n,s){return t=this.toSeconds(t),this._state.getValueAtTime(t)==="started"&&(this._state.cancel(t),this._restart(t,n,s)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,n)=>{if(n>0){let s=this._state.get(n);if(s&&s.state==="started"&&s.time!==n){let a=n-this.toSeconds(s.time),d;s.duration&&(d=this.toSeconds(s.duration)-a),this._start(t,this.toSeconds(s.offset)+a,d)}}},this._syncedStop=t=>{let n=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));this._state.getValueAtTime(n)==="started"&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(t=>this.context.transport.clear(t)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Mt,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class gn extends li{constructor(){super(V(gn.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;let t=V(gn.getDefaults(),arguments,["url","onload"]);Oe(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new xt({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new Dt(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(li.getDefaults(),{url:new Dt,loop:!1,loopEnd:0,loopStart:0,onload:Mt,onerror:Mt,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,n,s,a=1){mt(this.buffer.loaded,"buffer is either not set or not loaded");let d=this.toSeconds(t);this._startGain(d,a),n=this.loop?Ue(n,this.loopStart):Ue(n,0);let _=Math.max(this.toSeconds(n),0);if(this.loop){let O=this.toSeconds(this.loopEnd)||this.buffer.duration,E=this.toSeconds(this.loopStart),D=O-E;ao(_,O)&&(_=(_-E)%D+E),Je(_,this.buffer.duration)&&(_=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,$a(_,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(d,_)),Ct(s)){let O=this.toSeconds(s);O=Math.max(O,0),this.stop(d+O)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class vn extends $t{constructor(){super(V(vn.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;let t=V(vn.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign($t.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(mt(t in rc,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,this.state==="started")){let n=this.now();this._stop(n),this._start(n)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){let n=rc[this._type];this._source=new gn({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(n.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}let _n={brown:null,pink:null,white:null},rc={get brown(){if(!_n.brown){let o=[];for(let t=0;t<2;t++){let n=new Float32Array(220500);o[t]=n;let s=0;for(let a=0;a<220500;a++){let d=2*Math.random()-1;n[a]=(s+.02*d)/1.02,s=n[a],n[a]*=3.5}}_n.brown=new Dt().fromArray(o)}return _n.brown},get pink(){if(!_n.pink){let o=[];for(let t=0;t<2;t++){let n=new Float32Array(220500),s,a,d,_,O,E,D;o[t]=n,s=a=d=_=O=E=D=0;for(let I=0;I<220500;I++){let A=2*Math.random()-1;s=.99886*s+.0555179*A,a=.99332*a+.0750759*A,d=.969*d+.153852*A,_=.8665*_+.3104856*A,O=.55*O+.5329522*A,E=-.7616*E-.016898*A,n[I]=s+a+d+_+O+E+D+.5362*A,n[I]*=.11,D=.115926*A}}_n.pink=new Dt().fromArray(o)}return _n.pink},get white(){if(!_n.white){let o=[];for(let t=0;t<2;t++){let n=new Float32Array(220500);o[t]=n;for(let s=0;s<220500;s++)n[s]=2*Math.random()-1}_n.white=new Dt().fromArray(o)}return _n.white}};class di extends rt{constructor(){super(V(di.getDefaults(),arguments,["volume"])),this.name="UserMedia";let t=V(di.getDefaults(),arguments,["volume"]);this._volume=this.output=new sn({context:this.context,volume:t.volume}),this.volume=this._volume.volume,_t(this,"volume"),this.mute=t.mute}static getDefaults(){return Object.assign(rt.getDefaults(),{mute:!1,volume:0})}open(t){return Vt(this,void 0,void 0,function*(){mt(di.supported,"UserMedia is not supported"),this.state==="started"&&this.close();let n=yield di.enumerateDevices();Fe(t)?this._device=n[t]:(this._device=n.find(d=>d.label===t||d.deviceId===t),!this._device&&n.length>0&&(this._device=n[0]),mt(Ct(this._device),"No matching device "+t));let s={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(s.audio.deviceId=this._device.deviceId);let a=yield navigator.mediaDevices.getUserMedia(s);if(!this._stream){this._stream=a;let d=this.context.createMediaStreamSource(a);Oe(d,this.output),this._mediaStream=d}return this})}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach(t=>{t.stop()}),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return Vt(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(t=>t.kind==="audioinput")})}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return Ct(navigator.mediaDevices)&&Ct(navigator.mediaDevices.getUserMedia)}}function Wn(o,t){return Vt(this,void 0,void 0,function*(){let n=t/o.context.sampleRate,s=new oi(1,n,o.context.sampleRate);return new o.constructor(Object.assign(o.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)})}class fi extends li{constructor(){super(V(fi.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];let t=V(fi.getDefaults(),arguments,["frequency","type"]);Oe(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new xt({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new xt({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),_t(this,["frequency","detune"])}static getDefaults(){return Object.assign(li.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){let n=this.toSeconds(t);return this.log("start",n),this._startGain(n),this._oscillator.start(n),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Ut extends $t{constructor(){super(V(Ut.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;let t=V(Ut.getDefaults(),arguments,["frequency","type"]);this.frequency=new bt({context:this.context,units:"frequency",value:t.frequency}),_t(this,"frequency"),this.detune=new bt({context:this.context,units:"cents",value:t.detune}),_t(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&t.type!=="custom"&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign($t.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){let n=this.toSeconds(t),s=new fi({context:this.context,onended:()=>this.onstop(this)});this._oscillator=s,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}_stop(t){let n=this.toSeconds(t);this._oscillator&&this._oscillator.stop(n)}_restart(t){let n=this.toSeconds(t);return this.log("restart",n),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(n),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Ut._periodicWaveCache.find(t=>{return t.phase===this._phase&&(n=t.partials,s=this._partials,n.length===s.length&&n.every((a,d)=>s[d]===a));var n,s});{let t=Ut._periodicWaveCache.find(n=>n.type===this._type&&n.phase===this._phase);return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;let n=["sine","square","sawtooth","triangle"].indexOf(t)!==-1;if(this._phase===0&&n)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=t);else{let s=this._getCachedPeriodicWave();if(Ct(s)){let{partials:a,wave:d}=s;this._wave=d,this._partials=a,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{let[a,d]=this._getRealImaginary(t,this._phase),_=this.context.createPeriodicWave(a,d);this._wave=_,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Ut._periodicWaveCache.push({imag:d,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:a,type:this._type,wave:this._wave}),Ut._periodicWaveCache.length>100&&Ut._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&this._type!=="custom"&&t!=="custom"?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){ve(t,0);let n=this._type,s=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(s&&(n=s[1]),this._type!=="custom")this.type=t===0?n:n+t.toString();else{let a=new Float32Array(t);this._partials.forEach((d,_)=>a[_]=d),this._partials=Array.from(a),this.type=this._type}}_getRealImaginary(t,n){let s=2048,a=new Float32Array(s),d=new Float32Array(s),_=1;if(t==="custom"){if(_=this._partials.length+1,this._partialCount=this._partials.length,s=_,this._partials.length===0)return[a,d]}else{let O=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);O?(_=parseInt(O[2],10)+1,this._partialCount=parseInt(O[2],10),t=O[1],_=Math.max(_,2),s=_):this._partialCount=0,this._partials=[]}for(let O=1;O<s;++O){let E=2/(O*Math.PI),D;switch(t){case"sine":D=O<=_?1:0,this._partials[O-1]=D;break;case"square":D=1&O?2*E:0,this._partials[O-1]=D;break;case"sawtooth":D=E*(1&O?1:-1),this._partials[O-1]=D;break;case"triangle":D=1&O?E*E*2*(O-1>>1&1?-1:1):0,this._partials[O-1]=D;break;case"custom":D=this._partials[O-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}D!==0?(a[O]=-D*Math.sin(n*O),d[O]=D*Math.cos(n*O)):(a[O]=0,d[O]=0)}return[a,d]}_inverseFFT(t,n,s){let a=0,d=t.length;for(let _=0;_<d;_++)a+=t[_]*Math.cos(_*s)+n[_]*Math.sin(_*s);return a}getInitialValue(){let[t,n]=this._getRealImaginary(this._type,0),s=0,a=2*Math.PI;for(let d=0;d<32;d++)s=Math.max(this._inverseFFT(t,n,d/32*a),s);return Ka(-this._inverseFFT(t,n,this._phase)/s,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return Vt(this,void 0,void 0,function*(){return Wn(this,t)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Ut._periodicWaveCache=[];class Ne extends rt{constructor(){super(Object.assign(V(Ne.getDefaults(),arguments,["context"])))}connect(t,n=0,s=0){return Qi(this,t,n,s),this}}class Ge extends Ne{constructor(){super(Object.assign(V(Ge.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;let t=V(Ge.getDefaults(),arguments,["mapping","length"]);_e(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):Za(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(bt.getDefaults(),{length:1024})}setMap(t,n=1024){let s=new Float32Array(n);for(let a=0,d=n;a<d;a++){let _=a/(d-1)*2-1;s[a]=t(_,a)}return this.curve=s,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){mt(["none","2x","4x"].some(n=>n.includes(t)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Ps extends Ne{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Ge({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Gt extends bt{constructor(){super(Object.assign(V(Gt.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;let t=V(Gt.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new ft({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(bt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class mi extends $t{constructor(){super(V(mi.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Ps({context:this.context}),this._modulationNode=new ft({context:this.context});let t=V(mi.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Ut({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Ut({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Gt({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),_t(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ut.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Vt(this,void 0,void 0,function*(){return Wn(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Un extends $t{constructor(){super(V(Un.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new ft({context:this.context,gain:0});let t=V(Un.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Ut({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new bt({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new Ut({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new Gt({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new Gt({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),_t(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ut.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Vt(this,void 0,void 0,function*(){return Wn(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Gn extends $t{constructor(){super(V(Gn.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new ft({context:this.context,gain:0}),this._thresh=new Ge({context:this.context,mapping:n=>n<=0?-1:1});let t=V(Gn.getDefaults(),arguments,["frequency","width"]);this.width=new bt({context:this.context,units:"audioRange",value:t.width}),this._triangle=new Ut({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),_t(this,["width","frequency","detune"])}static getDefaults(){return Object.assign($t.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return Vt(this,void 0,void 0,function*(){return Wn(this,t)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class gi extends $t{constructor(){super(V(gi.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];let t=V(gi.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new bt({context:this.context,units:"frequency",value:t.frequency}),this.detune=new bt({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,_t(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ut.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach(n=>n.start(t))}_stop(t){t=this.toSeconds(t),this._forEach(n=>n.stop(t))}_restart(t){this._forEach(n=>n.restart(t))}_forEach(t){for(let n=0;n<this._oscillators.length;n++)t(this._oscillators[n],n)}get type(){return this._type}set type(t){this._type=t,this._forEach(n=>n.type=t)}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){let n=-t/2,s=t/(this._oscillators.length-1);this._forEach((a,d)=>a.detune.value=n+s*d)}}get count(){return this._oscillators.length}set count(t){if(ve(t,1),this._oscillators.length!==t){this._forEach(n=>n.dispose()),this._oscillators=[];for(let n=0;n<t;n++){let s=new Ut({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+n/t*360,partialCount:this._partialCount,onstop:n===0?()=>this.onstop(this):Mt});this.type==="custom"&&(s.partials=this._partials),this.frequency.connect(s.frequency),this.detune.connect(s.detune),s.detune.overridden=!1,s.connect(this.output),this._oscillators[n]=s}this.spread=this._spread,this.state==="started"&&this._forEach(n=>n.start())}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach((n,s)=>n.phase=this._phase+s/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach(n=>n.baseType=t),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach(n=>n.partials=t))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach(n=>n.partialCount=t),this._type=this._oscillators[0].type}asArray(t=1024){return Vt(this,void 0,void 0,function*(){return Wn(this,t)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(t=>t.dispose()),this}}class vi extends $t{constructor(){super(V(vi.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Gt({context:this.context,value:2});let t=V(vi.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Gn({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Ut({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),_t(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign($t.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return Vt(this,void 0,void 0,function*(){return Wn(this,t)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}let oc={am:mi,fat:gi,fm:Un,oscillator:Ut,pulse:Gn,pwm:vi};class rn extends $t{constructor(){super(V(rn.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";let t=V(rn.getDefaults(),arguments,["frequency","type"]);this.frequency=new bt({context:this.context,units:"frequency",value:t.frequency}),this.detune=new bt({context:this.context,units:"cents",value:t.detune}),_t(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(Ut.getDefaults(),Un.getDefaults(),mi.getDefaults(),gi.getDefaults(),Gn.getDefaults(),vi.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some(n=>this._sourceType===n)&&(t=this._sourceType),t+this._oscillator.type}set type(t){t.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):t.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):t==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):t==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;let n=oc[t],s=this.now();if(this._oscillator){let a=this._oscillator;a.stop(s),this.context.setTimeout(()=>a.dispose(),this.blockTime)}this._oscillator=new n({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(s)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let n="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(n=this._oscillator.type),t==="fm"?this.type="fm"+n:t==="am"?this.type="am"+n:t==="fat"?this.type="fat"+n:t==="oscillator"?this.type=n:t==="pulse"?this.type="pulse":t==="pwm"&&(this.type="pwm")}_getOscType(t,n){return t instanceof oc[n]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||t==="pulse"||t==="pwm"||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Fe(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Fe(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Be(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return Vt(this,void 0,void 0,function*(){return Wn(this,t)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Yn extends bt{constructor(){super(Object.assign(V(Yn.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new ft({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,qe(this._constantSource,this._sum)}static getDefaults(){return Object.assign(bt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class on extends Ne{constructor(){super(Object.assign(V(on.getDefaults(),arguments,["min","max"]))),this.name="Scale";let t=V(on.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Gt({context:this.context,value:t.max-t.min}),this._add=this.output=new Yn({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Ne.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class Is extends Ne{constructor(){super(Object.assign(V(Is.getDefaults(),arguments))),this.name="Zero",this._gain=new ft({context:this.context}),this.output=this._gain,this.input=void 0,Oe(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),uo(this.context.getConstant(0),this._gain),this}}class Te extends rt{constructor(){super(V(Te.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=xt.prototype._fromType,this._toType=xt.prototype._toType,this._is=xt.prototype._is,this._clampValue=xt.prototype._clampValue;let t=V(Te.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new Ut(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new ft({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new bt({context:this.context,units:"audioRange",value:0}),this._zeros=new Is({context:this.context}),this._a2g=new Ps({context:this.context}),this._scaler=this.output=new on({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),_t(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(Ut.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){let n=this.min,s=this.max;this._units=t,this.min=n,this.max=s}get state(){return this._oscillator.state}connect(t,n,s){return(t instanceof xt||t instanceof bt)&&(this.convert=t.convert,this.units=t.units),Qi(this,t,n,s),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function ac(o,t=1/0){let n=new WeakMap;return function(s,a){Reflect.defineProperty(s,a,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(d){ve(d,o,t),n.set(this,d)}})}}function yn(o,t=1/0){let n=new WeakMap;return function(s,a){Reflect.defineProperty(s,a,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(d){ve(this.toSeconds(d),o,t),n.set(this,d)}})}}class Hn extends $t{constructor(){super(V(Hn.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;let t=V(Hn.getDefaults(),arguments,["url","onload"]);this._buffer=new Dt({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign($t.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Mt,onerror:Mt,playbackRate:1,reverse:!1})}load(t){return Vt(this,void 0,void 0,function*(){return yield this._buffer.load(t),this._onload(),this})}_onload(t=Mt){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),this._activeSources.size!==0||this._synced||this._state.getValueAtTime(this.now())!=="started"||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,n,s){return super.start(t,n,s),this}_start(t,n,s){n=this._loop?Ue(n,this._loopStart):Ue(n,0);let a=this.toSeconds(n),d=s;s=Ue(s,Math.max(this._buffer.duration-a,0));let _=this.toSeconds(s);_/=this._playbackRate,t=this.toSeconds(t);let O=new gn({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+_),this._state.setStateAtTime("stopped",t+_,{implicitEnd:!0})),this._activeSources.add(O),this._loop&&Me(d)?O.start(t,a):O.start(t,a,_-this.toSeconds(this.fadeOut))}_stop(t){let n=this.toSeconds(t);this._activeSources.forEach(s=>s.stop(n))}restart(t,n,s){return super.restart(t,n,s),this}_restart(t,n,s){this._stop(t),this._start(t,n,s)}seek(t,n){let s=this.toSeconds(n);if(this._state.getValueAtTime(s)==="started"){let a=this.toSeconds(t);this._stop(s),this._start(s,a)}return this}setLoopPoints(t,n){return this.loopStart=t,this.loopEnd=n,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&ve(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopStart=t})}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&ve(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach(n=>{n.loopEnd=t})}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach(n=>{n.loop=t}),t)){let n=this._state.getNextState("stopped",this.now());n&&this._state.cancel(n.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;let n=this.now(),s=this._state.getNextState("stopped",n);s&&s.implicitEnd&&(this._state.cancel(s.time),this._activeSources.forEach(a=>a.cancelStop())),this._activeSources.forEach(a=>{a.playbackRate.setValueAtTime(t,n)})}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(t=>t.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Ze([yn(0)],Hn.prototype,"fadeIn",void 0),Ze([yn(0)],Hn.prototype,"fadeOut",void 0);class js extends rt{constructor(){super(V(js.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;let t=V(js.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new sn({context:this.context,volume:t.volume}),this.volume=this._volume.volume,_t(this,"volume"),this._buffers=new ui({urls:t.urls,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.mute=t.mute,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign($t.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:Mt,onerror:Mt,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._players.forEach(n=>{n.fadeIn=t})}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._players.forEach(n=>{n.fadeOut=t})}get state(){return Array.from(this._players).some(([t,n])=>n.state==="started")?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){if(mt(this.has(t),`No Player with the name ${t} exists on this object`),!this._players.has(t)){let n=new Hn({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output);this._players.set(t,n)}return this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,n,s){return mt(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,n,s),this}stopAll(t){return this._players.forEach(n=>n.stop(t)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(t=>t.dispose()),this._buffers.dispose(),this}}class Fs extends $t{constructor(){super(V(Fs.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];let t=V(Fs.getDefaults(),arguments,["url","onload"]);this.buffer=new Dt({onload:t.onload,onerror:t.onerror,reverse:t.reverse,url:t.url}),this._clock=new Bn({context:this.context,callback:this._tick.bind(this),frequency:1/t.grainSize}),this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign($t.getDefaults(),{onload:Mt,onerror:Mt,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,n,s){n=Ue(n,0),n=this.toSeconds(n),t=this.toSeconds(t);let a=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,n/a),s&&this.stop(t+this.toSeconds(s))}restart(t,n,s){return super.restart(t,n,s),this}_restart(t,n,s){this._stop(t),this._start(t,n,s)}_stop(t){this._clock.stop(t)}_onstop(t){this._activeSources.forEach(n=>{n.fadeOut=0,n.stop(t)}),this.onstop(this)}_tick(t){let n=this._clock.getTicksAtTime(t),s=n*this._grainSize;if(this.log("offset",s),!this.loop&&s>this.buffer.duration)return void this.stop(t);let a=s<this._overlap?0:this._overlap,d=new gn({context:this.context,url:this.buffer,fadeIn:a,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:ci(this.detune/100)}).connect(this.output);d.start(t,this._grainSize*n),d.stop(t+this._grainSize/this.playbackRate),this._activeSources.push(d),d.onended=()=>{let _=this._activeSources.indexOf(d);_!==-1&&this._activeSources.splice(_,1)}}get playbackRate(){return this._playbackRate}set playbackRate(t){ve(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&ve(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&ve(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){let n=this.toSeconds(t);ve(n,0),this._overlap=n}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(t=>t.dispose()),this}}class cc extends Ne{constructor(){super(...arguments),this.name="Abs",this._abs=new Ge({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class hc extends Ne{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Ge({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class fo extends Ne{constructor(){super(...arguments),this.name="Negate",this._multiply=new Gt({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class Qn extends bt{constructor(){super(Object.assign(V(Qn.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new ft({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new fo({context:this.context}),this.subtrahend=this._param,qe(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(bt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class Ls extends Ne{constructor(){super(Object.assign(V(Ls.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new Ge({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new Gt({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class Zi extends bt{constructor(){super(Object.assign(V(Zi.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;let t=V(Zi.getDefaults(),arguments,["value"]);this._subtract=this.input=new Qn({context:this.context,value:t.value}),this._gtz=this.output=new Ls({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,_t(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(bt.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class _i extends Ne{constructor(){super(Object.assign(V(_i.getDefaults(),arguments,["value"]))),this.name="Pow";let t=V(_i.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new Ge({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(Ne.getDefaults(),{value:1})}_expFunc(t){return n=>Math.pow(Math.abs(n),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Ji extends on{constructor(){super(Object.assign(V(Ji.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";let t=V(Ji.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new _i({context:this.context,value:t.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(on.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(t){this._exp.value=t}dispose(){return super.dispose(),this._exp.dispose(),this}}class mu extends bt{constructor(){super(V(bt.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;let t=V(bt.getDefaults(),arguments,["value","units"]);this._lastVal=t.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new Hi({context:this.context,offset:t.value,units:t.units}).start(0),this.setValueAtTime(t.value,0)}_onTick(t){let n=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==n&&(this._lastVal=n,this._constantSource.offset.setValueAtTime(n,t))}_anchorValue(t){let n=super.getValueAtTime(this.context.transport.seconds);this._lastVal=n,this._constantSource.offset.cancelAndHoldAtTime(t),this._constantSource.offset.setValueAtTime(n,t)}getValueAtTime(t){let n=new se(this.context,t).toSeconds();return super.getValueAtTime(n)}setValueAtTime(t,n){let s=new se(this.context,n).toSeconds();return super.setValueAtTime(t,s),this}linearRampToValueAtTime(t,n){let s=new se(this.context,n).toSeconds();return super.linearRampToValueAtTime(t,s),this}exponentialRampToValueAtTime(t,n){let s=new se(this.context,n).toSeconds();return super.exponentialRampToValueAtTime(t,s),this}setTargetAtTime(t,n,s){let a=new se(this.context,n).toSeconds();return super.setTargetAtTime(t,a,s),this}cancelScheduledValues(t){let n=new se(this.context,t).toSeconds();return super.cancelScheduledValues(n),this}setValueCurveAtTime(t,n,s,a){let d=new se(this.context,n).toSeconds();return s=this.toSeconds(s),super.setValueCurveAtTime(t,d,s,a),this}cancelAndHoldAtTime(t){let n=new se(this.context,t).toSeconds();return super.cancelAndHoldAtTime(n),this}setRampPoint(t){let n=new se(this.context,t).toSeconds();return super.setRampPoint(n),this}exponentialRampTo(t,n,s){let a=new se(this.context,s).toSeconds();return super.exponentialRampTo(t,n,a),this}linearRampTo(t,n,s){let a=new se(this.context,s).toSeconds();return super.linearRampTo(t,n,a),this}targetRampTo(t,n,s){let a=new se(this.context,s).toSeconds();return super.targetRampTo(t,n,a),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class ue extends rt{constructor(){super(V(ue.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new bt({context:this.context,value:0}),this.output=this._sig,this.input=void 0;let t=V(ue.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(rt.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,n){if(Be(t))return t;{let s;for(s in qs)if(qs[s][n]===t)return s;return t}}_setCurve(t,n,s){if(Be(s)&&Reflect.has(qs,s)){let a=qs[s];dn(a)?t!=="_decayCurve"&&(this[t]=a[n]):this[t]=a}else{if(!_e(s)||t==="_decayCurve")throw new Error("Envelope: invalid curve: "+s);this[t]=s}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){mt(["linear","exponential"].some(n=>n===t),"Invalid envelope curve: "+t),this._decayCurve=t}triggerAttack(t,n=1){this.log("triggerAttack",t,n),t=this.toSeconds(t);let s=this.toSeconds(this.attack),a=this.toSeconds(this.decay),d=this.getValueAtTime(t);if(d>0&&(s=(1-d)/(1/s)),s<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(n,t);else if(this._attackCurve==="linear")this._sig.linearRampTo(n,s,t);else if(this._attackCurve==="exponential")this._sig.targetRampTo(n,s,t);else{this._sig.cancelAndHoldAtTime(t);let _=this._attackCurve;for(let O=1;O<_.length;O++)if(_[O-1]<=d&&d<=_[O]){_=this._attackCurve.slice(O),_[0]=d;break}this._sig.setValueCurveAtTime(_,t,s,n)}if(a&&this.sustain<1){let _=n*this.sustain,O=t+s;this.log("decay",O),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(_,a+O):this._sig.exponentialApproachValueAtTime(_,O,a)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);let n=this.getValueAtTime(t);if(n>0){let s=this.toSeconds(this.release);s<this.sampleTime?this._sig.setValueAtTime(0,t):this._releaseCurve==="linear"?this._sig.linearRampTo(0,s,t):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,s,t):(mt(_e(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,s,n))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,n,s=1){return n=this.toSeconds(n),this.triggerAttack(n,s),this.triggerRelease(n+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,n=0,s=0){return Qi(this,t,n,s),this}asArray(t=1024){return Vt(this,void 0,void 0,function*(){let n=t/this.context.sampleRate,s=new oi(1,n,this.context.sampleRate),a=this.toSeconds(this.attack)+this.toSeconds(this.decay),d=a+this.toSeconds(this.release),_=.1*d,O=d+_,E=new this.constructor(Object.assign(this.get(),{attack:n*this.toSeconds(this.attack)/O,decay:n*this.toSeconds(this.decay)/O,release:n*this.toSeconds(this.release)/O,context:s}));return E._sig.toDestination(),E.triggerAttackRelease(n*(a+_)/O,0),(yield s.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Ze([yn(0)],ue.prototype,"attack",void 0),Ze([yn(0)],ue.prototype,"decay",void 0),Ze([ac(0,1)],ue.prototype,"sustain",void 0),Ze([yn(0)],ue.prototype,"release",void 0);let qs=(()=>{let o,t,n=[];for(o=0;o<128;o++)n[o]=Math.sin(o/127*(Math.PI/2));let s=[];for(o=0;o<127;o++){t=o/127;let D=Math.sin(t*(2*Math.PI)*6.4-Math.PI/2)+1;s[o]=D/10+.83*t}s[127]=1;let a=[];for(o=0;o<128;o++)a[o]=Math.ceil(o/127*5)/5;let d=[];for(o=0;o<128;o++)t=o/127,d[o]=.5*(1-Math.cos(Math.PI*t));let _=[];for(o=0;o<128;o++){t=o/127;let D=4*Math.pow(t,3)+.2,I=Math.cos(D*Math.PI*2*t);_[o]=Math.abs(I*(1-t))}function O(D){let I=new Array(D.length);for(let A=0;A<D.length;A++)I[A]=1-D[A];return I}return{bounce:{In:O(_),Out:_},cosine:{In:n,Out:(E=n,E.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:s,Out:O(s)},sine:{In:d,Out:O(d)},step:{In:a,Out:O(a)}};var E})();class Ve extends rt{constructor(){super(V(Ve.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;let t=V(Ve.getDefaults(),arguments);this._volume=this.output=new sn({context:this.context,volume:t.volume}),this.volume=this._volume.volume,_t(this,"volume")}static getDefaults(){return Object.assign(rt.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,n){let s=this["_original_"+t]=this[t];this[t]=(...a)=>{let d=a[n],_=this.context.transport.schedule(O=>{a[n]=O,s.apply(this,a)},d);this._scheduledEvents.push(_)}}unsync(){return this._scheduledEvents.forEach(t=>this.context.transport.clear(t)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,n,s,a){let d=this.toSeconds(s),_=this.toSeconds(n);return this.triggerAttack(t,d,a),this.triggerRelease(d+_),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class be extends Ve{constructor(){super(V(be.getDefaults(),arguments));let t=V(be.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Ve.getDefaults(),{detune:0,onsilence:Mt,portamento:0})}triggerAttack(t,n,s=1){this.log("triggerAttack",t,n,s);let a=this.toSeconds(n);return this._triggerEnvelopeAttack(a,s),this.setNote(t,a),this}triggerRelease(t){this.log("triggerRelease",t);let n=this.toSeconds(t);return this._triggerEnvelopeRelease(n),this}setNote(t,n){let s=this.toSeconds(n),a=t instanceof Ce?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(s)>.05){let d=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(a,d,s)}else this.frequency.setValueAtTime(a,s);return this}}Ze([yn(0)],be.prototype,"portamento",void 0);class yi extends ue{constructor(){super(V(yi.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ft({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class bn extends be{constructor(){super(V(bn.getDefaults(),arguments)),this.name="Synth";let t=V(bn.getDefaults(),arguments);this.oscillator=new rn(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new yi(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),_t(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(be.getDefaults(),{envelope:Object.assign(ye(ue.getDefaults(),Object.keys(rt.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(ye(rn.getDefaults(),[...Object.keys($t.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,n){if(this.envelope.triggerAttack(t,n),this.oscillator.start(t),this.envelope.sustain===0){let s=this.toSeconds(this.envelope.attack),a=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+s+a)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class bi extends be{constructor(){super(V(bi.getDefaults(),arguments)),this.name="ModulationSynth";let t=V(bi.getDefaults(),arguments);this._carrier=new bn({context:this.context,oscillator:t.oscillator,envelope:t.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new bn({context:this.context,oscillator:t.modulation,envelope:t.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new bt({context:this.context,units:"frequency"}),this.detune=new bt({context:this.context,value:t.detune,units:"cents"}),this.harmonicity=new Gt({context:this.context,value:t.harmonicity,minValue:0}),this._modulationNode=new ft({context:this.context,gain:0}),_t(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(be.getDefaults(),{harmonicity:3,oscillator:Object.assign(ye(rn.getDefaults(),[...Object.keys($t.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(ye(ue.getDefaults(),Object.keys(rt.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(ye(rn.getDefaults(),[...Object.keys($t.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(ye(ue.getDefaults(),Object.keys(rt.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(t,n){this._carrier._triggerEnvelopeAttack(t,n),this._modulator._triggerEnvelopeAttack(t,n)}_triggerEnvelopeRelease(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class mo extends bi{constructor(){super(V(mo.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new Ps({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class xi extends rt{constructor(){super(V(xi.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";let t=V(xi.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new xt({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new xt({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new xt({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new xt({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(rt.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){mt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,"Invalid filter type: "+t),this._filter.type=t}getFrequencyResponse(t=128){let n=new Float32Array(t);for(let _=0;_<t;_++){let O=19980*Math.pow(_/t,2)+20;n[_]=O}let s=new Float32Array(t),a=new Float32Array(t),d=this.context.createBiquadFilter();return d.type=this.type,d.Q.value=this.Q.value,d.frequency.value=this.frequency.value,d.gain.value=this.gain.value,d.getFrequencyResponse(n,s,a),s}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Re extends rt{constructor(){super(V(Re.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this._filters=[];let t=V(Re.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new bt({context:this.context,units:"positive",value:t.Q}),this.frequency=new bt({context:this.context,units:"frequency",value:t.frequency}),this.detune=new bt({context:this.context,units:"cents",value:t.detune}),this.gain=new bt({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,_t(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(rt.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){mt(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(t)!==-1,"Invalid filter type: "+t),this._type=t,this._filters.forEach(n=>n.type=t)}get rolloff(){return this._rolloff}set rolloff(t){let n=Fe(t)?t:parseInt(t,10),s=[-12,-24,-48,-96],a=s.indexOf(n);mt(a!==-1,"rolloff can only be "+s.join(", ")),a+=1,this._rolloff=n,this.input.disconnect(),this._filters.forEach(d=>d.disconnect()),this._filters=new Array(a);for(let d=0;d<a;d++){let _=new xi({context:this.context});_.type=this._type,this.frequency.connect(_.frequency),this.detune.connect(_.detune),this.Q.connect(_.Q),this.gain.connect(_.gain),this._filters[d]=_}this._internalChannels=this._filters,qe(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){let n=new xi({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),s=new Float32Array(t).map(()=>1);return this._filters.forEach(()=>{n.getFrequencyResponse(t).forEach((a,d)=>s[d]*=a)}),n.dispose(),s}dispose(){return super.dispose(),this._filters.forEach(t=>{t.dispose()}),Gi(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class wi extends ue{constructor(){super(V(wi.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";let t=V(wi.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=t.octaves,this._baseFrequency=this.toFrequency(t.baseFrequency),this._exponent=this.input=new _i({context:this.context,value:t.exponent}),this._scale=this.output=new on({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(ue.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){let n=this.toFrequency(t);ve(n,0),this._baseFrequency=n,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class En extends be{constructor(){super(V(En.getDefaults(),arguments)),this.name="MonoSynth";let t=V(En.getDefaults(),arguments);this.oscillator=new rn(Object.assign(t.oscillator,{context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Re(Object.assign(t.filter,{context:this.context})),this.filterEnvelope=new wi(Object.assign(t.filterEnvelope,{context:this.context})),this.envelope=new yi(Object.assign(t.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),_t(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(be.getDefaults(),{envelope:Object.assign(ye(ue.getDefaults(),Object.keys(rt.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(ye(Re.getDefaults(),Object.keys(rt.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(ye(wi.getDefaults(),Object.keys(rt.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(ye(rn.getDefaults(),Object.keys($t.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(t,n=1){if(this.envelope.triggerAttack(t,n),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),this.envelope.sustain===0){let s=this.toSeconds(this.envelope.attack),a=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+s+a)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class Ns extends be{constructor(){super(V(Ns.getDefaults(),arguments)),this.name="DuoSynth";let t=V(Ns.getDefaults(),arguments);this.voice0=new En(Object.assign(t.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new En(Object.assign(t.voice1,{context:this.context})),this.harmonicity=new Gt({context:this.context,units:"positive",value:t.harmonicity}),this._vibrato=new Te({frequency:t.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new ft({context:this.context,units:"normalRange",gain:t.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new bt({context:this.context,units:"frequency",value:440}),this.detune=new bt({context:this.context,units:"cents",value:t.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),_t(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(t){return t=this.toSeconds(t),this.voice0.envelope.getValueAtTime(t)+this.voice1.envelope.getValueAtTime(t)}static getDefaults(){return We(be.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:We(ye(En.getDefaults(),Object.keys(be.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:We(ye(En.getDefaults(),Object.keys(be.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(t,n){this.voice0._triggerEnvelopeAttack(t,n),this.voice1._triggerEnvelopeAttack(t,n)}_triggerEnvelopeRelease(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Vs extends bi{constructor(){super(V(Vs.getDefaults(),arguments)),this.name="FMSynth";let t=V(Vs.getDefaults(),arguments);this.modulationIndex=new Gt({context:this.context,value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(bi.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}let lc=[1,1.483,1.932,2.546,2.63,3.897];class zs extends be{constructor(){super(V(zs.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];let t=V(zs.getDefaults(),arguments);this.detune=new bt({context:this.context,units:"cents",value:t.detune}),this.frequency=new bt({context:this.context,units:"frequency"}),this._amplitude=new ft({context:this.context,gain:0}).connect(this.output),this._highpass=new Re({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let n=0;n<lc.length;n++){let s=new Un({context:this.context,harmonicity:t.harmonicity,modulationIndex:t.modulationIndex,modulationType:"square",onstop:n===0?()=>this.onsilence(this):Mt,type:"square"});s.connect(this._highpass),this._oscillators[n]=s;let a=new Gt({context:this.context,value:lc[n]});this._freqMultipliers[n]=a,this.frequency.chain(a,s.frequency),this.detune.connect(s.detune)}this._filterFreqScaler=new on({context:this.context,max:7e3,min:this.toFrequency(t.resonance)}),this.envelope=new ue({attack:t.envelope.attack,attackCurve:"linear",context:this.context,decay:t.envelope.decay,release:t.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=t.octaves,this.octaves=t.octaves}static getDefaults(){return We(be.getDefaults(),{envelope:Object.assign(ye(ue.getDefaults(),Object.keys(rt.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(t,n=1){return this.envelope.triggerAttack(t,n),this._oscillators.forEach(s=>s.start(t)),this.envelope.sustain===0&&this._oscillators.forEach(s=>{s.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(t){return this.envelope.triggerRelease(t),this._oscillators.forEach(n=>n.stop(t+this.toSeconds(this.envelope.release))),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(t){this._oscillators.forEach(n=>n.modulationIndex.value=t)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(t){this._oscillators.forEach(n=>n.harmonicity.value=t)}get resonance(){return this._filterFreqScaler.min}set resonance(t){this._filterFreqScaler.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}dispose(){return super.dispose(),this._oscillators.forEach(t=>t.dispose()),this._freqMultipliers.forEach(t=>t.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class Ti extends bn{constructor(){super(V(Ti.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;let t=V(Ti.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,_t(this,["oscillator","envelope"])}static getDefaults(){return We(be.getDefaults(),bn.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,n){let s=this.toSeconds(n),a=this.toFrequency(t instanceof Ce?t.toFrequency():t),d=a*this.octaves;return this.oscillator.frequency.setValueAtTime(d,s),this.oscillator.frequency.exponentialRampToValueAtTime(a,s+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Ze([ac(0)],Ti.prototype,"octaves",void 0),Ze([yn(0)],Ti.prototype,"pitchDecay",void 0);class Bs extends Ve{constructor(){super(V(Bs.getDefaults(),arguments)),this.name="NoiseSynth";let t=V(Bs.getDefaults(),arguments);this.noise=new vn(Object.assign({context:this.context},t.noise)),this.envelope=new yi(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(Ve.getDefaults(),{envelope:Object.assign(ye(ue.getDefaults(),Object.keys(rt.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(ye(vn.getDefaults(),Object.keys($t.getDefaults())),{type:"white"})})}triggerAttack(t,n=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,n),this.noise.start(t),this.envelope.sustain===0&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,n,s=1){return n=this.toSeconds(n),t=this.toSeconds(t),this.triggerAttack(n,s),this.triggerRelease(n+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}let go=new Set;function vo(o){go.add(o)}function uc(o,t){let n=`registerProcessor("${o}", ${t})`;go.add(n)}class _o extends rt{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=Mt;let n=URL.createObjectURL(new Blob([Array.from(go).join(`
`)],{type:"text/javascript"})),s=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(n,s).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(s,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}vo(`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`),vo(`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`),vo(`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`),uc("feedback-comb-filter",`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`);class Si extends _o{constructor(){super(V(Si.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";let t=V(Si.getDefaults(),arguments,["delayTime","resonance"]);this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this.delayTime=new xt({context:this.context,value:t.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new xt({context:this.context,value:t.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),_t(this,["resonance","delayTime"])}_audioWorkletName(){return"feedback-comb-filter"}static getDefaults(){return Object.assign(rt.getDefaults(),{delayTime:.1,resonance:.5})}onReady(t){qe(this.input,t,this.output);let n=t.parameters.get("delayTime");this.delayTime.setParam(n);let s=t.parameters.get("feedback");this.resonance.setParam(s)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Ci extends rt{constructor(){super(V(Ci.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";let t=V(Ci.getDefaults(),arguments,["frequency","type"]);this._frequency=t.frequency,this._type=t.type,this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(rt.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){let t=this._filter,n=this.toFrequency(this._frequency),s=1/(2*Math.PI*n);if(this._type==="lowpass"){let a=1/(s*this.context.sampleRate),d=a-1;this._filter=this.context.createIIRFilter([a,0],[1,d])}else{let a=1/(s*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,a])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(t),t.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(t=128){let n=new Float32Array(t);for(let d=0;d<t;d++){let _=19980*Math.pow(d/t,2)+20;n[d]=_}let s=new Float32Array(t),a=new Float32Array(t);return this._filter.getFrequencyResponse(n,s,a),s}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class ki extends rt{constructor(){super(V(ki.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";let t=V(ki.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new Si({context:this.context,delayTime:t.delayTime,resonance:t.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Ci({context:this.context,frequency:t.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(rt.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(t){this._lowpass.frequency=t}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Ws extends Ve{constructor(){super(V(Ws.getDefaults(),arguments)),this.name="PluckSynth";let t=V(Ws.getDefaults(),arguments);this._noise=new vn({context:this.context,type:"pink"}),this.attackNoise=t.attackNoise,this._lfcf=new ki({context:this.context,dampening:t.dampening,resonance:t.resonance}),this.resonance=t.resonance,this.release=t.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return We(Ve.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(t){this._lfcf.dampening=t}triggerAttack(t,n){let s=this.toFrequency(t);n=this.toSeconds(n);let a=1/s;return this._lfcf.delayTime.setValueAtTime(a,n),this._noise.start(n),this._noise.stop(n+a*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(n),this._lfcf.resonance.setValueAtTime(this.resonance,n),this}triggerRelease(t){return this._lfcf.resonance.linearRampTo(0,this.release,t),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Us extends Ve{constructor(){super(V(Us.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;let t=V(Us.getDefaults(),arguments,["voice","options"]);mt(!Fe(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");let n=t.voice.getDefaults();this.options=Object.assign(n,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();let s=this._voices.indexOf(this._dummyVoice);this._voices.splice(s,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(Ve.getDefaults(),{maxPolyphony:32,options:{},voice:bn})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);let n=this._activeVoices.findIndex(s=>s.voice===t);this._activeVoices.splice(n,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){let t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return t.connect(this.output),this._voices.push(t),t}Wi("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){let t=this._availableVoices.shift(),n=this._voices.indexOf(t);this._voices.splice(n,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,n,s){t.forEach(a=>{let d=new pi(this.context,a).toMidi(),_=this._getNextAvailableVoice();_&&(_.triggerAttack(a,n,s),this._activeVoices.push({midi:d,voice:_,released:!1}),this.log("triggerAttack",a,n))})}_triggerRelease(t,n){t.forEach(s=>{let a=new pi(this.context,s).toMidi(),d=this._activeVoices.find(({midi:_,released:O})=>_===a&&!O);d&&(d.voice.triggerRelease(n),d.released=!0,this.log("triggerRelease",s,n))})}_scheduleEvent(t,n,s,a){mt(!this.disposed,"Synth was already disposed"),s<=this.now()?t==="attack"?this._triggerAttack(n,s,a):this._triggerRelease(n,s):this.context.setTimeout(()=>{this._scheduleEvent(t,n,s,a)},s-this.now())}triggerAttack(t,n,s){Array.isArray(t)||(t=[t]);let a=this.toSeconds(n);return this._scheduleEvent("attack",t,a,s),this}triggerRelease(t,n){Array.isArray(t)||(t=[t]);let s=this.toSeconds(n);return this._scheduleEvent("release",t,s),this}triggerAttackRelease(t,n,s,a){let d=this.toSeconds(s);if(this.triggerAttack(t,d,a),_e(n)){mt(_e(t),"If the duration is an array, the notes must also be an array"),t=t;for(let _=0;_<t.length;_++){let O=n[Math.min(_,n.length-1)],E=this.toSeconds(O);mt(E>0,"The duration must be greater than 0"),this.triggerRelease(t[_],d+E)}}else{let _=this.toSeconds(n);mt(_>0,"The duration must be greater than 0"),this.triggerRelease(t,d+_)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(t){let n=ye(t,["onsilence","context"]);return this.options=We(this.options,n),this._voices.forEach(s=>s.set(n)),this._dummyVoice.set(n),this}get(){return this._dummyVoice.get()}releaseAll(t){let n=this.toSeconds(t);return this._activeVoices.forEach(({voice:s})=>{s.triggerRelease(n)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(t=>t.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Mi extends Ve{constructor(){super(V(Mi.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;let t=V(Mi.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),n={};Object.keys(t.urls).forEach(s=>{let a=parseInt(s,10);if(mt(Ui(s)||Fe(a)&&isFinite(a),"url key is neither a note or midi pitch: "+s),Ui(s)){let d=new Ce(this.context,s).toMidi();n[d]=t.urls[s]}else Fe(a)&&isFinite(a)&&(n[a]=t.urls[a])}),this._buffers=new ui({urls:n,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Ve.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Mt,onerror:Mt,release:.1,urls:{}})}_findClosest(t){let n=0;for(;n<96;){if(this._buffers.has(t+n))return-n;if(this._buffers.has(t-n))return n;n++}throw new Error("No available buffers for note: "+t)}triggerAttack(t,n,s=1){return this.log("triggerAttack",t,n,s),Array.isArray(t)||(t=[t]),t.forEach(a=>{let d=ic(new Ce(this.context,a).toFrequency()),_=Math.round(d),O=d-_,E=this._findClosest(_),D=_-E,I=this._buffers.get(D),A=ci(E+O),F=new gn({url:I,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:A}).connect(this.output);F.start(n,0,I.duration/A,s),_e(this._activeSources.get(_))||this._activeSources.set(_,[]),this._activeSources.get(_).push(F),F.onended=()=>{if(this._activeSources&&this._activeSources.has(_)){let P=this._activeSources.get(_),Y=P.indexOf(F);Y!==-1&&P.splice(Y,1)}}}),this}triggerRelease(t,n){return this.log("triggerRelease",t,n),Array.isArray(t)||(t=[t]),t.forEach(s=>{let a=new Ce(this.context,s).toMidi();if(this._activeSources.has(a)&&this._activeSources.get(a).length){let d=this._activeSources.get(a);n=this.toSeconds(n),d.forEach(_=>{_.stop(n)}),this._activeSources.set(a,[])}}),this}releaseAll(t){let n=this.toSeconds(t);return this._activeSources.forEach(s=>{for(;s.length;)s.shift().stop(n)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,n,s,a=1){let d=this.toSeconds(s);return this.triggerAttack(t,d,a),_e(n)?(mt(_e(t),"notes must be an array when duration is array"),t.forEach((_,O)=>{let E=n[Math.min(O,n.length-1)];this.triggerRelease(_,d+this.toSeconds(E))})):this.triggerRelease(t,d+this.toSeconds(n)),this}add(t,n,s){if(mt(Ui(t)||isFinite(t),"note must be a pitch or midi: "+t),Ui(t)){let a=new Ce(this.context,t).toMidi();this._buffers.add(a,n,s)}else this._buffers.add(t,n,s);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(t=>{t.forEach(n=>n.dispose())}),this._activeSources.clear(),this}}Ze([yn(0)],Mi.prototype,"attack",void 0),Ze([yn(0)],Mi.prototype,"release",void 0);class Ke extends le{constructor(){super(V(Ke.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new hi("stopped"),this._startOffset=0;let t=V(Ke.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(le.getDefaults(),{callback:Mt,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,n=>{let s;if(n.state==="started"){n.id!==-1&&this.context.transport.clear(n.id);let a=n.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||Fe(this._loop)&&this._loop>1){s=1/0,Fe(this._loop)&&(s=this._loop*this._getLoopDuration());let d=this._state.getAfter(a);d!==null&&(s=Math.min(s,d.time-a)),s!==1/0&&(this._state.setStateAtTime("stopped",a+s+1,{id:-1}),s=new zt(this.context,s));let _=new zt(this.context,this._getLoopDuration());n.id=this.context.transport.scheduleRepeat(this._tick.bind(this),_,new zt(this.context,a),s)}else n.id=this.context.transport.schedule(this._tick.bind(this),new zt(this.context,a))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){let n=this.toTicks(t);return this._state.getValueAtTime(n)==="stopped"&&(this._state.add({id:-1,state:"started",time:n}),this._rescheduleEvents(n)),this}stop(t){this.cancel(t);let n=this.toTicks(t);if(this._state.getValueAtTime(n)==="started"){this._state.setStateAtTime("stopped",n,{id:-1});let s=this._state.getBefore(n),a=n;s!==null&&(a=s.time),this._rescheduleEvents(a)}return this}cancel(t){t=Ue(t,-1/0);let n=this.toTicks(t);return this._state.forEachFrom(n,s=>{this.context.transport.clear(s.id)}),this._state.cancel(n),this}_tick(t){let n=this.context.transport.getTicksAtTime(t);if(!this.mute&&this._state.getValueAtTime(n)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let s=.02;oo(this.humanize)||(s=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*s}this.callback(t,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new zt(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new zt(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){let t=this.context.transport.ticks,n=this._state.get(t);if(n!==null&&n.state==="started"){let s=this._getLoopDuration();return(t-n.time)%s/s}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class Oi extends le{constructor(){super(V(Oi.getDefaults(),arguments,["callback","interval"])),this.name="Loop";let t=V(Oi.getDefaults(),arguments,["callback","interval"]);this._event=new Ke({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign(le.getDefaults(),{interval:"4n",callback:Mt,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return this._event.loop===!0?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}}class Ei extends Ke{constructor(){super(V(Ei.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new hi("stopped"),this._events=new Set;let t=V(Ei.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,t.events.forEach(n=>{_e(n)?this.add(n[0],n[1]):this.add(n)})}static getDefaults(){return Object.assign(Ke.getDefaults(),{events:[]})}start(t,n){let s=this.toTicks(t);if(this._state.getValueAtTime(s)!=="started"){n=Ue(n,this._loop?this._loopStart:0),n=this._loop?Ue(n,this._loopStart):Ue(n,0);let a=this.toTicks(n);this._state.add({id:-1,offset:a,state:"started",time:s}),this._forEach(d=>{this._startNote(d,s,a)})}return this}_startNote(t,n,s){n-=s,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<s&&(n+=this._getLoopDuration()),t.start(new zt(this.context,n))):t.startOffset<this._loopStart&&t.startOffset>=s&&(t.loop=!1,t.start(new zt(this.context,n))):t.startOffset>=s&&t.start(new zt(this.context,n))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach(n=>{n.startOffset+=this._startOffset})}stop(t){let n=this.toTicks(t);return this._state.cancel(n),this._state.setStateAtTime("stopped",n),this._forEach(s=>{s.stop(t)}),this}at(t,n){let s=new se(this.context,t).toTicks(),a=new zt(this.context,1).toSeconds(),d=this._events.values(),_=d.next();for(;!_.done;){let O=_.value;if(Math.abs(s-O.startOffset)<a)return Ct(n)&&(O.value=n),O;_=d.next()}return Ct(n)?(this.add(t,n),this.at(t)):null}add(t,n){t instanceof Object&&Reflect.has(t,"time")&&(t=(n=t).time);let s=this.toTicks(t),a;return n instanceof Ke?(a=n,a.callback=this._tick.bind(this)):a=new Ke({callback:this._tick.bind(this),context:this.context,value:n}),a.startOffset=s,a.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(a),this._restartEvent(a),this}_restartEvent(t){this._state.forEach(n=>{n.state==="started"?this._startNote(t,n.time,n.offset):t.stop(new zt(this.context,n.time))})}remove(t,n){return dn(t)&&t.hasOwnProperty("time")&&(t=(n=t).time),t=this.toTicks(t),this._events.forEach(s=>{s.startOffset===t&&(Me(n)||Ct(n)&&s.value===n)&&(this._events.delete(s),s.dispose())}),this}clear(){return this._forEach(t=>t.dispose()),this._events.clear(),this}cancel(t){return this._forEach(n=>n.cancel(t)),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach(n=>{n instanceof Ei?n._forEach(t):t(n)}),this}_setAll(t,n){this._forEach(s=>{s[t]=n})}_tick(t,n){this.mute||this.callback(t,n)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):t.state==="stopped"&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach(n=>{n.loopStart=this.loopStart,n.loopEnd=this.loopEnd,n.loop=t,this._testLoopBoundries(n)})}get loopEnd(){return new zt(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(n=>{n.loopEnd=t,this._testLoopBoundries(n)})}get loopStart(){return new zt(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(n=>{n.loopStart=this.loopStart,this._testLoopBoundries(n)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*gu(o){let t=0;for(;t<o.length;)t=Ri(t,o),yield o[t],t++}function*vu(o){let t=o.length-1;for(;t>=0;)t=Ri(t,o),yield o[t],t--}function*$i(o,t){for(;;)yield*t(o)}function Ri(o,t){return Ka(o,0,t.length-1)}function*pc(o,t){let n=t?0:o.length-1;for(;;)n=Ri(n,o),yield o[n],t?(n++,n>=o.length-1&&(t=!1)):(n--,n<=0&&(t=!0))}function*_u(o){let t=0,n=0;for(;t<o.length;)t=Ri(t,o),yield o[t],n++,t+=n%2?2:-1}function*yu(o){let t=o.length-1,n=0;for(;t>=0;)t=Ri(t,o),yield o[t],n++,t+=n%2?-2:1}function*bu(o){let t=[];for(let n=0;n<o.length;n++)t.push(n);for(;t.length>0;){let n=Ri(t.splice(Math.floor(t.length*Math.random()),1)[0],o);yield o[n]}}function*dc(o,t="up",n=0){switch(mt(o.length>0,"The array must have more than one value in it"),t){case"up":yield*$i(o,gu);case"down":yield*$i(o,vu);case"upDown":yield*pc(o,!0);case"downUp":yield*pc(o,!1);case"alternateUp":yield*$i(o,_u);case"alternateDown":yield*$i(o,yu);case"random":yield*function*(s){for(;;){let a=Math.floor(Math.random()*s.length);yield s[a]}}(o);case"randomOnce":yield*$i(o,bu);case"randomWalk":yield*function*(s){let a=Math.floor(Math.random()*s.length);for(;;)a===0?a++:a===s.length-1||Math.random()<.5?a--:a++,yield s[a]}(o)}}class Gs extends Oi{constructor(){super(V(Gs.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";let t=V(Gs.getDefaults(),arguments,["callback","values","pattern"]);this.callback=t.callback,this._values=t.values,this._pattern=dc(t.values,t.pattern),this._type=t.pattern}static getDefaults(){return Object.assign(Oi.getDefaults(),{pattern:"up",values:[],callback:Mt})}_tick(t){let n=this._pattern.next();this._value=n.value,this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=dc(this._values,this._type)}}class Ys extends Ke{constructor(){super(V(Ys.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new Ei({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];let t=V(Ys.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(ye(Ke.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,n){n!==null&&this.callback(t,n)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,n){return this._part.start(t,n&&this._indexTime(n)),this}stop(t){return this._part.stop(t),this}get subdivision(){return new zt(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(n,s)=>n[s],set:(n,s,a)=>(Be(s)&&isFinite(parseInt(s,10))&&_e(a)?n[s]=this._createSequence(a):n[s]=a,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,n,s){t.forEach((a,d)=>{let _=d*n+s;if(_e(a))this._rescheduleSequence(a,n/a.length,_);else{let O=new zt(this.context,_,"i").toSeconds();this._part.add(O,a)}})}_indexTime(t){return new zt(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=t===0?this._indexTime(this._eventsArray.length):this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}class Xn extends rt{constructor(){super(Object.assign(V(Xn.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new hc({context:this.context}),this.a=new ft({context:this.context,gain:0}),this.b=new ft({context:this.context,gain:0}),this.output=new ft({context:this.context}),this._internalChannels=[this.a,this.b];let t=V(Xn.getDefaults(),arguments,["fade"]);this.fade=new bt({context:this.context,units:"normalRange",value:t.fade}),_t(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Oe(this._split,this.a.gain,0),Oe(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(rt.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class ae extends rt{constructor(t){super(t),this.name="Effect",this._dryWet=new Xn({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ft({context:this.context}),this.effectReturn=new ft({context:this.context}),this.input=new ft({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],_t(this,"wet")}static getDefaults(){return Object.assign(rt.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Hs extends ae{constructor(t){super(t),this.name="LFOEffect",this._lfo=new Te({context:this.context,frequency:t.frequency,amplitude:t.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=t.type,_t(this,["frequency","depth"])}static getDefaults(){return Object.assign(ae.getDefaults(),{frequency:1,type:"sine",depth:1})}start(t){return this._lfo.start(t),this}stop(t){return this._lfo.stop(t),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Qs extends Hs{constructor(){super(V(Qs.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";let t=V(Qs.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new Re(Object.assign(t.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=t.octaves,this.baseFrequency=t.baseFrequency}static getDefaults(){return Object.assign(Hs.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._lfo.max=this._lfo.min*Math.pow(2,t)}dispose(){return super.dispose(),this.filter.dispose(),this}}class Di extends rt{constructor(){super(Object.assign(V(Di.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;let t=V(Di.getDefaults(),arguments,["pan"]);this.pan=new xt({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",_t(this,"pan")}static getDefaults(){return Object.assign(rt.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class Xs extends Hs{constructor(){super(V(Xs.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";let t=V(Xs.getDefaults(),arguments,["frequency"]);this._panner=new Di({context:this.context,channelCount:t.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(Hs.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class Ai extends rt{constructor(){super(V(Ai.getDefaults(),arguments,["smoothing"])),this.name="Follower";let t=V(Ai.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new cc({context:this.context}),this._lowpass=this.output=new Ci({context:this.context,frequency:1/this.toSeconds(t.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=t.smoothing}static getDefaults(){return Object.assign(rt.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class Zs extends ae{constructor(){super(V(Zs.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";let t=V(Zs.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new Ai({context:this.context,smoothing:t.follower}),this._sweepRange=new Ji({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this._inputBoost=new ft({context:this.context}),this._bandpass=new Re({context:this.context,rolloff:-48,frequency:0,Q:t.Q}),this._peaking=new Re({context:this.context,type:"peaking"}),this._peaking.gain.value=t.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=t.sensitivity,_t(this,["gain","Q"])}static getDefaults(){return Object.assign(ae.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(t){this._follower.smoothing=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._setSweepRange()}get sensitivity(){return Yi(1/this._inputBoost.gain.value)}set sensitivity(t){this._inputBoost.gain.value=1/ai(t)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}uc("bit-crusher",`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`);class Js extends ae{constructor(){super(V(Js.getDefaults(),arguments,["bits"])),this.name="BitCrusher";let t=V(Js.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new $s({context:this.context,bits:t.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(ae.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class $s extends _o{constructor(){super(V($s.getDefaults(),arguments)),this.name="BitCrusherWorklet";let t=V($s.getDefaults(),arguments);this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this.bits=new xt({context:this.context,value:t.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(_o.getDefaults(),{bits:12})}_audioWorkletName(){return"bit-crusher"}onReady(t){qe(this.input,t,this.output);let n=t.parameters.get("bits");this.bits.setParam(n)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class Ks extends ae{constructor(){super(V(Ks.getDefaults(),arguments,["order"])),this.name="Chebyshev";let t=V(Ks.getDefaults(),arguments,["order"]);this._shaper=new Ge({context:this.context,length:4096}),this._order=t.order,this.connectEffect(this._shaper),this.order=t.order,this.oversample=t.oversample}static getDefaults(){return Object.assign(ae.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(t,n,s){return s.has(n)||(n===0?s.set(n,0):n===1?s.set(n,t):s.set(n,2*t*this._getCoefficient(t,n-1,s)-this._getCoefficient(t,n-2,s))),s.get(n)}get order(){return this._order}set order(t){this._order=t,this._shaper.setMap(n=>this._getCoefficient(n,t,new Map))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Rn extends rt{constructor(){super(V(Rn.getDefaults(),arguments,["channels"])),this.name="Split";let t=V(Rn.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(rt.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class xn extends rt{constructor(){super(V(xn.getDefaults(),arguments,["channels"])),this.name="Merge";let t=V(xn.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(rt.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class an extends rt{constructor(t){super(t),this.name="StereoEffect",this.input=new ft({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new Xn({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new Rn({context:this.context,channels:2}),this._merge=new xn({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),_t(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),qe(...t),Oe(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),qe(...t),Oe(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(rt.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class yo extends an{constructor(t){super(t),this.feedback=new bt({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new ft({context:this.context}),this._feedbackR=new ft({context:this.context}),this._feedbackSplit=new Rn({context:this.context,channels:2}),this._feedbackMerge=new xn({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),_t(this,["feedback"])}static getDefaults(){return Object.assign(an.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class tr extends yo{constructor(){super(V(tr.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";let t=V(tr.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new Te({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new Te({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Ee({context:this.context}),this._delayNodeR=new Ee({context:this.context}),this.frequency=this._lfoL.frequency,_t(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=t.type,this.spread=t.spread}static getDefaults(){return Object.assign(yo.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;let n=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-n,0),this._lfoL.max=this._delayTime+n,this._lfoR.min=Math.max(this._delayTime-n,0),this._lfoR.max=this._delayTime+n}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class er extends ae{constructor(){super(V(er.getDefaults(),arguments,["distortion"])),this.name="Distortion";let t=V(er.getDefaults(),arguments,["distortion"]);this._shaper=new Ge({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(ae.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;let n=100*t,s=Math.PI/180;this._shaper.setMap(a=>Math.abs(a)<.001?0:(3+n)*a*20*s/(Math.PI+n*Math.abs(a)))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class nr extends ae{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new ft({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,_t(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(ae.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class ir extends nr{constructor(){super(V(ir.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";let t=V(ir.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new Ee({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),_t(this,"delayTime")}static getDefaults(){return Object.assign(nr.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class xu extends rt{constructor(t){super(t),this.name="PhaseShiftAllpass",this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this.offset90=new ft({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),qe(this.input,...this._bank0,this._oneSampleDelay,this.output),qe(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(t){return t.map(n=>{let s=[[n*n,0,-1],[1,0,-n*n]];return this.context.createIIRFilter(s[0],s[1])})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach(t=>t.disconnect()),this._bank1.forEach(t=>t.disconnect()),this._oneSampleDelay.disconnect(),this}}class sr extends ae{constructor(){super(V(sr.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";let t=V(sr.getDefaults(),arguments,["frequency"]);this.frequency=new bt({context:this.context,units:"frequency",value:t.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new fi({context:this.context,type:"sine"}),this._cosine=new Ut({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new Gt({context:this.context}),this._cosineMultiply=new Gt({context:this.context}),this._negate=new fo({context:this.context}),this._add=new Yn({context:this.context}),this._phaseShifter=new xu({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);let n=this.immediate();this._sine.start(n),this._cosine.start(n)}static getDefaults(){return Object.assign(ae.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}let fc=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],mc=[225,556,441,341];class rr extends an{constructor(){super(V(rr.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];let t=V(rr.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new bt({context:this.context,value:t.roomSize,units:"normalRange"}),this._allpassFiltersL=mc.map(n=>{let s=this.context.createBiquadFilter();return s.type="allpass",s.frequency.value=n,s}),this._allpassFiltersR=mc.map(n=>{let s=this.context.createBiquadFilter();return s.type="allpass",s.frequency.value=n,s}),this._combFilters=fc.map((n,s)=>{let a=new ki({context:this.context,dampening:t.dampening,delayTime:n});return s<fc.length/2?this.connectEffectLeft(a,...this._allpassFiltersL):this.connectEffectRight(a,...this._allpassFiltersR),this.roomSize.connect(a.resonance),a}),_t(this,["roomSize"])}static getDefaults(){return Object.assign(an.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(t){this._combFilters.forEach(n=>n.dampening=t)}dispose(){return super.dispose(),this._allpassFiltersL.forEach(t=>t.disconnect()),this._allpassFiltersR.forEach(t=>t.disconnect()),this._combFilters.forEach(t=>t.dispose()),this.roomSize.dispose(),this}}let gc=[.06748,.06404,.08212,.09004],wu=[.773,.802,.753,.733],Tu=[347,113,37];class or extends an{constructor(){super(V(or.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];let t=V(or.getDefaults(),arguments,["roomSize"]);this.roomSize=new bt({context:this.context,value:t.roomSize,units:"normalRange"}),this._scaleRoomSize=new on({context:this.context,min:-.733,max:.197}),this._allpassFilters=Tu.map(n=>{let s=this.context.createBiquadFilter();return s.type="allpass",s.frequency.value=n,s}),this._feedbackCombFilters=gc.map((n,s)=>{let a=new Si({context:this.context,delayTime:n});return this._scaleRoomSize.connect(a.resonance),a.resonance.value=wu[s],s<gc.length/2?this.connectEffectLeft(...this._allpassFilters,a):this.connectEffectRight(...this._allpassFilters,a),a}),this.roomSize.connect(this._scaleRoomSize),_t(this,["roomSize"])}static getDefaults(){return Object.assign(an.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach(t=>t.disconnect()),this._feedbackCombFilters.forEach(t=>t.dispose()),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class vc extends yo{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),_t(this,["feedback"])}}class ar extends vc{constructor(){super(V(ar.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";let t=V(ar.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new Ee({context:this.context,maxDelay:t.maxDelay}),this._rightDelay=new Ee({context:this.context,maxDelay:t.maxDelay}),this._rightPreDelay=new Ee({context:this.context,maxDelay:t.maxDelay}),this.delayTime=new bt({context:this.context,units:"time",value:t.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),_t(this,["delayTime"])}static getDefaults(){return Object.assign(vc.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class cr extends nr{constructor(){super(V(cr.getDefaults(),arguments,["pitch"])),this.name="PitchShift";let t=V(cr.getDefaults(),arguments,["pitch"]);this._frequency=new bt({context:this.context}),this._delayA=new Ee({maxDelay:1,context:this.context}),this._lfoA=new Te({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Ee({maxDelay:1,context:this.context}),this._lfoB=new Te({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new Xn({context:this.context}),this._crossFadeLFO=new Te({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Ee({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,_t(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);let n=this.now();this._lfoA.start(n),this._lfoB.start(n),this._crossFadeLFO.start(n),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(nr.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let n=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,n=ci(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,n=ci(t)-1),this._frequency.value=n*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class hr extends an{constructor(){super(V(hr.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";let t=V(hr.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new Te({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new Te({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this.Q=new bt({context:this.context,value:t.Q,units:"positive"}),this._filtersL=this._makeFilters(t.stages,this._lfoL),this._filtersR=this._makeFilters(t.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.octaves=t.octaves,this._lfoL.start(),this._lfoR.start(),_t(this,["frequency","Q"])}static getDefaults(){return Object.assign(an.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(t,n){let s=[];for(let a=0;a<t;a++){let d=this.context.createBiquadFilter();d.type="allpass",this.Q.connect(d.Q),n.connect(d.frequency),s.push(d)}return s}get octaves(){return this._octaves}set octaves(t){this._octaves=t;let n=this._baseFrequency*Math.pow(2,t);this._lfoL.max=n,this._lfoR.max=n}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(t=>t.disconnect()),this._filtersR.forEach(t=>t.disconnect()),this.frequency.dispose(),this}}class lr extends ae{constructor(){super(V(lr.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();let t=V(lr.getDefaults(),arguments,["decay"]);this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(ae.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){ve(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){ve(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return Vt(this,void 0,void 0,function*(){let t=this.ready,n=new oi(2,this._decay+this._preDelay,this.context.sampleRate),s=new vn({context:n}),a=new vn({context:n}),d=new xn({context:n});s.connect(d,0,0),a.connect(d,0,1);let _=new ft({context:n}).toDestination();d.connect(_),s.start(0),a.start(0),_.gain.setValueAtTime(0,0),_.gain.setValueAtTime(1,this._preDelay),_.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);let O=n.render();return this.ready=O.then(Mt),yield t,this._convolver.buffer=(yield O).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Ki extends rt{constructor(){super(V(Ki.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new Rn({channels:2,context:this.context}),this._midAdd=new Yn({context:this.context}),this.mid=new Gt({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new Qn({context:this.context}),this.side=new Gt({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class ts extends rt{constructor(){super(V(ts.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new ft({context:this.context}),this.side=new ft({context:this.context}),this._left=new Yn({context:this.context}),this._leftMult=new Gt({context:this.context,value:Math.SQRT1_2}),this._right=new Qn({context:this.context}),this._rightMult=new Gt({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new xn({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class _c extends ae{constructor(t){super(t),this.name="MidSideEffect",this._midSideMerge=new ts({context:this.context}),this._midSideSplit=new Ki({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...t){this._midSend.chain(...t,this._midReturn)}connectEffectSide(...t){this._sideSend.chain(...t,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class ur extends _c{constructor(){super(V(ur.getDefaults(),arguments,["width"])),this.name="StereoWidener";let t=V(ur.getDefaults(),arguments,["width"]);this.width=new bt({context:this.context,value:t.width,units:"normalRange"}),_t(this,["width"]),this._twoTimesWidthMid=new Gt({context:this.context,value:2}),this._twoTimesWidthSide=new Gt({context:this.context,value:2}),this._midMult=new Gt({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new Qn({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),Oe(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new Gt({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(_c.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class pr extends an{constructor(){super(V(pr.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";let t=V(pr.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new Te({context:this.context,type:t.type,min:1,max:0}),this._lfoR=new Te({context:this.context,type:t.type,min:1,max:0}),this._amplitudeL=new ft({context:this.context}),this._amplitudeR=new ft({context:this.context}),this.frequency=new bt({context:this.context,value:t.frequency,units:"frequency"}),this.depth=new bt({context:this.context,value:t.depth,units:"normalRange"}),_t(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=t.spread}static getDefaults(){return Object.assign(an.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class dr extends ae{constructor(){super(V(dr.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";let t=V(dr.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new Ee({context:this.context,delayTime:0,maxDelay:t.maxDelay}),this._lfo=new Te({context:this.context,type:t.type,min:0,max:t.maxDelay,frequency:t.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=t.depth,_t(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(ae.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Pi extends rt{constructor(){super(V(Pi.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];let t=V(Pi.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new ft({context:this.context}),this._split=new Rn({context:this.context,channels:t.channels}),this.input.connect(this._split),ve(t.channels,1);for(let n=0;n<t.channels;n++)this._analysers[n]=this.context.createAnalyser(),this._split.connect(this._analysers[n],n,0);this.size=t.size,this.type=t.type}static getDefaults(){return Object.assign(rt.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((t,n)=>{let s=this._buffers[n];this._type==="fft"?t.getFloatFrequencyData(s):this._type==="waveform"&&t.getFloatTimeDomainData(s)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach((n,s)=>{n.fftSize=2*t,this._buffers[s]=new Float32Array(t)})}get channels(){return this._analysers.length}get type(){return this._type}set type(t){mt(t==="waveform"||t==="fft","Analyser: invalid type: "+t),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach(n=>n.smoothingTimeConstant=t)}dispose(){return super.dispose(),this._analysers.forEach(t=>t.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class Dn extends rt{constructor(){super(V(Dn.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new Pi({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class fr extends Dn{constructor(){super(V(fr.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;let t=V(fr.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new Pi({context:this.context,size:256,type:"waveform",channels:t.channels}),this.smoothing=t.smoothing,this.normalRange=t.normalRange}static getDefaults(){return Object.assign(Dn.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return Wi("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){let t=this._analyser.getValue(),n=(this.channels===1?[t]:t).map(s=>{let a=s.reduce((_,O)=>_+O*O,0),d=Math.sqrt(a/s.length);return this._rms=Math.max(d,this._rms*this.smoothing),this.normalRange?this._rms:Yi(this._rms)});return this.channels===1?n[0]:n}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class mr extends Dn{constructor(){super(V(mr.getDefaults(),arguments,["size"])),this.name="FFT";let t=V(mr.getDefaults(),arguments,["size"]);this.normalRange=t.normalRange,this._analyser.type="fft",this.size=t.size}static getDefaults(){return Object.assign(rt.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map(t=>this.normalRange?ai(t):t)}get size(){return this._analyser.size}set size(t){this._analyser.size=t}get smoothing(){return this._analyser.smoothing}set smoothing(t){this._analyser.smoothing=t}getFrequencyOfIndex(t){return mt(0<=t&&t<this.size,"index must be greater than or equal to 0 and less than "+this.size),t*this.context.sampleRate/(2*this.size)}}class bo extends Dn{constructor(){super(V(bo.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class gr extends Dn{constructor(){super(V(gr.getDefaults(),arguments,["size"])),this.name="Waveform";let t=V(gr.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=t.size}static getDefaults(){return Object.assign(Dn.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(t){this._analyser.size=t}}class Kt extends rt{constructor(){super(V(Kt.getDefaults(),arguments,["solo"])),this.name="Solo";let t=V(Kt.getDefaults(),arguments,["solo"]);this.input=this.output=new ft({context:this.context}),Kt._allSolos.has(this.context)||Kt._allSolos.set(this.context,new Set),Kt._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(rt.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),Kt._allSolos.get(this.context).forEach(n=>n._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Kt._soloed.has(this.context)||Kt._soloed.set(this.context,new Set),Kt._soloed.get(this.context).add(this)}_removeSolo(){Kt._soloed.has(this.context)&&Kt._soloed.get(this.context).delete(this)}_isSoloed(){return Kt._soloed.has(this.context)&&Kt._soloed.get(this.context).has(this)}_noSolos(){return!Kt._soloed.has(this.context)||Kt._soloed.has(this.context)&&Kt._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Kt._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Kt._allSolos=new Map,Kt._soloed=new Map;class es extends rt{constructor(){super(V(es.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";let t=V(es.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Di({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new sn({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,_t(this,["pan","volume"])}static getDefaults(){return Object.assign(rt.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class An extends rt{constructor(){super(V(An.getDefaults(),arguments,["volume","pan"])),this.name="Channel";let t=V(An.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Kt({solo:t.solo,context:this.context}),this._panVol=this.output=new es({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),_t(this,["pan","volume"])}static getDefaults(){return Object.assign(rt.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return An.buses.has(t)||An.buses.set(t,new ft({context:this.context})),An.buses.get(t)}send(t,n=0){let s=this._getBus(t),a=new ft({context:this.context,units:"decibels",gain:n});return this.connect(a),a.connect(s),a}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}An.buses=new Map;class xo extends rt{constructor(){super(V(xo.getDefaults(),arguments)),this.name="Mono",this.input=new ft({context:this.context}),this._merge=this.output=new xn({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class Ii extends rt{constructor(){super(V(Ii.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new ft({context:this.context}),this.output=void 0,this.low=new Re({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Re({context:this.context,frequency:0,type:"highpass"}),this.mid=new Re({context:this.context,frequency:0,type:"lowpass"}),this.high=new Re({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];let t=V(Ii.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new bt({context:this.context,units:"frequency",value:t.lowFrequency}),this.highFrequency=new bt({context:this.context,units:"frequency",value:t.highFrequency}),this.Q=new bt({context:this.context,units:"positive",value:t.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),_t(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(rt.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Gi(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class Su extends rt{constructor(){super(...arguments),this.name="Listener",this.positionX=new xt({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new xt({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new xt({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new xt({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new xt({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new xt({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new xt({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new xt({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new xt({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(rt.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Ss(o=>{o.listener=new Su({context:o})}),Cs(o=>{o.listener.dispose()});class vr extends rt{constructor(){super(V(vr.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";let t=V(vr.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=t.panningModel,this.maxDistance=t.maxDistance,this.distanceModel=t.distanceModel,this.coneOuterGain=t.coneOuterGain,this.coneOuterAngle=t.coneOuterAngle,this.coneInnerAngle=t.coneInnerAngle,this.refDistance=t.refDistance,this.rolloffFactor=t.rolloffFactor,this.positionX=new xt({context:this.context,param:this._panner.positionX,value:t.positionX}),this.positionY=new xt({context:this.context,param:this._panner.positionY,value:t.positionY}),this.positionZ=new xt({context:this.context,param:this._panner.positionZ,value:t.positionZ}),this.orientationX=new xt({context:this.context,param:this._panner.orientationX,value:t.orientationX}),this.orientationY=new xt({context:this.context,param:this._panner.orientationY,value:t.orientationY}),this.orientationZ=new xt({context:this.context,param:this._panner.orientationZ,value:t.orientationZ})}static getDefaults(){return Object.assign(rt.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(t,n,s){return this.positionX.value=t,this.positionY.value=n,this.positionZ.value=s,this}setOrientation(t,n,s){return this.orientationX.value=t,this.orientationY.value=n,this.orientationZ.value=s,this}get panningModel(){return this._panner.panningModel}set panningModel(t){this._panner.panningModel=t}get refDistance(){return this._panner.refDistance}set refDistance(t){this._panner.refDistance=t}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(t){this._panner.rolloffFactor=t}get distanceModel(){return this._panner.distanceModel}set distanceModel(t){this._panner.distanceModel=t}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(t){this._panner.coneInnerAngle=t}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(t){this._panner.coneOuterAngle=t}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(t){this._panner.coneOuterGain=t}get maxDistance(){return this._panner.maxDistance}set maxDistance(t){this._panner.maxDistance=t}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class ns extends rt{constructor(){super(V(ns.getDefaults(),arguments)),this.name="Recorder";let t=V(ns.getDefaults(),arguments);this.input=new ft({context:this.context}),mt(ns.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:t.mimeType})}static getDefaults(){return rt.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return fn!==null&&Reflect.has(fn,"MediaRecorder")}get state(){return this._recorder.state==="inactive"?"stopped":this._recorder.state==="paused"?"paused":"started"}start(){return Vt(this,void 0,void 0,function*(){mt(this.state!=="started","Recorder is already started");let t=new Promise(n=>{let s=()=>{this._recorder.removeEventListener("start",s,!1),n()};this._recorder.addEventListener("start",s,!1)});return this._recorder.start(),yield t})}stop(){return Vt(this,void 0,void 0,function*(){mt(this.state!=="stopped","Recorder is not started");let t=new Promise(n=>{let s=a=>{this._recorder.removeEventListener("dataavailable",s,!1),n(a.data)};this._recorder.addEventListener("dataavailable",s,!1)});return this._recorder.stop(),yield t})}pause(){return mt(this.state==="started","Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class cn extends rt{constructor(){super(V(cn.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;let t=V(cn.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new xt({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new xt({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new xt({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new xt({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new xt({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),_t(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(rt.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class _r extends rt{constructor(){super(Object.assign(V(_r.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";let t=V(_r.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new Ai({context:this.context,smoothing:t.smoothing}),this._gt=new Zi({context:this.context,value:ai(t.threshold)}),this.input=new ft({context:this.context}),this._gate=this.output=new ft({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(rt.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return Yi(this._gt.value)}set threshold(t){this._gt.value=ai(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class yr extends rt{constructor(){super(Object.assign(V(yr.getDefaults(),arguments,["threshold"]))),this.name="Limiter";let t=V(yr.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new cn({context:this.context,ratio:20,attack:.003,release:.01,threshold:t.threshold}),this.threshold=this._compressor.threshold,_t(this,"threshold")}static getDefaults(){return Object.assign(rt.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class br extends rt{constructor(){super(Object.assign(V(br.getDefaults(),arguments))),this.name="MidSideCompressor";let t=V(br.getDefaults(),arguments);this._midSideSplit=this.input=new Ki({context:this.context}),this._midSideMerge=this.output=new ts({context:this.context}),this.mid=new cn(Object.assign(t.mid,{context:this.context})),this.side=new cn(Object.assign(t.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),_t(this,["mid","side"])}static getDefaults(){return Object.assign(rt.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class xr extends rt{constructor(){super(Object.assign(V(xr.getDefaults(),arguments))),this.name="MultibandCompressor";let t=V(xr.getDefaults(),arguments);this._splitter=this.input=new Ii({context:this.context,lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new ft({context:this.context}),this.low=new cn(Object.assign(t.low,{context:this.context})),this.mid=new cn(Object.assign(t.mid,{context:this.context})),this.high=new cn(Object.assign(t.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),_t(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(rt.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class wr extends rt{constructor(){super(V(wr.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new ft({context:this.context}),this._internalChannels=[];let t=V(wr.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new Ii({context:this.context,highFrequency:t.highFrequency,lowFrequency:t.lowFrequency}),this._lowGain=new ft({context:this.context,gain:t.low,units:"decibels"}),this._midGain=new ft({context:this.context,gain:t.mid,units:"decibels"}),this._highGain=new ft({context:this.context,gain:t.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),_t(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(rt.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Gi(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class Tr extends rt{constructor(){super(V(Tr.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();let t=V(Tr.getDefaults(),arguments,["url","onload"]);this._buffer=new Dt(t.url,n=>{this.buffer=n,t.onload()}),this.input=new ft({context:this.context}),this.output=new ft({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=t.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(rt.getDefaults(),{normalize:!0,onload:Mt})}load(t){return Vt(this,void 0,void 0,function*(){this.buffer=yield this._buffer.load(t)})}get buffer(){return this._buffer.length?this._buffer:null}set buffer(t){t&&this._buffer.set(t),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));let n=this._buffer.get();this._convolver.buffer=n||null}get normalize(){return this._convolver.normalize}set normalize(t){this._convolver.normalize=t}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function Cu(){return Wt().now()}function ku(){return Wt().immediate()}let Mu=Wt().transport;function Ou(){return Wt().transport}let Eu=Wt().destination,Ru=Wt().destination;function Du(){return Wt().destination}let Au=Wt().listener;function Pu(){return Wt().listener}let Iu=Wt().draw;function ju(){return Wt().draw}let Fu=Wt();function Lu(){return Dt.loaded()}let qu=Dt,Nu=ui,Vu=gn}])})});var Dc=Zn((Rc,So)=>{parcelRequire=function(e,i,r,c){var h,p=typeof parcelRequire=="function"&&parcelRequire,f=typeof wo=="function"&&wo;function g(u,x){if(!i[u]){if(!e[u]){var w=typeof parcelRequire=="function"&&parcelRequire;if(!x&&w)return w(u,!0);if(p)return p(u,!0);if(f&&typeof u=="string")return f(u);var M=new Error("Cannot find module '"+u+"'");throw M.code="MODULE_NOT_FOUND",M}b.resolve=function(T){return e[u][1][T]||T},b.cache={};var k=i[u]=new g.Module(u);e[u][0].call(k.exports,b,k,k.exports,this)}return i[u].exports;function b(T){return g(b.resolve(T))}}g.isParcelRequire=!0,g.Module=function(u){this.id=u,this.bundle=g,this.exports={}},g.modules=e,g.cache=i,g.parent=p,g.register=function(u,x){e[u]=[function(w,M){M.exports=x},{}]};for(var y=0;y<r.length;y++)try{g(r[y])}catch(u){h||(h=u)}if(r.length){var S=g(r[r.length-1]);typeof Rc=="object"&&typeof So!="undefined"?So.exports=S:typeof define=="function"&&define.amd?define(function(){return S}):c&&(this[c]=S)}if(parcelRequire=g,h)throw h;return g}({EgBh:[function(e,i,r){var c={};c.useBlobBuilder=function(){try{return new Blob([]),!1}catch(f){return!0}}(),c.useArrayBufferView=!c.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch(f){return!0}}(),i.exports.binaryFeatures=c;var h=i.exports.BlobBuilder;function p(){this._pieces=[],this._parts=[]}typeof window!="undefined"&&(h=i.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),p.prototype.append=function(f){typeof f=="number"?this._pieces.push(f):(this.flush(),this._parts.push(f))},p.prototype.flush=function(){if(this._pieces.length>0){var f=new Uint8Array(this._pieces);c.useArrayBufferView||(f=f.buffer),this._parts.push(f),this._pieces=[]}},p.prototype.getBuffer=function(){if(this.flush(),c.useBlobBuilder){for(var f=new h,g=0,y=this._parts.length;g<y;g++)f.append(this._parts[g]);return f.getBlob()}return new Blob(this._parts)},i.exports.BufferBuilder=p},{}],kdPp:[function(e,i,r){var c=e("./bufferbuilder").BufferBuilder,h=e("./bufferbuilder").binaryFeatures,p={unpack:function(u){return new f(u).unpack()},pack:function(u){var x=new g;return x.pack(u),x.getBuffer()}};function f(u){this.index=0,this.dataBuffer=u,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function g(){this.bufferBuilder=new c}function y(u){var x=u.charCodeAt(0);return x<=2047?"00":x<=65535?"000":x<=2097151?"0000":x<=67108863?"00000":"000000"}function S(u){return u.length>600?new Blob([u]).size:u.replace(/[^\u0000-\u007F]/g,y).length}i.exports=p,f.prototype.unpack=function(){var u,x=this.unpack_uint8();if(x<128)return x;if((224^x)<32)return(224^x)-32;if((u=160^x)<=15)return this.unpack_raw(u);if((u=176^x)<=15)return this.unpack_string(u);if((u=144^x)<=15)return this.unpack_array(u);if((u=128^x)<=15)return this.unpack_map(u);switch(x){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return u=this.unpack_uint16(),this.unpack_string(u);case 217:return u=this.unpack_uint32(),this.unpack_string(u);case 218:return u=this.unpack_uint16(),this.unpack_raw(u);case 219:return u=this.unpack_uint32(),this.unpack_raw(u);case 220:return u=this.unpack_uint16(),this.unpack_array(u);case 221:return u=this.unpack_uint32(),this.unpack_array(u);case 222:return u=this.unpack_uint16(),this.unpack_map(u);case 223:return u=this.unpack_uint32(),this.unpack_map(u)}},f.prototype.unpack_uint8=function(){var u=255&this.dataView[this.index];return this.index++,u},f.prototype.unpack_uint16=function(){var u=this.read(2),x=256*(255&u[0])+(255&u[1]);return this.index+=2,x},f.prototype.unpack_uint32=function(){var u=this.read(4),x=256*(256*(256*u[0]+u[1])+u[2])+u[3];return this.index+=4,x},f.prototype.unpack_uint64=function(){var u=this.read(8),x=256*(256*(256*(256*(256*(256*(256*u[0]+u[1])+u[2])+u[3])+u[4])+u[5])+u[6])+u[7];return this.index+=8,x},f.prototype.unpack_int8=function(){var u=this.unpack_uint8();return u<128?u:u-256},f.prototype.unpack_int16=function(){var u=this.unpack_uint16();return u<32768?u:u-65536},f.prototype.unpack_int32=function(){var u=this.unpack_uint32();return u<Math.pow(2,31)?u:u-Math.pow(2,32)},f.prototype.unpack_int64=function(){var u=this.unpack_uint64();return u<Math.pow(2,63)?u:u-Math.pow(2,64)},f.prototype.unpack_raw=function(u){if(this.length<this.index+u)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+u+" "+this.length);var x=this.dataBuffer.slice(this.index,this.index+u);return this.index+=u,x},f.prototype.unpack_string=function(u){for(var x,w,M=this.read(u),k=0,b="";k<u;)(x=M[k])<128?(b+=String.fromCharCode(x),k++):(192^x)<32?(w=(192^x)<<6|63&M[k+1],b+=String.fromCharCode(w),k+=2):(w=(15&x)<<12|(63&M[k+1])<<6|63&M[k+2],b+=String.fromCharCode(w),k+=3);return this.index+=u,b},f.prototype.unpack_array=function(u){for(var x=new Array(u),w=0;w<u;w++)x[w]=this.unpack();return x},f.prototype.unpack_map=function(u){for(var x={},w=0;w<u;w++){var M=this.unpack(),k=this.unpack();x[M]=k}return x},f.prototype.unpack_float=function(){var u=this.unpack_uint32(),x=(u>>23&255)-127;return(u>>31==0?1:-1)*(8388607&u|8388608)*Math.pow(2,x-23)},f.prototype.unpack_double=function(){var u=this.unpack_uint32(),x=this.unpack_uint32(),w=(u>>20&2047)-1023;return(u>>31==0?1:-1)*((1048575&u|1048576)*Math.pow(2,w-20)+x*Math.pow(2,w-52))},f.prototype.read=function(u){var x=this.index;if(x+u<=this.length)return this.dataView.subarray(x,x+u);throw new Error("BinaryPackFailure: read index out of range")},g.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},g.prototype.pack=function(u){var x=typeof u;if(x==="string")this.pack_string(u);else if(x==="number")Math.floor(u)===u?this.pack_integer(u):this.pack_double(u);else if(x==="boolean")u===!0?this.bufferBuilder.append(195):u===!1&&this.bufferBuilder.append(194);else if(x==="undefined")this.bufferBuilder.append(192);else{if(x!=="object")throw new Error('Type "'+x+'" not yet supported');if(u===null)this.bufferBuilder.append(192);else{var w=u.constructor;if(w==Array)this.pack_array(u);else if(w==Blob||w==File||u instanceof Blob||u instanceof File)this.pack_bin(u);else if(w==ArrayBuffer)h.useArrayBufferView?this.pack_bin(new Uint8Array(u)):this.pack_bin(u);else if("BYTES_PER_ELEMENT"in u)h.useArrayBufferView?this.pack_bin(new Uint8Array(u.buffer)):this.pack_bin(u.buffer);else if(w==Object||w.toString().startsWith("class"))this.pack_object(u);else if(w==Date)this.pack_string(u.toString());else{if(typeof u.toBinaryPack!="function")throw new Error('Type "'+w.toString()+'" not yet supported');this.bufferBuilder.append(u.toBinaryPack())}}}this.bufferBuilder.flush()},g.prototype.pack_bin=function(u){var x=u.length||u.byteLength||u.size;if(x<=15)this.pack_uint8(160+x);else if(x<=65535)this.bufferBuilder.append(218),this.pack_uint16(x);else{if(!(x<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(x)}this.bufferBuilder.append(u)},g.prototype.pack_string=function(u){var x=S(u);if(x<=15)this.pack_uint8(176+x);else if(x<=65535)this.bufferBuilder.append(216),this.pack_uint16(x);else{if(!(x<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(x)}this.bufferBuilder.append(u)},g.prototype.pack_array=function(u){var x=u.length;if(x<=15)this.pack_uint8(144+x);else if(x<=65535)this.bufferBuilder.append(220),this.pack_uint16(x);else{if(!(x<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(x)}for(var w=0;w<x;w++)this.pack(u[w])},g.prototype.pack_integer=function(u){if(u>=-32&&u<=127)this.bufferBuilder.append(255&u);else if(u>=0&&u<=255)this.bufferBuilder.append(204),this.pack_uint8(u);else if(u>=-128&&u<=127)this.bufferBuilder.append(208),this.pack_int8(u);else if(u>=0&&u<=65535)this.bufferBuilder.append(205),this.pack_uint16(u);else if(u>=-32768&&u<=32767)this.bufferBuilder.append(209),this.pack_int16(u);else if(u>=0&&u<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(u);else if(u>=-2147483648&&u<=2147483647)this.bufferBuilder.append(210),this.pack_int32(u);else if(u>=-9223372036854776e3&&u<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(u);else{if(!(u>=0&&u<=18446744073709552e3))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(u)}},g.prototype.pack_double=function(u){var x=0;u<0&&(x=1,u=-u);var w=Math.floor(Math.log(u)/Math.LN2),M=u/Math.pow(2,w)-1,k=Math.floor(M*Math.pow(2,52)),b=Math.pow(2,32),T=x<<31|w+1023<<20|k/b&1048575,m=k%b;this.bufferBuilder.append(203),this.pack_int32(T),this.pack_int32(m)},g.prototype.pack_object=function(u){var x=Object.keys(u).length;if(x<=15)this.pack_uint8(128+x);else if(x<=65535)this.bufferBuilder.append(222),this.pack_uint16(x);else{if(!(x<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(x)}for(var w in u)u.hasOwnProperty(w)&&(this.pack(w),this.pack(u[w]))},g.prototype.pack_uint8=function(u){this.bufferBuilder.append(u)},g.prototype.pack_uint16=function(u){this.bufferBuilder.append(u>>8),this.bufferBuilder.append(255&u)},g.prototype.pack_uint32=function(u){var x=4294967295&u;this.bufferBuilder.append((4278190080&x)>>>24),this.bufferBuilder.append((16711680&x)>>>16),this.bufferBuilder.append((65280&x)>>>8),this.bufferBuilder.append(255&x)},g.prototype.pack_uint64=function(u){var x=u/Math.pow(2,32),w=u%Math.pow(2,32);this.bufferBuilder.append((4278190080&x)>>>24),this.bufferBuilder.append((16711680&x)>>>16),this.bufferBuilder.append((65280&x)>>>8),this.bufferBuilder.append(255&x),this.bufferBuilder.append((4278190080&w)>>>24),this.bufferBuilder.append((16711680&w)>>>16),this.bufferBuilder.append((65280&w)>>>8),this.bufferBuilder.append(255&w)},g.prototype.pack_int8=function(u){this.bufferBuilder.append(255&u)},g.prototype.pack_int16=function(u){this.bufferBuilder.append((65280&u)>>8),this.bufferBuilder.append(255&u)},g.prototype.pack_int32=function(u){this.bufferBuilder.append(u>>>24&255),this.bufferBuilder.append((16711680&u)>>>16),this.bufferBuilder.append((65280&u)>>>8),this.bufferBuilder.append(255&u)},g.prototype.pack_int64=function(u){var x=Math.floor(u/Math.pow(2,32)),w=u%Math.pow(2,32);this.bufferBuilder.append((4278190080&x)>>>24),this.bufferBuilder.append((16711680&x)>>>16),this.bufferBuilder.append((65280&x)>>>8),this.bufferBuilder.append(255&x),this.bufferBuilder.append((4278190080&w)>>>24),this.bufferBuilder.append((16711680&w)>>>16),this.bufferBuilder.append((65280&w)>>>8),this.bufferBuilder.append(255&w)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(e,i,r){"use strict";function c(v,l,C){return l in v?Object.defineProperty(v,l,{value:C,enumerable:!0,configurable:!0,writable:!0}):v[l]=C,v}function h(v){return(h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l})(v)}Object.defineProperty(r,"__esModule",{value:!0}),r.extractVersion=g,r.wrapPeerConnectionEvent=y,r.disableLog=S,r.disableWarnings=u,r.log=x,r.deprecated=w,r.detectBrowser=M,r.compactObject=b,r.walkStats=T,r.filterStats=m;var p=!0,f=!0;function g(v,l,C){var R=v.match(l);return R&&R.length>=C&&parseInt(R[C],10)}function y(v,l,C){if(v.RTCPeerConnection){var R=v.RTCPeerConnection.prototype,j=R.addEventListener;R.addEventListener=function(z,W){if(z!==l)return j.apply(this,arguments);var U=function(G){var et=C(G);et&&W(et)};return this._eventMap=this._eventMap||{},this._eventMap[W]=U,j.apply(this,[z,U])};var L=R.removeEventListener;R.removeEventListener=function(z,W){if(z!==l||!this._eventMap||!this._eventMap[W])return L.apply(this,arguments);var U=this._eventMap[W];return delete this._eventMap[W],L.apply(this,[z,U])},Object.defineProperty(R,"on"+l,{get:function(){return this["_on"+l]},set:function(z){this["_on"+l]&&(this.removeEventListener(l,this["_on"+l]),delete this["_on"+l]),z&&this.addEventListener(l,this["_on"+l]=z)},enumerable:!0,configurable:!0})}}function S(v){return typeof v!="boolean"?new Error("Argument type: "+h(v)+". Please use a boolean."):(p=v,v?"adapter.js logging disabled":"adapter.js logging enabled")}function u(v){return typeof v!="boolean"?new Error("Argument type: "+h(v)+". Please use a boolean."):(f=!v,"adapter.js deprecation warnings "+(v?"disabled":"enabled"))}function x(){if((typeof window=="undefined"?"undefined":h(window))==="object"){if(p)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function w(v,l){f&&console.warn(v+" is deprecated, please use "+l+" instead.")}function M(v){var{navigator:l}=v,C={browser:null,version:null};if(v===void 0||!v.navigator)return C.browser="Not a browser.",C;if(l.mozGetUserMedia)C.browser="firefox",C.version=g(l.userAgent,/Firefox\/(\d+)\./,1);else if(l.webkitGetUserMedia||v.isSecureContext===!1&&v.webkitRTCPeerConnection&&!v.RTCIceGatherer)C.browser="chrome",C.version=g(l.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(l.mediaDevices&&l.userAgent.match(/Edge\/(\d+).(\d+)$/))C.browser="edge",C.version=g(l.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!v.RTCPeerConnection||!l.userAgent.match(/AppleWebKit\/(\d+)\./))return C.browser="Not a supported browser.",C;C.browser="safari",C.version=g(l.userAgent,/AppleWebKit\/(\d+)\./,1),C.supportsUnifiedPlan=v.RTCRtpTransceiver&&"currentDirection"in v.RTCRtpTransceiver.prototype}return C}function k(v){return Object.prototype.toString.call(v)==="[object Object]"}function b(v){return k(v)?Object.keys(v).reduce(function(l,C){var R=k(v[C]),j=R?b(v[C]):v[C],L=R&&!Object.keys(j).length;return j===void 0||L?l:Object.assign(l,c({},C,j))},{}):v}function T(v,l,C){l&&!C.has(l.id)&&(C.set(l.id,l),Object.keys(l).forEach(function(R){R.endsWith("Id")?T(v,v.get(l[R]),C):R.endsWith("Ids")&&l[R].forEach(function(j){T(v,v.get(j),C)})}))}function m(v,l,C){var R=C?"outbound-rtp":"inbound-rtp",j=new Map;if(l===null)return j;var L=[];return v.forEach(function(z){z.type==="track"&&z.trackIdentifier===l.id&&L.push(z)}),L.forEach(function(z){v.forEach(function(W){W.type===R&&W.trackId===z.id&&T(v,W,j)})}),j}},{}],s6SN:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=y;var c=p(e("../utils.js"));function h(){if(typeof WeakMap!="function")return null;var S=new WeakMap;return h=function(){return S},S}function p(S){if(S&&S.__esModule)return S;if(S===null||typeof S!="object"&&typeof S!="function")return{default:S};var u=h();if(u&&u.has(S))return u.get(S);var x={},w=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var M in S)if(Object.prototype.hasOwnProperty.call(S,M)){var k=w?Object.getOwnPropertyDescriptor(S,M):null;k&&(k.get||k.set)?Object.defineProperty(x,M,k):x[M]=S[M]}return x.default=S,u&&u.set(S,x),x}function f(S){return(f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u})(S)}var g=c.log;function y(S){var u=S&&S.navigator;if(u.mediaDevices){var x=c.detectBrowser(S),w=function(T){if(f(T)!=="object"||T.mandatory||T.optional)return T;var m={};return Object.keys(T).forEach(function(v){if(v!=="require"&&v!=="advanced"&&v!=="mediaSource"){var l=f(T[v])==="object"?T[v]:{ideal:T[v]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);var C=function(j,L){return j?j+L.charAt(0).toUpperCase()+L.slice(1):L==="deviceId"?"sourceId":L};if(l.ideal!==void 0){m.optional=m.optional||[];var R={};typeof l.ideal=="number"?(R[C("min",v)]=l.ideal,m.optional.push(R),(R={})[C("max",v)]=l.ideal,m.optional.push(R)):(R[C("",v)]=l.ideal,m.optional.push(R))}l.exact!==void 0&&typeof l.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[C("",v)]=l.exact):["min","max"].forEach(function(j){l[j]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[C(j,v)]=l[j])})}}),T.advanced&&(m.optional=(m.optional||[]).concat(T.advanced)),m},M=function(T,m){if(x.version>=61)return m(T);if((T=JSON.parse(JSON.stringify(T)))&&f(T.audio)==="object"){var v=function(j,L,z){L in j&&!(z in j)&&(j[z]=j[L],delete j[L])};v((T=JSON.parse(JSON.stringify(T))).audio,"autoGainControl","googAutoGainControl"),v(T.audio,"noiseSuppression","googNoiseSuppression"),T.audio=w(T.audio)}if(T&&f(T.video)==="object"){var l=T.video.facingMode;l=l&&(f(l)==="object"?l:{ideal:l});var C,R=x.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&(!u.mediaDevices.getSupportedConstraints||!u.mediaDevices.getSupportedConstraints().facingMode||R)&&(delete T.video.facingMode,l.exact==="environment"||l.ideal==="environment"?C=["back","rear"]:l.exact!=="user"&&l.ideal!=="user"||(C=["front"]),C))return u.mediaDevices.enumerateDevices().then(function(j){var L=(j=j.filter(function(z){return z.kind==="videoinput"})).find(function(z){return C.some(function(W){return z.label.toLowerCase().includes(W)})});return!L&&j.length&&C.includes("back")&&(L=j[j.length-1]),L&&(T.video.deviceId=l.exact?{exact:L.deviceId}:{ideal:L.deviceId}),T.video=w(T.video),g("chrome: "+JSON.stringify(T)),m(T)});T.video=w(T.video)}return g("chrome: "+JSON.stringify(T)),m(T)},k=function(T){return x.version>=64?T:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[T.name]||T.name,message:T.message,constraint:T.constraint||T.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(u.getUserMedia=function(T,m,v){M(T,function(l){u.webkitGetUserMedia(l,m,function(C){v&&v(k(C))})})}.bind(u),u.mediaDevices.getUserMedia){var b=u.mediaDevices.getUserMedia.bind(u.mediaDevices);u.mediaDevices.getUserMedia=function(T){return M(T,function(m){return b(m).then(function(v){if(m.audio&&!v.getAudioTracks().length||m.video&&!v.getVideoTracks().length)throw v.getTracks().forEach(function(l){l.stop()}),new DOMException("","NotFoundError");return v},function(v){return Promise.reject(k(v))})})}}}}},{"../utils.js":"iSxC"}],VHa8:[function(e,i,r){"use strict";function c(h,p){h.navigator.mediaDevices&&"getDisplayMedia"in h.navigator.mediaDevices||h.navigator.mediaDevices&&(typeof p=="function"?h.navigator.mediaDevices.getDisplayMedia=function(f){return p(f).then(function(g){var y=f.video&&f.video.width,S=f.video&&f.video.height,u=f.video&&f.video.frameRate;return f.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:g,maxFrameRate:u||3}},y&&(f.video.mandatory.maxWidth=y),S&&(f.video.mandatory.maxHeight=S),h.navigator.mediaDevices.getUserMedia(f)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=c},{}],uI5X:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimMediaStream=u,r.shimOnTrack=x,r.shimGetSendersWithDtmf=w,r.shimGetStats=M,r.shimSenderReceiverGetStats=k,r.shimAddTrackRemoveTrackWithNative=b,r.shimAddTrackRemoveTrack=T,r.shimPeerConnection=m,r.fixNegotiationNeeded=v,Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return h.shimGetUserMedia}}),Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return p.shimGetDisplayMedia}});var c=g(e("../utils.js")),h=e("./getusermedia"),p=e("./getdisplaymedia");function f(){if(typeof WeakMap!="function")return null;var l=new WeakMap;return f=function(){return l},l}function g(l){if(l&&l.__esModule)return l;if(l===null||typeof l!="object"&&typeof l!="function")return{default:l};var C=f();if(C&&C.has(l))return C.get(l);var R={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in l)if(Object.prototype.hasOwnProperty.call(l,L)){var z=j?Object.getOwnPropertyDescriptor(l,L):null;z&&(z.get||z.set)?Object.defineProperty(R,L,z):R[L]=l[L]}return R.default=l,C&&C.set(l,R),R}function y(l,C,R){return C in l?Object.defineProperty(l,C,{value:R,enumerable:!0,configurable:!0,writable:!0}):l[C]=R,l}function S(l){return(S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C})(l)}function u(l){l.MediaStream=l.MediaStream||l.webkitMediaStream}function x(l){if(S(l)!=="object"||!l.RTCPeerConnection||"ontrack"in l.RTCPeerConnection.prototype)c.wrapPeerConnectionEvent(l,"track",function(R){return R.transceiver||Object.defineProperty(R,"transceiver",{value:{receiver:R.receiver}}),R});else{Object.defineProperty(l.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(R){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=R)},enumerable:!0,configurable:!0});var C=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(){var R=this;return this._ontrackpoly||(this._ontrackpoly=function(j){j.stream.addEventListener("addtrack",function(L){var z;z=l.RTCPeerConnection.prototype.getReceivers?R.getReceivers().find(function(U){return U.track&&U.track.id===L.track.id}):{track:L.track};var W=new Event("track");W.track=L.track,W.receiver=z,W.transceiver={receiver:z},W.streams=[j.stream],R.dispatchEvent(W)}),j.stream.getTracks().forEach(function(L){var z;z=l.RTCPeerConnection.prototype.getReceivers?R.getReceivers().find(function(U){return U.track&&U.track.id===L.id}):{track:L};var W=new Event("track");W.track=L,W.receiver=z,W.transceiver={receiver:z},W.streams=[j.stream],R.dispatchEvent(W)})},this.addEventListener("addstream",this._ontrackpoly)),C.apply(this,arguments)}}}function w(l){if(S(l)==="object"&&l.RTCPeerConnection&&!("getSenders"in l.RTCPeerConnection.prototype)&&"createDTMFSender"in l.RTCPeerConnection.prototype){var C=function(U,G){return{track:G,get dtmf(){return this._dtmf===void 0&&(G.kind==="audio"?this._dtmf=U.createDTMFSender(G):this._dtmf=null),this._dtmf},_pc:U}};if(!l.RTCPeerConnection.prototype.getSenders){l.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var R=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addTrack=function(U,G){var et=R.apply(this,arguments);return et||(et=C(this,U),this._senders.push(et)),et};var j=l.RTCPeerConnection.prototype.removeTrack;l.RTCPeerConnection.prototype.removeTrack=function(U){j.apply(this,arguments);var G=this._senders.indexOf(U);G!==-1&&this._senders.splice(G,1)}}var L=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(U){var G=this;this._senders=this._senders||[],L.apply(this,[U]),U.getTracks().forEach(function(et){G._senders.push(C(G,et))})};var z=l.RTCPeerConnection.prototype.removeStream;l.RTCPeerConnection.prototype.removeStream=function(U){var G=this;this._senders=this._senders||[],z.apply(this,[U]),U.getTracks().forEach(function(et){var at=G._senders.find(function(lt){return lt.track===et});at&&G._senders.splice(G._senders.indexOf(at),1)})}}else if(S(l)==="object"&&l.RTCPeerConnection&&"getSenders"in l.RTCPeerConnection.prototype&&"createDTMFSender"in l.RTCPeerConnection.prototype&&l.RTCRtpSender&&!("dtmf"in l.RTCRtpSender.prototype)){var W=l.RTCPeerConnection.prototype.getSenders;l.RTCPeerConnection.prototype.getSenders=function(){var U=this,G=W.apply(this,[]);return G.forEach(function(et){return et._pc=U}),G},Object.defineProperty(l.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function M(l){if(l.RTCPeerConnection){var C=l.RTCPeerConnection.prototype.getStats;l.RTCPeerConnection.prototype.getStats=function(){var R=this,[j,L,z]=arguments;if(arguments.length>0&&typeof j=="function")return C.apply(this,arguments);if(C.length===0&&(arguments.length===0||typeof j!="function"))return C.apply(this,[]);var W=function(G){var et={};return G.result().forEach(function(at){var lt={id:at.id,timestamp:at.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[at.type]||at.type};at.names().forEach(function($){lt[$]=at.stat($)}),et[lt.id]=lt}),et},U=function(G){return new Map(Object.keys(G).map(function(et){return[et,G[et]]}))};return arguments.length>=2?C.apply(this,[function(G){L(U(W(G)))},j]):new Promise(function(G,et){C.apply(R,[function(at){G(U(W(at)))},et])}).then(L,z)}}}function k(l){if(S(l)==="object"&&l.RTCPeerConnection&&l.RTCRtpSender&&l.RTCRtpReceiver){if(!("getStats"in l.RTCRtpSender.prototype)){var C=l.RTCPeerConnection.prototype.getSenders;C&&(l.RTCPeerConnection.prototype.getSenders=function(){var z=this,W=C.apply(this,[]);return W.forEach(function(U){return U._pc=z}),W});var R=l.RTCPeerConnection.prototype.addTrack;R&&(l.RTCPeerConnection.prototype.addTrack=function(){var z=R.apply(this,arguments);return z._pc=this,z}),l.RTCRtpSender.prototype.getStats=function(){var z=this;return this._pc.getStats().then(function(W){return c.filterStats(W,z.track,!0)})}}if(!("getStats"in l.RTCRtpReceiver.prototype)){var j=l.RTCPeerConnection.prototype.getReceivers;j&&(l.RTCPeerConnection.prototype.getReceivers=function(){var z=this,W=j.apply(this,[]);return W.forEach(function(U){return U._pc=z}),W}),c.wrapPeerConnectionEvent(l,"track",function(z){return z.receiver._pc=z.srcElement,z}),l.RTCRtpReceiver.prototype.getStats=function(){var z=this;return this._pc.getStats().then(function(W){return c.filterStats(W,z.track,!1)})}}if("getStats"in l.RTCRtpSender.prototype&&"getStats"in l.RTCRtpReceiver.prototype){var L=l.RTCPeerConnection.prototype.getStats;l.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof l.MediaStreamTrack){var z,W,U,G=arguments[0];return this.getSenders().forEach(function(et){et.track===G&&(z?U=!0:z=et)}),this.getReceivers().forEach(function(et){return et.track===G&&(W?U=!0:W=et),et.track===G}),U||z&&W?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):z?z.getStats():W?W.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return L.apply(this,arguments)}}}}function b(l){l.RTCPeerConnection.prototype.getLocalStreams=function(){var z=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(W){return z._shimmedLocalStreams[W][0]})};var C=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addTrack=function(z,W){if(!W)return C.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var U=C.apply(this,arguments);return this._shimmedLocalStreams[W.id]?this._shimmedLocalStreams[W.id].indexOf(U)===-1&&this._shimmedLocalStreams[W.id].push(U):this._shimmedLocalStreams[W.id]=[W,U],U};var R=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(z){var W=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},z.getTracks().forEach(function(et){if(W.getSenders().find(function(at){return at.track===et}))throw new DOMException("Track already exists.","InvalidAccessError")});var U=this.getSenders();R.apply(this,arguments);var G=this.getSenders().filter(function(et){return U.indexOf(et)===-1});this._shimmedLocalStreams[z.id]=[z].concat(G)};var j=l.RTCPeerConnection.prototype.removeStream;l.RTCPeerConnection.prototype.removeStream=function(z){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[z.id],j.apply(this,arguments)};var L=l.RTCPeerConnection.prototype.removeTrack;l.RTCPeerConnection.prototype.removeTrack=function(z){var W=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},z&&Object.keys(this._shimmedLocalStreams).forEach(function(U){var G=W._shimmedLocalStreams[U].indexOf(z);G!==-1&&W._shimmedLocalStreams[U].splice(G,1),W._shimmedLocalStreams[U].length===1&&delete W._shimmedLocalStreams[U]}),L.apply(this,arguments)}}function T(l){if(l.RTCPeerConnection){var C=c.detectBrowser(l);if(l.RTCPeerConnection.prototype.addTrack&&C.version>=65)return b(l);var R=l.RTCPeerConnection.prototype.getLocalStreams;l.RTCPeerConnection.prototype.getLocalStreams=function(){var G=this,et=R.apply(this);return this._reverseStreams=this._reverseStreams||{},et.map(function(at){return G._reverseStreams[at.id]})};var j=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(G){var et=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},G.getTracks().forEach(function(lt){if(et.getSenders().find(function($){return $.track===lt}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[G.id]){var at=new l.MediaStream(G.getTracks());this._streams[G.id]=at,this._reverseStreams[at.id]=G,G=at}j.apply(this,[G])};var L=l.RTCPeerConnection.prototype.removeStream;l.RTCPeerConnection.prototype.removeStream=function(G){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},L.apply(this,[this._streams[G.id]||G]),delete this._reverseStreams[this._streams[G.id]?this._streams[G.id].id:G.id],delete this._streams[G.id]},l.RTCPeerConnection.prototype.addTrack=function(G,et){var at=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var lt=[].slice.call(arguments,1);if(lt.length!==1||!lt[0].getTracks().find(function(st){return st===G}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(st){return st.track===G}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var $=this._streams[et.id];if($)$.addTrack(G),Promise.resolve().then(function(){at.dispatchEvent(new Event("negotiationneeded"))});else{var ot=new l.MediaStream([G]);this._streams[et.id]=ot,this._reverseStreams[ot.id]=et,this.addStream(ot)}return this.getSenders().find(function(st){return st.track===G})},["createOffer","createAnswer"].forEach(function(G){var et=l.RTCPeerConnection.prototype[G],at=y({},G,function(){var lt=this,$=arguments;return arguments.length&&typeof arguments[0]=="function"?et.apply(this,[function(ot){var st=U(lt,ot);$[0].apply(null,[st])},function(ot){$[1]&&$[1].apply(null,ot)},arguments[2]]):et.apply(this,arguments).then(function(ot){return U(lt,ot)})});l.RTCPeerConnection.prototype[G]=at[G]});var z=l.RTCPeerConnection.prototype.setLocalDescription;l.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(G=this,et=arguments[0],at=et.sdp,Object.keys(G._reverseStreams||[]).forEach(function(lt){var $=G._reverseStreams[lt],ot=G._streams[$.id];at=at.replace(new RegExp($.id,"g"),ot.id)}),new RTCSessionDescription({type:et.type,sdp:at})),z.apply(this,arguments)):z.apply(this,arguments);var G,et,at};var W=Object.getOwnPropertyDescriptor(l.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(l.RTCPeerConnection.prototype,"localDescription",{get:function(){var G=W.get.apply(this);return G.type===""?G:U(this,G)}}),l.RTCPeerConnection.prototype.removeTrack=function(G){var et,at=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!G._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(G._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(lt){at._streams[lt].getTracks().find(function($){return G.track===$})&&(et=at._streams[lt])}),et&&(et.getTracks().length===1?this.removeStream(this._reverseStreams[et.id]):et.removeTrack(G.track),this.dispatchEvent(new Event("negotiationneeded")))}}function U(G,et){var at=et.sdp;return Object.keys(G._reverseStreams||[]).forEach(function(lt){var $=G._reverseStreams[lt],ot=G._streams[$.id];at=at.replace(new RegExp(ot.id,"g"),$.id)}),new RTCSessionDescription({type:et.type,sdp:at})}}function m(l){var C=c.detectBrowser(l);if(!l.RTCPeerConnection&&l.webkitRTCPeerConnection&&(l.RTCPeerConnection=l.webkitRTCPeerConnection),l.RTCPeerConnection){C.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(j){var L=l.RTCPeerConnection.prototype[j],z=y({},j,function(){return arguments[0]=new(j==="addIceCandidate"?l.RTCIceCandidate:l.RTCSessionDescription)(arguments[0]),L.apply(this,arguments)});l.RTCPeerConnection.prototype[j]=z[j]});var R=l.RTCPeerConnection.prototype.addIceCandidate;l.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?C.version<78&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():R.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}function v(l){c.wrapPeerConnectionEvent(l,"negotiationneeded",function(C){if(C.target.signalingState==="stable")return C})}},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=f;var c=p(e("../utils"));function h(){if(typeof WeakMap!="function")return null;var g=new WeakMap;return h=function(){return g},g}function p(g){if(g&&g.__esModule)return g;if(g===null||typeof g!="object"&&typeof g!="function")return{default:g};var y=h();if(y&&y.has(g))return y.get(g);var S={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in g)if(Object.prototype.hasOwnProperty.call(g,x)){var w=u?Object.getOwnPropertyDescriptor(g,x):null;w&&(w.get||w.set)?Object.defineProperty(S,x,w):S[x]=g[x]}return S.default=g,y&&y.set(g,S),S}function f(g,y){var S=!1;return(g=JSON.parse(JSON.stringify(g))).filter(function(u){if(u&&(u.urls||u.url)){var x=u.urls||u.url;u.url&&!u.urls&&c.deprecated("RTCIceServer.url","RTCIceServer.urls");var w=typeof x=="string";return w&&(x=[x]),x=x.filter(function(M){if(M.indexOf("stun:")===0)return!1;var k=M.startsWith("turn")&&!M.startsWith("turn:[")&&M.includes("transport=udp");return k&&!S?(S=!0,!0):k&&!S}),delete u.url,u.urls=w?x[0]:x,!!x.length}})}},{"../utils":"iSxC"}],YHvh:[function(e,i,r){"use strict";var c={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};c.localCName=c.generateIdentifier(),c.splitLines=function(h){return h.trim().split(`
`).map(function(p){return p.trim()})},c.splitSections=function(h){return h.split(`
m=`).map(function(p,f){return(f>0?"m="+p:p).trim()+`\r
`})},c.getDescription=function(h){var p=c.splitSections(h);return p&&p[0]},c.getMediaSections=function(h){var p=c.splitSections(h);return p.shift(),p},c.matchPrefix=function(h,p){return c.splitLines(h).filter(function(f){return f.indexOf(p)===0})},c.parseCandidate=function(h){for(var p,f={foundation:(p=h.indexOf("a=candidate:")===0?h.substring(12).split(" "):h.substring(10).split(" "))[0],component:parseInt(p[1],10),protocol:p[2].toLowerCase(),priority:parseInt(p[3],10),ip:p[4],address:p[4],port:parseInt(p[5],10),type:p[7]},g=8;g<p.length;g+=2)switch(p[g]){case"raddr":f.relatedAddress=p[g+1];break;case"rport":f.relatedPort=parseInt(p[g+1],10);break;case"tcptype":f.tcpType=p[g+1];break;case"ufrag":f.ufrag=p[g+1],f.usernameFragment=p[g+1];break;default:f[p[g]]=p[g+1]}return f},c.writeCandidate=function(h){var p=[];p.push(h.foundation),p.push(h.component),p.push(h.protocol.toUpperCase()),p.push(h.priority),p.push(h.address||h.ip),p.push(h.port);var f=h.type;return p.push("typ"),p.push(f),f!=="host"&&h.relatedAddress&&h.relatedPort&&(p.push("raddr"),p.push(h.relatedAddress),p.push("rport"),p.push(h.relatedPort)),h.tcpType&&h.protocol.toLowerCase()==="tcp"&&(p.push("tcptype"),p.push(h.tcpType)),(h.usernameFragment||h.ufrag)&&(p.push("ufrag"),p.push(h.usernameFragment||h.ufrag)),"candidate:"+p.join(" ")},c.parseIceOptions=function(h){return h.substr(14).split(" ")},c.parseRtpMap=function(h){var p=h.substr(9).split(" "),f={payloadType:parseInt(p.shift(),10)};return p=p[0].split("/"),f.name=p[0],f.clockRate=parseInt(p[1],10),f.channels=p.length===3?parseInt(p[2],10):1,f.numChannels=f.channels,f},c.writeRtpMap=function(h){var p=h.payloadType;h.preferredPayloadType!==void 0&&(p=h.preferredPayloadType);var f=h.channels||h.numChannels||1;return"a=rtpmap:"+p+" "+h.name+"/"+h.clockRate+(f!==1?"/"+f:"")+`\r
`},c.parseExtmap=function(h){var p=h.substr(9).split(" ");return{id:parseInt(p[0],10),direction:p[0].indexOf("/")>0?p[0].split("/")[1]:"sendrecv",uri:p[1]}},c.writeExtmap=function(h){return"a=extmap:"+(h.id||h.preferredId)+(h.direction&&h.direction!=="sendrecv"?"/"+h.direction:"")+" "+h.uri+`\r
`},c.parseFmtp=function(h){for(var p,f={},g=h.substr(h.indexOf(" ")+1).split(";"),y=0;y<g.length;y++)f[(p=g[y].trim().split("="))[0].trim()]=p[1];return f},c.writeFmtp=function(h){var p="",f=h.payloadType;if(h.preferredPayloadType!==void 0&&(f=h.preferredPayloadType),h.parameters&&Object.keys(h.parameters).length){var g=[];Object.keys(h.parameters).forEach(function(y){h.parameters[y]?g.push(y+"="+h.parameters[y]):g.push(y)}),p+="a=fmtp:"+f+" "+g.join(";")+`\r
`}return p},c.parseRtcpFb=function(h){var p=h.substr(h.indexOf(" ")+1).split(" ");return{type:p.shift(),parameter:p.join(" ")}},c.writeRtcpFb=function(h){var p="",f=h.payloadType;return h.preferredPayloadType!==void 0&&(f=h.preferredPayloadType),h.rtcpFeedback&&h.rtcpFeedback.length&&h.rtcpFeedback.forEach(function(g){p+="a=rtcp-fb:"+f+" "+g.type+(g.parameter&&g.parameter.length?" "+g.parameter:"")+`\r
`}),p},c.parseSsrcMedia=function(h){var p=h.indexOf(" "),f={ssrc:parseInt(h.substr(7,p-7),10)},g=h.indexOf(":",p);return g>-1?(f.attribute=h.substr(p+1,g-p-1),f.value=h.substr(g+1)):f.attribute=h.substr(p+1),f},c.parseSsrcGroup=function(h){var p=h.substr(13).split(" ");return{semantics:p.shift(),ssrcs:p.map(function(f){return parseInt(f,10)})}},c.getMid=function(h){var p=c.matchPrefix(h,"a=mid:")[0];if(p)return p.substr(6)},c.parseFingerprint=function(h){var p=h.substr(14).split(" ");return{algorithm:p[0].toLowerCase(),value:p[1]}},c.getDtlsParameters=function(h,p){return{role:"auto",fingerprints:c.matchPrefix(h+p,"a=fingerprint:").map(c.parseFingerprint)}},c.writeDtlsParameters=function(h,p){var f="a=setup:"+p+`\r
`;return h.fingerprints.forEach(function(g){f+="a=fingerprint:"+g.algorithm+" "+g.value+`\r
`}),f},c.getIceParameters=function(h,p){var f=c.splitLines(h);return{usernameFragment:(f=f.concat(c.splitLines(p))).filter(function(g){return g.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:f.filter(function(g){return g.indexOf("a=ice-pwd:")===0})[0].substr(10)}},c.writeIceParameters=function(h){return"a=ice-ufrag:"+h.usernameFragment+`\r
a=ice-pwd:`+h.password+`\r
`},c.parseRtpParameters=function(h){for(var p={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},f=c.splitLines(h)[0].split(" "),g=3;g<f.length;g++){var y=f[g],S=c.matchPrefix(h,"a=rtpmap:"+y+" ")[0];if(S){var u=c.parseRtpMap(S),x=c.matchPrefix(h,"a=fmtp:"+y+" ");switch(u.parameters=x.length?c.parseFmtp(x[0]):{},u.rtcpFeedback=c.matchPrefix(h,"a=rtcp-fb:"+y+" ").map(c.parseRtcpFb),p.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":p.fecMechanisms.push(u.name.toUpperCase())}}}return c.matchPrefix(h,"a=extmap:").forEach(function(w){p.headerExtensions.push(c.parseExtmap(w))}),p},c.writeRtpDescription=function(h,p){var f="";f+="m="+h+" ",f+=p.codecs.length>0?"9":"0",f+=" UDP/TLS/RTP/SAVPF ",f+=p.codecs.map(function(y){return y.preferredPayloadType!==void 0?y.preferredPayloadType:y.payloadType}).join(" ")+`\r
`,f+=`c=IN IP4 0.0.0.0\r
`,f+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,p.codecs.forEach(function(y){f+=c.writeRtpMap(y),f+=c.writeFmtp(y),f+=c.writeRtcpFb(y)});var g=0;return p.codecs.forEach(function(y){y.maxptime>g&&(g=y.maxptime)}),g>0&&(f+="a=maxptime:"+g+`\r
`),f+=`a=rtcp-mux\r
`,p.headerExtensions&&p.headerExtensions.forEach(function(y){f+=c.writeExtmap(y)}),f},c.parseRtpEncodingParameters=function(h){var p,f=[],g=c.parseRtpParameters(h),y=g.fecMechanisms.indexOf("RED")!==-1,S=g.fecMechanisms.indexOf("ULPFEC")!==-1,u=c.matchPrefix(h,"a=ssrc:").map(function(k){return c.parseSsrcMedia(k)}).filter(function(k){return k.attribute==="cname"}),x=u.length>0&&u[0].ssrc,w=c.matchPrefix(h,"a=ssrc-group:FID").map(function(k){return k.substr(17).split(" ").map(function(b){return parseInt(b,10)})});w.length>0&&w[0].length>1&&w[0][0]===x&&(p=w[0][1]),g.codecs.forEach(function(k){if(k.name.toUpperCase()==="RTX"&&k.parameters.apt){var b={ssrc:x,codecPayloadType:parseInt(k.parameters.apt,10)};x&&p&&(b.rtx={ssrc:p}),f.push(b),y&&((b=JSON.parse(JSON.stringify(b))).fec={ssrc:x,mechanism:S?"red+ulpfec":"red"},f.push(b))}}),f.length===0&&x&&f.push({ssrc:x});var M=c.matchPrefix(h,"b=");return M.length&&(M=M[0].indexOf("b=TIAS:")===0?parseInt(M[0].substr(7),10):M[0].indexOf("b=AS:")===0?1e3*parseInt(M[0].substr(5),10)*.95-16e3:void 0,f.forEach(function(k){k.maxBitrate=M})),f},c.parseRtcpParameters=function(h){var p={},f=c.matchPrefix(h,"a=ssrc:").map(function(S){return c.parseSsrcMedia(S)}).filter(function(S){return S.attribute==="cname"})[0];f&&(p.cname=f.value,p.ssrc=f.ssrc);var g=c.matchPrefix(h,"a=rtcp-rsize");p.reducedSize=g.length>0,p.compound=g.length===0;var y=c.matchPrefix(h,"a=rtcp-mux");return p.mux=y.length>0,p},c.parseMsid=function(h){var p,f=c.matchPrefix(h,"a=msid:");if(f.length===1)return{stream:(p=f[0].substr(7).split(" "))[0],track:p[1]};var g=c.matchPrefix(h,"a=ssrc:").map(function(y){return c.parseSsrcMedia(y)}).filter(function(y){return y.attribute==="msid"});return g.length>0?{stream:(p=g[0].value.split(" "))[0],track:p[1]}:void 0},c.parseSctpDescription=function(h){var p,f=c.parseMLine(h),g=c.matchPrefix(h,"a=max-message-size:");g.length>0&&(p=parseInt(g[0].substr(19),10)),isNaN(p)&&(p=65536);var y=c.matchPrefix(h,"a=sctp-port:");if(y.length>0)return{port:parseInt(y[0].substr(12),10),protocol:f.fmt,maxMessageSize:p};if(c.matchPrefix(h,"a=sctpmap:").length>0){var S=c.matchPrefix(h,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(S[0],10),protocol:S[1],maxMessageSize:p}}},c.writeSctpDescription=function(h,p){var f=[];return f=h.protocol!=="DTLS/SCTP"?["m="+h.kind+" 9 "+h.protocol+" "+p.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+p.port+`\r
`]:["m="+h.kind+" 9 "+h.protocol+" "+p.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+p.port+" "+p.protocol+` 65535\r
`],p.maxMessageSize!==void 0&&f.push("a=max-message-size:"+p.maxMessageSize+`\r
`),f.join("")},c.generateSessionId=function(){return Math.random().toString().substr(2,21)},c.writeSessionBoilerplate=function(h,p,f){var g=p!==void 0?p:2;return`v=0\r
o=`+(f||"thisisadapterortc")+" "+(h||c.generateSessionId())+" "+g+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},c.writeMediaSection=function(h,p,f,g){var y=c.writeRtpDescription(h.kind,p);if(y+=c.writeIceParameters(h.iceGatherer.getLocalParameters()),y+=c.writeDtlsParameters(h.dtlsTransport.getLocalParameters(),f==="offer"?"actpass":"active"),y+="a=mid:"+h.mid+`\r
`,h.direction?y+="a="+h.direction+`\r
`:h.rtpSender&&h.rtpReceiver?y+=`a=sendrecv\r
`:h.rtpSender?y+=`a=sendonly\r
`:h.rtpReceiver?y+=`a=recvonly\r
`:y+=`a=inactive\r
`,h.rtpSender){var S="msid:"+g.id+" "+h.rtpSender.track.id+`\r
`;y+="a="+S,y+="a=ssrc:"+h.sendEncodingParameters[0].ssrc+" "+S,h.sendEncodingParameters[0].rtx&&(y+="a=ssrc:"+h.sendEncodingParameters[0].rtx.ssrc+" "+S,y+="a=ssrc-group:FID "+h.sendEncodingParameters[0].ssrc+" "+h.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return y+="a=ssrc:"+h.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+`\r
`,h.rtpSender&&h.sendEncodingParameters[0].rtx&&(y+="a=ssrc:"+h.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+`\r
`),y},c.getDirection=function(h,p){for(var f=c.splitLines(h),g=0;g<f.length;g++)switch(f[g]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return f[g].substr(2)}return p?c.getDirection(p):"sendrecv"},c.getKind=function(h){return c.splitLines(h)[0].split(" ")[0].substr(2)},c.isRejected=function(h){return h.split(" ",2)[1]==="0"},c.parseMLine=function(h){var p=c.splitLines(h)[0].substr(2).split(" ");return{kind:p[0],port:parseInt(p[1],10),protocol:p[2],fmt:p.slice(3).join(" ")}},c.parseOLine=function(h){var p=c.matchPrefix(h,"o=")[0].substr(2).split(" ");return{username:p[0],sessionId:p[1],sessionVersion:parseInt(p[2],10),netType:p[3],addressType:p[4],address:p[5]}},c.isValidSDP=function(h){if(typeof h!="string"||h.length===0)return!1;for(var p=c.splitLines(h),f=0;f<p.length;f++)if(p[f].length<2||p[f].charAt(1)!=="=")return!1;return!0},typeof i=="object"&&(i.exports=c)},{}],NJ2u:[function(e,i,r){"use strict";var c=e("sdp");function h(x){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[x.type]||x.type}function p(x,w,M,k,b){var T=c.writeRtpDescription(x.kind,w);if(T+=c.writeIceParameters(x.iceGatherer.getLocalParameters()),T+=c.writeDtlsParameters(x.dtlsTransport.getLocalParameters(),M==="offer"?"actpass":b||"active"),T+="a=mid:"+x.mid+`\r
`,x.rtpSender&&x.rtpReceiver?T+=`a=sendrecv\r
`:x.rtpSender?T+=`a=sendonly\r
`:x.rtpReceiver?T+=`a=recvonly\r
`:T+=`a=inactive\r
`,x.rtpSender){var m=x.rtpSender._initialTrackId||x.rtpSender.track.id;x.rtpSender._initialTrackId=m;var v="msid:"+(k?k.id:"-")+" "+m+`\r
`;T+="a="+v,T+="a=ssrc:"+x.sendEncodingParameters[0].ssrc+" "+v,x.sendEncodingParameters[0].rtx&&(T+="a=ssrc:"+x.sendEncodingParameters[0].rtx.ssrc+" "+v,T+="a=ssrc-group:FID "+x.sendEncodingParameters[0].ssrc+" "+x.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return T+="a=ssrc:"+x.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+`\r
`,x.rtpSender&&x.sendEncodingParameters[0].rtx&&(T+="a=ssrc:"+x.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+`\r
`),T}function f(x,w){var M=!1;return(x=JSON.parse(JSON.stringify(x))).filter(function(k){if(k&&(k.urls||k.url)){var b=k.urls||k.url;k.url&&!k.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var T=typeof b=="string";return T&&(b=[b]),b=b.filter(function(m){return m.indexOf("turn:")===0&&m.indexOf("transport=udp")!==-1&&m.indexOf("turn:[")===-1&&!M?(M=!0,!0):m.indexOf("stun:")===0&&w>=14393&&m.indexOf("?transport=udp")===-1}),delete k.url,k.urls=T?b[0]:b,!!b.length}})}function g(x,w){var M={codecs:[],headerExtensions:[],fecMechanisms:[]},k=function(T,m){T=parseInt(T,10);for(var v=0;v<m.length;v++)if(m[v].payloadType===T||m[v].preferredPayloadType===T)return m[v]},b=function(T,m,v,l){var C=k(T.parameters.apt,v),R=k(m.parameters.apt,l);return C&&R&&C.name.toLowerCase()===R.name.toLowerCase()};return x.codecs.forEach(function(T){for(var m=0;m<w.codecs.length;m++){var v=w.codecs[m];if(T.name.toLowerCase()===v.name.toLowerCase()&&T.clockRate===v.clockRate){if(T.name.toLowerCase()==="rtx"&&T.parameters&&v.parameters.apt&&!b(T,v,x.codecs,w.codecs))continue;(v=JSON.parse(JSON.stringify(v))).numChannels=Math.min(T.numChannels,v.numChannels),M.codecs.push(v),v.rtcpFeedback=v.rtcpFeedback.filter(function(l){for(var C=0;C<T.rtcpFeedback.length;C++)if(T.rtcpFeedback[C].type===l.type&&T.rtcpFeedback[C].parameter===l.parameter)return!0;return!1});break}}}),x.headerExtensions.forEach(function(T){for(var m=0;m<w.headerExtensions.length;m++){var v=w.headerExtensions[m];if(T.uri===v.uri){M.headerExtensions.push(v);break}}}),M}function y(x,w,M){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[w][x].indexOf(M)!==-1}function S(x,w){var M=x.getRemoteCandidates().find(function(k){return w.foundation===k.foundation&&w.ip===k.ip&&w.port===k.port&&w.priority===k.priority&&w.protocol===k.protocol&&w.type===k.type});return M||x.addRemoteCandidate(w),!M}function u(x,w){var M=new Error(w);return M.name=x,M.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[x],M}i.exports=function(x,w){function M(m,v){v.addTrack(m),v.dispatchEvent(new x.MediaStreamTrackEvent("addtrack",{track:m}))}function k(m,v,l,C){var R=new Event("track");R.track=v,R.receiver=l,R.transceiver={receiver:l},R.streams=C,x.setTimeout(function(){m._dispatchEvent("track",R)})}var b=function(m){var v=this,l=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(R){v[R]=l[R].bind(l)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",m=JSON.parse(JSON.stringify(m||{})),this.usingBundle=m.bundlePolicy==="max-bundle",m.rtcpMuxPolicy==="negotiate")throw u("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(m.rtcpMuxPolicy||(m.rtcpMuxPolicy="require"),m.iceTransportPolicy){case"all":case"relay":break;default:m.iceTransportPolicy="all"}switch(m.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:m.bundlePolicy="balanced"}if(m.iceServers=f(m.iceServers||[],w),this._iceGatherers=[],m.iceCandidatePoolSize)for(var C=m.iceCandidatePoolSize;C>0;C--)this._iceGatherers.push(new x.RTCIceGatherer({iceServers:m.iceServers,gatherPolicy:m.iceTransportPolicy}));else m.iceCandidatePoolSize=0;this._config=m,this.transceivers=[],this._sdpSessionId=c.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(b.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(b.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),b.prototype.onicecandidate=null,b.prototype.onaddstream=null,b.prototype.ontrack=null,b.prototype.onremovestream=null,b.prototype.onsignalingstatechange=null,b.prototype.oniceconnectionstatechange=null,b.prototype.onconnectionstatechange=null,b.prototype.onicegatheringstatechange=null,b.prototype.onnegotiationneeded=null,b.prototype.ondatachannel=null,b.prototype._dispatchEvent=function(m,v){this._isClosed||(this.dispatchEvent(v),typeof this["on"+m]=="function"&&this["on"+m](v))},b.prototype._emitGatheringStateChange=function(){var m=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",m)},b.prototype.getConfiguration=function(){return this._config},b.prototype.getLocalStreams=function(){return this.localStreams},b.prototype.getRemoteStreams=function(){return this.remoteStreams},b.prototype._createTransceiver=function(m,v){var l=this.transceivers.length>0,C={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:m,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&l)C.iceTransport=this.transceivers[0].iceTransport,C.dtlsTransport=this.transceivers[0].dtlsTransport;else{var R=this._createIceAndDtlsTransports();C.iceTransport=R.iceTransport,C.dtlsTransport=R.dtlsTransport}return v||this.transceivers.push(C),C},b.prototype.addTrack=function(m,v){if(this._isClosed)throw u("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var l;if(this.transceivers.find(function(R){return R.track===m}))throw u("InvalidAccessError","Track already exists.");for(var C=0;C<this.transceivers.length;C++)this.transceivers[C].track||this.transceivers[C].kind!==m.kind||(l=this.transceivers[C]);return l||(l=this._createTransceiver(m.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(v)===-1&&this.localStreams.push(v),l.track=m,l.stream=v,l.rtpSender=new x.RTCRtpSender(m,l.dtlsTransport),l.rtpSender},b.prototype.addStream=function(m){var v=this;if(w>=15025)m.getTracks().forEach(function(C){v.addTrack(C,m)});else{var l=m.clone();m.getTracks().forEach(function(C,R){var j=l.getTracks()[R];C.addEventListener("enabled",function(L){j.enabled=L.enabled})}),l.getTracks().forEach(function(C){v.addTrack(C,l)})}},b.prototype.removeTrack=function(m){if(this._isClosed)throw u("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(m instanceof x.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var v=this.transceivers.find(function(C){return C.rtpSender===m});if(!v)throw u("InvalidAccessError","Sender was not created by this connection.");var l=v.stream;v.rtpSender.stop(),v.rtpSender=null,v.track=null,v.stream=null,this.transceivers.map(function(C){return C.stream}).indexOf(l)===-1&&this.localStreams.indexOf(l)>-1&&this.localStreams.splice(this.localStreams.indexOf(l),1),this._maybeFireNegotiationNeeded()},b.prototype.removeStream=function(m){var v=this;m.getTracks().forEach(function(l){var C=v.getSenders().find(function(R){return R.track===l});C&&v.removeTrack(C)})},b.prototype.getSenders=function(){return this.transceivers.filter(function(m){return!!m.rtpSender}).map(function(m){return m.rtpSender})},b.prototype.getReceivers=function(){return this.transceivers.filter(function(m){return!!m.rtpReceiver}).map(function(m){return m.rtpReceiver})},b.prototype._createIceGatherer=function(m,v){var l=this;if(v&&m>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var C=new x.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(C,"state",{value:"new",writable:!0}),this.transceivers[m].bufferedCandidateEvents=[],this.transceivers[m].bufferCandidates=function(R){var j=!R.candidate||Object.keys(R.candidate).length===0;C.state=j?"completed":"gathering",l.transceivers[m].bufferedCandidateEvents!==null&&l.transceivers[m].bufferedCandidateEvents.push(R)},C.addEventListener("localcandidate",this.transceivers[m].bufferCandidates),C},b.prototype._gather=function(m,v){var l=this,C=this.transceivers[v].iceGatherer;if(!C.onlocalcandidate){var R=this.transceivers[v].bufferedCandidateEvents;this.transceivers[v].bufferedCandidateEvents=null,C.removeEventListener("localcandidate",this.transceivers[v].bufferCandidates),C.onlocalcandidate=function(j){if(!(l.usingBundle&&v>0)){var L=new Event("icecandidate");L.candidate={sdpMid:m,sdpMLineIndex:v};var z=j.candidate,W=!z||Object.keys(z).length===0;if(W)C.state!=="new"&&C.state!=="gathering"||(C.state="completed");else{C.state==="new"&&(C.state="gathering"),z.component=1,z.ufrag=C.getLocalParameters().usernameFragment;var U=c.writeCandidate(z);L.candidate=Object.assign(L.candidate,c.parseCandidate(U)),L.candidate.candidate=U,L.candidate.toJSON=function(){return{candidate:L.candidate.candidate,sdpMid:L.candidate.sdpMid,sdpMLineIndex:L.candidate.sdpMLineIndex,usernameFragment:L.candidate.usernameFragment}}}var G=c.getMediaSections(l._localDescription.sdp);G[L.candidate.sdpMLineIndex]+=W?`a=end-of-candidates\r
`:"a="+L.candidate.candidate+`\r
`,l._localDescription.sdp=c.getDescription(l._localDescription.sdp)+G.join("");var et=l.transceivers.every(function(at){return at.iceGatherer&&at.iceGatherer.state==="completed"});l.iceGatheringState!=="gathering"&&(l.iceGatheringState="gathering",l._emitGatheringStateChange()),W||l._dispatchEvent("icecandidate",L),et&&(l._dispatchEvent("icecandidate",new Event("icecandidate")),l.iceGatheringState="complete",l._emitGatheringStateChange())}},x.setTimeout(function(){R.forEach(function(j){C.onlocalcandidate(j)})},0)}},b.prototype._createIceAndDtlsTransports=function(){var m=this,v=new x.RTCIceTransport(null);v.onicestatechange=function(){m._updateIceConnectionState(),m._updateConnectionState()};var l=new x.RTCDtlsTransport(v);return l.ondtlsstatechange=function(){m._updateConnectionState()},l.onerror=function(){Object.defineProperty(l,"state",{value:"failed",writable:!0}),m._updateConnectionState()},{iceTransport:v,dtlsTransport:l}},b.prototype._disposeIceAndDtlsTransports=function(m){var v=this.transceivers[m].iceGatherer;v&&(delete v.onlocalcandidate,delete this.transceivers[m].iceGatherer);var l=this.transceivers[m].iceTransport;l&&(delete l.onicestatechange,delete this.transceivers[m].iceTransport);var C=this.transceivers[m].dtlsTransport;C&&(delete C.ondtlsstatechange,delete C.onerror,delete this.transceivers[m].dtlsTransport)},b.prototype._transceive=function(m,v,l){var C=g(m.localCapabilities,m.remoteCapabilities);v&&m.rtpSender&&(C.encodings=m.sendEncodingParameters,C.rtcp={cname:c.localCName,compound:m.rtcpParameters.compound},m.recvEncodingParameters.length&&(C.rtcp.ssrc=m.recvEncodingParameters[0].ssrc),m.rtpSender.send(C)),l&&m.rtpReceiver&&C.codecs.length>0&&(m.kind==="video"&&m.recvEncodingParameters&&w<15019&&m.recvEncodingParameters.forEach(function(R){delete R.rtx}),m.recvEncodingParameters.length?C.encodings=m.recvEncodingParameters:C.encodings=[{}],C.rtcp={compound:m.rtcpParameters.compound},m.rtcpParameters.cname&&(C.rtcp.cname=m.rtcpParameters.cname),m.sendEncodingParameters.length&&(C.rtcp.ssrc=m.sendEncodingParameters[0].ssrc),m.rtpReceiver.receive(C))},b.prototype.setLocalDescription=function(m){var v,l,C=this;if(["offer","answer"].indexOf(m.type)===-1)return Promise.reject(u("TypeError",'Unsupported type "'+m.type+'"'));if(!y("setLocalDescription",m.type,C.signalingState)||C._isClosed)return Promise.reject(u("InvalidStateError","Can not set local "+m.type+" in state "+C.signalingState));if(m.type==="offer")v=c.splitSections(m.sdp),l=v.shift(),v.forEach(function(j,L){var z=c.parseRtpParameters(j);C.transceivers[L].localCapabilities=z}),C.transceivers.forEach(function(j,L){C._gather(j.mid,L)});else if(m.type==="answer"){v=c.splitSections(C._remoteDescription.sdp),l=v.shift();var R=c.matchPrefix(l,"a=ice-lite").length>0;v.forEach(function(j,L){var z=C.transceivers[L],W=z.iceGatherer,U=z.iceTransport,G=z.dtlsTransport,et=z.localCapabilities,at=z.remoteCapabilities;if(!(c.isRejected(j)&&c.matchPrefix(j,"a=bundle-only").length===0)&&!z.rejected){var lt=c.getIceParameters(j,l),$=c.getDtlsParameters(j,l);R&&($.role="server"),C.usingBundle&&L!==0||(C._gather(z.mid,L),U.state==="new"&&U.start(W,lt,R?"controlling":"controlled"),G.state==="new"&&G.start($));var ot=g(et,at);C._transceive(z,ot.codecs.length>0,!1)}})}return C._localDescription={type:m.type,sdp:m.sdp},m.type==="offer"?C._updateSignalingState("have-local-offer"):C._updateSignalingState("stable"),Promise.resolve()},b.prototype.setRemoteDescription=function(m){var v=this;if(["offer","answer"].indexOf(m.type)===-1)return Promise.reject(u("TypeError",'Unsupported type "'+m.type+'"'));if(!y("setRemoteDescription",m.type,v.signalingState)||v._isClosed)return Promise.reject(u("InvalidStateError","Can not set remote "+m.type+" in state "+v.signalingState));var l={};v.remoteStreams.forEach(function(U){l[U.id]=U});var C=[],R=c.splitSections(m.sdp),j=R.shift(),L=c.matchPrefix(j,"a=ice-lite").length>0,z=c.matchPrefix(j,"a=group:BUNDLE ").length>0;v.usingBundle=z;var W=c.matchPrefix(j,"a=ice-options:")[0];return v.canTrickleIceCandidates=!!W&&W.substr(14).split(" ").indexOf("trickle")>=0,R.forEach(function(U,G){var et=c.splitLines(U),at=c.getKind(U),lt=c.isRejected(U)&&c.matchPrefix(U,"a=bundle-only").length===0,$=et[0].substr(2).split(" ")[2],ot=c.getDirection(U,j),st=c.parseMsid(U),Rt=c.getMid(U)||c.generateIdentifier();if(lt||at==="application"&&($==="DTLS/SCTP"||$==="UDP/DTLS/SCTP"))v.transceivers[G]={mid:Rt,kind:at,protocol:$,rejected:!0};else{var ut,pt,Ft,Ht,ne,Zt,pe,de,fe;!lt&&v.transceivers[G]&&v.transceivers[G].rejected&&(v.transceivers[G]=v._createTransceiver(at,!0));var Pe,ln,wn=c.parseRtpParameters(U);lt||(Pe=c.getIceParameters(U,j),(ln=c.getDtlsParameters(U,j)).role="client"),pe=c.parseRtpEncodingParameters(U);var tn=c.parseRtcpParameters(U),ji=c.matchPrefix(U,"a=end-of-candidates",j).length>0,un=c.matchPrefix(U,"a=candidate:").map(function(me){return c.parseCandidate(me)}).filter(function(me){return me.component===1});if((m.type==="offer"||m.type==="answer")&&!lt&&z&&G>0&&v.transceivers[G]&&(v._disposeIceAndDtlsTransports(G),v.transceivers[G].iceGatherer=v.transceivers[0].iceGatherer,v.transceivers[G].iceTransport=v.transceivers[0].iceTransport,v.transceivers[G].dtlsTransport=v.transceivers[0].dtlsTransport,v.transceivers[G].rtpSender&&v.transceivers[G].rtpSender.setTransport(v.transceivers[0].dtlsTransport),v.transceivers[G].rtpReceiver&&v.transceivers[G].rtpReceiver.setTransport(v.transceivers[0].dtlsTransport)),m.type!=="offer"||lt)m.type==="answer"&&!lt&&(pt=(ut=v.transceivers[G]).iceGatherer,Ft=ut.iceTransport,Ht=ut.dtlsTransport,ne=ut.rtpReceiver,Zt=ut.sendEncodingParameters,de=ut.localCapabilities,v.transceivers[G].recvEncodingParameters=pe,v.transceivers[G].remoteCapabilities=wn,v.transceivers[G].rtcpParameters=tn,un.length&&Ft.state==="new"&&(!L&&!ji||z&&G!==0?un.forEach(function(me){S(ut.iceTransport,me)}):Ft.setRemoteCandidates(un)),z&&G!==0||(Ft.state==="new"&&Ft.start(pt,Pe,"controlling"),Ht.state==="new"&&Ht.start(ln)),!g(ut.localCapabilities,ut.remoteCapabilities).codecs.filter(function(me){return me.name.toLowerCase()==="rtx"}).length&&ut.sendEncodingParameters[0].rtx&&delete ut.sendEncodingParameters[0].rtx,v._transceive(ut,ot==="sendrecv"||ot==="recvonly",ot==="sendrecv"||ot==="sendonly"),!ne||ot!=="sendrecv"&&ot!=="sendonly"?delete ut.rtpReceiver:(fe=ne.track,st?(l[st.stream]||(l[st.stream]=new x.MediaStream),M(fe,l[st.stream]),C.push([fe,ne,l[st.stream]])):(l.default||(l.default=new x.MediaStream),M(fe,l.default),C.push([fe,ne,l.default]))));else{(ut=v.transceivers[G]||v._createTransceiver(at)).mid=Rt,ut.iceGatherer||(ut.iceGatherer=v._createIceGatherer(G,z)),un.length&&ut.iceTransport.state==="new"&&(!ji||z&&G!==0?un.forEach(function(me){S(ut.iceTransport,me)}):ut.iceTransport.setRemoteCandidates(un)),de=x.RTCRtpReceiver.getCapabilities(at),w<15019&&(de.codecs=de.codecs.filter(function(me){return me.name!=="rtx"})),Zt=ut.sendEncodingParameters||[{ssrc:1001*(2*G+2)}];var Ie,Tn=!1;ot==="sendrecv"||ot==="sendonly"?(Tn=!ut.rtpReceiver,ne=ut.rtpReceiver||new x.RTCRtpReceiver(ut.dtlsTransport,at),Tn&&(fe=ne.track,st&&st.stream==="-"||(st?(l[st.stream]||(l[st.stream]=new x.MediaStream,Object.defineProperty(l[st.stream],"id",{get:function(){return st.stream}})),Object.defineProperty(fe,"id",{get:function(){return st.track}}),Ie=l[st.stream]):(l.default||(l.default=new x.MediaStream),Ie=l.default)),Ie&&(M(fe,Ie),ut.associatedRemoteMediaStreams.push(Ie)),C.push([fe,ne,Ie]))):ut.rtpReceiver&&ut.rtpReceiver.track&&(ut.associatedRemoteMediaStreams.forEach(function(me){var $n,Fi,qn=me.getTracks().find(function(Nt){return Nt.id===ut.rtpReceiver.track.id});qn&&($n=qn,(Fi=me).removeTrack($n),Fi.dispatchEvent(new x.MediaStreamTrackEvent("removetrack",{track:$n})))}),ut.associatedRemoteMediaStreams=[]),ut.localCapabilities=de,ut.remoteCapabilities=wn,ut.rtpReceiver=ne,ut.rtcpParameters=tn,ut.sendEncodingParameters=Zt,ut.recvEncodingParameters=pe,v._transceive(v.transceivers[G],!1,Tn)}}}),v._dtlsRole===void 0&&(v._dtlsRole=m.type==="offer"?"active":"passive"),v._remoteDescription={type:m.type,sdp:m.sdp},m.type==="offer"?v._updateSignalingState("have-remote-offer"):v._updateSignalingState("stable"),Object.keys(l).forEach(function(U){var G=l[U];if(G.getTracks().length){if(v.remoteStreams.indexOf(G)===-1){v.remoteStreams.push(G);var et=new Event("addstream");et.stream=G,x.setTimeout(function(){v._dispatchEvent("addstream",et)})}C.forEach(function(at){var lt=at[0],$=at[1];G.id===at[2].id&&k(v,lt,$,[G])})}}),C.forEach(function(U){U[2]||k(v,U[0],U[1],[])}),x.setTimeout(function(){v&&v.transceivers&&v.transceivers.forEach(function(U){U.iceTransport&&U.iceTransport.state==="new"&&U.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),U.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},b.prototype.close=function(){this.transceivers.forEach(function(m){m.iceTransport&&m.iceTransport.stop(),m.dtlsTransport&&m.dtlsTransport.stop(),m.rtpSender&&m.rtpSender.stop(),m.rtpReceiver&&m.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},b.prototype._updateSignalingState=function(m){this.signalingState=m;var v=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",v)},b.prototype._maybeFireNegotiationNeeded=function(){var m=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,x.setTimeout(function(){if(m.needNegotiation){m.needNegotiation=!1;var v=new Event("negotiationneeded");m._dispatchEvent("negotiationneeded",v)}},0))},b.prototype._updateIceConnectionState=function(){var m,v={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(C){C.iceTransport&&!C.rejected&&v[C.iceTransport.state]++}),m="new",v.failed>0?m="failed":v.checking>0?m="checking":v.disconnected>0?m="disconnected":v.new>0?m="new":v.connected>0?m="connected":v.completed>0&&(m="completed"),m!==this.iceConnectionState){this.iceConnectionState=m;var l=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",l)}},b.prototype._updateConnectionState=function(){var m,v={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(C){C.iceTransport&&C.dtlsTransport&&!C.rejected&&(v[C.iceTransport.state]++,v[C.dtlsTransport.state]++)}),v.connected+=v.completed,m="new",v.failed>0?m="failed":v.connecting>0?m="connecting":v.disconnected>0?m="disconnected":v.new>0?m="new":v.connected>0&&(m="connected"),m!==this.connectionState){this.connectionState=m;var l=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",l)}},b.prototype.createOffer=function(){var m=this;if(m._isClosed)return Promise.reject(u("InvalidStateError","Can not call createOffer after close"));var v=m.transceivers.filter(function(L){return L.kind==="audio"}).length,l=m.transceivers.filter(function(L){return L.kind==="video"}).length,C=arguments[0];if(C){if(C.mandatory||C.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");C.offerToReceiveAudio!==void 0&&(v=C.offerToReceiveAudio===!0?1:C.offerToReceiveAudio===!1?0:C.offerToReceiveAudio),C.offerToReceiveVideo!==void 0&&(l=C.offerToReceiveVideo===!0?1:C.offerToReceiveVideo===!1?0:C.offerToReceiveVideo)}for(m.transceivers.forEach(function(L){L.kind==="audio"?--v<0&&(L.wantReceive=!1):L.kind==="video"&&--l<0&&(L.wantReceive=!1)});v>0||l>0;)v>0&&(m._createTransceiver("audio"),v--),l>0&&(m._createTransceiver("video"),l--);var R=c.writeSessionBoilerplate(m._sdpSessionId,m._sdpSessionVersion++);m.transceivers.forEach(function(L,z){var W=L.track,U=L.kind,G=L.mid||c.generateIdentifier();L.mid=G,L.iceGatherer||(L.iceGatherer=m._createIceGatherer(z,m.usingBundle));var et=x.RTCRtpSender.getCapabilities(U);w<15019&&(et.codecs=et.codecs.filter(function(lt){return lt.name!=="rtx"})),et.codecs.forEach(function(lt){lt.name==="H264"&&lt.parameters["level-asymmetry-allowed"]===void 0&&(lt.parameters["level-asymmetry-allowed"]="1"),L.remoteCapabilities&&L.remoteCapabilities.codecs&&L.remoteCapabilities.codecs.forEach(function($){lt.name.toLowerCase()===$.name.toLowerCase()&&lt.clockRate===$.clockRate&&(lt.preferredPayloadType=$.payloadType)})}),et.headerExtensions.forEach(function(lt){(L.remoteCapabilities&&L.remoteCapabilities.headerExtensions||[]).forEach(function($){lt.uri===$.uri&&(lt.id=$.id)})});var at=L.sendEncodingParameters||[{ssrc:1001*(2*z+1)}];W&&w>=15019&&U==="video"&&!at[0].rtx&&(at[0].rtx={ssrc:at[0].ssrc+1}),L.wantReceive&&(L.rtpReceiver=new x.RTCRtpReceiver(L.dtlsTransport,U)),L.localCapabilities=et,L.sendEncodingParameters=at}),m._config.bundlePolicy!=="max-compat"&&(R+="a=group:BUNDLE "+m.transceivers.map(function(L){return L.mid}).join(" ")+`\r
`),R+=`a=ice-options:trickle\r
`,m.transceivers.forEach(function(L,z){R+=p(L,L.localCapabilities,"offer",L.stream,m._dtlsRole),R+=`a=rtcp-rsize\r
`,!L.iceGatherer||m.iceGatheringState==="new"||z!==0&&m.usingBundle||(L.iceGatherer.getLocalCandidates().forEach(function(W){W.component=1,R+="a="+c.writeCandidate(W)+`\r
`}),L.iceGatherer.state==="completed"&&(R+=`a=end-of-candidates\r
`))});var j=new x.RTCSessionDescription({type:"offer",sdp:R});return Promise.resolve(j)},b.prototype.createAnswer=function(){var m=this;if(m._isClosed)return Promise.reject(u("InvalidStateError","Can not call createAnswer after close"));if(m.signalingState!=="have-remote-offer"&&m.signalingState!=="have-local-pranswer")return Promise.reject(u("InvalidStateError","Can not call createAnswer in signalingState "+m.signalingState));var v=c.writeSessionBoilerplate(m._sdpSessionId,m._sdpSessionVersion++);m.usingBundle&&(v+="a=group:BUNDLE "+m.transceivers.map(function(R){return R.mid}).join(" ")+`\r
`),v+=`a=ice-options:trickle\r
`;var l=c.getMediaSections(m._remoteDescription.sdp).length;m.transceivers.forEach(function(R,j){if(!(j+1>l)){if(R.rejected)return R.kind==="application"?R.protocol==="DTLS/SCTP"?v+=`m=application 0 DTLS/SCTP 5000\r
`:v+="m=application 0 "+R.protocol+` webrtc-datachannel\r
`:R.kind==="audio"?v+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:R.kind==="video"&&(v+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(v+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+R.mid+`\r
`);var L;R.stream&&(R.kind==="audio"?L=R.stream.getAudioTracks()[0]:R.kind==="video"&&(L=R.stream.getVideoTracks()[0]),L&&w>=15019&&R.kind==="video"&&!R.sendEncodingParameters[0].rtx&&(R.sendEncodingParameters[0].rtx={ssrc:R.sendEncodingParameters[0].ssrc+1}));var z=g(R.localCapabilities,R.remoteCapabilities);!z.codecs.filter(function(W){return W.name.toLowerCase()==="rtx"}).length&&R.sendEncodingParameters[0].rtx&&delete R.sendEncodingParameters[0].rtx,v+=p(R,z,"answer",R.stream,m._dtlsRole),R.rtcpParameters&&R.rtcpParameters.reducedSize&&(v+=`a=rtcp-rsize\r
`)}});var C=new x.RTCSessionDescription({type:"answer",sdp:v});return Promise.resolve(C)},b.prototype.addIceCandidate=function(m){var v,l=this;return m&&m.sdpMLineIndex===void 0&&!m.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(C,R){if(!l._remoteDescription)return R(u("InvalidStateError","Can not add ICE candidate without a remote description"));if(m&&m.candidate!==""){var j=m.sdpMLineIndex;if(m.sdpMid){for(var L=0;L<l.transceivers.length;L++)if(l.transceivers[L].mid===m.sdpMid){j=L;break}}var z=l.transceivers[j];if(!z)return R(u("OperationError","Can not add ICE candidate"));if(z.rejected)return C();var W=Object.keys(m.candidate).length>0?c.parseCandidate(m.candidate):{};if(W.protocol==="tcp"&&(W.port===0||W.port===9)||W.component&&W.component!==1)return C();if((j===0||j>0&&z.iceTransport!==l.transceivers[0].iceTransport)&&!S(z.iceTransport,W))return R(u("OperationError","Can not add ICE candidate"));var U=m.candidate.trim();U.indexOf("a=")===0&&(U=U.substr(2)),(v=c.getMediaSections(l._remoteDescription.sdp))[j]+="a="+(W.type?U:"end-of-candidates")+`\r
`,l._remoteDescription.sdp=c.getDescription(l._remoteDescription.sdp)+v.join("")}else for(var G=0;G<l.transceivers.length&&(l.transceivers[G].rejected||(l.transceivers[G].iceTransport.addRemoteCandidate({}),(v=c.getMediaSections(l._remoteDescription.sdp))[G]+=`a=end-of-candidates\r
`,l._remoteDescription.sdp=c.getDescription(l._remoteDescription.sdp)+v.join(""),!l.usingBundle));G++);C()})},b.prototype.getStats=function(m){if(m&&m instanceof x.MediaStreamTrack){var v=null;if(this.transceivers.forEach(function(C){C.rtpSender&&C.rtpSender.track===m?v=C.rtpSender:C.rtpReceiver&&C.rtpReceiver.track===m&&(v=C.rtpReceiver)}),!v)throw u("InvalidAccessError","Invalid selector.");return v.getStats()}var l=[];return this.transceivers.forEach(function(C){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(R){C[R]&&l.push(C[R].getStats())})}),Promise.all(l).then(function(C){var R=new Map;return C.forEach(function(j){j.forEach(function(L){R.set(L.id,L)})}),R})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(m){var v=x[m];if(v&&v.prototype&&v.prototype.getStats){var l=v.prototype.getStats;v.prototype.getStats=function(){return l.apply(this).then(function(C){var R=new Map;return Object.keys(C).forEach(function(j){C[j].type=h(C[j]),R.set(j,C[j])}),R})}}});var T=["createOffer","createAnswer"];return T.forEach(function(m){var v=b.prototype[m];b.prototype[m]=function(){var l=arguments;return typeof l[0]=="function"||typeof l[1]=="function"?v.apply(this,[arguments[2]]).then(function(C){typeof l[0]=="function"&&l[0].apply(null,[C])},function(C){typeof l[1]=="function"&&l[1].apply(null,[C])}):v.apply(this,arguments)}}),(T=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(m){var v=b.prototype[m];b.prototype[m]=function(){var l=arguments;return typeof l[1]=="function"||typeof l[2]=="function"?v.apply(this,arguments).then(function(){typeof l[1]=="function"&&l[1].apply(null)},function(C){typeof l[2]=="function"&&l[2].apply(null,[C])}):v.apply(this,arguments)}}),["getStats"].forEach(function(m){var v=b.prototype[m];b.prototype[m]=function(){var l=arguments;return typeof l[1]=="function"?v.apply(this,arguments).then(function(){typeof l[1]=="function"&&l[1].apply(null)}):v.apply(this,arguments)}}),b}},{sdp:"YHvh"}],YdKx:[function(e,i,r){"use strict";function c(h){var p=h&&h.navigator,f=p.mediaDevices.getUserMedia.bind(p.mediaDevices);p.mediaDevices.getUserMedia=function(g){return f(g).catch(function(y){return Promise.reject(function(S){return{name:{PermissionDeniedError:"NotAllowedError"}[S.name]||S.name,message:S.message,constraint:S.constraint,toString:function(){return this.name}}}(y))})}}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=c},{}],P3bV:[function(e,i,r){"use strict";function c(h){"getDisplayMedia"in h.navigator&&h.navigator.mediaDevices&&(h.navigator.mediaDevices&&"getDisplayMedia"in h.navigator.mediaDevices||(h.navigator.mediaDevices.getDisplayMedia=h.navigator.getDisplayMedia.bind(h.navigator)))}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=c},{}],XRic:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimPeerConnection=x,r.shimReplaceTrack=w,Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return f.shimGetUserMedia}}),Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return g.shimGetDisplayMedia}});var c=u(e("../utils")),h=e("./filtericeservers"),p=y(e("rtcpeerconnection-shim")),f=e("./getusermedia"),g=e("./getdisplaymedia");function y(M){return M&&M.__esModule?M:{default:M}}function S(){if(typeof WeakMap!="function")return null;var M=new WeakMap;return S=function(){return M},M}function u(M){if(M&&M.__esModule)return M;if(M===null||typeof M!="object"&&typeof M!="function")return{default:M};var k=S();if(k&&k.has(M))return k.get(M);var b={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in M)if(Object.prototype.hasOwnProperty.call(M,m)){var v=T?Object.getOwnPropertyDescriptor(M,m):null;v&&(v.get||v.set)?Object.defineProperty(b,m,v):b[m]=M[m]}return b.default=M,k&&k.set(M,b),b}function x(M){var k=c.detectBrowser(M);if(M.RTCIceGatherer&&(M.RTCIceCandidate||(M.RTCIceCandidate=function(m){return m}),M.RTCSessionDescription||(M.RTCSessionDescription=function(m){return m}),k.version<15025)){var b=Object.getOwnPropertyDescriptor(M.MediaStreamTrack.prototype,"enabled");Object.defineProperty(M.MediaStreamTrack.prototype,"enabled",{set:function(m){b.set.call(this,m);var v=new Event("enabled");v.enabled=m,this.dispatchEvent(v)}})}!M.RTCRtpSender||"dtmf"in M.RTCRtpSender.prototype||Object.defineProperty(M.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new M.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),M.RTCDtmfSender&&!M.RTCDTMFSender&&(M.RTCDTMFSender=M.RTCDtmfSender);var T=(0,p.default)(M,k.version);M.RTCPeerConnection=function(m){return m&&m.iceServers&&(m.iceServers=(0,h.filterIceServers)(m.iceServers,k.version),c.log("ICE servers after filtering:",m.iceServers)),new T(m)},M.RTCPeerConnection.prototype=T.prototype}function w(M){!M.RTCRtpSender||"replaceTrack"in M.RTCRtpSender.prototype||(M.RTCRtpSender.prototype.replaceTrack=M.RTCRtpSender.prototype.setTrack)}},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=g;var c=p(e("../utils"));function h(){if(typeof WeakMap!="function")return null;var y=new WeakMap;return h=function(){return y},y}function p(y){if(y&&y.__esModule)return y;if(y===null||typeof y!="object"&&typeof y!="function")return{default:y};var S=h();if(S&&S.has(y))return S.get(y);var u={},x=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in y)if(Object.prototype.hasOwnProperty.call(y,w)){var M=x?Object.getOwnPropertyDescriptor(y,w):null;M&&(M.get||M.set)?Object.defineProperty(u,w,M):u[w]=y[w]}return u.default=y,S&&S.set(y,u),u}function f(y){return(f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(y)}function g(y){var S=c.detectBrowser(y),u=y&&y.navigator,x=y&&y.MediaStreamTrack;if(u.getUserMedia=function(T,m,v){c.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),u.mediaDevices.getUserMedia(T).then(m,v)},!(S.version>55&&"autoGainControl"in u.mediaDevices.getSupportedConstraints())){var w=function(T,m,v){m in T&&!(v in T)&&(T[v]=T[m],delete T[m])},M=u.mediaDevices.getUserMedia.bind(u.mediaDevices);if(u.mediaDevices.getUserMedia=function(T){return f(T)==="object"&&f(T.audio)==="object"&&(T=JSON.parse(JSON.stringify(T)),w(T.audio,"autoGainControl","mozAutoGainControl"),w(T.audio,"noiseSuppression","mozNoiseSuppression")),M(T)},x&&x.prototype.getSettings){var k=x.prototype.getSettings;x.prototype.getSettings=function(){var T=k.apply(this,arguments);return w(T,"mozAutoGainControl","autoGainControl"),w(T,"mozNoiseSuppression","noiseSuppression"),T}}if(x&&x.prototype.applyConstraints){var b=x.prototype.applyConstraints;x.prototype.applyConstraints=function(T){return this.kind==="audio"&&f(T)==="object"&&(T=JSON.parse(JSON.stringify(T)),w(T,"autoGainControl","mozAutoGainControl"),w(T,"noiseSuppression","mozNoiseSuppression")),b.apply(this,[T])}}}}},{"../utils":"iSxC"}],UuGU:[function(e,i,r){"use strict";function c(h,p){h.navigator.mediaDevices&&"getDisplayMedia"in h.navigator.mediaDevices||h.navigator.mediaDevices&&(h.navigator.mediaDevices.getDisplayMedia=function(f){if(!f||!f.video){var g=new DOMException("getDisplayMedia without video constraints is undefined");return g.name="NotFoundError",g.code=8,Promise.reject(g)}return f.video===!0?f.video={mediaSource:p}:f.video.mediaSource=p,h.navigator.mediaDevices.getUserMedia(f)})}Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=c},{}],Fzdr:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimOnTrack=u,r.shimPeerConnection=x,r.shimSenderGetStats=w,r.shimReceiverGetStats=M,r.shimRemoveStream=k,r.shimRTCDataChannel=b,r.shimAddTransceiver=T,r.shimCreateOffer=m,r.shimCreateAnswer=v,Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return h.shimGetUserMedia}}),Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return p.shimGetDisplayMedia}});var c=g(e("../utils")),h=e("./getusermedia"),p=e("./getdisplaymedia");function f(){if(typeof WeakMap!="function")return null;var l=new WeakMap;return f=function(){return l},l}function g(l){if(l&&l.__esModule)return l;if(l===null||typeof l!="object"&&typeof l!="function")return{default:l};var C=f();if(C&&C.has(l))return C.get(l);var R={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in l)if(Object.prototype.hasOwnProperty.call(l,L)){var z=j?Object.getOwnPropertyDescriptor(l,L):null;z&&(z.get||z.set)?Object.defineProperty(R,L,z):R[L]=l[L]}return R.default=l,C&&C.set(l,R),R}function y(l,C,R){return C in l?Object.defineProperty(l,C,{value:R,enumerable:!0,configurable:!0,writable:!0}):l[C]=R,l}function S(l){return(S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C})(l)}function u(l){S(l)==="object"&&l.RTCTrackEvent&&"receiver"in l.RTCTrackEvent.prototype&&!("transceiver"in l.RTCTrackEvent.prototype)&&Object.defineProperty(l.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function x(l){var C=c.detectBrowser(l);if(S(l)==="object"&&(l.RTCPeerConnection||l.mozRTCPeerConnection)){if(!l.RTCPeerConnection&&l.mozRTCPeerConnection&&(l.RTCPeerConnection=l.mozRTCPeerConnection),C.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(z){var W=l.RTCPeerConnection.prototype[z],U=y({},z,function(){return arguments[0]=new(z==="addIceCandidate"?l.RTCIceCandidate:l.RTCSessionDescription)(arguments[0]),W.apply(this,arguments)});l.RTCPeerConnection.prototype[z]=U[z]}),C.version<68){var R=l.RTCPeerConnection.prototype.addIceCandidate;l.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&arguments[0].candidate===""?Promise.resolve():R.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var j={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},L=l.RTCPeerConnection.prototype.getStats;l.RTCPeerConnection.prototype.getStats=function(){var[z,W,U]=arguments;return L.apply(this,[z||null]).then(function(G){if(C.version<53&&!W)try{G.forEach(function(et){et.type=j[et.type]||et.type})}catch(et){if(et.name!=="TypeError")throw et;G.forEach(function(at,lt){G.set(lt,Object.assign({},at,{type:j[at.type]||at.type}))})}return G}).then(W,U)}}}function w(l){if(S(l)==="object"&&l.RTCPeerConnection&&l.RTCRtpSender&&!(l.RTCRtpSender&&"getStats"in l.RTCRtpSender.prototype)){var C=l.RTCPeerConnection.prototype.getSenders;C&&(l.RTCPeerConnection.prototype.getSenders=function(){var j=this,L=C.apply(this,[]);return L.forEach(function(z){return z._pc=j}),L});var R=l.RTCPeerConnection.prototype.addTrack;R&&(l.RTCPeerConnection.prototype.addTrack=function(){var j=R.apply(this,arguments);return j._pc=this,j}),l.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function M(l){if(S(l)==="object"&&l.RTCPeerConnection&&l.RTCRtpSender&&!(l.RTCRtpSender&&"getStats"in l.RTCRtpReceiver.prototype)){var C=l.RTCPeerConnection.prototype.getReceivers;C&&(l.RTCPeerConnection.prototype.getReceivers=function(){var R=this,j=C.apply(this,[]);return j.forEach(function(L){return L._pc=R}),j}),c.wrapPeerConnectionEvent(l,"track",function(R){return R.receiver._pc=R.srcElement,R}),l.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function k(l){!l.RTCPeerConnection||"removeStream"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.removeStream=function(C){var R=this;c.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(j){j.track&&C.getTracks().includes(j.track)&&R.removeTrack(j)})})}function b(l){l.DataChannel&&!l.RTCDataChannel&&(l.RTCDataChannel=l.DataChannel)}function T(l){if(S(l)==="object"&&l.RTCPeerConnection){var C=l.RTCPeerConnection.prototype.addTransceiver;C&&(l.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var R=arguments[1],j=R&&"sendEncodings"in R;j&&R.sendEncodings.forEach(function(U){if("rid"in U&&!/^[a-z0-9]{0,16}$/i.test(U.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in U&&!(parseFloat(U.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in U&&!(parseFloat(U.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var L=C.apply(this,arguments);if(j){var{sender:z}=L,W=z.getParameters();"encodings"in W||(W.encodings=R.sendEncodings,this.setParametersPromises.push(z.setParameters(W).catch(function(){})))}return L})}}function m(l){if(S(l)==="object"&&l.RTCPeerConnection){var C=l.RTCPeerConnection.prototype.createOffer;l.RTCPeerConnection.prototype.createOffer=function(){var R=arguments,j=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return C.apply(j,R)}).finally(function(){j.setParametersPromises=[]}):C.apply(this,arguments)}}}function v(l){if(S(l)==="object"&&l.RTCPeerConnection){var C=l.RTCPeerConnection.prototype.createAnswer;l.RTCPeerConnection.prototype.createAnswer=function(){var R=arguments,j=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return C.apply(j,R)}).finally(function(){j.setParametersPromises=[]}):C.apply(this,arguments)}}}},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimLocalStreamsAPI=g,r.shimRemoteStreamsAPI=y,r.shimCallbacksAPI=S,r.shimGetUserMedia=u,r.shimConstraints=x,r.shimRTCIceServerUrls=w,r.shimTrackEventTransceiver=M,r.shimCreateOfferLegacy=k;var c=p(e("../utils"));function h(){if(typeof WeakMap!="function")return null;var b=new WeakMap;return h=function(){return b},b}function p(b){if(b&&b.__esModule)return b;if(b===null||typeof b!="object"&&typeof b!="function")return{default:b};var T=h();if(T&&T.has(b))return T.get(b);var m={},v=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in b)if(Object.prototype.hasOwnProperty.call(b,l)){var C=v?Object.getOwnPropertyDescriptor(b,l):null;C&&(C.get||C.set)?Object.defineProperty(m,l,C):m[l]=b[l]}return m.default=b,T&&T.set(b,m),m}function f(b){return(f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T})(b)}function g(b){if(f(b)==="object"&&b.RTCPeerConnection){if("getLocalStreams"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in b.RTCPeerConnection.prototype)){var T=b.RTCPeerConnection.prototype.addTrack;b.RTCPeerConnection.prototype.addStream=function(m){var v=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(m)||this._localStreams.push(m),m.getAudioTracks().forEach(function(l){return T.call(v,l,m)}),m.getVideoTracks().forEach(function(l){return T.call(v,l,m)})},b.RTCPeerConnection.prototype.addTrack=function(m){var v=arguments[1];return v&&(this._localStreams?this._localStreams.includes(v)||this._localStreams.push(v):this._localStreams=[v]),T.apply(this,arguments)}}"removeStream"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.removeStream=function(m){var v=this;this._localStreams||(this._localStreams=[]);var l=this._localStreams.indexOf(m);if(l!==-1){this._localStreams.splice(l,1);var C=m.getTracks();this.getSenders().forEach(function(R){C.includes(R.track)&&v.removeTrack(R)})}})}}function y(b){if(f(b)==="object"&&b.RTCPeerConnection&&("getRemoteStreams"in b.RTCPeerConnection.prototype||(b.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in b.RTCPeerConnection.prototype))){Object.defineProperty(b.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(m){var v=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=m),this.addEventListener("track",this._onaddstreampoly=function(l){l.streams.forEach(function(C){if(v._remoteStreams||(v._remoteStreams=[]),!v._remoteStreams.includes(C)){v._remoteStreams.push(C);var R=new Event("addstream");R.stream=C,v.dispatchEvent(R)}})})}});var T=b.RTCPeerConnection.prototype.setRemoteDescription;b.RTCPeerConnection.prototype.setRemoteDescription=function(){var m=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(v){v.streams.forEach(function(l){if(m._remoteStreams||(m._remoteStreams=[]),!(m._remoteStreams.indexOf(l)>=0)){m._remoteStreams.push(l);var C=new Event("addstream");C.stream=l,m.dispatchEvent(C)}})}),T.apply(m,arguments)}}}function S(b){if(f(b)==="object"&&b.RTCPeerConnection){var T=b.RTCPeerConnection.prototype,m=T.createOffer,v=T.createAnswer,l=T.setLocalDescription,C=T.setRemoteDescription,R=T.addIceCandidate;T.createOffer=function(L,z){var W=arguments.length>=2?arguments[2]:arguments[0],U=m.apply(this,[W]);return z?(U.then(L,z),Promise.resolve()):U},T.createAnswer=function(L,z){var W=arguments.length>=2?arguments[2]:arguments[0],U=v.apply(this,[W]);return z?(U.then(L,z),Promise.resolve()):U};var j=function(L,z,W){var U=l.apply(this,[L]);return W?(U.then(z,W),Promise.resolve()):U};T.setLocalDescription=j,j=function(L,z,W){var U=C.apply(this,[L]);return W?(U.then(z,W),Promise.resolve()):U},T.setRemoteDescription=j,j=function(L,z,W){var U=R.apply(this,[L]);return W?(U.then(z,W),Promise.resolve()):U},T.addIceCandidate=j}}function u(b){var T=b&&b.navigator;if(T.mediaDevices&&T.mediaDevices.getUserMedia){var m=T.mediaDevices,v=m.getUserMedia.bind(m);T.mediaDevices.getUserMedia=function(l){return v(x(l))}}!T.getUserMedia&&T.mediaDevices&&T.mediaDevices.getUserMedia&&(T.getUserMedia=function(l,C,R){T.mediaDevices.getUserMedia(l).then(C,R)}.bind(T))}function x(b){return b&&b.video!==void 0?Object.assign({},b,{video:c.compactObject(b.video)}):b}function w(b){var T=b.RTCPeerConnection;b.RTCPeerConnection=function(m,v){if(m&&m.iceServers){for(var l=[],C=0;C<m.iceServers.length;C++){var R=m.iceServers[C];!R.hasOwnProperty("urls")&&R.hasOwnProperty("url")?(c.deprecated("RTCIceServer.url","RTCIceServer.urls"),(R=JSON.parse(JSON.stringify(R))).urls=R.url,delete R.url,l.push(R)):l.push(m.iceServers[C])}m.iceServers=l}return new T(m,v)},b.RTCPeerConnection.prototype=T.prototype,"generateCertificate"in b.RTCPeerConnection&&Object.defineProperty(b.RTCPeerConnection,"generateCertificate",{get:function(){return T.generateCertificate}})}function M(b){f(b)==="object"&&b.RTCTrackEvent&&"receiver"in b.RTCTrackEvent.prototype&&!("transceiver"in b.RTCTrackEvent.prototype)&&Object.defineProperty(b.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function k(b){var T=b.RTCPeerConnection.prototype.createOffer;b.RTCPeerConnection.prototype.createOffer=function(m){if(m){m.offerToReceiveAudio!==void 0&&(m.offerToReceiveAudio=!!m.offerToReceiveAudio);var v=this.getTransceivers().find(function(C){return C.receiver.track.kind==="audio"});m.offerToReceiveAudio===!1&&v?v.direction==="sendrecv"?v.setDirection?v.setDirection("sendonly"):v.direction="sendonly":v.direction==="recvonly"&&(v.setDirection?v.setDirection("inactive"):v.direction="inactive"):m.offerToReceiveAudio!==!0||v||this.addTransceiver("audio"),m.offerToReceiveVideo!==void 0&&(m.offerToReceiveVideo=!!m.offerToReceiveVideo);var l=this.getTransceivers().find(function(C){return C.receiver.track.kind==="video"});m.offerToReceiveVideo===!1&&l?l.direction==="sendrecv"?l.setDirection?l.setDirection("sendonly"):l.direction="sendonly":l.direction==="recvonly"&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive"):m.offerToReceiveVideo!==!0||l||this.addTransceiver("video")}return T.apply(this,arguments)}}},{"../utils":"iSxC"}],GOQK:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimRTCIceCandidate=S,r.shimMaxMessageSize=u,r.shimSendThrowTypeError=x,r.shimConnectionState=w,r.removeAllowExtmapMixed=M;var c=g(e("sdp")),h=f(e("./utils"));function p(){if(typeof WeakMap!="function")return null;var k=new WeakMap;return p=function(){return k},k}function f(k){if(k&&k.__esModule)return k;if(k===null||typeof k!="object"&&typeof k!="function")return{default:k};var b=p();if(b&&b.has(k))return b.get(k);var T={},m=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in k)if(Object.prototype.hasOwnProperty.call(k,v)){var l=m?Object.getOwnPropertyDescriptor(k,v):null;l&&(l.get||l.set)?Object.defineProperty(T,v,l):T[v]=k[v]}return T.default=k,b&&b.set(k,T),T}function g(k){return k&&k.__esModule?k:{default:k}}function y(k){return(y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(b){return typeof b}:function(b){return b&&typeof Symbol=="function"&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b})(k)}function S(k){if(k.RTCIceCandidate&&!(k.RTCIceCandidate&&"foundation"in k.RTCIceCandidate.prototype)){var b=k.RTCIceCandidate;k.RTCIceCandidate=function(T){if(y(T)==="object"&&T.candidate&&T.candidate.indexOf("a=")===0&&((T=JSON.parse(JSON.stringify(T))).candidate=T.candidate.substr(2)),T.candidate&&T.candidate.length){var m=new b(T),v=c.default.parseCandidate(T.candidate),l=Object.assign(m,v);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new b(T)},k.RTCIceCandidate.prototype=b.prototype,h.wrapPeerConnectionEvent(k,"icecandidate",function(T){return T.candidate&&Object.defineProperty(T,"candidate",{value:new k.RTCIceCandidate(T.candidate),writable:"false"}),T})}}function u(k){if(k.RTCPeerConnection){var b=h.detectBrowser(k);"sctp"in k.RTCPeerConnection.prototype||Object.defineProperty(k.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var T=k.RTCPeerConnection.prototype.setRemoteDescription;k.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,b.browser==="chrome"&&b.version>=76){var{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(W){if(!W||!W.sdp)return!1;var U=c.default.splitSections(W.sdp);return U.shift(),U.some(function(G){var et=c.default.parseMLine(G);return et&&et.kind==="application"&&et.protocol.indexOf("SCTP")!==-1})}(arguments[0])){var v,l=function(W){var U=W.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(U===null||U.length<2)return-1;var G=parseInt(U[1],10);return G!=G?-1:G}(arguments[0]),C=(L=l,z=65536,b.browser==="firefox"&&(z=b.version<57?L===-1?16384:2147483637:b.version<60?b.version===57?65535:65536:2147483637),z),R=function(W,U){var G=65536;b.browser==="firefox"&&b.version===57&&(G=65535);var et=c.default.matchPrefix(W.sdp,"a=max-message-size:");return et.length>0?G=parseInt(et[0].substr(19),10):b.browser==="firefox"&&U!==-1&&(G=2147483637),G}(arguments[0],l);v=C===0&&R===0?Number.POSITIVE_INFINITY:C===0||R===0?Math.max(C,R):Math.min(C,R);var j={};Object.defineProperty(j,"maxMessageSize",{get:function(){return v}}),this._sctp=j}var L,z;return T.apply(this,arguments)}}}function x(k){if(k.RTCPeerConnection&&"createDataChannel"in k.RTCPeerConnection.prototype){var b=k.RTCPeerConnection.prototype.createDataChannel;k.RTCPeerConnection.prototype.createDataChannel=function(){var m=b.apply(this,arguments);return T(m,this),m},h.wrapPeerConnectionEvent(k,"datachannel",function(m){return T(m.channel,m.target),m})}function T(m,v){var l=m.send;m.send=function(){var C=arguments[0],R=C.length||C.size||C.byteLength;if(m.readyState==="open"&&v.sctp&&R>v.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+v.sctp.maxMessageSize+" bytes)");return l.apply(m,arguments)}}}function w(k){if(k.RTCPeerConnection&&!("connectionState"in k.RTCPeerConnection.prototype)){var b=k.RTCPeerConnection.prototype;Object.defineProperty(b,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(b,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(T){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),T&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=T)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(T){var m=b[T];b[T]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(v){var l=v.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;var C=new Event("connectionstatechange",v);l.dispatchEvent(C)}return v},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),m.apply(this,arguments)}})}}function M(k){if(k.RTCPeerConnection){var b=h.detectBrowser(k);if(!(b.browser==="chrome"&&b.version>=71)){var T=k.RTCPeerConnection.prototype.setRemoteDescription;k.RTCPeerConnection.prototype.setRemoteDescription=function(m){return m&&m.sdp&&m.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1&&(m.sdp=m.sdp.split(`
`).filter(function(v){return v.trim()!=="a=extmap-allow-mixed"}).join(`
`)),T.apply(this,arguments)}}}}},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=x;var c=u(e("./utils")),h=u(e("./chrome/chrome_shim")),p=u(e("./edge/edge_shim")),f=u(e("./firefox/firefox_shim")),g=u(e("./safari/safari_shim")),y=u(e("./common_shim"));function S(){if(typeof WeakMap!="function")return null;var w=new WeakMap;return S=function(){return w},w}function u(w){if(w&&w.__esModule)return w;if(w===null||typeof w!="object"&&typeof w!="function")return{default:w};var M=S();if(M&&M.has(w))return M.get(w);var k={},b=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var T in w)if(Object.prototype.hasOwnProperty.call(w,T)){var m=b?Object.getOwnPropertyDescriptor(w,T):null;m&&(m.get||m.set)?Object.defineProperty(k,T,m):k[T]=w[T]}return k.default=w,M&&M.set(w,k),k}function x(){var{window:w}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},k=c.log,b=c.detectBrowser(w),T={browserDetails:b,commonShim:y,extractVersion:c.extractVersion,disableLog:c.disableLog,disableWarnings:c.disableWarnings};switch(b.browser){case"chrome":if(!h||!h.shimPeerConnection||!M.shimChrome)return k("Chrome shim is not included in this adapter release."),T;k("adapter.js shimming chrome."),T.browserShim=h,h.shimGetUserMedia(w),h.shimMediaStream(w),h.shimPeerConnection(w),h.shimOnTrack(w),h.shimAddTrackRemoveTrack(w),h.shimGetSendersWithDtmf(w),h.shimGetStats(w),h.shimSenderReceiverGetStats(w),h.fixNegotiationNeeded(w),y.shimRTCIceCandidate(w),y.shimConnectionState(w),y.shimMaxMessageSize(w),y.shimSendThrowTypeError(w),y.removeAllowExtmapMixed(w);break;case"firefox":if(!f||!f.shimPeerConnection||!M.shimFirefox)return k("Firefox shim is not included in this adapter release."),T;k("adapter.js shimming firefox."),T.browserShim=f,f.shimGetUserMedia(w),f.shimPeerConnection(w),f.shimOnTrack(w),f.shimRemoveStream(w),f.shimSenderGetStats(w),f.shimReceiverGetStats(w),f.shimRTCDataChannel(w),f.shimAddTransceiver(w),f.shimCreateOffer(w),f.shimCreateAnswer(w),y.shimRTCIceCandidate(w),y.shimConnectionState(w),y.shimMaxMessageSize(w),y.shimSendThrowTypeError(w);break;case"edge":if(!p||!p.shimPeerConnection||!M.shimEdge)return k("MS edge shim is not included in this adapter release."),T;k("adapter.js shimming edge."),T.browserShim=p,p.shimGetUserMedia(w),p.shimGetDisplayMedia(w),p.shimPeerConnection(w),p.shimReplaceTrack(w),y.shimMaxMessageSize(w),y.shimSendThrowTypeError(w);break;case"safari":if(!g||!M.shimSafari)return k("Safari shim is not included in this adapter release."),T;k("adapter.js shimming safari."),T.browserShim=g,g.shimRTCIceServerUrls(w),g.shimCreateOfferLegacy(w),g.shimCallbacksAPI(w),g.shimLocalStreamsAPI(w),g.shimRemoteStreamsAPI(w),g.shimTrackEventTransceiver(w),g.shimGetUserMedia(w),y.shimRTCIceCandidate(w),y.shimMaxMessageSize(w),y.shimSendThrowTypeError(w),y.removeAllowExtmapMixed(w);break;default:k("Unsupported browser!")}return T}},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var c=e("./adapter_factory.js"),h=(0,c.adapterFactory)({window}),p=h;r.default=p},{"./adapter_factory.js":"KtlG"}],sXtV:[function(e,i,r){"use strict";var c=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(r,"__esModule",{value:!0});var h=c(e("webrtc-adapter"));r.webRTCAdapter=h.default},{"webrtc-adapter":"tI1X"}],I31f:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c=e("./adapter");r.Supports=new(function(){function h(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return h.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection!="undefined"},h.prototype.isBrowserSupported=function(){var p=this.getBrowser(),f=this.getVersion();return!!this.supportedBrowsers.includes(p)&&(p==="chrome"?f>=this.minChromeVersion:p==="firefox"?f>=this.minFirefoxVersion:p==="safari"&&!this.isIOS&&f>=this.minSafariVersion)},h.prototype.getBrowser=function(){return c.webRTCAdapter.browserDetails.browser},h.prototype.getVersion=function(){return c.webRTCAdapter.browserDetails.version||0},h.prototype.isUnifiedPlanSupported=function(){var p,f=this.getBrowser(),g=c.webRTCAdapter.browserDetails.version||0;if(f==="chrome"&&g<72)return!1;if(f==="firefox"&&g>=59)return!0;if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;var y=!1;try{(p=new RTCPeerConnection).addTransceiver("audio"),y=!0}catch(S){}finally{p&&p.close()}return y},h.prototype.toString=function(){return`Supports: 
    browser:`+this.getBrowser()+` 
    version:`+this.getVersion()+` 
    isIOS:`+this.isIOS+` 
    isWebRTCSupported:`+this.isWebRTCSupported()+` 
    isBrowserSupported:`+this.isBrowserSupported()+` 
    isUnifiedPlanSupported:`+this.isUnifiedPlanSupported()},h}())},{"./adapter":"sXtV"}],BHXf:[function(e,i,r){"use strict";var c=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var y={};if(g!=null)for(var S in g)Object.hasOwnProperty.call(g,S)&&(y[S]=g[S]);return y.default=g,y};Object.defineProperty(r,"__esModule",{value:!0});var h=c(e("peerjs-js-binarypack")),p=e("./supports"),f={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};r.util=new(function(){function g(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=f,this.browser=p.Supports.getBrowser(),this.browserVersion=p.Supports.getVersion(),this.supports=function(){var y,S={browser:p.Supports.isBrowserSupported(),webRTC:p.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!S.webRTC)return S;try{y=new RTCPeerConnection(f),S.audioVideo=!0;var u=void 0;try{u=y.createDataChannel("_PEERJSTEST",{ordered:!0}),S.data=!0,S.reliable=!!u.ordered;try{u.binaryType="blob",S.binaryBlob=!p.Supports.isIOS}catch(x){}}catch(x){}finally{u&&u.close()}}catch(x){}finally{y&&y.close()}return S}(),this.pack=h.pack,this.unpack=h.unpack,this._dataCount=1}return g.prototype.noop=function(){},g.prototype.validateId=function(y){return!y||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(y)},g.prototype.chunk=function(y){for(var S=[],u=y.size,x=Math.ceil(u/r.util.chunkedMTU),w=0,M=0;M<u;){var k=Math.min(u,M+r.util.chunkedMTU),b=y.slice(M,k),T={__peerData:this._dataCount,n:w,data:b,total:x};S.push(T),M=k,w++}return this._dataCount++,S},g.prototype.blobToArrayBuffer=function(y,S){var u=new FileReader;return u.onload=function(x){x.target&&S(x.target.result)},u.readAsArrayBuffer(y),u},g.prototype.binaryStringToArrayBuffer=function(y){for(var S=new Uint8Array(y.length),u=0;u<y.length;u++)S[u]=255&y.charCodeAt(u);return S.buffer},g.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},g.prototype.isSecure=function(){return location.protocol==="https:"},g}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(e,i,r){"use strict";var c=Object.prototype.hasOwnProperty,h="~";function p(){}function f(u,x,w){this.fn=u,this.context=x,this.once=w||!1}function g(u,x,w,M,k){if(typeof w!="function")throw new TypeError("The listener must be a function");var b=new f(w,M||u,k),T=h?h+x:x;return u._events[T]?u._events[T].fn?u._events[T]=[u._events[T],b]:u._events[T].push(b):(u._events[T]=b,u._eventsCount++),u}function y(u,x){--u._eventsCount==0?u._events=new p:delete u._events[x]}function S(){this._events=new p,this._eventsCount=0}Object.create&&(p.prototype=Object.create(null),new p().__proto__||(h=!1)),S.prototype.eventNames=function(){var u,x,w=[];if(this._eventsCount===0)return w;for(x in u=this._events)c.call(u,x)&&w.push(h?x.slice(1):x);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(u)):w},S.prototype.listeners=function(u){var x=h?h+u:u,w=this._events[x];if(!w)return[];if(w.fn)return[w.fn];for(var M=0,k=w.length,b=new Array(k);M<k;M++)b[M]=w[M].fn;return b},S.prototype.listenerCount=function(u){var x=h?h+u:u,w=this._events[x];return w?w.fn?1:w.length:0},S.prototype.emit=function(u,x,w,M,k,b){var T=h?h+u:u;if(!this._events[T])return!1;var m,v,l=this._events[T],C=arguments.length;if(l.fn){switch(l.once&&this.removeListener(u,l.fn,void 0,!0),C){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,x),!0;case 3:return l.fn.call(l.context,x,w),!0;case 4:return l.fn.call(l.context,x,w,M),!0;case 5:return l.fn.call(l.context,x,w,M,k),!0;case 6:return l.fn.call(l.context,x,w,M,k,b),!0}for(v=1,m=new Array(C-1);v<C;v++)m[v-1]=arguments[v];l.fn.apply(l.context,m)}else{var R,j=l.length;for(v=0;v<j;v++)switch(l[v].once&&this.removeListener(u,l[v].fn,void 0,!0),C){case 1:l[v].fn.call(l[v].context);break;case 2:l[v].fn.call(l[v].context,x);break;case 3:l[v].fn.call(l[v].context,x,w);break;case 4:l[v].fn.call(l[v].context,x,w,M);break;default:if(!m)for(R=1,m=new Array(C-1);R<C;R++)m[R-1]=arguments[R];l[v].fn.apply(l[v].context,m)}}return!0},S.prototype.on=function(u,x,w){return g(this,u,x,w,!1)},S.prototype.once=function(u,x,w){return g(this,u,x,w,!0)},S.prototype.removeListener=function(u,x,w,M){var k=h?h+u:u;if(!this._events[k])return this;if(!x)return y(this,k),this;var b=this._events[k];if(b.fn)b.fn!==x||M&&!b.once||w&&b.context!==w||y(this,k);else{for(var T=0,m=[],v=b.length;T<v;T++)(b[T].fn!==x||M&&!b[T].once||w&&b[T].context!==w)&&m.push(b[T]);m.length?this._events[k]=m.length===1?m[0]:m:y(this,k)}return this},S.prototype.removeAllListeners=function(u){var x;return u?(x=h?h+u:u,this._events[x]&&y(this,x)):(this._events=new p,this._eventsCount=0),this},S.prototype.off=S.prototype.removeListener,S.prototype.addListener=S.prototype.on,S.prefixed=h,S.EventEmitter=S,typeof i!="undefined"&&(i.exports=S)},{}],WOs9:[function(e,i,r){"use strict";var c=this&&this.__read||function(y,S){var u=typeof Symbol=="function"&&y[Symbol.iterator];if(!u)return y;var x,w,M=u.call(y),k=[];try{for(;(S===void 0||S-- >0)&&!(x=M.next()).done;)k.push(x.value)}catch(b){w={error:b}}finally{try{x&&!x.done&&(u=M.return)&&u.call(M)}finally{if(w)throw w.error}}return k},h=this&&this.__spread||function(){for(var y=[],S=0;S<arguments.length;S++)y=y.concat(c(arguments[S]));return y};Object.defineProperty(r,"__esModule",{value:!0});var p,f="PeerJS: ";(function(y){y[y.Disabled=0]="Disabled",y[y.Errors=1]="Errors",y[y.Warnings=2]="Warnings",y[y.All=3]="All"})(p=r.LogLevel||(r.LogLevel={}));var g=function(){function y(){this._logLevel=p.Disabled}return Object.defineProperty(y.prototype,"logLevel",{get:function(){return this._logLevel},set:function(S){this._logLevel=S},enumerable:!0,configurable:!0}),y.prototype.log=function(){for(var S=[],u=0;u<arguments.length;u++)S[u]=arguments[u];this._logLevel>=p.All&&this._print.apply(this,h([p.All],S))},y.prototype.warn=function(){for(var S=[],u=0;u<arguments.length;u++)S[u]=arguments[u];this._logLevel>=p.Warnings&&this._print.apply(this,h([p.Warnings],S))},y.prototype.error=function(){for(var S=[],u=0;u<arguments.length;u++)S[u]=arguments[u];this._logLevel>=p.Errors&&this._print.apply(this,h([p.Errors],S))},y.prototype.setLogFunction=function(S){this._print=S},y.prototype._print=function(S){for(var u=[],x=1;x<arguments.length;x++)u[x-1]=arguments[x];var w=h([f],u);for(var M in w)w[M]instanceof Error&&(w[M]="("+w[M].name+") "+w[M].message);S>=p.All?console.log.apply(console,h(w)):S>=p.Warnings?console.warn.apply(console,h(["WARNING"],w)):S>=p.Errors&&console.error.apply(console,h(["ERROR"],w))},y}();r.default=new g},{}],ZRYf:[function(e,i,r){"use strict";var c,h,p,f,g,y,S;Object.defineProperty(r,"__esModule",{value:!0}),function(u){u.Open="open",u.Stream="stream",u.Data="data",u.Close="close",u.Error="error",u.IceStateChanged="iceStateChanged"}(c=r.ConnectionEventType||(r.ConnectionEventType={})),function(u){u.Data="data",u.Media="media"}(h=r.ConnectionType||(r.ConnectionType={})),function(u){u.Open="open",u.Close="close",u.Connection="connection",u.Call="call",u.Disconnected="disconnected",u.Error="error"}(p=r.PeerEventType||(r.PeerEventType={})),function(u){u.BrowserIncompatible="browser-incompatible",u.Disconnected="disconnected",u.InvalidID="invalid-id",u.InvalidKey="invalid-key",u.Network="network",u.PeerUnavailable="peer-unavailable",u.SslUnavailable="ssl-unavailable",u.ServerError="server-error",u.SocketError="socket-error",u.SocketClosed="socket-closed",u.UnavailableID="unavailable-id",u.WebRTC="webrtc"}(f=r.PeerErrorType||(r.PeerErrorType={})),function(u){u.Binary="binary",u.BinaryUTF8="binary-utf8",u.JSON="json"}(g=r.SerializationType||(r.SerializationType={})),function(u){u.Message="message",u.Disconnected="disconnected",u.Error="error",u.Close="close"}(y=r.SocketEventType||(r.SocketEventType={})),function(u){u.Heartbeat="HEARTBEAT",u.Candidate="CANDIDATE",u.Offer="OFFER",u.Answer="ANSWER",u.Open="OPEN",u.Error="ERROR",u.IdTaken="ID-TAKEN",u.InvalidKey="INVALID-KEY",u.Leave="LEAVE",u.Expire="EXPIRE"}(S=r.ServerMessageType||(r.ServerMessageType={}))},{}],wJlv:[function(e,i,r){"use strict";var c=this&&this.__extends||function(){var w=function(M,k){return(w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,T){b.__proto__=T}||function(b,T){for(var m in T)T.hasOwnProperty(m)&&(b[m]=T[m])})(M,k)};return function(M,k){function b(){this.constructor=M}w(M,k),M.prototype=k===null?Object.create(k):(b.prototype=k.prototype,new b)}}(),h=this&&this.__read||function(w,M){var k=typeof Symbol=="function"&&w[Symbol.iterator];if(!k)return w;var b,T,m=k.call(w),v=[];try{for(;(M===void 0||M-- >0)&&!(b=m.next()).done;)v.push(b.value)}catch(l){T={error:l}}finally{try{b&&!b.done&&(k=m.return)&&k.call(m)}finally{if(T)throw T.error}}return v},p=this&&this.__spread||function(){for(var w=[],M=0;M<arguments.length;M++)w=w.concat(h(arguments[M]));return w},f=this&&this.__values||function(w){var M=typeof Symbol=="function"&&Symbol.iterator,k=M&&w[M],b=0;if(k)return k.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&b>=w.length&&(w=void 0),{value:w&&w[b++],done:!w}}};throw new TypeError(M?"Object is not iterable.":"Symbol.iterator is not defined.")},g=this&&this.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(r,"__esModule",{value:!0});var y=e("eventemitter3"),S=g(e("./logger")),u=e("./enums"),x=function(w){function M(k,b,T,m,v,l){l===void 0&&(l=5e3);var C=w.call(this)||this;C.pingInterval=l,C._disconnected=!0,C._messagesQueue=[];var R=k?"wss://":"ws://";return C._baseUrl=R+b+":"+T+m+"peerjs?key="+v,C}return c(M,w),M.prototype.start=function(k,b){var T=this;this._id=k;var m=this._baseUrl+"&id="+k+"&token="+b;!this._socket&&this._disconnected&&(this._socket=new WebSocket(m),this._disconnected=!1,this._socket.onmessage=function(v){var l;try{l=JSON.parse(v.data),S.default.log("Server message received:",l)}catch(C){return void S.default.log("Invalid server message",v.data)}T.emit(u.SocketEventType.Message,l)},this._socket.onclose=function(v){T._disconnected||(S.default.log("Socket closed.",v),T._cleanup(),T._disconnected=!0,T.emit(u.SocketEventType.Disconnected))},this._socket.onopen=function(){T._disconnected||(T._sendQueuedMessages(),S.default.log("Socket open"),T._scheduleHeartbeat())})},M.prototype._scheduleHeartbeat=function(){var k=this;this._wsPingTimer=setTimeout(function(){k._sendHeartbeat()},this.pingInterval)},M.prototype._sendHeartbeat=function(){if(this._wsOpen()){var k=JSON.stringify({type:u.ServerMessageType.Heartbeat});this._socket.send(k),this._scheduleHeartbeat()}else S.default.log("Cannot send heartbeat, because socket closed")},M.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},M.prototype._sendQueuedMessages=function(){var k,b,T=p(this._messagesQueue);this._messagesQueue=[];try{for(var m=f(T),v=m.next();!v.done;v=m.next()){var l=v.value;this.send(l)}}catch(C){k={error:C}}finally{try{v&&!v.done&&(b=m.return)&&b.call(m)}finally{if(k)throw k.error}}},M.prototype.send=function(k){if(!this._disconnected)if(this._id)if(k.type){if(this._wsOpen()){var b=JSON.stringify(k);this._socket.send(b)}}else this.emit(u.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(k)},M.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},M.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},M}(y.EventEmitter);r.Socket=x},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(e,i,r){"use strict";var c=this&&this.__assign||function(){return(c=Object.assign||function(x){for(var w,M=1,k=arguments.length;M<k;M++)for(var b in w=arguments[M])Object.prototype.hasOwnProperty.call(w,b)&&(x[b]=w[b]);return x}).apply(this,arguments)},h=this&&this.__awaiter||function(x,w,M,k){return new(M||(M=Promise))(function(b,T){function m(C){try{l(k.next(C))}catch(R){T(R)}}function v(C){try{l(k.throw(C))}catch(R){T(R)}}function l(C){var R;C.done?b(C.value):(R=C.value,R instanceof M?R:new M(function(j){j(R)})).then(m,v)}l((k=k.apply(x,w||[])).next())})},p=this&&this.__generator||function(x,w){var M,k,b,T,m={label:0,sent:function(){if(1&b[0])throw b[1];return b[1]},trys:[],ops:[]};return T={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function v(l){return function(C){return function(R){if(M)throw new TypeError("Generator is already executing.");for(;m;)try{if(M=1,k&&(b=2&R[0]?k.return:R[0]?k.throw||((b=k.return)&&b.call(k),0):k.next)&&!(b=b.call(k,R[1])).done)return b;switch(k=0,b&&(R=[2&R[0],b.value]),R[0]){case 0:case 1:b=R;break;case 4:return m.label++,{value:R[1],done:!1};case 5:m.label++,k=R[1],R=[0];continue;case 7:R=m.ops.pop(),m.trys.pop();continue;default:if(!(b=(b=m.trys).length>0&&b[b.length-1])&&(R[0]===6||R[0]===2)){m=0;continue}if(R[0]===3&&(!b||R[1]>b[0]&&R[1]<b[3])){m.label=R[1];break}if(R[0]===6&&m.label<b[1]){m.label=b[1],b=R;break}if(b&&m.label<b[2]){m.label=b[2],m.ops.push(R);break}b[2]&&m.ops.pop(),m.trys.pop();continue}R=w.call(x,m)}catch(j){R=[6,j],k=0}finally{M=b=0}if(5&R[0])throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}([l,C])}}},f=this&&this.__importDefault||function(x){return x&&x.__esModule?x:{default:x}};Object.defineProperty(r,"__esModule",{value:!0});var g=e("./util"),y=f(e("./logger")),S=e("./enums"),u=function(){function x(w){this.connection=w}return x.prototype.startConnection=function(w){var M=this._startPeerConnection();if(this.connection.peerConnection=M,this.connection.type===S.ConnectionType.Media&&w._stream&&this._addTracksToConnection(w._stream,M),w.originator){if(this.connection.type===S.ConnectionType.Data){var k=this.connection,b={ordered:!!w.reliable},T=M.createDataChannel(k.label,b);k.initialize(T)}this._makeOffer()}else this.handleSDP("OFFER",w.sdp)},x.prototype._startPeerConnection=function(){y.default.log("Creating RTCPeerConnection.");var w=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(w),w},x.prototype._setupListeners=function(w){var M=this,k=this.connection.peer,b=this.connection.connectionId,T=this.connection.type,m=this.connection.provider;y.default.log("Listening for ICE candidates."),w.onicecandidate=function(v){v.candidate&&v.candidate.candidate&&(y.default.log("Received ICE candidates for "+k+":",v.candidate),m.socket.send({type:S.ServerMessageType.Candidate,payload:{candidate:v.candidate,type:T,connectionId:b},dst:k}))},w.oniceconnectionstatechange=function(){switch(w.iceConnectionState){case"failed":y.default.log("iceConnectionState is failed, closing connections to "+k),M.connection.emit(S.ConnectionEventType.Error,new Error("Negotiation of connection to "+k+" failed.")),M.connection.close();break;case"closed":y.default.log("iceConnectionState is closed, closing connections to "+k),M.connection.emit(S.ConnectionEventType.Error,new Error("Connection to "+k+" closed.")),M.connection.close();break;case"disconnected":y.default.log("iceConnectionState changed to disconnected on the connection with "+k);break;case"completed":w.onicecandidate=g.util.noop}M.connection.emit(S.ConnectionEventType.IceStateChanged,w.iceConnectionState)},y.default.log("Listening for data channel"),w.ondatachannel=function(v){y.default.log("Received data channel");var l=v.channel;m.getConnection(k,b).initialize(l)},y.default.log("Listening for remote stream"),w.ontrack=function(v){y.default.log("Received remote stream");var l=v.streams[0],C=m.getConnection(k,b);if(C.type===S.ConnectionType.Media){var R=C;M._addStreamToMediaConnection(l,R)}}},x.prototype.cleanup=function(){y.default.log("Cleaning up PeerConnection to "+this.connection.peer);var w=this.connection.peerConnection;if(w){this.connection.peerConnection=null,w.onicecandidate=w.oniceconnectionstatechange=w.ondatachannel=w.ontrack=function(){};var M=w.signalingState!=="closed",k=!1;if(this.connection.type===S.ConnectionType.Data){var b=this.connection.dataChannel;b&&(k=!!b.readyState&&b.readyState!=="closed")}(M||k)&&w.close()}},x.prototype._makeOffer=function(){return h(this,void 0,Promise,function(){var w,M,k,b,T,m,v;return p(this,function(l){switch(l.label){case 0:w=this.connection.peerConnection,M=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,w.createOffer(this.connection.options.constraints)];case 2:k=l.sent(),y.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(k.sdp=this.connection.options.sdpTransform(k.sdp)||k.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,w.setLocalDescription(k)];case 4:return l.sent(),y.default.log("Set localDescription:",k,"for:"+this.connection.peer),b={sdp:k,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:g.util.browser},this.connection.type===S.ConnectionType.Data&&(T=this.connection,b=c(c({},b),{label:T.label,reliable:T.reliable,serialization:T.serialization})),M.socket.send({type:S.ServerMessageType.Offer,payload:b,dst:this.connection.peer}),[3,6];case 5:return(m=l.sent())!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(M.emitError(S.PeerErrorType.WebRTC,m),y.default.log("Failed to setLocalDescription, ",m)),[3,6];case 6:return[3,8];case 7:return v=l.sent(),M.emitError(S.PeerErrorType.WebRTC,v),y.default.log("Failed to createOffer, ",v),[3,8];case 8:return[2]}})})},x.prototype._makeAnswer=function(){return h(this,void 0,Promise,function(){var w,M,k,b,T;return p(this,function(m){switch(m.label){case 0:w=this.connection.peerConnection,M=this.connection.provider,m.label=1;case 1:return m.trys.push([1,7,,8]),[4,w.createAnswer()];case 2:k=m.sent(),y.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(k.sdp=this.connection.options.sdpTransform(k.sdp)||k.sdp),m.label=3;case 3:return m.trys.push([3,5,,6]),[4,w.setLocalDescription(k)];case 4:return m.sent(),y.default.log("Set localDescription:",k,"for:"+this.connection.peer),M.socket.send({type:S.ServerMessageType.Answer,payload:{sdp:k,type:this.connection.type,connectionId:this.connection.connectionId,browser:g.util.browser},dst:this.connection.peer}),[3,6];case 5:return b=m.sent(),M.emitError(S.PeerErrorType.WebRTC,b),y.default.log("Failed to setLocalDescription, ",b),[3,6];case 6:return[3,8];case 7:return T=m.sent(),M.emitError(S.PeerErrorType.WebRTC,T),y.default.log("Failed to create answer, ",T),[3,8];case 8:return[2]}})})},x.prototype.handleSDP=function(w,M){return h(this,void 0,Promise,function(){var k,b,T,m;return p(this,function(v){switch(v.label){case 0:M=new RTCSessionDescription(M),k=this.connection.peerConnection,b=this.connection.provider,y.default.log("Setting remote description",M),T=this,v.label=1;case 1:return v.trys.push([1,5,,6]),[4,k.setRemoteDescription(M)];case 2:return v.sent(),y.default.log("Set remoteDescription:"+w+" for:"+this.connection.peer),w!=="OFFER"?[3,4]:[4,T._makeAnswer()];case 3:v.sent(),v.label=4;case 4:return[3,6];case 5:return m=v.sent(),b.emitError(S.PeerErrorType.WebRTC,m),y.default.log("Failed to setRemoteDescription, ",m),[3,6];case 6:return[2]}})})},x.prototype.handleCandidate=function(w){return h(this,void 0,Promise,function(){var M,k,b,T,m,v;return p(this,function(l){switch(l.label){case 0:y.default.log("handleCandidate:",w),M=w.candidate,k=w.sdpMLineIndex,b=w.sdpMid,T=this.connection.peerConnection,m=this.connection.provider,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,T.addIceCandidate(new RTCIceCandidate({sdpMid:b,sdpMLineIndex:k,candidate:M}))];case 2:return l.sent(),y.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return v=l.sent(),m.emitError(S.PeerErrorType.WebRTC,v),y.default.log("Failed to handleCandidate, ",v),[3,4];case 4:return[2]}})})},x.prototype._addTracksToConnection=function(w,M){if(y.default.log("add tracks from stream "+w.id+" to peer connection"),!M.addTrack)return y.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");w.getTracks().forEach(function(k){M.addTrack(k,w)})},x.prototype._addStreamToMediaConnection=function(w,M){y.default.log("add stream "+w.id+" to media connection "+M.connectionId),M.addStream(w)},x}();r.Negotiator=u},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(e,i,r){"use strict";var c=this&&this.__extends||function(){var f=function(g,y){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,u){S.__proto__=u}||function(S,u){for(var x in u)u.hasOwnProperty(x)&&(S[x]=u[x])})(g,y)};return function(g,y){function S(){this.constructor=g}f(g,y),g.prototype=y===null?Object.create(y):(S.prototype=y.prototype,new S)}}();Object.defineProperty(r,"__esModule",{value:!0});var h=e("eventemitter3"),p=function(f){function g(y,S,u){var x=f.call(this)||this;return x.peer=y,x.provider=S,x.options=u,x._open=!1,x.metadata=u.metadata,x}return c(g,f),Object.defineProperty(g.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),g}(h.EventEmitter);r.BaseConnection=p},{eventemitter3:"JJlS"}],dbHP:[function(e,i,r){"use strict";var c=this&&this.__extends||function(){var M=function(k,b){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,m){T.__proto__=m}||function(T,m){for(var v in m)m.hasOwnProperty(v)&&(T[v]=m[v])})(k,b)};return function(k,b){function T(){this.constructor=k}M(k,b),k.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(M){for(var k,b=1,T=arguments.length;b<T;b++)for(var m in k=arguments[b])Object.prototype.hasOwnProperty.call(k,m)&&(M[m]=k[m]);return M}).apply(this,arguments)},p=this&&this.__values||function(M){var k=typeof Symbol=="function"&&Symbol.iterator,b=k&&M[k],T=0;if(b)return b.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&T>=M.length&&(M=void 0),{value:M&&M[T++],done:!M}}};throw new TypeError(k?"Object is not iterable.":"Symbol.iterator is not defined.")},f=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(r,"__esModule",{value:!0});var g=e("./util"),y=f(e("./logger")),S=e("./negotiator"),u=e("./enums"),x=e("./baseconnection"),w=function(M){function k(b,T,m){var v=M.call(this,b,T,m)||this;return v._localStream=v.options._stream,v.connectionId=v.options.connectionId||k.ID_PREFIX+g.util.randomToken(),v._negotiator=new S.Negotiator(v),v._localStream&&v._negotiator.startConnection({_stream:v._localStream,originator:!0}),v}return c(k,M),Object.defineProperty(k.prototype,"type",{get:function(){return u.ConnectionType.Media},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"localStream",{get:function(){return this._localStream},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!0,configurable:!0}),k.prototype.addStream=function(b){y.default.log("Receiving stream",b),this._remoteStream=b,M.prototype.emit.call(this,u.ConnectionEventType.Stream,b)},k.prototype.handleMessage=function(b){var T=b.type,m=b.payload;switch(b.type){case u.ServerMessageType.Answer:this._negotiator.handleSDP(T,m.sdp),this._open=!0;break;case u.ServerMessageType.Candidate:this._negotiator.handleCandidate(m.candidate);break;default:y.default.warn("Unrecognized message type:"+T+" from peer:"+this.peer)}},k.prototype.answer=function(b,T){var m,v;if(T===void 0&&(T={}),this._localStream)y.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=b,T&&T.sdpTransform&&(this.options.sdpTransform=T.sdpTransform),this._negotiator.startConnection(h(h({},this.options._payload),{_stream:b}));var l=this.provider._getMessages(this.connectionId);try{for(var C=p(l),R=C.next();!R.done;R=C.next()){var j=R.value;this.handleMessage(j)}}catch(L){m={error:L}}finally{try{R&&!R.done&&(v=C.return)&&v.call(C)}finally{if(m)throw m.error}}this._open=!0}},k.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,M.prototype.emit.call(this,u.ConnectionEventType.Close))},k.ID_PREFIX="mc_",k}(x.BaseConnection);r.MediaConnection=w},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(e,i,r){"use strict";var c=this&&this.__extends||function(){var y=function(S,u){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,w){x.__proto__=w}||function(x,w){for(var M in w)w.hasOwnProperty(M)&&(x[M]=w[M])})(S,u)};return function(S,u){function x(){this.constructor=S}y(S,u),S.prototype=u===null?Object.create(u):(x.prototype=u.prototype,new x)}}(),h=this&&this.__importDefault||function(y){return y&&y.__esModule?y:{default:y}};Object.defineProperty(r,"__esModule",{value:!0});var p=e("eventemitter3"),f=h(e("./logger")),g=function(y){function S(){var u=y.call(this)||this;return u.fileReader=new FileReader,u._queue=[],u._processing=!1,u.fileReader.onload=function(x){u._processing=!1,x.target&&u.emit("done",x.target.result),u.doNextTask()},u.fileReader.onerror=function(x){f.default.error("EncodingQueue error:",x),u._processing=!1,u.destroy(),u.emit("error",x)},u}return c(S,y),Object.defineProperty(S.prototype,"queue",{get:function(){return this._queue},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"size",{get:function(){return this.queue.length},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"processing",{get:function(){return this._processing},enumerable:!0,configurable:!0}),S.prototype.enque=function(u){this.queue.push(u),this.processing||this.doNextTask()},S.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},S.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},S}(p.EventEmitter);r.EncodingQueue=g},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(e,i,r){"use strict";var c=this&&this.__extends||function(){var M=function(k,b){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,m){T.__proto__=m}||function(T,m){for(var v in m)m.hasOwnProperty(v)&&(T[v]=m[v])})(k,b)};return function(k,b){function T(){this.constructor=k}M(k,b),k.prototype=b===null?Object.create(b):(T.prototype=b.prototype,new T)}}(),h=this&&this.__values||function(M){var k=typeof Symbol=="function"&&Symbol.iterator,b=k&&M[k],T=0;if(b)return b.call(M);if(M&&typeof M.length=="number")return{next:function(){return M&&T>=M.length&&(M=void 0),{value:M&&M[T++],done:!M}}};throw new TypeError(k?"Object is not iterable.":"Symbol.iterator is not defined.")},p=this&&this.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(r,"__esModule",{value:!0});var f=e("./util"),g=p(e("./logger")),y=e("./negotiator"),S=e("./enums"),u=e("./baseconnection"),x=e("./encodingQueue"),w=function(M){function k(b,T,m){var v=M.call(this,b,T,m)||this;return v.stringify=JSON.stringify,v.parse=JSON.parse,v._buffer=[],v._bufferSize=0,v._buffering=!1,v._chunkedData={},v._encodingQueue=new x.EncodingQueue,v.connectionId=v.options.connectionId||k.ID_PREFIX+f.util.randomToken(),v.label=v.options.label||v.connectionId,v.serialization=v.options.serialization||S.SerializationType.Binary,v.reliable=!!v.options.reliable,v._encodingQueue.on("done",function(l){v._bufferedSend(l)}),v._encodingQueue.on("error",function(){g.default.error("DC#"+v.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),v.close()}),v._negotiator=new y.Negotiator(v),v._negotiator.startConnection(v.options._payload||{originator:!0}),v}return c(k,M),Object.defineProperty(k.prototype,"type",{get:function(){return S.ConnectionType.Data},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!0,configurable:!0}),Object.defineProperty(k.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!0,configurable:!0}),k.prototype.initialize=function(b){this._dc=b,this._configureDataChannel()},k.prototype._configureDataChannel=function(){var b=this;f.util.supports.binaryBlob&&!f.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){g.default.log("DC#"+b.connectionId+" dc connection success"),b._open=!0,b.emit(S.ConnectionEventType.Open)},this.dataChannel.onmessage=function(T){g.default.log("DC#"+b.connectionId+" dc onmessage:",T.data),b._handleDataMessage(T)},this.dataChannel.onclose=function(){g.default.log("DC#"+b.connectionId+" dc closed for:",b.peer),b.close()}},k.prototype._handleDataMessage=function(b){var T=this,m=b.data,v=m.constructor,l=m;if(this.serialization===S.SerializationType.Binary||this.serialization===S.SerializationType.BinaryUTF8){if(v===Blob)return void f.util.blobToArrayBuffer(m,function(R){var j=f.util.unpack(R);T.emit(S.ConnectionEventType.Data,j)});if(v===ArrayBuffer)l=f.util.unpack(m);else if(v===String){var C=f.util.binaryStringToArrayBuffer(m);l=f.util.unpack(C)}}else this.serialization===S.SerializationType.JSON&&(l=this.parse(m));l.__peerData?this._handleChunk(l):M.prototype.emit.call(this,S.ConnectionEventType.Data,l)},k.prototype._handleChunk=function(b){var T=b.__peerData,m=this._chunkedData[T]||{data:[],count:0,total:b.total};if(m.data[b.n]=b.data,m.count++,this._chunkedData[T]=m,m.total===m.count){delete this._chunkedData[T];var v=new Blob(m.data);this._handleDataMessage({data:v})}},k.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,M.prototype.emit.call(this,S.ConnectionEventType.Close))},k.prototype.send=function(b,T){if(this.open)if(this.serialization===S.SerializationType.JSON)this._bufferedSend(this.stringify(b));else if(this.serialization===S.SerializationType.Binary||this.serialization===S.SerializationType.BinaryUTF8){var m=f.util.pack(b);if(!T&&m.size>f.util.chunkedMTU)return void this._sendChunks(m);f.util.supports.binaryBlob?this._bufferedSend(m):this._encodingQueue.enque(m)}else this._bufferedSend(b);else M.prototype.emit.call(this,S.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},k.prototype._bufferedSend=function(b){!this._buffering&&this._trySend(b)||(this._buffer.push(b),this._bufferSize=this._buffer.length)},k.prototype._trySend=function(b){var T=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>k.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){T._buffering=!1,T._tryBuffer()},50),!1;try{this.dataChannel.send(b)}catch(m){return g.default.error("DC#:"+this.connectionId+" Error when sending:",m),this._buffering=!0,this.close(),!1}return!0},k.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var b=this._buffer[0];this._trySend(b)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},k.prototype._sendChunks=function(b){var T,m,v=f.util.chunk(b);g.default.log("DC#"+this.connectionId+" Try to send "+v.length+" chunks...");try{for(var l=h(v),C=l.next();!C.done;C=l.next()){var R=C.value;this.send(R,!0)}}catch(j){T={error:j}}finally{try{C&&!C.done&&(m=l.return)&&m.call(l)}finally{if(T)throw T.error}}},k.prototype.handleMessage=function(b){var T=b.payload;switch(b.type){case S.ServerMessageType.Answer:this._negotiator.handleSDP(b.type,T.sdp);break;case S.ServerMessageType.Candidate:this._negotiator.handleCandidate(T.candidate);break;default:g.default.warn("Unrecognized message type:",b.type,"from peer:",this.peer)}},k.ID_PREFIX="dc_",k.MAX_BUFFERED_AMOUNT=8388608,k}(u.BaseConnection);r.DataConnection=w},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(e,i,r){"use strict";var c=this&&this.__awaiter||function(S,u,x,w){return new(x||(x=Promise))(function(M,k){function b(v){try{m(w.next(v))}catch(l){k(l)}}function T(v){try{m(w.throw(v))}catch(l){k(l)}}function m(v){var l;v.done?M(v.value):(l=v.value,l instanceof x?l:new x(function(C){C(l)})).then(b,T)}m((w=w.apply(S,u||[])).next())})},h=this&&this.__generator||function(S,u){var x,w,M,k,b={label:0,sent:function(){if(1&M[0])throw M[1];return M[1]},trys:[],ops:[]};return k={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function T(m){return function(v){return function(l){if(x)throw new TypeError("Generator is already executing.");for(;b;)try{if(x=1,w&&(M=2&l[0]?w.return:l[0]?w.throw||((M=w.return)&&M.call(w),0):w.next)&&!(M=M.call(w,l[1])).done)return M;switch(w=0,M&&(l=[2&l[0],M.value]),l[0]){case 0:case 1:M=l;break;case 4:return b.label++,{value:l[1],done:!1};case 5:b.label++,w=l[1],l=[0];continue;case 7:l=b.ops.pop(),b.trys.pop();continue;default:if(!(M=(M=b.trys).length>0&&M[M.length-1])&&(l[0]===6||l[0]===2)){b=0;continue}if(l[0]===3&&(!M||l[1]>M[0]&&l[1]<M[3])){b.label=l[1];break}if(l[0]===6&&b.label<M[1]){b.label=M[1],M=l;break}if(M&&b.label<M[2]){b.label=M[2],b.ops.push(l);break}M[2]&&b.ops.pop(),b.trys.pop();continue}l=u.call(S,b)}catch(C){l=[6,C],w=0}finally{x=M=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([m,v])}}},p=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(r,"__esModule",{value:!0});var f=e("./util"),g=p(e("./logger")),y=function(){function S(u){this._options=u}return S.prototype._buildUrl=function(u){var x=(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+u;return x+="?ts="+new Date().getTime()+Math.random()},S.prototype.retrieveId=function(){return c(this,void 0,Promise,function(){var u,x,w,M;return h(this,function(k){switch(k.label){case 0:u=this._buildUrl("id"),k.label=1;case 1:return k.trys.push([1,3,,4]),[4,fetch(u)];case 2:if((x=k.sent()).status!==200)throw new Error("Error. Status:"+x.status);return[2,x.text()];case 3:throw w=k.sent(),g.default.error("Error retrieving ID",w),M="",this._options.path==="/"&&this._options.host!==f.util.CLOUD_HOST&&(M=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+M);case 4:return[2]}})})},S.prototype.listAllPeers=function(){return c(this,void 0,Promise,function(){var u,x,w,M;return h(this,function(k){switch(k.label){case 0:u=this._buildUrl("peers"),k.label=1;case 1:return k.trys.push([1,3,,4]),[4,fetch(u)];case 2:if((x=k.sent()).status!==200)throw x.status===401?(w="",w=this._options.host===f.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+w)):new Error("Error. Status:"+x.status);return[2,x.json()];case 3:throw M=k.sent(),g.default.error("Error retrieving list peers",M),new Error("Could not get list peers from the server."+M);case 4:return[2]}})})},S}();r.API=y},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(e,i,r){"use strict";var c=this&&this.__extends||function(){var v=function(l,C){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,j){R.__proto__=j}||function(R,j){for(var L in j)j.hasOwnProperty(L)&&(R[L]=j[L])})(l,C)};return function(l,C){function R(){this.constructor=l}v(l,C),l.prototype=C===null?Object.create(C):(R.prototype=C.prototype,new R)}}(),h=this&&this.__assign||function(){return(h=Object.assign||function(v){for(var l,C=1,R=arguments.length;C<R;C++)for(var j in l=arguments[C])Object.prototype.hasOwnProperty.call(l,j)&&(v[j]=l[j]);return v}).apply(this,arguments)},p=this&&this.__values||function(v){var l=typeof Symbol=="function"&&Symbol.iterator,C=l&&v[l],R=0;if(C)return C.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&R>=v.length&&(v=void 0),{value:v&&v[R++],done:!v}}};throw new TypeError(l?"Object is not iterable.":"Symbol.iterator is not defined.")},f=this&&this.__read||function(v,l){var C=typeof Symbol=="function"&&v[Symbol.iterator];if(!C)return v;var R,j,L=C.call(v),z=[];try{for(;(l===void 0||l-- >0)&&!(R=L.next()).done;)z.push(R.value)}catch(W){j={error:W}}finally{try{R&&!R.done&&(C=L.return)&&C.call(L)}finally{if(j)throw j.error}}return z},g=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(r,"__esModule",{value:!0});var y=e("eventemitter3"),S=e("./util"),u=g(e("./logger")),x=e("./socket"),w=e("./mediaconnection"),M=e("./dataconnection"),k=e("./enums"),b=e("./api"),T=function(){return function(){}}(),m=function(v){function l(C,R){var j,L=v.call(this)||this;return L._id=null,L._lastServerId=null,L._destroyed=!1,L._disconnected=!1,L._open=!1,L._connections=new Map,L._lostMessages=new Map,C&&C.constructor==Object?R=C:C&&(j=C.toString()),R=h({debug:0,host:S.util.CLOUD_HOST,port:S.util.CLOUD_PORT,path:"/",key:l.DEFAULT_KEY,token:S.util.randomToken(),config:S.util.defaultConfig},R),L._options=R,L._options.host==="/"&&(L._options.host=window.location.hostname),L._options.path&&(L._options.path[0]!=="/"&&(L._options.path="/"+L._options.path),L._options.path[L._options.path.length-1]!=="/"&&(L._options.path+="/")),L._options.secure===void 0&&L._options.host!==S.util.CLOUD_HOST?L._options.secure=S.util.isSecure():L._options.host==S.util.CLOUD_HOST&&(L._options.secure=!0),L._options.logFunction&&u.default.setLogFunction(L._options.logFunction),u.default.logLevel=L._options.debug||0,L._api=new b.API(R),L._socket=L._createServerConnection(),S.util.supports.audioVideo||S.util.supports.data?j&&!S.util.validateId(j)?(L._delayedAbort(k.PeerErrorType.InvalidID,'ID "'+j+'" is invalid'),L):(j?L._initialize(j):L._api.retrieveId().then(function(z){return L._initialize(z)}).catch(function(z){return L._abort(k.PeerErrorType.ServerError,z)}),L):(L._delayedAbort(k.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),L)}return c(l,v),Object.defineProperty(l.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"socket",{get:function(){return this._socket},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"connections",{get:function(){var C,R,j=Object.create(null);try{for(var L=p(this._connections),z=L.next();!z.done;z=L.next()){var W=f(z.value,2),U=W[0],G=W[1];j[U]=G}}catch(et){C={error:et}}finally{try{z&&!z.done&&(R=L.return)&&R.call(L)}finally{if(C)throw C.error}}return j},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!0,configurable:!0}),l.prototype._createServerConnection=function(){var C=this,R=new x.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return R.on(k.SocketEventType.Message,function(j){C._handleMessage(j)}),R.on(k.SocketEventType.Error,function(j){C._abort(k.PeerErrorType.SocketError,j)}),R.on(k.SocketEventType.Disconnected,function(){C.disconnected||(C.emitError(k.PeerErrorType.Network,"Lost connection to server."),C.disconnect())}),R.on(k.SocketEventType.Close,function(){C.disconnected||C._abort(k.PeerErrorType.SocketClosed,"Underlying socket is already closed.")}),R},l.prototype._initialize=function(C){this._id=C,this.socket.start(C,this._options.token)},l.prototype._handleMessage=function(C){var R,j,L=C.type,z=C.payload,W=C.src;switch(L){case k.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(k.PeerEventType.Open,this.id);break;case k.ServerMessageType.Error:this._abort(k.PeerErrorType.ServerError,z.msg);break;case k.ServerMessageType.IdTaken:this._abort(k.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case k.ServerMessageType.InvalidKey:this._abort(k.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case k.ServerMessageType.Leave:u.default.log("Received leave message from "+W),this._cleanupPeer(W),this._connections.delete(W);break;case k.ServerMessageType.Expire:this.emitError(k.PeerErrorType.PeerUnavailable,"Could not connect to peer "+W);break;case k.ServerMessageType.Offer:var U=z.connectionId;if(($=this.getConnection(W,U))&&($.close(),u.default.warn("Offer received for existing Connection ID:"+U)),z.type===k.ConnectionType.Media)$=new w.MediaConnection(W,this,{connectionId:U,_payload:z,metadata:z.metadata}),this._addConnection(W,$),this.emit(k.PeerEventType.Call,$);else{if(z.type!==k.ConnectionType.Data)return void u.default.warn("Received malformed connection type:"+z.type);$=new M.DataConnection(W,this,{connectionId:U,_payload:z,metadata:z.metadata,label:z.label,serialization:z.serialization,reliable:z.reliable}),this._addConnection(W,$),this.emit(k.PeerEventType.Connection,$)}var G=this._getMessages(U);try{for(var et=p(G),at=et.next();!at.done;at=et.next()){var lt=at.value;$.handleMessage(lt)}}catch(ot){R={error:ot}}finally{try{at&&!at.done&&(j=et.return)&&j.call(et)}finally{if(R)throw R.error}}break;default:if(!z)return void u.default.warn("You received a malformed message from "+W+" of type "+L);var $;U=z.connectionId,($=this.getConnection(W,U))&&$.peerConnection?$.handleMessage(C):U?this._storeMessage(U,C):u.default.warn("You received an unrecognized message:",C)}},l.prototype._storeMessage=function(C,R){this._lostMessages.has(C)||this._lostMessages.set(C,[]),this._lostMessages.get(C).push(R)},l.prototype._getMessages=function(C){var R=this._lostMessages.get(C);return R?(this._lostMessages.delete(C),R):[]},l.prototype.connect=function(C,R){if(R===void 0&&(R={}),this.disconnected)return u.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(k.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var j=new M.DataConnection(C,this,R);return this._addConnection(C,j),j},l.prototype.call=function(C,R,j){if(j===void 0&&(j={}),this.disconnected)return u.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(k.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(R){j._stream=R;var L=new w.MediaConnection(C,this,j);return this._addConnection(C,L),L}u.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},l.prototype._addConnection=function(C,R){u.default.log("add connection "+R.type+":"+R.connectionId+" to peerId:"+C),this._connections.has(C)||this._connections.set(C,[]),this._connections.get(C).push(R)},l.prototype._removeConnection=function(C){var R=this._connections.get(C.peer);if(R){var j=R.indexOf(C);j!==-1&&R.splice(j,1)}this._lostMessages.delete(C.connectionId)},l.prototype.getConnection=function(C,R){var j,L,z=this._connections.get(C);if(!z)return null;try{for(var W=p(z),U=W.next();!U.done;U=W.next()){var G=U.value;if(G.connectionId===R)return G}}catch(et){j={error:et}}finally{try{U&&!U.done&&(L=W.return)&&L.call(W)}finally{if(j)throw j.error}}return null},l.prototype._delayedAbort=function(C,R){var j=this;setTimeout(function(){j._abort(C,R)},0)},l.prototype._abort=function(C,R){u.default.error("Aborting!"),this.emitError(C,R),this._lastServerId?this.disconnect():this.destroy()},l.prototype.emitError=function(C,R){var j;u.default.error("Error:",R),(j=typeof R=="string"?new Error(R):R).type=C,this.emit(k.PeerEventType.Error,j)},l.prototype.destroy=function(){this.destroyed||(u.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(k.PeerEventType.Close))},l.prototype._cleanup=function(){var C,R;try{for(var j=p(this._connections.keys()),L=j.next();!L.done;L=j.next()){var z=L.value;this._cleanupPeer(z),this._connections.delete(z)}}catch(W){C={error:W}}finally{try{L&&!L.done&&(R=j.return)&&R.call(j)}finally{if(C)throw C.error}}this.socket.removeAllListeners()},l.prototype._cleanupPeer=function(C){var R,j,L=this._connections.get(C);if(L)try{for(var z=p(L),W=z.next();!W.done;W=z.next())W.value.close()}catch(U){R={error:U}}finally{try{W&&!W.done&&(j=z.return)&&j.call(z)}finally{if(R)throw R.error}}},l.prototype.disconnect=function(){if(!this.disconnected){var C=this.id;u.default.log("Disconnect peer with ID:"+C),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=C,this._id=null,this.emit(k.PeerEventType.Disconnected,C)}},l.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)u.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");u.default.error("In a hurry? We're still trying to make the initial connection!")}},l.prototype.listAllPeers=function(C){var R=this;C===void 0&&(C=function(j){}),this._api.listAllPeers().then(function(j){return C(j)}).catch(function(j){return R._abort(k.PeerErrorType.ServerError,j)})},l.DEFAULT_KEY="peerjs",l}(y.EventEmitter);r.Peer=m},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(e,i,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c=e("./util"),h=e("./peer");r.peerjs={Peer:h.Peer,util:c.util},r.default=h.Peer,window.peerjs=r.peerjs,window.Peer=h.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"],null)});var Tt,Lt,Ln,kf,Jn=He(()=>{Tt=1e-6,Lt=typeof Float32Array!="undefined"?Float32Array:Array,Ln=Math.random,kf=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,i=arguments.length;i--;)e+=arguments[i]*arguments[i];return Math.sqrt(e)})});function Ac(){var e=new Lt(9);return Lt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}var Pc=He(()=>{Jn()});var rs={};Sr(rs,{add:()=>Sp,adjoint:()=>Zu,clone:()=>Uu,copy:()=>Gu,create:()=>Wu,determinant:()=>Ju,equals:()=>Op,exactEquals:()=>Mp,frob:()=>Tp,fromQuat:()=>dp,fromQuat2:()=>lp,fromRotation:()=>op,fromRotationTranslation:()=>Fc,fromRotationTranslationScale:()=>up,fromRotationTranslationScaleOrigin:()=>pp,fromScaling:()=>rp,fromTranslation:()=>sp,fromValues:()=>Yu,fromXRotation:()=>ap,fromYRotation:()=>cp,fromZRotation:()=>hp,frustum:()=>fp,getRotation:()=>ko,getScaling:()=>Lc,getTranslation:()=>Co,identity:()=>Ic,invert:()=>Xu,lookAt:()=>bp,mul:()=>Ep,multiply:()=>jc,multiplyScalar:()=>Cp,multiplyScalarAndAdd:()=>kp,ortho:()=>_p,orthoNO:()=>Nc,orthoZO:()=>yp,perspective:()=>mp,perspectiveFromFieldOfView:()=>vp,perspectiveNO:()=>qc,perspectiveZO:()=>gp,rotate:()=>tp,rotateX:()=>ep,rotateY:()=>np,rotateZ:()=>ip,scale:()=>Ku,set:()=>Hu,str:()=>wp,sub:()=>Rp,subtract:()=>Vc,targetTo:()=>xp,translate:()=>$u,transpose:()=>Qu});function Wu(){var e=new Lt(16);return Lt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Uu(e){var i=new Lt(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Gu(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Yu(e,i,r,c,h,p,f,g,y,S,u,x,w,M,k,b){var T=new Lt(16);return T[0]=e,T[1]=i,T[2]=r,T[3]=c,T[4]=h,T[5]=p,T[6]=f,T[7]=g,T[8]=y,T[9]=S,T[10]=u,T[11]=x,T[12]=w,T[13]=M,T[14]=k,T[15]=b,T}function Hu(e,i,r,c,h,p,f,g,y,S,u,x,w,M,k,b,T){return e[0]=i,e[1]=r,e[2]=c,e[3]=h,e[4]=p,e[5]=f,e[6]=g,e[7]=y,e[8]=S,e[9]=u,e[10]=x,e[11]=w,e[12]=M,e[13]=k,e[14]=b,e[15]=T,e}function Ic(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qu(e,i){if(e===i){var r=i[1],c=i[2],h=i[3],p=i[6],f=i[7],g=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=c,e[9]=p,e[11]=i[14],e[12]=h,e[13]=f,e[14]=g}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Xu(e,i){var r=i[0],c=i[1],h=i[2],p=i[3],f=i[4],g=i[5],y=i[6],S=i[7],u=i[8],x=i[9],w=i[10],M=i[11],k=i[12],b=i[13],T=i[14],m=i[15],v=r*g-c*f,l=r*y-h*f,C=r*S-p*f,R=c*y-h*g,j=c*S-p*g,L=h*S-p*y,z=u*b-x*k,W=u*T-w*k,U=u*m-M*k,G=x*T-w*b,et=x*m-M*b,at=w*m-M*T,lt=v*at-l*et+C*G+R*U-j*W+L*z;return lt?(lt=1/lt,e[0]=(g*at-y*et+S*G)*lt,e[1]=(h*et-c*at-p*G)*lt,e[2]=(b*L-T*j+m*R)*lt,e[3]=(w*j-x*L-M*R)*lt,e[4]=(y*U-f*at-S*W)*lt,e[5]=(r*at-h*U+p*W)*lt,e[6]=(T*C-k*L-m*l)*lt,e[7]=(u*L-w*C+M*l)*lt,e[8]=(f*et-g*U+S*z)*lt,e[9]=(c*U-r*et-p*z)*lt,e[10]=(k*j-b*C+m*v)*lt,e[11]=(x*C-u*j-M*v)*lt,e[12]=(g*W-f*G-y*z)*lt,e[13]=(r*G-c*W+h*z)*lt,e[14]=(b*l-k*R-T*v)*lt,e[15]=(u*R-x*l+w*v)*lt,e):null}function Zu(e,i){var r=i[0],c=i[1],h=i[2],p=i[3],f=i[4],g=i[5],y=i[6],S=i[7],u=i[8],x=i[9],w=i[10],M=i[11],k=i[12],b=i[13],T=i[14],m=i[15];return e[0]=g*(w*m-M*T)-x*(y*m-S*T)+b*(y*M-S*w),e[1]=-(c*(w*m-M*T)-x*(h*m-p*T)+b*(h*M-p*w)),e[2]=c*(y*m-S*T)-g*(h*m-p*T)+b*(h*S-p*y),e[3]=-(c*(y*M-S*w)-g*(h*M-p*w)+x*(h*S-p*y)),e[4]=-(f*(w*m-M*T)-u*(y*m-S*T)+k*(y*M-S*w)),e[5]=r*(w*m-M*T)-u*(h*m-p*T)+k*(h*M-p*w),e[6]=-(r*(y*m-S*T)-f*(h*m-p*T)+k*(h*S-p*y)),e[7]=r*(y*M-S*w)-f*(h*M-p*w)+u*(h*S-p*y),e[8]=f*(x*m-M*b)-u*(g*m-S*b)+k*(g*M-S*x),e[9]=-(r*(x*m-M*b)-u*(c*m-p*b)+k*(c*M-p*x)),e[10]=r*(g*m-S*b)-f*(c*m-p*b)+k*(c*S-p*g),e[11]=-(r*(g*M-S*x)-f*(c*M-p*x)+u*(c*S-p*g)),e[12]=-(f*(x*T-w*b)-u*(g*T-y*b)+k*(g*w-y*x)),e[13]=r*(x*T-w*b)-u*(c*T-h*b)+k*(c*w-h*x),e[14]=-(r*(g*T-y*b)-f*(c*T-h*b)+k*(c*y-h*g)),e[15]=r*(g*w-y*x)-f*(c*w-h*x)+u*(c*y-h*g),e}function Ju(e){var i=e[0],r=e[1],c=e[2],h=e[3],p=e[4],f=e[5],g=e[6],y=e[7],S=e[8],u=e[9],x=e[10],w=e[11],M=e[12],k=e[13],b=e[14],T=e[15],m=i*f-r*p,v=i*g-c*p,l=i*y-h*p,C=r*g-c*f,R=r*y-h*f,j=c*y-h*g,L=S*k-u*M,z=S*b-x*M,W=S*T-w*M,U=u*b-x*k,G=u*T-w*k,et=x*T-w*b;return m*et-v*G+l*U+C*W-R*z+j*L}function jc(e,i,r){var c=i[0],h=i[1],p=i[2],f=i[3],g=i[4],y=i[5],S=i[6],u=i[7],x=i[8],w=i[9],M=i[10],k=i[11],b=i[12],T=i[13],m=i[14],v=i[15],l=r[0],C=r[1],R=r[2],j=r[3];return e[0]=l*c+C*g+R*x+j*b,e[1]=l*h+C*y+R*w+j*T,e[2]=l*p+C*S+R*M+j*m,e[3]=l*f+C*u+R*k+j*v,l=r[4],C=r[5],R=r[6],j=r[7],e[4]=l*c+C*g+R*x+j*b,e[5]=l*h+C*y+R*w+j*T,e[6]=l*p+C*S+R*M+j*m,e[7]=l*f+C*u+R*k+j*v,l=r[8],C=r[9],R=r[10],j=r[11],e[8]=l*c+C*g+R*x+j*b,e[9]=l*h+C*y+R*w+j*T,e[10]=l*p+C*S+R*M+j*m,e[11]=l*f+C*u+R*k+j*v,l=r[12],C=r[13],R=r[14],j=r[15],e[12]=l*c+C*g+R*x+j*b,e[13]=l*h+C*y+R*w+j*T,e[14]=l*p+C*S+R*M+j*m,e[15]=l*f+C*u+R*k+j*v,e}function $u(e,i,r){var c=r[0],h=r[1],p=r[2],f,g,y,S,u,x,w,M,k,b,T,m;return i===e?(e[12]=i[0]*c+i[4]*h+i[8]*p+i[12],e[13]=i[1]*c+i[5]*h+i[9]*p+i[13],e[14]=i[2]*c+i[6]*h+i[10]*p+i[14],e[15]=i[3]*c+i[7]*h+i[11]*p+i[15]):(f=i[0],g=i[1],y=i[2],S=i[3],u=i[4],x=i[5],w=i[6],M=i[7],k=i[8],b=i[9],T=i[10],m=i[11],e[0]=f,e[1]=g,e[2]=y,e[3]=S,e[4]=u,e[5]=x,e[6]=w,e[7]=M,e[8]=k,e[9]=b,e[10]=T,e[11]=m,e[12]=f*c+u*h+k*p+i[12],e[13]=g*c+x*h+b*p+i[13],e[14]=y*c+w*h+T*p+i[14],e[15]=S*c+M*h+m*p+i[15]),e}function Ku(e,i,r){var c=r[0],h=r[1],p=r[2];return e[0]=i[0]*c,e[1]=i[1]*c,e[2]=i[2]*c,e[3]=i[3]*c,e[4]=i[4]*h,e[5]=i[5]*h,e[6]=i[6]*h,e[7]=i[7]*h,e[8]=i[8]*p,e[9]=i[9]*p,e[10]=i[10]*p,e[11]=i[11]*p,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function tp(e,i,r,c){var h=c[0],p=c[1],f=c[2],g=Math.hypot(h,p,f),y,S,u,x,w,M,k,b,T,m,v,l,C,R,j,L,z,W,U,G,et,at,lt,$;return g<Tt?null:(g=1/g,h*=g,p*=g,f*=g,y=Math.sin(r),S=Math.cos(r),u=1-S,x=i[0],w=i[1],M=i[2],k=i[3],b=i[4],T=i[5],m=i[6],v=i[7],l=i[8],C=i[9],R=i[10],j=i[11],L=h*h*u+S,z=p*h*u+f*y,W=f*h*u-p*y,U=h*p*u-f*y,G=p*p*u+S,et=f*p*u+h*y,at=h*f*u+p*y,lt=p*f*u-h*y,$=f*f*u+S,e[0]=x*L+b*z+l*W,e[1]=w*L+T*z+C*W,e[2]=M*L+m*z+R*W,e[3]=k*L+v*z+j*W,e[4]=x*U+b*G+l*et,e[5]=w*U+T*G+C*et,e[6]=M*U+m*G+R*et,e[7]=k*U+v*G+j*et,e[8]=x*at+b*lt+l*$,e[9]=w*at+T*lt+C*$,e[10]=M*at+m*lt+R*$,e[11]=k*at+v*lt+j*$,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function ep(e,i,r){var c=Math.sin(r),h=Math.cos(r),p=i[4],f=i[5],g=i[6],y=i[7],S=i[8],u=i[9],x=i[10],w=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=p*h+S*c,e[5]=f*h+u*c,e[6]=g*h+x*c,e[7]=y*h+w*c,e[8]=S*h-p*c,e[9]=u*h-f*c,e[10]=x*h-g*c,e[11]=w*h-y*c,e}function np(e,i,r){var c=Math.sin(r),h=Math.cos(r),p=i[0],f=i[1],g=i[2],y=i[3],S=i[8],u=i[9],x=i[10],w=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=p*h-S*c,e[1]=f*h-u*c,e[2]=g*h-x*c,e[3]=y*h-w*c,e[8]=p*c+S*h,e[9]=f*c+u*h,e[10]=g*c+x*h,e[11]=y*c+w*h,e}function ip(e,i,r){var c=Math.sin(r),h=Math.cos(r),p=i[0],f=i[1],g=i[2],y=i[3],S=i[4],u=i[5],x=i[6],w=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=p*h+S*c,e[1]=f*h+u*c,e[2]=g*h+x*c,e[3]=y*h+w*c,e[4]=S*h-p*c,e[5]=u*h-f*c,e[6]=x*h-g*c,e[7]=w*h-y*c,e}function sp(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function rp(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function op(e,i,r){var c=r[0],h=r[1],p=r[2],f=Math.hypot(c,h,p),g,y,S;return f<Tt?null:(f=1/f,c*=f,h*=f,p*=f,g=Math.sin(i),y=Math.cos(i),S=1-y,e[0]=c*c*S+y,e[1]=h*c*S+p*g,e[2]=p*c*S-h*g,e[3]=0,e[4]=c*h*S-p*g,e[5]=h*h*S+y,e[6]=p*h*S+c*g,e[7]=0,e[8]=c*p*S+h*g,e[9]=h*p*S-c*g,e[10]=p*p*S+y,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ap(e,i){var r=Math.sin(i),c=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function cp(e,i){var r=Math.sin(i),c=Math.cos(i);return e[0]=c,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hp(e,i){var r=Math.sin(i),c=Math.cos(i);return e[0]=c,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fc(e,i,r){var c=i[0],h=i[1],p=i[2],f=i[3],g=c+c,y=h+h,S=p+p,u=c*g,x=c*y,w=c*S,M=h*y,k=h*S,b=p*S,T=f*g,m=f*y,v=f*S;return e[0]=1-(M+b),e[1]=x+v,e[2]=w-m,e[3]=0,e[4]=x-v,e[5]=1-(u+b),e[6]=k+T,e[7]=0,e[8]=w+m,e[9]=k-T,e[10]=1-(u+M),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function lp(e,i){var r=new Lt(3),c=-i[0],h=-i[1],p=-i[2],f=i[3],g=i[4],y=i[5],S=i[6],u=i[7],x=c*c+h*h+p*p+f*f;return x>0?(r[0]=(g*f+u*c+y*p-S*h)*2/x,r[1]=(y*f+u*h+S*c-g*p)*2/x,r[2]=(S*f+u*p+g*h-y*c)*2/x):(r[0]=(g*f+u*c+y*p-S*h)*2,r[1]=(y*f+u*h+S*c-g*p)*2,r[2]=(S*f+u*p+g*h-y*c)*2),Fc(e,i,r),e}function Co(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Lc(e,i){var r=i[0],c=i[1],h=i[2],p=i[4],f=i[5],g=i[6],y=i[8],S=i[9],u=i[10];return e[0]=Math.hypot(r,c,h),e[1]=Math.hypot(p,f,g),e[2]=Math.hypot(y,S,u),e}function ko(e,i){var r=new Lt(3);Lc(r,i);var c=1/r[0],h=1/r[1],p=1/r[2],f=i[0]*c,g=i[1]*h,y=i[2]*p,S=i[4]*c,u=i[5]*h,x=i[6]*p,w=i[8]*c,M=i[9]*h,k=i[10]*p,b=f+u+k,T=0;return b>0?(T=Math.sqrt(b+1)*2,e[3]=.25*T,e[0]=(x-M)/T,e[1]=(w-y)/T,e[2]=(g-S)/T):f>u&&f>k?(T=Math.sqrt(1+f-u-k)*2,e[3]=(x-M)/T,e[0]=.25*T,e[1]=(g+S)/T,e[2]=(w+y)/T):u>k?(T=Math.sqrt(1+u-f-k)*2,e[3]=(w-y)/T,e[0]=(g+S)/T,e[1]=.25*T,e[2]=(x+M)/T):(T=Math.sqrt(1+k-f-u)*2,e[3]=(g-S)/T,e[0]=(w+y)/T,e[1]=(x+M)/T,e[2]=.25*T),e}function up(e,i,r,c){var h=i[0],p=i[1],f=i[2],g=i[3],y=h+h,S=p+p,u=f+f,x=h*y,w=h*S,M=h*u,k=p*S,b=p*u,T=f*u,m=g*y,v=g*S,l=g*u,C=c[0],R=c[1],j=c[2];return e[0]=(1-(k+T))*C,e[1]=(w+l)*C,e[2]=(M-v)*C,e[3]=0,e[4]=(w-l)*R,e[5]=(1-(x+T))*R,e[6]=(b+m)*R,e[7]=0,e[8]=(M+v)*j,e[9]=(b-m)*j,e[10]=(1-(x+k))*j,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function pp(e,i,r,c,h){var p=i[0],f=i[1],g=i[2],y=i[3],S=p+p,u=f+f,x=g+g,w=p*S,M=p*u,k=p*x,b=f*u,T=f*x,m=g*x,v=y*S,l=y*u,C=y*x,R=c[0],j=c[1],L=c[2],z=h[0],W=h[1],U=h[2],G=(1-(b+m))*R,et=(M+C)*R,at=(k-l)*R,lt=(M-C)*j,$=(1-(w+m))*j,ot=(T+v)*j,st=(k+l)*L,Rt=(T-v)*L,ut=(1-(w+b))*L;return e[0]=G,e[1]=et,e[2]=at,e[3]=0,e[4]=lt,e[5]=$,e[6]=ot,e[7]=0,e[8]=st,e[9]=Rt,e[10]=ut,e[11]=0,e[12]=r[0]+z-(G*z+lt*W+st*U),e[13]=r[1]+W-(et*z+$*W+Rt*U),e[14]=r[2]+U-(at*z+ot*W+ut*U),e[15]=1,e}function dp(e,i){var r=i[0],c=i[1],h=i[2],p=i[3],f=r+r,g=c+c,y=h+h,S=r*f,u=c*f,x=c*g,w=h*f,M=h*g,k=h*y,b=p*f,T=p*g,m=p*y;return e[0]=1-x-k,e[1]=u+m,e[2]=w-T,e[3]=0,e[4]=u-m,e[5]=1-S-k,e[6]=M+b,e[7]=0,e[8]=w+T,e[9]=M-b,e[10]=1-S-x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fp(e,i,r,c,h,p,f){var g=1/(r-i),y=1/(h-c),S=1/(p-f);return e[0]=p*2*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p*2*y,e[6]=0,e[7]=0,e[8]=(r+i)*g,e[9]=(h+c)*y,e[10]=(f+p)*S,e[11]=-1,e[12]=0,e[13]=0,e[14]=f*p*2*S,e[15]=0,e}function qc(e,i,r,c,h){var p=1/Math.tan(i/2),f;return e[0]=p/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,h!=null&&h!==1/0?(f=1/(c-h),e[10]=(h+c)*f,e[14]=2*h*c*f):(e[10]=-1,e[14]=-2*c),e}function gp(e,i,r,c,h){var p=1/Math.tan(i/2),f;return e[0]=p/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,h!=null&&h!==1/0?(f=1/(c-h),e[10]=h*f,e[14]=h*c*f):(e[10]=-1,e[14]=-c),e}function vp(e,i,r,c){var h=Math.tan(i.upDegrees*Math.PI/180),p=Math.tan(i.downDegrees*Math.PI/180),f=Math.tan(i.leftDegrees*Math.PI/180),g=Math.tan(i.rightDegrees*Math.PI/180),y=2/(f+g),S=2/(h+p);return e[0]=y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=S,e[6]=0,e[7]=0,e[8]=-((f-g)*y*.5),e[9]=(h-p)*S*.5,e[10]=c/(r-c),e[11]=-1,e[12]=0,e[13]=0,e[14]=c*r/(r-c),e[15]=0,e}function Nc(e,i,r,c,h,p,f){var g=1/(i-r),y=1/(c-h),S=1/(p-f);return e[0]=-2*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*S,e[11]=0,e[12]=(i+r)*g,e[13]=(h+c)*y,e[14]=(f+p)*S,e[15]=1,e}function yp(e,i,r,c,h,p,f){var g=1/(i-r),y=1/(c-h),S=1/(p-f);return e[0]=-2*g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*y,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=S,e[11]=0,e[12]=(i+r)*g,e[13]=(h+c)*y,e[14]=p*S,e[15]=1,e}function bp(e,i,r,c){var h,p,f,g,y,S,u,x,w,M,k=i[0],b=i[1],T=i[2],m=c[0],v=c[1],l=c[2],C=r[0],R=r[1],j=r[2];return Math.abs(k-C)<Tt&&Math.abs(b-R)<Tt&&Math.abs(T-j)<Tt?Ic(e):(u=k-C,x=b-R,w=T-j,M=1/Math.hypot(u,x,w),u*=M,x*=M,w*=M,h=v*w-l*x,p=l*u-m*w,f=m*x-v*u,M=Math.hypot(h,p,f),M?(M=1/M,h*=M,p*=M,f*=M):(h=0,p=0,f=0),g=x*f-w*p,y=w*h-u*f,S=u*p-x*h,M=Math.hypot(g,y,S),M?(M=1/M,g*=M,y*=M,S*=M):(g=0,y=0,S=0),e[0]=h,e[1]=g,e[2]=u,e[3]=0,e[4]=p,e[5]=y,e[6]=x,e[7]=0,e[8]=f,e[9]=S,e[10]=w,e[11]=0,e[12]=-(h*k+p*b+f*T),e[13]=-(g*k+y*b+S*T),e[14]=-(u*k+x*b+w*T),e[15]=1,e)}function xp(e,i,r,c){var h=i[0],p=i[1],f=i[2],g=c[0],y=c[1],S=c[2],u=h-r[0],x=p-r[1],w=f-r[2],M=u*u+x*x+w*w;M>0&&(M=1/Math.sqrt(M),u*=M,x*=M,w*=M);var k=y*w-S*x,b=S*u-g*w,T=g*x-y*u;return M=k*k+b*b+T*T,M>0&&(M=1/Math.sqrt(M),k*=M,b*=M,T*=M),e[0]=k,e[1]=b,e[2]=T,e[3]=0,e[4]=x*T-w*b,e[5]=w*k-u*T,e[6]=u*b-x*k,e[7]=0,e[8]=u,e[9]=x,e[10]=w,e[11]=0,e[12]=h,e[13]=p,e[14]=f,e[15]=1,e}function wp(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Tp(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Sp(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Vc(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Cp(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function kp(e,i,r,c){return e[0]=i[0]+r[0]*c,e[1]=i[1]+r[1]*c,e[2]=i[2]+r[2]*c,e[3]=i[3]+r[3]*c,e[4]=i[4]+r[4]*c,e[5]=i[5]+r[5]*c,e[6]=i[6]+r[6]*c,e[7]=i[7]+r[7]*c,e[8]=i[8]+r[8]*c,e[9]=i[9]+r[9]*c,e[10]=i[10]+r[10]*c,e[11]=i[11]+r[11]*c,e[12]=i[12]+r[12]*c,e[13]=i[13]+r[13]*c,e[14]=i[14]+r[14]*c,e[15]=i[15]+r[15]*c,e}function Mp(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Op(e,i){var r=e[0],c=e[1],h=e[2],p=e[3],f=e[4],g=e[5],y=e[6],S=e[7],u=e[8],x=e[9],w=e[10],M=e[11],k=e[12],b=e[13],T=e[14],m=e[15],v=i[0],l=i[1],C=i[2],R=i[3],j=i[4],L=i[5],z=i[6],W=i[7],U=i[8],G=i[9],et=i[10],at=i[11],lt=i[12],$=i[13],ot=i[14],st=i[15];return Math.abs(r-v)<=Tt*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(c-l)<=Tt*Math.max(1,Math.abs(c),Math.abs(l))&&Math.abs(h-C)<=Tt*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-R)<=Tt*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(f-j)<=Tt*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(g-L)<=Tt*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(y-z)<=Tt*Math.max(1,Math.abs(y),Math.abs(z))&&Math.abs(S-W)<=Tt*Math.max(1,Math.abs(S),Math.abs(W))&&Math.abs(u-U)<=Tt*Math.max(1,Math.abs(u),Math.abs(U))&&Math.abs(x-G)<=Tt*Math.max(1,Math.abs(x),Math.abs(G))&&Math.abs(w-et)<=Tt*Math.max(1,Math.abs(w),Math.abs(et))&&Math.abs(M-at)<=Tt*Math.max(1,Math.abs(M),Math.abs(at))&&Math.abs(k-lt)<=Tt*Math.max(1,Math.abs(k),Math.abs(lt))&&Math.abs(b-$)<=Tt*Math.max(1,Math.abs(b),Math.abs($))&&Math.abs(T-ot)<=Tt*Math.max(1,Math.abs(T),Math.abs(ot))&&Math.abs(m-st)<=Tt*Math.max(1,Math.abs(m),Math.abs(st))}var mp,_p,Ep,Rp,Mo=He(()=>{Jn();mp=qc;_p=Nc;Ep=jc,Rp=Vc});var Ae={};Sr(Ae,{add:()=>Ip,angle:()=>td,bezier:()=>Yp,ceil:()=>jp,clone:()=>Dp,copy:()=>Ap,create:()=>Cr,cross:()=>os,dist:()=>cd,distance:()=>Gc,div:()=>ad,divide:()=>Uc,dot:()=>Mr,equals:()=>sd,exactEquals:()=>id,floor:()=>Fp,forEach:()=>ud,fromValues:()=>kr,hermite:()=>Gp,inverse:()=>Wp,len:()=>Eo,length:()=>zc,lerp:()=>Up,max:()=>qp,min:()=>Lp,mul:()=>od,multiply:()=>Wc,negate:()=>Bp,normalize:()=>Oo,random:()=>Hp,rotateX:()=>Jp,rotateY:()=>$p,rotateZ:()=>Kp,round:()=>Np,scale:()=>Vp,scaleAndAdd:()=>zp,set:()=>Pp,sqrDist:()=>hd,sqrLen:()=>ld,squaredDistance:()=>Yc,squaredLength:()=>Hc,str:()=>nd,sub:()=>rd,subtract:()=>Bc,transformMat3:()=>Xp,transformMat4:()=>Qp,transformQuat:()=>Zp,zero:()=>ed});function Cr(){var e=new Lt(3);return Lt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Dp(e){var i=new Lt(3);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i}function zc(e){var i=e[0],r=e[1],c=e[2];return Math.hypot(i,r,c)}function kr(e,i,r){var c=new Lt(3);return c[0]=e,c[1]=i,c[2]=r,c}function Ap(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Pp(e,i,r,c){return e[0]=i,e[1]=r,e[2]=c,e}function Ip(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function Bc(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e}function Wc(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e}function Uc(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e}function jp(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e}function Fp(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e}function Lp(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e}function qp(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e}function Np(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e}function Vp(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e}function zp(e,i,r,c){return e[0]=i[0]+r[0]*c,e[1]=i[1]+r[1]*c,e[2]=i[2]+r[2]*c,e}function Gc(e,i){var r=i[0]-e[0],c=i[1]-e[1],h=i[2]-e[2];return Math.hypot(r,c,h)}function Yc(e,i){var r=i[0]-e[0],c=i[1]-e[1],h=i[2]-e[2];return r*r+c*c+h*h}function Hc(e){var i=e[0],r=e[1],c=e[2];return i*i+r*r+c*c}function Bp(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e}function Wp(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e}function Oo(e,i){var r=i[0],c=i[1],h=i[2],p=r*r+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),e[0]=i[0]*p,e[1]=i[1]*p,e[2]=i[2]*p,e}function Mr(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]}function os(e,i,r){var c=i[0],h=i[1],p=i[2],f=r[0],g=r[1],y=r[2];return e[0]=h*y-p*g,e[1]=p*f-c*y,e[2]=c*g-h*f,e}function Up(e,i,r,c){var h=i[0],p=i[1],f=i[2];return e[0]=h+c*(r[0]-h),e[1]=p+c*(r[1]-p),e[2]=f+c*(r[2]-f),e}function Gp(e,i,r,c,h,p){var f=p*p,g=f*(2*p-3)+1,y=f*(p-2)+p,S=f*(p-1),u=f*(3-2*p);return e[0]=i[0]*g+r[0]*y+c[0]*S+h[0]*u,e[1]=i[1]*g+r[1]*y+c[1]*S+h[1]*u,e[2]=i[2]*g+r[2]*y+c[2]*S+h[2]*u,e}function Yp(e,i,r,c,h,p){var f=1-p,g=f*f,y=p*p,S=g*f,u=3*p*g,x=3*y*f,w=y*p;return e[0]=i[0]*S+r[0]*u+c[0]*x+h[0]*w,e[1]=i[1]*S+r[1]*u+c[1]*x+h[1]*w,e[2]=i[2]*S+r[2]*u+c[2]*x+h[2]*w,e}function Hp(e,i){i=i||1;var r=Ln()*2*Math.PI,c=Ln()*2-1,h=Math.sqrt(1-c*c)*i;return e[0]=Math.cos(r)*h,e[1]=Math.sin(r)*h,e[2]=c*i,e}function Qp(e,i,r){var c=i[0],h=i[1],p=i[2],f=r[3]*c+r[7]*h+r[11]*p+r[15];return f=f||1,e[0]=(r[0]*c+r[4]*h+r[8]*p+r[12])/f,e[1]=(r[1]*c+r[5]*h+r[9]*p+r[13])/f,e[2]=(r[2]*c+r[6]*h+r[10]*p+r[14])/f,e}function Xp(e,i,r){var c=i[0],h=i[1],p=i[2];return e[0]=c*r[0]+h*r[3]+p*r[6],e[1]=c*r[1]+h*r[4]+p*r[7],e[2]=c*r[2]+h*r[5]+p*r[8],e}function Zp(e,i,r){var c=r[0],h=r[1],p=r[2],f=r[3],g=i[0],y=i[1],S=i[2],u=h*S-p*y,x=p*g-c*S,w=c*y-h*g,M=h*w-p*x,k=p*u-c*w,b=c*x-h*u,T=f*2;return u*=T,x*=T,w*=T,M*=2,k*=2,b*=2,e[0]=g+u+M,e[1]=y+x+k,e[2]=S+w+b,e}function Jp(e,i,r,c){var h=[],p=[];return h[0]=i[0]-r[0],h[1]=i[1]-r[1],h[2]=i[2]-r[2],p[0]=h[0],p[1]=h[1]*Math.cos(c)-h[2]*Math.sin(c),p[2]=h[1]*Math.sin(c)+h[2]*Math.cos(c),e[0]=p[0]+r[0],e[1]=p[1]+r[1],e[2]=p[2]+r[2],e}function $p(e,i,r,c){var h=[],p=[];return h[0]=i[0]-r[0],h[1]=i[1]-r[1],h[2]=i[2]-r[2],p[0]=h[2]*Math.sin(c)+h[0]*Math.cos(c),p[1]=h[1],p[2]=h[2]*Math.cos(c)-h[0]*Math.sin(c),e[0]=p[0]+r[0],e[1]=p[1]+r[1],e[2]=p[2]+r[2],e}function Kp(e,i,r,c){var h=[],p=[];return h[0]=i[0]-r[0],h[1]=i[1]-r[1],h[2]=i[2]-r[2],p[0]=h[0]*Math.cos(c)-h[1]*Math.sin(c),p[1]=h[0]*Math.sin(c)+h[1]*Math.cos(c),p[2]=h[2],e[0]=p[0]+r[0],e[1]=p[1]+r[1],e[2]=p[2]+r[2],e}function td(e,i){var r=e[0],c=e[1],h=e[2],p=i[0],f=i[1],g=i[2],y=Math.sqrt(r*r+c*c+h*h),S=Math.sqrt(p*p+f*f+g*g),u=y*S,x=u&&Mr(e,i)/u;return Math.acos(Math.min(Math.max(x,-1),1))}function ed(e){return e[0]=0,e[1]=0,e[2]=0,e}function nd(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function id(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]}function sd(e,i){var r=e[0],c=e[1],h=e[2],p=i[0],f=i[1],g=i[2];return Math.abs(r-p)<=Tt*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(c-f)<=Tt*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(h-g)<=Tt*Math.max(1,Math.abs(h),Math.abs(g))}var rd,od,ad,cd,hd,Eo,ld,ud,Ro=He(()=>{Jn();rd=Bc,od=Wc,ad=Uc,cd=Gc,hd=Yc,Eo=zc,ld=Hc,ud=function(){var e=Cr();return function(i,r,c,h,p,f){var g,y;for(r||(r=3),c||(c=0),h?y=Math.min(h*r+c,i.length):y=i.length,g=c;g<y;g+=r)e[0]=i[g],e[1]=i[g+1],e[2]=i[g+2],p(e,e,f),i[g]=e[0],i[g+1]=e[1],i[g+2]=e[2];return i}}()});function pd(){var e=new Lt(4);return Lt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Qc(e){var i=new Lt(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Xc(e,i,r,c){var h=new Lt(4);return h[0]=e,h[1]=i,h[2]=r,h[3]=c,h}function Zc(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Jc(e,i,r,c,h){return e[0]=i,e[1]=r,e[2]=c,e[3]=h,e}function $c(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Kc(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function th(e){var i=e[0],r=e[1],c=e[2],h=e[3];return Math.hypot(i,r,c,h)}function eh(e){var i=e[0],r=e[1],c=e[2],h=e[3];return i*i+r*r+c*c+h*h}function nh(e,i){var r=i[0],c=i[1],h=i[2],p=i[3],f=r*r+c*c+h*h+p*p;return f>0&&(f=1/Math.sqrt(f)),e[0]=r*f,e[1]=c*f,e[2]=h*f,e[3]=p*f,e}function ih(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function sh(e,i,r,c){var h=i[0],p=i[1],f=i[2],g=i[3];return e[0]=h+c*(r[0]-h),e[1]=p+c*(r[1]-p),e[2]=f+c*(r[2]-f),e[3]=g+c*(r[3]-g),e}function rh(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function oh(e,i){var r=e[0],c=e[1],h=e[2],p=e[3],f=i[0],g=i[1],y=i[2],S=i[3];return Math.abs(r-f)<=Tt*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(c-g)<=Tt*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(h-y)<=Tt*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(p-S)<=Tt*Math.max(1,Math.abs(p),Math.abs(S))}var Pf,ah=He(()=>{Jn();Pf=function(){var e=pd();return function(i,r,c,h,p,f){var g,y;for(r||(r=4),c||(c=0),h?y=Math.min(h*r+c,i.length):y=i.length,g=c;g<y;g+=r)e[0]=i[g],e[1]=i[g+1],e[2]=i[g+2],e[3]=i[g+3],p(e,e,f),i[g]=e[0],i[g+1]=e[1],i[g+2]=e[2],i[g+3]=e[3];return i}}()});var Pr={};Sr(Pr,{add:()=>kd,calculateW:()=>gd,clone:()=>Td,conjugate:()=>bd,copy:()=>Er,create:()=>as,dot:()=>Rr,equals:()=>Ad,exactEquals:()=>Dd,exp:()=>lh,fromEuler:()=>xd,fromMat3:()=>ph,fromValues:()=>Sd,getAngle:()=>md,getAxisAngle:()=>fd,identity:()=>dd,invert:()=>yd,len:()=>Ed,length:()=>Dr,lerp:()=>Od,ln:()=>uh,mul:()=>Md,multiply:()=>hh,normalize:()=>Io,pow:()=>vd,random:()=>_d,rotateX:()=>Do,rotateY:()=>Ao,rotateZ:()=>Po,rotationTo:()=>Pd,scale:()=>dh,set:()=>Cd,setAxes:()=>jd,setAxisAngle:()=>ch,slerp:()=>Or,sqlerp:()=>Id,sqrLen:()=>Rd,squaredLength:()=>Ar,str:()=>wd});function as(){var e=new Lt(4);return Lt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function dd(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ch(e,i,r){r=r*.5;var c=Math.sin(r);return e[0]=c*i[0],e[1]=c*i[1],e[2]=c*i[2],e[3]=Math.cos(r),e}function fd(e,i){var r=Math.acos(i[3])*2,c=Math.sin(r/2);return c>Tt?(e[0]=i[0]/c,e[1]=i[1]/c,e[2]=i[2]/c):(e[0]=1,e[1]=0,e[2]=0),r}function md(e,i){var r=Rr(e,i);return Math.acos(2*r*r-1)}function hh(e,i,r){var c=i[0],h=i[1],p=i[2],f=i[3],g=r[0],y=r[1],S=r[2],u=r[3];return e[0]=c*u+f*g+h*S-p*y,e[1]=h*u+f*y+p*g-c*S,e[2]=p*u+f*S+c*y-h*g,e[3]=f*u-c*g-h*y-p*S,e}function Do(e,i,r){r*=.5;var c=i[0],h=i[1],p=i[2],f=i[3],g=Math.sin(r),y=Math.cos(r);return e[0]=c*y+f*g,e[1]=h*y+p*g,e[2]=p*y-h*g,e[3]=f*y-c*g,e}function Ao(e,i,r){r*=.5;var c=i[0],h=i[1],p=i[2],f=i[3],g=Math.sin(r),y=Math.cos(r);return e[0]=c*y-p*g,e[1]=h*y+f*g,e[2]=p*y+c*g,e[3]=f*y-h*g,e}function Po(e,i,r){r*=.5;var c=i[0],h=i[1],p=i[2],f=i[3],g=Math.sin(r),y=Math.cos(r);return e[0]=c*y+h*g,e[1]=h*y-c*g,e[2]=p*y+f*g,e[3]=f*y-p*g,e}function gd(e,i){var r=i[0],c=i[1],h=i[2];return e[0]=r,e[1]=c,e[2]=h,e[3]=Math.sqrt(Math.abs(1-r*r-c*c-h*h)),e}function lh(e,i){var r=i[0],c=i[1],h=i[2],p=i[3],f=Math.sqrt(r*r+c*c+h*h),g=Math.exp(p),y=f>0?g*Math.sin(f)/f:0;return e[0]=r*y,e[1]=c*y,e[2]=h*y,e[3]=g*Math.cos(f),e}function uh(e,i){var r=i[0],c=i[1],h=i[2],p=i[3],f=Math.sqrt(r*r+c*c+h*h),g=f>0?Math.atan2(f,p)/f:0;return e[0]=r*g,e[1]=c*g,e[2]=h*g,e[3]=.5*Math.log(r*r+c*c+h*h+p*p),e}function vd(e,i,r){return uh(e,i),dh(e,e,r),lh(e,e),e}function Or(e,i,r,c){var h=i[0],p=i[1],f=i[2],g=i[3],y=r[0],S=r[1],u=r[2],x=r[3],w,M,k,b,T;return M=h*y+p*S+f*u+g*x,M<0&&(M=-M,y=-y,S=-S,u=-u,x=-x),1-M>Tt?(w=Math.acos(M),k=Math.sin(w),b=Math.sin((1-c)*w)/k,T=Math.sin(c*w)/k):(b=1-c,T=c),e[0]=b*h+T*y,e[1]=b*p+T*S,e[2]=b*f+T*u,e[3]=b*g+T*x,e}function _d(e){var i=Ln(),r=Ln(),c=Ln(),h=Math.sqrt(1-i),p=Math.sqrt(i);return e[0]=h*Math.sin(2*Math.PI*r),e[1]=h*Math.cos(2*Math.PI*r),e[2]=p*Math.sin(2*Math.PI*c),e[3]=p*Math.cos(2*Math.PI*c),e}function yd(e,i){var r=i[0],c=i[1],h=i[2],p=i[3],f=r*r+c*c+h*h+p*p,g=f?1/f:0;return e[0]=-r*g,e[1]=-c*g,e[2]=-h*g,e[3]=p*g,e}function bd(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=i[3],e}function ph(e,i){var r=i[0]+i[4]+i[8],c;if(r>0)c=Math.sqrt(r+1),e[3]=.5*c,c=.5/c,e[0]=(i[5]-i[7])*c,e[1]=(i[6]-i[2])*c,e[2]=(i[1]-i[3])*c;else{var h=0;i[4]>i[0]&&(h=1),i[8]>i[h*3+h]&&(h=2);var p=(h+1)%3,f=(h+2)%3;c=Math.sqrt(i[h*3+h]-i[p*3+p]-i[f*3+f]+1),e[h]=.5*c,c=.5/c,e[3]=(i[p*3+f]-i[f*3+p])*c,e[p]=(i[p*3+h]+i[h*3+p])*c,e[f]=(i[f*3+h]+i[h*3+f])*c}return e}function xd(e,i,r,c){var h=.5*Math.PI/180;i*=h,r*=h,c*=h;var p=Math.sin(i),f=Math.cos(i),g=Math.sin(r),y=Math.cos(r),S=Math.sin(c),u=Math.cos(c);return e[0]=p*y*u-f*g*S,e[1]=f*g*u+p*y*S,e[2]=f*y*S-p*g*u,e[3]=f*y*u+p*g*S,e}function wd(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var Td,Sd,Er,Cd,kd,Md,dh,Rr,Od,Dr,Ed,Ar,Rd,Io,Dd,Ad,Pd,Id,jd,jo=He(()=>{Jn();Pc();Ro();ah();Td=Qc,Sd=Xc,Er=Zc,Cd=Jc,kd=$c,Md=hh,dh=Kc,Rr=ih,Od=sh,Dr=th,Ed=Dr,Ar=eh,Rd=Ar,Io=nh,Dd=rh,Ad=oh,Pd=function(){var e=Cr(),i=kr(1,0,0),r=kr(0,1,0);return function(c,h,p){var f=Mr(h,p);return f<-.999999?(os(e,i,h),Eo(e)<1e-6&&os(e,r,h),Oo(e,e),ch(c,e,Math.PI),c):f>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(os(e,h,p),c[0]=e[0],c[1]=e[1],c[2]=e[2],c[3]=1+f,Io(c,c))}}(),Id=function(){var e=as(),i=as();return function(r,c,h,p,f,g){return Or(e,c,f,g),Or(i,h,p,g),Or(r,e,i,2*g*(1-g)),r}}(),jd=function(){var e=Ac();return function(i,r,c,h){return e[0]=c[0],e[3]=c[1],e[6]=c[2],e[1]=h[0],e[4]=h[1],e[7]=h[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Io(i,ph(i,e))}}()});var cs={};Sr(cs,{add:()=>sf,clone:()=>Ld,conjugate:()=>hf,copy:()=>mh,create:()=>Fd,dot:()=>vh,equals:()=>mf,exactEquals:()=>ff,fromMat4:()=>Bd,fromRotation:()=>zd,fromRotationTranslation:()=>fh,fromRotationTranslationValues:()=>Nd,fromTranslation:()=>Vd,fromValues:()=>qd,getDual:()=>Yd,getReal:()=>Gd,getTranslation:()=>Xd,identity:()=>Wd,invert:()=>cf,len:()=>lf,length:()=>_h,lerp:()=>af,mul:()=>rf,multiply:()=>gh,normalize:()=>pf,rotateAroundAxis:()=>nf,rotateByQuatAppend:()=>tf,rotateByQuatPrepend:()=>ef,rotateX:()=>Jd,rotateY:()=>$d,rotateZ:()=>Kd,scale:()=>of,set:()=>Ud,setDual:()=>Qd,setReal:()=>Hd,sqrLen:()=>uf,squaredLength:()=>Ir,str:()=>df,translate:()=>Zd});function Fd(){var e=new Lt(8);return Lt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function Ld(e){var i=new Lt(8);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i}function qd(e,i,r,c,h,p,f,g){var y=new Lt(8);return y[0]=e,y[1]=i,y[2]=r,y[3]=c,y[4]=h,y[5]=p,y[6]=f,y[7]=g,y}function Nd(e,i,r,c,h,p,f){var g=new Lt(8);g[0]=e,g[1]=i,g[2]=r,g[3]=c;var y=h*.5,S=p*.5,u=f*.5;return g[4]=y*c+S*r-u*i,g[5]=S*c+u*e-y*r,g[6]=u*c+y*i-S*e,g[7]=-y*e-S*i-u*r,g}function fh(e,i,r){var c=r[0]*.5,h=r[1]*.5,p=r[2]*.5,f=i[0],g=i[1],y=i[2],S=i[3];return e[0]=f,e[1]=g,e[2]=y,e[3]=S,e[4]=c*S+h*y-p*g,e[5]=h*S+p*f-c*y,e[6]=p*S+c*g-h*f,e[7]=-c*f-h*g-p*y,e}function Vd(e,i){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=i[0]*.5,e[5]=i[1]*.5,e[6]=i[2]*.5,e[7]=0,e}function zd(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Bd(e,i){var r=as();ko(r,i);var c=new Lt(3);return Co(c,i),fh(e,r,c),e}function mh(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e}function Wd(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function Ud(e,i,r,c,h,p,f,g,y){return e[0]=i,e[1]=r,e[2]=c,e[3]=h,e[4]=p,e[5]=f,e[6]=g,e[7]=y,e}function Yd(e,i){return e[0]=i[4],e[1]=i[5],e[2]=i[6],e[3]=i[7],e}function Qd(e,i){return e[4]=i[0],e[5]=i[1],e[6]=i[2],e[7]=i[3],e}function Xd(e,i){var r=i[4],c=i[5],h=i[6],p=i[7],f=-i[0],g=-i[1],y=-i[2],S=i[3];return e[0]=(r*S+p*f+c*y-h*g)*2,e[1]=(c*S+p*g+h*f-r*y)*2,e[2]=(h*S+p*y+r*g-c*f)*2,e}function Zd(e,i,r){var c=i[0],h=i[1],p=i[2],f=i[3],g=r[0]*.5,y=r[1]*.5,S=r[2]*.5,u=i[4],x=i[5],w=i[6],M=i[7];return e[0]=c,e[1]=h,e[2]=p,e[3]=f,e[4]=f*g+h*S-p*y+u,e[5]=f*y+p*g-c*S+x,e[6]=f*S+c*y-h*g+w,e[7]=-c*g-h*y-p*S+M,e}function Jd(e,i,r){var c=-i[0],h=-i[1],p=-i[2],f=i[3],g=i[4],y=i[5],S=i[6],u=i[7],x=g*f+u*c+y*p-S*h,w=y*f+u*h+S*c-g*p,M=S*f+u*p+g*h-y*c,k=u*f-g*c-y*h-S*p;return Do(e,i,r),c=e[0],h=e[1],p=e[2],f=e[3],e[4]=x*f+k*c+w*p-M*h,e[5]=w*f+k*h+M*c-x*p,e[6]=M*f+k*p+x*h-w*c,e[7]=k*f-x*c-w*h-M*p,e}function $d(e,i,r){var c=-i[0],h=-i[1],p=-i[2],f=i[3],g=i[4],y=i[5],S=i[6],u=i[7],x=g*f+u*c+y*p-S*h,w=y*f+u*h+S*c-g*p,M=S*f+u*p+g*h-y*c,k=u*f-g*c-y*h-S*p;return Ao(e,i,r),c=e[0],h=e[1],p=e[2],f=e[3],e[4]=x*f+k*c+w*p-M*h,e[5]=w*f+k*h+M*c-x*p,e[6]=M*f+k*p+x*h-w*c,e[7]=k*f-x*c-w*h-M*p,e}function Kd(e,i,r){var c=-i[0],h=-i[1],p=-i[2],f=i[3],g=i[4],y=i[5],S=i[6],u=i[7],x=g*f+u*c+y*p-S*h,w=y*f+u*h+S*c-g*p,M=S*f+u*p+g*h-y*c,k=u*f-g*c-y*h-S*p;return Po(e,i,r),c=e[0],h=e[1],p=e[2],f=e[3],e[4]=x*f+k*c+w*p-M*h,e[5]=w*f+k*h+M*c-x*p,e[6]=M*f+k*p+x*h-w*c,e[7]=k*f-x*c-w*h-M*p,e}function tf(e,i,r){var c=r[0],h=r[1],p=r[2],f=r[3],g=i[0],y=i[1],S=i[2],u=i[3];return e[0]=g*f+u*c+y*p-S*h,e[1]=y*f+u*h+S*c-g*p,e[2]=S*f+u*p+g*h-y*c,e[3]=u*f-g*c-y*h-S*p,g=i[4],y=i[5],S=i[6],u=i[7],e[4]=g*f+u*c+y*p-S*h,e[5]=y*f+u*h+S*c-g*p,e[6]=S*f+u*p+g*h-y*c,e[7]=u*f-g*c-y*h-S*p,e}function ef(e,i,r){var c=i[0],h=i[1],p=i[2],f=i[3],g=r[0],y=r[1],S=r[2],u=r[3];return e[0]=c*u+f*g+h*S-p*y,e[1]=h*u+f*y+p*g-c*S,e[2]=p*u+f*S+c*y-h*g,e[3]=f*u-c*g-h*y-p*S,g=r[4],y=r[5],S=r[6],u=r[7],e[4]=c*u+f*g+h*S-p*y,e[5]=h*u+f*y+p*g-c*S,e[6]=p*u+f*S+c*y-h*g,e[7]=f*u-c*g-h*y-p*S,e}function nf(e,i,r,c){if(Math.abs(c)<Tt)return mh(e,i);var h=Math.hypot(r[0],r[1],r[2]);c=c*.5;var p=Math.sin(c),f=p*r[0]/h,g=p*r[1]/h,y=p*r[2]/h,S=Math.cos(c),u=i[0],x=i[1],w=i[2],M=i[3];e[0]=u*S+M*f+x*y-w*g,e[1]=x*S+M*g+w*f-u*y,e[2]=w*S+M*y+u*g-x*f,e[3]=M*S-u*f-x*g-w*y;var k=i[4],b=i[5],T=i[6],m=i[7];return e[4]=k*S+m*f+b*y-T*g,e[5]=b*S+m*g+T*f-k*y,e[6]=T*S+m*y+k*g-b*f,e[7]=m*S-k*f-b*g-T*y,e}function sf(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e}function gh(e,i,r){var c=i[0],h=i[1],p=i[2],f=i[3],g=r[4],y=r[5],S=r[6],u=r[7],x=i[4],w=i[5],M=i[6],k=i[7],b=r[0],T=r[1],m=r[2],v=r[3];return e[0]=c*v+f*b+h*m-p*T,e[1]=h*v+f*T+p*b-c*m,e[2]=p*v+f*m+c*T-h*b,e[3]=f*v-c*b-h*T-p*m,e[4]=c*u+f*g+h*S-p*y+x*v+k*b+w*m-M*T,e[5]=h*u+f*y+p*g-c*S+w*v+k*T+M*b-x*m,e[6]=p*u+f*S+c*y-h*g+M*v+k*m+x*T-w*b,e[7]=f*u-c*g-h*y-p*S+k*v-x*b-w*T-M*m,e}function of(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e}function af(e,i,r,c){var h=1-c;return vh(i,r)<0&&(c=-c),e[0]=i[0]*h+r[0]*c,e[1]=i[1]*h+r[1]*c,e[2]=i[2]*h+r[2]*c,e[3]=i[3]*h+r[3]*c,e[4]=i[4]*h+r[4]*c,e[5]=i[5]*h+r[5]*c,e[6]=i[6]*h+r[6]*c,e[7]=i[7]*h+r[7]*c,e}function cf(e,i){var r=Ir(i);return e[0]=-i[0]/r,e[1]=-i[1]/r,e[2]=-i[2]/r,e[3]=i[3]/r,e[4]=-i[4]/r,e[5]=-i[5]/r,e[6]=-i[6]/r,e[7]=i[7]/r,e}function hf(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=i[3],e[4]=-i[4],e[5]=-i[5],e[6]=-i[6],e[7]=i[7],e}function pf(e,i){var r=Ir(i);if(r>0){r=Math.sqrt(r);var c=i[0]/r,h=i[1]/r,p=i[2]/r,f=i[3]/r,g=i[4],y=i[5],S=i[6],u=i[7],x=c*g+h*y+p*S+f*u;e[0]=c,e[1]=h,e[2]=p,e[3]=f,e[4]=(g-c*x)/r,e[5]=(y-h*x)/r,e[6]=(S-p*x)/r,e[7]=(u-f*x)/r}return e}function df(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function ff(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]}function mf(e,i){var r=e[0],c=e[1],h=e[2],p=e[3],f=e[4],g=e[5],y=e[6],S=e[7],u=i[0],x=i[1],w=i[2],M=i[3],k=i[4],b=i[5],T=i[6],m=i[7];return Math.abs(r-u)<=Tt*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(c-x)<=Tt*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-w)<=Tt*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-M)<=Tt*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(f-k)<=Tt*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(g-b)<=Tt*Math.max(1,Math.abs(g),Math.abs(b))&&Math.abs(y-T)<=Tt*Math.max(1,Math.abs(y),Math.abs(T))&&Math.abs(S-m)<=Tt*Math.max(1,Math.abs(S),Math.abs(m))}var Gd,Hd,rf,vh,_h,lf,Ir,uf,yh=He(()=>{Jn();jo();Mo();Gd=Er;Hd=Er;rf=gh;vh=Rr;_h=Dr,lf=_h,Ir=Ar,uf=Ir});var hs=He(()=>{Mo();jo();yh();Ro()});var bh={};is(bh);var xh=He(()=>{hs();WL.registerComponent("cursor",{collisionGroup:{type:WL.Type.Int,default:1},cursorRayObject:{type:WL.Type.Object},cursorRayScalingAxis:{type:WL.Type.Enum,values:["x","y","z","none"],default:"z"},cursorObject:{type:WL.Type.Object},handedness:{type:WL.Type.Enum,values:["input component","left","right","none"],default:"input component"},rayCastMode:{type:WL.Type.Enum,values:["collision","physx"],default:"collision"},styleCursor:{type:WL.Type.Bool,default:!0}},{init:function(){this.session=null,this.collisionMask=1<<this.collisionGroup,this.maxDistance=100;let e=this.onDestroy.bind(this);WL.onSceneLoaded.push(e),this.onDestroyCallbacks=[()=>{let i=WL.onSceneLoaded.indexOf(e);i>=0&&WL.onSceneLoaded.splice(i,1)}]},start:function(){if(this.handedness==0){let i=this.object.getComponent("input");i?(this.handedness=i.handedness,this.input=i):console.warn("cursor component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right"][this.handedness-1];if(this.globalTarget=this.object.addComponent("cursor-target"),this.origin=new Float32Array(3),this.cursorObjScale=new Float32Array(3),this.direction=[0,0,0],this.tempQuat=new Float32Array(4),this.viewComponent=this.object.getComponent("view"),this.viewComponent!=null){let i=this.onClick.bind(this);WL.canvas.addEventListener("click",i);let r=this.onPointerMove.bind(this);WL.canvas.addEventListener("pointermove",r);let c=this.onPointerDown.bind(this);WL.canvas.addEventListener("pointerdown",c);let h=this.onPointerUp.bind(this);WL.canvas.addEventListener("pointerup",h),this.projectionMatrix=new Float32Array(16),rs.invert(this.projectionMatrix,this.viewComponent.projectionMatrix);let p=this.onViewportResize.bind(this);window.addEventListener("resize",p),this.onDestroyCallbacks.push(()=>{WL.canvas.removeEventListener("click",i),WL.canvas.removeEventListener("pointermove",r),WL.canvas.removeEventListener("pointerdown",c),WL.canvas.removeEventListener("pointerup",h),window.removeEventListener("resize",p)})}this.isHovering=!1,this.visible=!0,this.isDown=!1,this.lastIsDown=!1,this.cursorPos=new Float32Array(3),this.hoveringObject=null;let e=this.setupVREvents.bind(this);WL.onXRSessionStart.push(e),this.onDestroyCallbacks.push(()=>{let i=WL.onXRSessionStart.indexOf(e);i>=0&&WL.onXRSessionStart.splice(i,1)}),this.cursorRayObject&&(this.cursorRayScale=new Float32Array(3),this.cursorRayScale.set(this.cursorRayObject.scalingLocal),this.object.getTranslationWorld(this.origin),this.object.getForward(this.direction),this._setCursorRayTransform([this.origin[0]+this.direction[0],this.origin[1]+this.direction[1],this.origin[2]+this.direction[2]]))},onViewportResize:function(){!this.viewComponent||rs.invert(this.projectionMatrix,this.viewComponent.projectionMatrix)},_setCursorRayTransform:function(e){if(!this.cursorRayObject)return;let i=Ae.dist(this.origin,e);this.cursorRayObject.setTranslationLocal([0,0,-i/2]),this.cursorRayScalingAxis!=4&&(this.cursorRayObject.resetScaling(),this.cursorRayScale[this.cursorRayScalingAxis]=i/2,this.cursorRayObject.scale(this.cursorRayScale))},_setCursorVisibility:function(e){this.visible!=e&&(this.visible=e,!!this.cursorObject&&(e?(this.cursorObject.resetScaling(),this.cursorObject.scale(this.cursorObjScale)):(this.cursorObjScale.set(this.cursorObject.scalingLocal),this.cursorObject.scale([0,0,0]))))},update:function(){this.doUpdate(!1)},doUpdate:function(e){if(this.session){if(this.arTouchDown&&this.input&&WL.xrSession.inputSources[0].handedness==="none"&&WL.xrSession.inputSources[0].gamepad){let r=WL.xrSession.inputSources[0].gamepad.axes;this.direction=[r[0],-r[1],-1],this.updateDirection()}else this.object.getTranslationWorld(this.origin),this.object.getForward(this.direction);let i=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(this.origin,this.direction,this.collisionMask):WL.physics.rayCast(this.origin,this.direction,this.collisionMask,this.maxDistance);i.hitCount>0?this.cursorPos.set(i.locations[0]):this.cursorPos.fill(0),this.hoverBehaviour(i,e)}this.cursorObject&&(this.hoveringObject&&(this.cursorPos[0]!=0||this.cursorPos[1]!=0||this.cursorPos[2]!=0)?(this._setCursorVisibility(!0),this.cursorObject.setTranslationWorld(this.cursorPos),this._setCursorRayTransform(this.cursorPos)):this._setCursorVisibility(!1))},hoverBehaviour:function(e,i){if(e.hitCount>0){if(!this.hoveringObject||!this.hoveringObject.equals(e.objects[0])){if(this.hoveringObject){let h=this.hoveringObject.getComponent("cursor-target");h&&h.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this)}this.hoveringObject=e.objects[0],this.styleCursor&&(WL.canvas.style.cursor="pointer");let c=this.hoveringObject.getComponent("cursor-target");c&&(this.hoveringObjectTarget=c,c.onHover(this.hoveringObject,this)),this.globalTarget.onHover(this.hoveringObject,this)}this.hoveringObjectTarget&&this.hoveringObjectTarget.onMove(this.hoveringObject,this);let r=this.hoveringObject.getComponent("cursor-target");this.isDown!==this.lastIsDown&&(this.isDown?(r&&r.onDown(this.hoveringObject,this),this.globalTarget.onDown(this.hoveringObject,this)):(r&&r.onUp(this.hoveringObject,this),this.globalTarget.onUp(this.hoveringObject,this))),i&&(r&&r.onClick(this.hoveringObject,this),this.globalTarget.onClick(this.hoveringObject,this))}else if(this.hoveringObject&&e.hitCount==0){let r=this.hoveringObject.getComponent("cursor-target");r&&r.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this),this.hoveringObject=null,this.hoveringObjectTarget=null,this.styleCursor&&(WL.canvas.style.cursor="default")}this.lastIsDown=this.isDown},setupVREvents:function(e){this.session=e;let i=function(p){this.session=null}.bind(this);e.addEventListener("end",i);let r=this.onSelect.bind(this);e.addEventListener("select",r);let c=this.onSelectStart.bind(this);e.addEventListener("selectstart",c);let h=this.onSelectEnd.bind(this);e.addEventListener("selectend",h),this.onDestroyCallbacks.push(()=>{!this.session||(e.removeEventListener("end",i),e.removeEventListener("select",r),e.removeEventListener("selectstart",c),e.removeEventListener("selectend",h))}),this.onViewportResize()},onSelect:function(e){e.inputSource.handedness==this.handedness&&this.doUpdate(!0)},onSelectStart:function(e){this.arTouchDown=!0,e.inputSource.handedness==this.handedness&&(this.isDown=!0)},onSelectEnd:function(e){this.arTouchDown=!1,e.inputSource.handedness==this.handedness&&(this.isDown=!1)},onPointerMove:function(e){if(!e.isPrimary)return;let i=e.target.getBoundingClientRect(),r=this.updateMousePos(e.clientX,e.clientY,i.width,i.height);this.hoverBehaviour(r,!1)},onClick:function(e){let i=e.target.getBoundingClientRect(),r=this.updateMousePos(e.clientX,e.clientY,i.width,i.height);this.hoverBehaviour(r,!0)},onPointerDown:function(e){if(!e.isPrimary||e.button!==0)return;let i=e.target.getBoundingClientRect(),r=this.updateMousePos(e.clientX,e.clientY,i.width,i.height);this.isDown=!0,this.hoverBehaviour(r,!1)},onPointerUp:function(e){if(!e.isPrimary||e.button!==0)return;let i=e.target.getBoundingClientRect(),r=this.updateMousePos(e.clientX,e.clientY,i.width,i.height);this.isDown=!1,this.hoverBehaviour(r,!1)},updateMousePos:function(e,i,r,c){let h=e/r,p=i/c;return this.direction=[h*2-1,-p*2+1,-1],this.updateDirection()},updateDirection:function(){this.object.getTranslationWorld(this.origin),Ae.transformMat4(this.direction,this.direction,this.projectionMatrix),Ae.normalize(this.direction,this.direction),Ae.transformQuat(this.direction,this.direction,this.object.transformWorld);let e=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(this.origin,this.direction,this.collisionMask):WL.physics.rayCast(this.origin,this.direction,this.collisionMask,this.maxDistance);return e.hitCount>0?this.cursorPos.set(e.locations[0]):this.cursorPos.fill(0),e},onDeactivate:function(){if(this._setCursorVisibility(!1),this.hoveringObject){let e=this.hoveringObject.getComponent("cursor-target");e&&e.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this)}this.cursorRayObject&&this.cursorRayObject.scale([0,0,0])},onActivate:function(){this._setCursorVisibility(!0)},onDestroy:function(){for(let e of this.onDestroyCallbacks)e()}})});var wh=Zn(()=>{WL.registerComponent("cursor-target",{},{init:function(){this.hoverFunctions=[],this.unHoverFunctions=[],this.clickFunctions=[],this.moveFunctions=[],this.downFunctions=[],this.upFunctions=[]},onHover:function(e,i){for(let r of this.hoverFunctions)r(e,i)},onUnhover:function(e,i){for(let r of this.unHoverFunctions)r(e,i)},onClick:function(e,i){for(let r of this.clickFunctions)r(e,i)},onMove:function(e,i){for(let r of this.moveFunctions)r(e,i)},onDown:function(e,i){for(let r of this.downFunctions)r(e,i)},onUp:function(e,i){for(let r of this.upFunctions)r(e,i)},addHoverFunction:function(e){this._validateCallback(e),this.hoverFunctions.push(e)},removeHoverFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.hoverFunctions,e)},addUnHoverFunction:function(e){this._validateCallback(e),this.unHoverFunctions.push(e)},removeUnHoverFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.unHoverFunctions,e)},addClickFunction:function(e){this._validateCallback(e),this.clickFunctions.push(e)},removeClickFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.clickFunctions,e)},addMoveFunction:function(e){this._validateCallback(e),this.moveFunctions.push(e)},removeMoveFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.moveFunctions,e)},addDownFunction:function(e){this._validateCallback(e),this.downFunctions.push(e)},removeDownFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.downFunctions,e)},addUpFunction:function(e){this._validateCallback(e),this.upFunctions.push(e)},removeUpFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.upFunctions,e)},_removeItemOnce:function(e,i){var r=e.indexOf(i);return r>-1&&e.splice(r,1),e},_validateCallback:function(e){if(typeof e!="function")throw new TypeError(this.object.name+".cursor-target: Argument needs to be a function")}})});var Th={};is(Th);var Sh=He(()=>{hs();WL.registerComponent("wasd-controls",{speed:{type:WL.Type.Float,default:.1},headObject:{type:WL.Type.Object}},{init:function(){this.up=!1,this.right=!1,this.down=!1,this.left=!1,window.addEventListener("keydown",this.press.bind(this)),window.addEventListener("keyup",this.release.bind(this))},start:function(){this.headObject=this.headObject||this.object},update:function(){let e=[0,0,0];this.up&&(e[2]-=1),this.down&&(e[2]+=1),this.left&&(e[0]-=1),this.right&&(e[0]+=1),Ae.normalize(e,e),e[0]*=this.speed,e[2]*=this.speed,Ae.transformQuat(e,e,this.headObject.transformWorld),this.object.translate(e)},press:function(e){e.keyCode===38||e.keyCode===87||e.keyCode===90?this.up=!0:e.keyCode===39||e.keyCode===68?this.right=!0:e.keyCode===40||e.keyCode===83?this.down=!0:(e.keyCode===37||e.keyCode===65||e.keyCode===81)&&(this.left=!0)},release:function(e){e.keyCode===38||e.keyCode===87||e.keyCode===90?this.up=!1:e.keyCode===39||e.keyCode===68?this.right=!1:e.keyCode===40||e.keyCode===83?this.down=!1:(e.keyCode===37||e.keyCode===65||e.keyCode===81)&&(this.left=!1)}})});var Ch={};is(Ch);var kh=He(()=>{hs();WL.registerComponent("mouse-look",{sensitity:{type:WL.Type.Float,default:.25},requireMouseDown:{type:WL.Type.Bool,default:!0},mouseButtonIndex:{type:WL.Type.Int,default:0}},{init:function(){this.currentRotationY=0,this.currentRotationX=0,this.origin=new Float32Array(3),this.parentOrigin=new Float32Array(3),document.addEventListener("mousemove",function(e){this.active&&(this.mouseDown||!this.requireMouseDown)&&(this.rotationY=-this.sensitity*e.movementX/100,this.rotationX=-this.sensitity*e.movementY/100,this.currentRotationX+=this.rotationX,this.currentRotationY+=this.rotationY,this.currentRotationX=Math.min(1.507,this.currentRotationX),this.currentRotationX=Math.max(-1.507,this.currentRotationX),this.object.getTranslationWorld(this.origin),this.object.parent.getTranslationWorld(this.parentOrigin),Ae.sub(this.origin,this.origin,this.parentOrigin),this.object.resetTranslationRotation(),this.object.rotateAxisAngleRad([1,0,0],this.currentRotationX),this.object.rotateAxisAngleRad([0,1,0],this.currentRotationY),this.object.translate(this.origin))}.bind(this)),this.requireMouseDown&&(this.mouseButtonIndex==2&&WL.canvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),WL.canvas.addEventListener("mousedown",function(e){if(e.button==this.mouseButtonIndex&&(this.mouseDown=!0,document.body.style.cursor="grabbing",e.button==1))return e.preventDefault(),!1}.bind(this)),WL.canvas.addEventListener("mouseup",function(e){e.button==this.mouseButtonIndex&&(this.mouseDown=!1,document.body.style.cursor="initial")}.bind(this)))},start:function(){this.rotationX=0,this.rotationY=0}})});var Mh={};is(Mh);var Oh=He(()=>{hs();WL.registerComponent("hand-tracking",{handedness:{type:WL.Type.Enum,default:"left",values:["left","right"]},jointMesh:{type:WL.Type.Mesh,default:null},jointMaterial:{type:WL.Type.Material,default:null},handSkin:{type:WL.Type.Skin,default:null},deactivateChildrenWithoutPose:{type:WL.Type.Bool,default:!0},controllerToDeactivate:{type:WL.Type.Object}},{ORDERED_JOINTS:["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],init:function(){this.handedness=["left","right"][this.handedness]},start:function(){if(this.joints=[],this.session=null,this.hasPose=!1,this._childrenActive=!0,!("XRHand"in window)){console.warn("WebXR Hand Tracking not supported by this browser."),this.active=!1;return}if(this.handSkin){let i=this.handSkin.jointIds;this.joints[this.ORDERED_JOINTS[0]]=new WL.Object(i[0]);for(let r=0;r<i.length;++r){let c=new WL.Object(i[r]);this.joints[c.name]=c}return}for(let e=0;e<=this.ORDERED_JOINTS.length;++e){let i=WL.scene.addObject(this.object.parent),r=i.addComponent("mesh");r.mesh=this.jointMesh,r.material=this.jointMaterial,this.joints[this.ORDERED_JOINTS[e]]=i}},update:function(e){if(this.session||WL.xrSession&&this.setupVREvents(WL.xrSession),!!this.session){if(this.hasPose=!1,this.session&&this.session.inputSources)for(let i=0;i<=this.session.inputSources.length;++i){let r=this.session.inputSources[i];if(!r||!r.hand||r.handedness!=this.handedness)continue;if(this.hasPose=!0,r.hand.get("wrist")!==null){let p=Module.webxr_frame.getJointPose(r.hand.get("wrist"),WebXR.refSpaces[WebXR.refSpace]);p&&(this.object.resetTranslationRotation(),this.object.transformLocal.set([p.transform.orientation.x,p.transform.orientation.y,p.transform.orientation.z,p.transform.orientation.w]),this.object.translate([p.transform.position.x,p.transform.position.y,p.transform.position.z]))}let c=new Float32Array(3),h=new Float32Array(4);Pr.invert(h,this.object.transformLocal),this.object.getTranslationLocal(c);for(let p=0;p<this.ORDERED_JOINTS.length;++p){let f=this.ORDERED_JOINTS[p],g=this.joints[f];if(g==null)continue;let y=null;if(r.hand.get(f)!==null&&(y=Module.webxr_frame.getJointPose(r.hand.get(f),WebXR.refSpaces[WebXR.refSpace])),y!==null)if(this.handSkin)g.resetTranslationRotation(),g.translate([y.transform.position.x-c[0],y.transform.position.y-c[1],y.transform.position.z-c[2]]),g.rotate(h),g.rotateObject([y.transform.orientation.x,y.transform.orientation.y,y.transform.orientation.z,y.transform.orientation.w]);else{g.resetTransform(),g.transformLocal.set([y.transform.orientation.x,y.transform.orientation.y,y.transform.orientation.z,y.transform.orientation.w]),g.translate([y.transform.position.x,y.transform.position.y,y.transform.position.z]);let S=y.radius||.007;g.scale([S,S,S])}else this.handSkin||g.scale([0,0,0])}}!this.hasPose&&this._childrenActive?(this._childrenActive=!1,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!1),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!0,this.setChildrenActive(!0,this.controllerToDeactivate))):this.hasPose&&!this._childrenActive&&(this._childrenActive=!0,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!0),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!1,this.setChildrenActive(!1,this.controllerToDeactivate)))}},setChildrenActive:function(e,i){i=i||this.object;let r=i.children;for(let c of r)c.active=e,this.setChildrenActive(e,c)},isGrabbing:function(){let e=[0,0,0];cs.getTranslation(e,this.joints["index-finger-tip"].transformLocal);let i=[0,0,0];return cs.getTranslation(i,this.joints["thumb-tip"].transformLocal),Ae.sqrDist(i,e)<.001},setupVREvents:function(e){this.session=e}})});wc();Tc();Sc();kc();Ec();Dc();xh();wh();Sh();kh();Oh();})();
/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */
//# sourceMappingURL=canvas-ui-bundle.js.map
