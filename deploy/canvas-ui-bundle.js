(()=>{var nf=Object.create;var ao=Object.defineProperty;var sf=Object.getOwnPropertyDescriptor;var rf=Object.getOwnPropertyNames;var of=Object.getPrototypeOf,af=Object.prototype.hasOwnProperty;var un=t=>ao(t,"__esModule",{value:!0});var ma=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(n,i)=>(typeof require!="undefined"?require:n)[i]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var bn=(t,n)=>()=>(t&&(n=t(t=0)),n);var Ye=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports),cf=(t,n)=>{un(t);for(var i in n)ao(t,i,{get:n[i],enumerable:!0})},lf=(t,n,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of rf(n))!af.call(t,r)&&r!=="default"&&ao(t,r,{get:()=>n[r],enumerable:!(i=sf(n,r))||i.enumerable});return t},Pn=t=>lf(un(ao(t!=null?nf(of(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var Cl=Ye(()=>{WL.registerComponent("controller-teleport-component",{teleportIndicatorMeshObject:{type:WL.Type.Object,default:null},camRoot:{type:WL.Type.Object,default:null},cam:{type:WL.Type.Object,default:null},floorGroup:{type:WL.Type.Int,default:1},thumbstickActivationThreshhold:{type:WL.Type.Float,default:-.7},thumbstickDeactivationThreshhold:{type:WL.Type.Float,default:.3},indicatorYOffset:{type:WL.Type.Float,default:0},snapTurnAmount:{type:WL.Type.Float,default:.6}},{init:function(){if(this.thumbstickActivationThreshhold=-.7,this.prevThumbstickYAxisInput=0,this.prevThumbstickXAxisInput=0,this.input=this.object.getComponent("input"),this._tempVec=[0,0,0],this._camRotation=0,this._currentIndicatorRotation=0,!this.input){console.error(this.object.name,"controller-teleport-component.js: input component is required on the object.");return}this.teleportIndicatorMeshObject?(this.isIndicating=!1,this.indicatorHidden=!0,this.hitSpot=void 0):console.error(this.object.name,"controller-teleport-component.js: Teleport indicator mesh is missing.")},start:function(){WL.onXRSessionStart.push(this.setupVREvents.bind(this))},update:function(){let t=0,n=0,i=0;if(this.gamepadLeft&&this.gamepadLeft.axes&&(t=this.gamepadLeft.axes[2],n=this.gamepadLeft.axes[3],i=Math.abs(t)+Math.abs(n)),!this.isIndicating&&this.prevThumbstickYAxisInput>=this.thumbstickActivationThreshhold&&n<this.thumbstickActivationThreshhold?(this.isIndicating=!0,this.cam.getForward(this._tempVec),this._tempVec[1]=0,glMatrix.vec3.normalize(this._tempVec,this._tempVec),this._camRotation=Math.atan2(this._tempVec[0],this._tempVec[2])):this.isIndicating&&i<this.thumbstickDeactivationThreshhold&&(this.isIndicating=!1,this.teleportIndicatorMeshObject.translate([1e3,1e3,1e3]),this.hitSpot&&this.camRoot?(this.camRoot.resetTransform(),this.hitSpot[1]=0,this.cam.getForward(this._tempVec),this._tempVec[1]=0,glMatrix.vec3.normalize(this._tempVec,this._tempVec),this._camRotation=Math.atan2(this._tempVec[0],this._tempVec[2]),this._camRotation=this._currentIndicatorRotation-this._camRotation,this.camRoot.rotateAxisAngleRad([0,1,0],this._camRotation),this.camRoot.translate(this.hitSpot)):this.camRoot||console.error(this.object.name,"controller-teleport-component.js: Cam Root reference is missing.")),this.isIndicating&&this.teleportIndicatorMeshObject&&this.input){let r=[0,0,0];glMatrix.quat2.getTranslation(r,this.object.transformWorld);let c=this.object.transformWorld,u=[0,0,0];glMatrix.vec3.transformQuat(u,[0,0,-1],c);let p=WL.scene.rayCast(r,u,1<<this.floorGroup);p.hitCount>0?(this.indicatorHidden&&(this.indicatorHidden=!1),this._currentIndicatorRotation=this._camRotation+(Math.PI+Math.atan2(t,n)),this.teleportIndicatorMeshObject.resetTranslationRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(p.locations[0]),this.hitSpot=p.locations[0],this.indicatorYOffset&&(this.hitSpot[2]+=this.indicatorYOffset)):(this.indicatorHidden||(this.teleportIndicatorMeshObject.translate([1e3,1e3,1e3]),this.indicatorHidden=!0),this.hitSpot=void 0)}else Math.abs(this.prevThumbstickXAxisInput)<=Math.abs(this.thumbstickActivationThreshhold)&&Math.abs(t)>Math.abs(this.thumbstickActivationThreshhold)&&(this.camRoot.getTranslationWorld(this._tempVec),this._camRotation-=Math.sign(t)*this.snapTurnAmount,this.camRoot.resetTranslationRotation(),this.camRoot.rotateAxisAngleRad([0,1,0],this._camRotation),this.camRoot.translate(this._tempVec));this.prevThumbstickXAxisInput=t,this.prevThumbstickYAxisInput=n},setupVREvents:function(t){if(this.session=t,t.addEventListener("end",function(i){this.gamepad=null,this.session=null}.bind(this)),t.inputSources&&t.inputSources.length)for(var n=0;n<t.inputSources.length;n++){let i=t.inputSources[n];i.handedness=="right"?this.gamepadRight=i.gamepad:this.gamepadLeft=i.gamepad}t.addEventListener("inputsourceschange",function(i){if(i.added&&i.added.length)for(var r=0;r<i.added.length;r++){let c=i.added[r];c.handedness=="right"?this.gamepadRight=c.gamepad:this.gamepadLeft=c.gamepad}}.bind(this))}})});var kl=Ye(()=>{WL.registerComponent("drum",{networkObject:{type:WL.Type.Object}},{start:function(){this.networkComponent=this.networkObject.getComponent("peer-manager"),this.networkComponent.addNetworkDataRecievedCallback("drumPlay",this.playSound.bind(this)),this.sound=this.object.getComponent("howler-audio-source"),this.collision=this.object.getComponent("collision"),this.lastOverlaps=[],this.tempVec=new Float32Array(3),this.synth=new Tone.MembraneSynth().toDestination(),this.notes=["A","B","C","D","E","F","G"],this.amountOctaves=2,this.baseNum=1/(this.notes.length*this.amountOctaves)},playSound:function(t){t instanceof ArrayBuffer&&(t=new Float32Array(t));let n=Math.floor(t[1]/this.baseNum);n=Math.min(n,this.notes.length*this.amountOctaves);let i=n/this.notes.length,r=n%this.notes.length,c=this.notes[r]+""+i;this.synth.triggerAttackRelease(c,"2n")},update:function(t){if(this.overlaps=this.collision.queryOverlaps(),this.overlapNames=[],this.overlaps.length)for(let n=0;n<this.overlaps.length;n++){let i=this.overlaps[n].object.name;this.lastOverlaps.includes(i)||(this.overlaps[n].object.getTranslationWorld(this.tempVec),this.onEnter(this.tempVec)),this.overlapNames.push(i)}this.lastOverlaps=this.overlapNames},onEnter:function(t){this.playSound(t),this.networkComponent.sendPackage("drumPlay",t)},onLeave:function(){}})});var Ml=Ye(()=>{WL.registerComponent("network-buttons",{peerManagerObject:{type:WL.Type.Object},cursor:{type:WL.Type.Object},hostButton:{type:WL.Type.Object},joinButton:{type:WL.Type.Object}},{start:function(){this.pm=this.peerManagerObject.getComponent("peer-manager");for(let t of this.object.children)t.name=="HostButton"&&(this.hostButton=this.hostButton||t),t.name=="JoinButton"&&(this.joinButton=this.joinButton||t);this.hostButtonCollider=this.hostButton.getComponent("collision"),this.hostButton.getComponent("cursor-target").addClickFunction(this.pm.host.bind(this.pm)),this.joinButtonCollider=this.joinButton.getComponent("collision"),this.joinButton.getComponent("cursor-target").addClickFunction(this.pm.join.bind(this.pm)),this.pm.addConnectionEstablishedCallback(this.hide.bind(this)),this.pm.addDisconnectCallback(this.show.bind(this))},show:function(){this.cursor.getComponent("cursor").setEnabled&&this.cursor.getComponent("cursor").setEnabled(!0),this.hostButtonCollider.active=!0,this.joinButtonCollider.active=!0,this.object.setTranslationLocal([0,0,-3])},hide:function(){this.cursor.getComponent("cursor").setEnabled&&this.cursor.getComponent("cursor").setEnabled(!1),this.hostButtonCollider.active=!1,this.joinButtonCollider.active=!1,this.object.setTranslationLocal([0,-300,0])}})});var Ol=Ye(()=>{var Al=!1;WL.registerComponent("peer-manager",{serverId:{type:WL.Type.String,default:"THISISAWONDERLANDENGINEPLACEHOLDER"},networkSendFrequencyInS:{type:WL.Type.Float,default:.01},playerHead:{type:WL.Type.Object},playerRightHand:{type:WL.Type.Object},playerLeftHand:{type:WL.Type.Object},networkPlayerPool:{type:WL.Type.Object},voiceEnabled:{type:WL.Type.Bool,default:!0}},{init:function(){this.streams={},this.activePlayers={},this.currentDataPackage={},this.calls={},this.connections=[],this.currentTime=0,this.headDualQuat=new Float32Array(8),this.rightHandDualQuat=new Float32Array(8),this.leftHandDualQuat=new Float32Array(8),this.audio=document.createElement("AUDIO"),this.audio.id="localAudio",document.body.appendChild(this.audio),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(t=>{this.localStream=t}).catch(t=>console.error("User denied audio access.",t)),this.connectionEstablishedCallbacks=this.connectionEstablishedCallbacks||[],this.clientJoinedCallbacks=this.clientJoinedCallbacks||[],this.disconnectCallbacks=this.disconnectCallbacks||[],this.registeredNetworkCallbacks=this.registeredNetworkCallbacks||{}},start:function(){this.networkPlayerSpawner=this.networkPlayerPool.getComponent("peer-networked-player-pool")||this.networkPlayerPool.getComponent("peer-networked-player-spawner")},host:function(){this.peer=new Peer(this.serverId),this.peer.on("open",this._onHostOpen.bind(this)),this.peer.on("connection",this._onHostConnected.bind(this)),this.peer.on("disconnected",this._onDisconnected.bind(this)),this.peer.on("call",t=>{this.calls[t.peer]=t,t.answer(this.localStream),t.on("stream",n=>{let i=document.createElement("AUDIO");i.id="remoteAudio"+t.peer,document.body.appendChild(i),i.srcObject=n,i.autoplay=!0,this.streams[t.peer]=n})})},kick:function(t){this.currentDataPackage.disconnect=this.currentDataPackage.disconnect||[],this.currentDataPackage.disconnect.push(t),this._removePlayer(t)},_onHostOpen:function(t){Al=!0,this.serverId=t,this.activePlayers[this.serverId]={};for(let n of this.connectionEstablishedCallbacks)n()},_onHostConnected:function(t){this._hostPlayerJoined(t.peer,t.metadata.username),this.connections.push(t),t.on("open",()=>{t.send({joinedPlayers:Object.keys(this.activePlayers),joined:!0})}),t.on("close",()=>this._onHostConnectionClose(t)),t.on("data",n=>this._onHostDataRecieved(n,t)),this.object.setTranslationWorld([0,0,0])},_onHostDataRecieved:function(t,n){t.transforms&&this.activePlayers[n.peer]&&this.activePlayers[n.peer].setTransforms(t.transforms);for(let i of Object.keys(t))i!="transforms"&&this.registeredNetworkCallbacks[i]&&this.registeredNetworkCallbacks[i](t[i]);this.currentDataPackage[n.peer]=t},_onHostConnectionClose:function(t){this._removePlayer(t.peer),this.object.setTranslationWorld([0,-1,0]),this.disconnect(),this.currentDataPackage.disconnect=this.currentDataPackage.disconnect||[],this.currentDataPackage.disconnect.push(t.peer)},_hostPlayerJoined:function(t){let n=this.networkPlayerSpawner.getEntity();this.activePlayers[t]=n,this.currentDataPackage.joinedPlayers=this.currentDataPackage.joinedPlayers||[],this.currentDataPackage.joinedPlayers.push(t);for(let i of this.clientJoinedCallbacks)i(t,n)},join:function(){this.connect(this.serverId)},connect:function(t){if(!t)return console.error("peer-manager: Connection id parameter missing");this.peer||(this.peer=new Peer,this.peer.on("open",this._clientOnOpen.bind(this)),this.peer.on("disconnected",this._onDisconnected.bind(this)),this.connectionId=t,this.peer.on("call",n=>{!this.voiceEnabled||(this.calls[n.peer]=n,n.answer(this.localStream),n.on("stream",i=>{let r=document.createElement("AUDIO");r.id="remoteAudio"+t,document.body.appendChild(r),r.srcObject=i,r.autoplay=!0,this.streams[t]=i}))}))},disconnect:function(){!this.peer||(this.peer.destroy(),this.peer=null,this.connections=[],delete this.connection)},_onClientConnected:function(){this.call(this.serverId),Al=!1;for(let t of this.connectionEstablishedCallbacks)t()},_onClientDataRecieved:function(t){let n=Object.keys(this.registeredNetworkCallbacks),i="joined"in t;for(let r of Object.keys(t)){let c=t[r];if(r=="joinedPlayers"){for(let p=0;p<t.joinedPlayers.length;p++){let _=t.joinedPlayers[p];if(_==this.peer.id||this.activePlayers[_])continue;!i&&_!=this.serverId&&setTimeout(()=>{this.call(_)},Math.floor(500*p));let g=this.networkPlayerSpawner.getEntity();this.activePlayers[_]=g;for(let S of this.clientJoinedCallbacks)S(_,g)}continue}if(r=="call")continue;if(r=="disconnect")for(let p of c)this._removePlayer(p);if(this.activePlayers[r]){let p=Object.keys(c);for(let _ of p){if(_=="transforms"){this.activePlayers[r].setTransforms(c.transforms);continue}n.includes(_)&&this.registeredNetworkCallbacks[_](c[_])}continue}n.includes(r)&&this.registeredNetworkCallbacks[r](c)}},_removeAllPlayers:function(){let t=Object.keys(this.activePlayers);for(let n of t)this._removePlayer(n)},_removePlayer:function(t){if(!!this.activePlayers[t]){if(this.calls[t]&&(this.calls[t].close(),delete this.calls[t]),this.connections.length){let n=this.connections.find(i=>i.peer===t);if(n){n.close();let i=this.connections.indexOf(n);i>-1&&this.connections.splice(i,1)}}!this.activePlayers[t]||(Object.keys(this.activePlayers[t]).length!==0&&(this.activePlayers[t].reset(),this.networkPlayerSpawner.returnEntity(this.activePlayers[t])),delete this.activePlayers[t])}},_onDisconnected:function(t){this._removeAllPlayers(),this.disconnect();for(let n of this.disconnectCallbacks)n(t.peer)},call:function(t){if(!this.voiceEnabled)return;if(!this.localStream){console.error("Cannot call: no audio stream");return}let n=this.peer.call(t,this.localStream);this.calls[t]=n,n.on("stream",i=>{let r=document.createElement("AUDIO");r.id=t,document.body.appendChild(r),r.srcObject=i,r.autoplay=!0,this.streams[t]=i})},_clientOnOpen:function(){this.connection=this.peer.connect(this.connectionId,{metadata:{username:"TestName"}}),this.connection.on("open",this._onClientConnected.bind(this)),this.connection.on("data",this._onClientDataRecieved.bind(this)),this.connection.on("close",this._onClientClose.bind(this))},_onClientClose:function(){this.peer&&this.peer.destroy()},addConnectionEstablishedCallback:function(t){this.connectionEstablishedCallbacks=this.connectionEstablishedCallbacks||[],this.connectionEstablishedCallbacks.push(t)},removeConnectionEstablishedCallback:function(t){let n=this.connectionEstablishedCallbacks.indexOf(t);n<=-1||this.connectionEstablishedCallbacks.splice(n,1)},addClientJoinedCallback:function(t){this.clientJoinedCallbacks=this.clientJoinedCallbacks||[],this.clientJoinedCallbacks.push(t)},removeClientJoinedCallback:function(t){let n=this.clientJoinedCallbacks.indexOf(t);n<=-1||this.clientJoinedCallbacks.splice(n,1)},addDisconnectCallback:function(t){this.disconnectCallbacks=this.disconnectCallbacks||[],this.disconnectCallbacks.push(t)},removeDisconnectCallback:function(t){let n=this.disconnectCallbacks.indexOf(t);n<=-1||this.disconnectCallbacks.splice(n,1)},addNetworkDataRecievedCallback:function(t,n){this.registeredNetworkCallbacks=this.registeredNetworkCallbacks||{},this.registeredNetworkCallbacks[t]=n},removeNetworkDataRecievedCallback:function(t){delete this.registeredNetworkCallbacks[t]},sendPackage:function(t,n){this.currentDataPackage[t]=n},sendPackageImmediately:function(t,n){let i={};if(i[t]=n,this.connection){this.connection.send(i);return}for(let r of this.connections)r.send(i)},toggleMute:function(){this.localStream.getTracks()[0].enabled=!this.localStream.getTracks()[0].enabled},setOwnMute:function(t){this.localStream.getTracks()[0].enabled=!t},setOtherMute:function(t,n){this.streams[t]&&(this.streams[t].getTracks()[0].enabled=!n)},update:function(t){if(!(!this.connection&&this.connections.length==0)&&(this.currentTime+=t,!(this.currentTime<this.networkSendFrequencyInS))){if(this.currentTime=0,this.headDualQuat.set(this.playerHead.transformWorld),this.rightHandDualQuat.set(this.playerRightHand.transformWorld),this.leftHandDualQuat.set(this.playerLeftHand.transformWorld),this.connections.length){if(this.currentDataPackage[this.serverId]={transforms:{head:this.headDualQuat,rightHand:this.rightHandDualQuat,leftHand:this.leftHandDualQuat}},Object.keys(this.currentDataPackage).length==0)return;for(let n of this.connections){let i=n.peer,r=Object.fromEntries(Object.entries(this.currentDataPackage).filter(c=>c[0]!=i));Object.keys(r).length&&n.send(r)}}else this.currentDataPackage.transforms={head:this.headDualQuat,rightHand:this.rightHandDualQuat,leftHand:this.leftHandDualQuat},this.connection.send(this.currentDataPackage);this.currentDataPackage={}}}});WL.registerComponent("peer-networked-player-pool",{},{init:function(){this.inactivePool=[];for(let t of this.object.children)this.inactivePool.push(t.getComponent("peer-networked-player"))},getEntity:function(){if(this.inactivePool.length)return this.inactivePool.shift();console.error("peer-networked-player-pool: No more inactive entities")},returnEntity:function(t){this.inactivePool.push(t)}});WL.registerComponent("peer-networked-player",{nameTextObject:{type:WL.Type.Object}},{init:function(){for(let t of this.object.children)t.name=="Head"&&(this.head=t),t.name=="LeftHand"&&(this.leftHand=t),t.name=="RightHand"&&(this.rightHand=t)},setName:function(t){this.nameTextObject&&(this.nameTextObject.getComponent("text").text=t)},reset:function(){this.head.resetTranslationRotation(),this.rightHand.resetTranslationRotation(),this.leftHand.resetTranslationRotation()},setTransforms:function(t){this.head.transformLocal.set(new Float32Array(t.head)),this.head.setDirty(),this.rightHand.transformLocal.set(new Float32Array(t.rightHand)),this.rightHand.setDirty(),this.leftHand.transformLocal.set(new Float32Array(t.leftHand)),this.leftHand.setDirty()}});WL.registerComponent("peer-networked-player-spawner",{headMesh:{type:WL.Type.Mesh},headMaterial:{type:WL.Type.Material},leftHandMesh:{type:WL.Type.Mesh},leftHandMaterial:{type:WL.Type.Material},rightHandMesh:{type:WL.Type.Mesh},rightHandMaterial:{type:WL.Type.Material}},{init:function(){this.count=0},getEntity:function(){let t=WL.scene.addObject(1),n=WL.scene.addObjects(3,t);return n[0].name="Head",n[0].addComponent("mesh",{mesh:this.headMesh,material:this.headMaterial}),n[1].name="LeftHand",n[1].addComponent("mesh",{mesh:this.leftHandMesh,material:this.leftHandMaterial}),n[2].name="RightHand",n[2].addComponent("mesh",{mesh:this.rightHandMesh,material:this.rightHandMaterial}),t.name=`Player ${this.count++}`,t.addComponent("peer-networked-player")},returnEntity:function(t){console.log("returning:",t),t.children.forEach(n=>{n.active=!1}),t.active=!1}})});var Pl=Ye((Ws,_a)=>{(function(t,n){typeof Ws=="object"&&typeof _a=="object"?_a.exports=n():typeof define=="function"&&define.amd?define([],n):typeof Ws=="object"?Ws.Tone=n():t.Tone=n()})(typeof self!="undefined"?self:Ws,function(){return function(t){var n={};function i(r){if(n[r])return n[r].exports;var c=n[r]={i:r,l:!1,exports:{}};return t[r].call(c.exports,c,c.exports,i),c.l=!0,c.exports}return i.m=t,i.c=n,i.d=function(r,c,u){i.o(r,c)||Object.defineProperty(r,c,{enumerable:!0,get:u})},i.r=function(r){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},i.t=function(r,c){if(1&c&&(r=i(r)),8&c||4&c&&typeof r=="object"&&r&&r.__esModule)return r;var u=Object.create(null);if(i.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:r}),2&c&&typeof r!="string")for(var p in r)i.d(u,p,function(_){return r[_]}.bind(null,p));return u},i.n=function(r){var c=r&&r.__esModule?function(){return r.default}:function(){return r};return i.d(c,"a",c),c},i.o=function(r,c){return Object.prototype.hasOwnProperty.call(r,c)},i.p="",i(i.s=9)}([function(t,n,i){(function(r,c,u,p){"use strict";function _($){return $&&typeof $=="object"&&"default"in $?$:{default:$}}var g=_(c),S=_(u),o=_(p),h=function($,ce,re){return{endTime:ce,insertTime:re,type:"exponentialRampToValue",value:$}},f=function($,ce,re){return{endTime:ce,insertTime:re,type:"linearRampToValue",value:$}},v=function($,ce){return{startTime:ce,type:"setValue",value:$}},x=function($,ce,re){return{duration:re,startTime:ce,type:"setValueCurve",values:$}},T=function($,ce,re){var qe=re.startTime,he=re.target,pe=re.timeConstant;return he+(ce-he)*Math.exp((qe-$)/pe)},w=function($){return $.type==="exponentialRampToValue"},y=function($){return $.type==="linearRampToValue"},C=function($){return w($)||y($)},m=function($){return $.type==="setValue"},M=function($){return $.type==="setValueCurve"},R=function $(ce,re,qe,he){var pe=ce[re];return pe===void 0?he:C(pe)||m(pe)?pe.value:M(pe)?pe.values[pe.values.length-1]:T(qe,$(ce,re-1,pe.startTime,he),pe)},I=function($,ce,re,qe,he){return re===void 0?[qe.insertTime,he]:C(re)?[re.endTime,re.value]:m(re)?[re.startTime,re.value]:M(re)?[re.startTime+re.duration,re.values[re.values.length-1]]:[re.startTime,R($,ce-1,re.startTime,he)]},L=function($){return $.type==="cancelAndHold"},q=function($){return $.type==="cancelScheduledValues"},z=function($){return L($)||q($)?$.cancelTime:w($)||y($)?$.endTime:$.startTime},U=function($,ce,re,qe){var he=qe.endTime,pe=qe.value;return re===pe?pe:0<re&&0<pe||re<0&&pe<0?re*Math.pow(pe/re,($-ce)/(he-ce)):0},H=function($,ce,re,qe){return re+($-ce)/(qe.endTime-ce)*(qe.value-re)},ee=function($,ce){var re=ce.duration,qe=ce.startTime,he=ce.values;return function(pe,He){var ot=Math.floor(He),_t=Math.ceil(He);return ot===_t?pe[ot]:(1-(He-ot))*pe[ot]+(1-(_t-He))*pe[_t]}(he,($-qe)/re*(he.length-1))},ie=function($){return $.type==="setTarget"},ae=function(){function $(ce){S.default(this,$),this._automationEvents=[],this._currenTime=0,this._defaultValue=ce}return o.default($,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(ce){var re=z(ce);if(L(ce)||q(ce)){var qe=this._automationEvents.findIndex(function(Yt){return q(ce)&&M(Yt)?Yt.startTime+Yt.duration>=re:z(Yt)>=re}),he=this._automationEvents[qe];if(qe!==-1&&(this._automationEvents=this._automationEvents.slice(0,qe)),L(ce)){var pe=this._automationEvents[this._automationEvents.length-1];if(he!==void 0&&C(he)){if(ie(pe))throw new Error("The internal list is malformed.");var He=M(pe)?pe.startTime+pe.duration:z(pe),ot=M(pe)?pe.values[pe.values.length-1]:pe.value,_t=w(he)?U(re,He,ot,he):H(re,He,ot,he),lt=w(he)?h(_t,re,this._currenTime):f(_t,re,this._currenTime);this._automationEvents.push(lt)}pe!==void 0&&ie(pe)&&this._automationEvents.push(v(this.getValue(re),re)),pe!==void 0&&M(pe)&&pe.startTime+pe.duration>re&&(this._automationEvents[this._automationEvents.length-1]=x(new Float32Array([6,7]),pe.startTime,re-pe.startTime))}}else{var kt=this._automationEvents.findIndex(function(Yt){return z(Yt)>re}),Mt=kt===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[kt-1];if(Mt!==void 0&&M(Mt)&&z(Mt)+Mt.duration>re)return!1;var At=w(ce)?h(ce.value,ce.endTime,this._currenTime):y(ce)?f(ce.value,re,this._currenTime):ce;if(kt===-1)this._automationEvents.push(At);else{if(M(ce)&&re+ce.duration>z(this._automationEvents[kt]))return!1;this._automationEvents.splice(kt,0,At)}}return!0}},{key:"flush",value:function(ce){var re=this._automationEvents.findIndex(function(pe){return z(pe)>ce});if(re>1){var qe=this._automationEvents.slice(re-1),he=qe[0];ie(he)&&qe.unshift(v(R(this._automationEvents,re-2,he.startTime,this._defaultValue),he.startTime)),this._automationEvents=qe}}},{key:"getValue",value:function(ce){if(this._automationEvents.length===0)return this._defaultValue;var re=this._automationEvents[this._automationEvents.length-1],qe=this._automationEvents.findIndex(function(Ln){return z(Ln)>ce}),he=this._automationEvents[qe],pe=z(re)<=ce?re:this._automationEvents[qe-1];if(pe!==void 0&&ie(pe)&&(he===void 0||!C(he)||he.insertTime>ce))return T(ce,R(this._automationEvents,qe-2,pe.startTime,this._defaultValue),pe);if(pe!==void 0&&m(pe)&&(he===void 0||!C(he)))return pe.value;if(pe!==void 0&&M(pe)&&(he===void 0||!C(he)||pe.startTime+pe.duration>ce))return ce<pe.startTime+pe.duration?ee(ce,pe):pe.values[pe.values.length-1];if(pe!==void 0&&C(pe)&&(he===void 0||!C(he)))return pe.value;if(he!==void 0&&w(he)){var He=I(this._automationEvents,qe-1,pe,he,this._defaultValue),ot=g.default(He,2),_t=ot[0],lt=ot[1];return U(ce,_t,lt,he)}if(he!==void 0&&y(he)){var kt=I(this._automationEvents,qe-1,pe,he,this._defaultValue),Mt=g.default(kt,2),At=Mt[0],Yt=Mt[1];return H(ce,At,Yt,he)}return this._defaultValue}}]),$}();r.AutomationEventList=ae,r.createCancelAndHoldAutomationEvent=function($){return{cancelTime:$,type:"cancelAndHold"}},r.createCancelScheduledValuesAutomationEvent=function($){return{cancelTime:$,type:"cancelScheduledValues"}},r.createExponentialRampToValueAutomationEvent=function($,ce){return{endTime:ce,type:"exponentialRampToValue",value:$}},r.createLinearRampToValueAutomationEvent=function($,ce){return{endTime:ce,type:"linearRampToValue",value:$}},r.createSetTargetAutomationEvent=function($,ce,re){return{startTime:ce,target:$,timeConstant:re,type:"setTarget"}},r.createSetValueAutomationEvent=v,r.createSetValueCurveAutomationEvent=x,Object.defineProperty(r,"__esModule",{value:!0})})(n,i(1),i(7),i(8))},function(t,n,i){var r=i(2),c=i(3),u=i(4),p=i(6);t.exports=function(_,g){return r(_)||c(_,g)||u(_,g)||p()}},function(t,n){t.exports=function(i){if(Array.isArray(i))return i}},function(t,n){t.exports=function(i,r){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(i)){var c=[],u=!0,p=!1,_=void 0;try{for(var g,S=i[Symbol.iterator]();!(u=(g=S.next()).done)&&(c.push(g.value),!r||c.length!==r);u=!0);}catch(o){p=!0,_=o}finally{try{u||S.return==null||S.return()}finally{if(p)throw _}}return c}}},function(t,n,i){var r=i(5);t.exports=function(c,u){if(c){if(typeof c=="string")return r(c,u);var p=Object.prototype.toString.call(c).slice(8,-1);return p==="Object"&&c.constructor&&(p=c.constructor.name),p==="Map"||p==="Set"?Array.from(c):p==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(p)?r(c,u):void 0}}},function(t,n){t.exports=function(i,r){(r==null||r>i.length)&&(r=i.length);for(var c=0,u=new Array(r);c<r;c++)u[c]=i[c];return u}},function(t,n){t.exports=function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}},function(t,n){t.exports=function(i,r){if(!(i instanceof r))throw new TypeError("Cannot call a class as a function")}},function(t,n){function i(r,c){for(var u=0;u<c.length;u++){var p=c[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(r,p.key,p)}}t.exports=function(r,c,u){return c&&i(r.prototype,c),u&&i(r,u),r}},function(t,n,i){"use strict";i.r(n),i.d(n,"getContext",function(){return tt}),i.d(n,"setContext",function(){return ur}),i.d(n,"Clock",function(){return yi}),i.d(n,"Context",function(){return Vi}),i.d(n,"BaseContext",function(){return na}),i.d(n,"Delay",function(){return Ut}),i.d(n,"Gain",function(){return me}),i.d(n,"Offline",function(){return xp}),i.d(n,"OfflineContext",function(){return Ni}),i.d(n,"Param",function(){return Me}),i.d(n,"ToneAudioBuffer",function(){return Ne}),i.d(n,"ToneAudioBuffers",function(){return Hi}),i.d(n,"ToneAudioNode",function(){return oe}),i.d(n,"connectSeries",function(){return $t}),i.d(n,"connect",function(){return zt}),i.d(n,"disconnect",function(){return ra}),i.d(n,"FrequencyClass",function(){return Vt}),i.d(n,"Frequency",function(){return bp}),i.d(n,"MidiClass",function(){return Gi}),i.d(n,"Midi",function(){return Tp}),i.d(n,"TimeClass",function(){return Jt}),i.d(n,"Time",function(){return gp}),i.d(n,"TicksClass",function(){return $e}),i.d(n,"Ticks",function(){return Sp}),i.d(n,"TransportTimeClass",function(){return vt}),i.d(n,"TransportTime",function(){return wp}),i.d(n,"Emitter",function(){return qi}),i.d(n,"IntervalTimeline",function(){return cl}),i.d(n,"StateTimeline",function(){return zi}),i.d(n,"Timeline",function(){return vn}),i.d(n,"isUndef",function(){return Bt}),i.d(n,"isDefined",function(){return Pe}),i.d(n,"isFunction",function(){return el}),i.d(n,"isNumber",function(){return Zt}),i.d(n,"isObject",function(){return Vn}),i.d(n,"isBoolean",function(){return ea}),i.d(n,"isArray",function(){return Pt}),i.d(n,"isString",function(){return rn}),i.d(n,"isNote",function(){return As}),i.d(n,"dbToGain",function(){return Wi}),i.d(n,"gainToDb",function(){return Rs}),i.d(n,"intervalToFrequencyRatio",function(){return Bi}),i.d(n,"ftom",function(){return ii}),i.d(n,"mtof",function(){return ia}),i.d(n,"optionsFromArguments",function(){return W}),i.d(n,"defaultArg",function(){return an}),i.d(n,"Unit",function(){return c}),i.d(n,"debug",function(){return r}),i.d(n,"Noise",function(){return zn}),i.d(n,"UserMedia",function(){return Yi}),i.d(n,"Oscillator",function(){return nt}),i.d(n,"AMOscillator",function(){return Qi}),i.d(n,"FMOscillator",function(){return wi}),i.d(n,"PulseOscillator",function(){return xi}),i.d(n,"FatOscillator",function(){return Zi}),i.d(n,"PWMOscillator",function(){return Ji}),i.d(n,"OmniOscillator",function(){return Mn}),i.d(n,"ToneOscillatorNode",function(){return Xi}),i.d(n,"LFO",function(){return Ft}),i.d(n,"ToneBufferSource",function(){return Bn}),i.d(n,"Player",function(){return Si}),i.d(n,"Players",function(){return vr}),i.d(n,"GrainPlayer",function(){return yr}),i.d(n,"Add",function(){return Ti}),i.d(n,"Abs",function(){return dl}),i.d(n,"AudioToGain",function(){return _r}),i.d(n,"GainToAudio",function(){return pl}),i.d(n,"GreaterThan",function(){return Is}),i.d(n,"GreaterThanZero",function(){return br}),i.d(n,"Multiply",function(){return it}),i.d(n,"Negate",function(){return aa}),i.d(n,"Pow",function(){return $i}),i.d(n,"Signal",function(){return Se}),i.d(n,"connectSignal",function(){return Ps}),i.d(n,"Scale",function(){return An}),i.d(n,"ScaleExp",function(){return js}),i.d(n,"Subtract",function(){return Ci}),i.d(n,"SyncedSignal",function(){return Ap}),i.d(n,"WaveShaper",function(){return cn}),i.d(n,"Zero",function(){return gr}),i.d(n,"AMSynth",function(){return ca}),i.d(n,"DuoSynth",function(){return xr}),i.d(n,"FMSynth",function(){return Tr}),i.d(n,"MetalSynth",function(){return Sr}),i.d(n,"MembraneSynth",function(){return is}),i.d(n,"MonoSynth",function(){return ri}),i.d(n,"NoiseSynth",function(){return Cr}),i.d(n,"PluckSynth",function(){return kr}),i.d(n,"PolySynth",function(){return Mr}),i.d(n,"Sampler",function(){return as}),i.d(n,"Synth",function(){return Gn}),i.d(n,"Loop",function(){return cs}),i.d(n,"Part",function(){return ls}),i.d(n,"Pattern",function(){return Ar}),i.d(n,"Sequence",function(){return Or}),i.d(n,"ToneEvent",function(){return yn}),i.d(n,"AutoFilter",function(){return Er}),i.d(n,"AutoPanner",function(){return Pr}),i.d(n,"AutoWah",function(){return Dr}),i.d(n,"BitCrusher",function(){return Ir}),i.d(n,"Chebyshev",function(){return Lr}),i.d(n,"Chorus",function(){return Fr}),i.d(n,"Distortion",function(){return qr}),i.d(n,"FeedbackDelay",function(){return Nr}),i.d(n,"FrequencyShifter",function(){return Wr}),i.d(n,"Freeverb",function(){return Br}),i.d(n,"JCReverb",function(){return zr}),i.d(n,"PingPongDelay",function(){return Ur}),i.d(n,"PitchShift",function(){return Hr}),i.d(n,"Phaser",function(){return Gr}),i.d(n,"Reverb",function(){return Yr}),i.d(n,"StereoWidener",function(){return Xr}),i.d(n,"Tremolo",function(){return Qr}),i.d(n,"Vibrato",function(){return Zr}),i.d(n,"Analyser",function(){return ps}),i.d(n,"Meter",function(){return Jr}),i.d(n,"FFT",function(){return $r}),i.d(n,"DCMeter",function(){return pa}),i.d(n,"Waveform",function(){return Kr}),i.d(n,"Follower",function(){return ds}),i.d(n,"Channel",function(){return ci}),i.d(n,"CrossFade",function(){return ki}),i.d(n,"Merge",function(){return Yn}),i.d(n,"MidSideMerge",function(){return qs}),i.d(n,"MidSideSplit",function(){return Fs}),i.d(n,"Mono",function(){return fa}),i.d(n,"MultibandSplit",function(){return fs}),i.d(n,"Panner",function(){return hs}),i.d(n,"Panner3D",function(){return eo}),i.d(n,"PanVol",function(){return Vs}),i.d(n,"Recorder",function(){return Ns}),i.d(n,"Solo",function(){return dt}),i.d(n,"Split",function(){return oi}),i.d(n,"Volume",function(){return kn}),i.d(n,"Compressor",function(){return Rn}),i.d(n,"Gate",function(){return to}),i.d(n,"Limiter",function(){return no}),i.d(n,"MidSideCompressor",function(){return io}),i.d(n,"MultibandCompressor",function(){return so}),i.d(n,"AmplitudeEnvelope",function(){return Ki}),i.d(n,"Envelope",function(){return Ct}),i.d(n,"FrequencyEnvelope",function(){return ns}),i.d(n,"EQ3",function(){return ro}),i.d(n,"Filter",function(){return Ht}),i.d(n,"OnePoleFilter",function(){return rs}),i.d(n,"FeedbackCombFilter",function(){return ss}),i.d(n,"LowpassCombFilter",function(){return os}),i.d(n,"Convolver",function(){return oo}),i.d(n,"BiquadFilter",function(){return ts}),i.d(n,"version",function(){return u}),i.d(n,"start",function(){return _p}),i.d(n,"supported",function(){return hp}),i.d(n,"now",function(){return qp}),i.d(n,"immediate",function(){return Vp}),i.d(n,"Transport",function(){return Np}),i.d(n,"getTransport",function(){return Wp}),i.d(n,"Destination",function(){return Bp}),i.d(n,"Master",function(){return zp}),i.d(n,"getDestination",function(){return Up}),i.d(n,"Listener",function(){return Hp}),i.d(n,"getListener",function(){return Gp}),i.d(n,"Draw",function(){return Yp}),i.d(n,"getDraw",function(){return Xp}),i.d(n,"context",function(){return Qp}),i.d(n,"loaded",function(){return Zp}),i.d(n,"Buffer",function(){return Jp}),i.d(n,"Buffers",function(){return $p}),i.d(n,"BufferSource",function(){return Kp});var r={};i.r(r),i.d(r,"assert",function(){return _e}),i.d(r,"assertRange",function(){return Et}),i.d(r,"assertContextRunning",function(){return $o}),i.d(r,"setLogger",function(){return dp}),i.d(r,"log",function(){return Kc}),i.d(r,"warn",function(){return Ms});var c={};i.r(c);let u="14.7.77";var p=i(0);let _=new WeakSet,g=new WeakMap,S=new WeakMap,o=new WeakMap,h=new WeakMap,f=new WeakMap,v=new WeakMap,x=new WeakMap,T=new WeakMap,w=new WeakMap,y={construct:()=>y},C=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,m=(l,e)=>{let s=[],a=l.replace(/^[\s]+/,""),d=a.match(C);for(;d!==null;){let b=d[1].slice(1,-1),k=d[0].replace(/([\s]+)?;?$/,"").replace(b,new URL(b,e).toString());s.push(k),a=a.slice(d[0].length).replace(/^[\s]+/,""),d=a.match(C)}return[s.join(";"),a]},M=l=>{if(l!==void 0&&!Array.isArray(l))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},R=l=>{if(!(e=>{try{new new Proxy(e,y)}catch{return!1}return!0})(l))throw new TypeError("The given value for processorCtor should be a constructor.");if(l.prototype===null||typeof l.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},I=(l,e)=>{let s=l.get(e);if(s===void 0)throw new Error("A value with the given key could not be found.");return s},L=(l,e)=>{let s=Array.from(l).filter(e);if(s.length>1)throw Error("More than one element was found.");if(s.length===0)throw Error("No element was found.");let[a]=s;return l.delete(a),a},q=(l,e,s,a)=>{let d=I(l,e),b=L(d,k=>k[0]===s&&k[1]===a);return d.size===0&&l.delete(e),b},z=l=>I(v,l),U=l=>{if(_.has(l))throw new Error("The AudioNode is already stored.");_.add(l),z(l).forEach(e=>e(!0))},H=l=>"port"in l,ee=l=>{if(!_.has(l))throw new Error("The AudioNode is not stored.");_.delete(l),z(l).forEach(e=>e(!1))},ie=(l,e)=>{!H(l)&&e.every(s=>s.size===0)&&ee(l)},ae={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},$=(l,e)=>l.context===e,ce=l=>{try{l.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},re=()=>new DOMException("","IndexSizeError"),qe=l=>{var e;l.getChannelData=(e=l.getChannelData,s=>{try{return e.call(l,s)}catch(a){throw a.code===12?re():a}})},he={numberOfChannels:1},pe=-34028234663852886e22,He=-pe,ot=l=>_.has(l),_t={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},lt=l=>I(g,l),kt=l=>I(o,l),Mt=(l,e)=>{let{activeInputs:s}=lt(l);s.forEach(d=>d.forEach(([b])=>{e.includes(l)||Mt(b,[...e,l])}));let a=(d=>"playbackRate"in d)(l)?[l.playbackRate]:H(l)?Array.from(l.parameters.values()):(d=>"frequency"in d&&"gain"in d)(l)?[l.Q,l.detune,l.frequency,l.gain]:(d=>"offset"in d)(l)?[l.offset]:(d=>!("frequency"in d)&&"gain"in d)(l)?[l.gain]:(d=>"detune"in d&&"frequency"in d)(l)?[l.detune,l.frequency]:(d=>"pan"in d)(l)?[l.pan]:[];for(let d of a){let b=kt(d);b!==void 0&&b.activeInputs.forEach(([k])=>Mt(k,e))}ot(l)&&ee(l)},At=l=>{Mt(l.destination,[])},Yt=l=>l===void 0||typeof l=="number"||typeof l=="string"&&(l==="balanced"||l==="interactive"||l==="playback"),Ln=l=>"context"in l,$n=l=>Ln(l[0]),Tn=(l,e,s,a)=>{for(let d of l)if(s(d)){if(a)return!1;throw Error("The set contains at least one similar element.")}return l.add(e),!0},ys=(l,e,[s,a],d)=>{Tn(l,[e,s,a],b=>b[0]===e&&b[1]===s,d)},Fn=(l,[e,s,a],d)=>{let b=l.get(e);b===void 0?l.set(e,new Set([[s,a]])):Tn(b,[s,a],k=>k[0]===s,d)},Xt=l=>"inputs"in l,Kn=(l,e,s,a)=>{if(Xt(e)){let d=e.inputs[a];return l.connect(d,s,0),[d,s,0]}return l.connect(e,s,a),[e,s,a]},Ot=(l,e,s)=>{for(let a of l)if(a[0]===e&&a[1]===s)return l.delete(a),a;return null},Pi=(l,e)=>{if(!z(l).delete(e))throw new Error("Missing the expected event listener.")},bs=(l,e,s)=>{let a=I(l,e),d=L(a,b=>b[0]===s);return a.size===0&&l.delete(e),d},mi=(l,e,s,a)=>{Xt(e)?l.disconnect(e.inputs[a],s,0):l.disconnect(e,s,a)},Ze=l=>I(S,l),ws=l=>I(h,l),_i=l=>x.has(l),Ys=l=>!_.has(l),Na=l=>new Promise(e=>{let s=l.createScriptProcessor(256,1,1),a=l.createGain(),d=l.createBuffer(1,2,44100),b=d.getChannelData(0);b[0]=1,b[1]=1;let k=l.createBufferSource();k.buffer=d,k.loop=!0,k.connect(s).connect(l.destination),k.connect(a),k.disconnect(a),s.onaudioprocess=A=>{let O=A.inputBuffer.getChannelData(0);Array.prototype.some.call(O,E=>E===1)?e(!0):e(!1),k.stop(),s.onaudioprocess=null,k.disconnect(s),s.disconnect(l.destination)},k.start()}),Oo=(l,e)=>{let s=new Map;for(let a of l)for(let d of a){let b=s.get(d);s.set(d,b===void 0?1:b+1)}s.forEach((a,d)=>e(d,a))},Xs=l=>"context"in l,Bh=(l,e,s,a)=>{let{activeInputs:d,passiveInputs:b}=kt(e),{outputs:k}=lt(l),A=z(l),O=E=>{let j=Ze(l),P=ws(e);if(E){let F=bs(b,l,s);ys(d,l,F,!1),a||_i(l)||j.connect(P,s)}else{let F=((D,G,N)=>L(D,V=>V[0]===G&&V[1]===N))(d,l,s);Fn(b,F,!1),a||_i(l)||j.disconnect(P,s)}};return!!Tn(k,[e,s],E=>E[0]===e&&E[1]===s,!0)&&(A.add(O),ot(l)?ys(d,l,[s,O],!0):Fn(b,[l,s,O],!0),!0)},Ro=(l,e,s,a,d)=>{let[b,k]=((A,O,E,j)=>{let{activeInputs:P,passiveInputs:F}=lt(O),D=Ot(P[j],A,E);return D===null?[q(F,A,E,j)[2],!1]:[D[2],!0]})(l,s,a,d);if(b!==null&&(Pi(l,b),!k||e||_i(l)||mi(Ze(l),Ze(s),a,d)),ot(s)){let{activeInputs:A}=lt(s);ie(s,A)}},Eo=(l,e,s,a)=>{let[d,b]=((k,A,O)=>{let{activeInputs:E,passiveInputs:j}=kt(A),P=Ot(E,k,O);return P===null?[bs(j,k,O)[1],!1]:[P[2],!0]})(l,s,a);d!==null&&(Pi(l,d),!b||e||_i(l)||Ze(l).disconnect(ws(s),a))};class Wa{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,s=null){return this._map.forEach((a,d)=>e.call(s,a,d,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}let zh={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function Qs(l,e,s,a,d){if(typeof l.copyFromChannel=="function")e[s].byteLength===0&&(e[s]=new Float32Array(128)),l.copyFromChannel(e[s],a,d);else{let b=l.getChannelData(a);if(e[s].byteLength===0)e[s]=b.slice(d,d+128);else{let k=new Float32Array(b.buffer,d*Float32Array.BYTES_PER_ELEMENT,128);e[s].set(k)}}}let Ba=(l,e,s,a,d)=>{typeof l.copyToChannel=="function"?e[s].byteLength!==0&&l.copyToChannel(e[s],a,d):e[s].byteLength!==0&&l.getChannelData(a).set(e[s],d)},Zs=(l,e)=>{let s=[];for(let a=0;a<l;a+=1){let d=[],b=typeof e=="number"?e:e[a];for(let k=0;k<b;k+=1)d.push(new Float32Array(128));s.push(d)}return s},Uh=async(l,e,s,a,d,b,k)=>{let A=e===null?128*Math.ceil(l.context.length/128):e.length,O=a.channelCount*a.numberOfInputs,E=d.reduce((V,B)=>V+B,0),j=E===0?null:s.createBuffer(E,A,s.sampleRate);if(b===void 0)throw new Error("Missing the processor constructor.");let P=lt(l),F=await((V,B)=>{let X=I(w,V),Y=Ze(B);return I(X,Y)})(s,l),D=Zs(a.numberOfInputs,a.channelCount),G=Zs(a.numberOfOutputs,d),N=Array.from(l.parameters.keys()).reduce((V,B)=>({...V,[B]:new Float32Array(128)}),{});for(let V=0;V<A;V+=128){if(a.numberOfInputs>0&&e!==null)for(let B=0;B<a.numberOfInputs;B+=1)for(let X=0;X<a.channelCount;X+=1)Qs(e,D[B],X,X,V);b.parameterDescriptors!==void 0&&e!==null&&b.parameterDescriptors.forEach(({name:B},X)=>{Qs(e,N,B,O+X,V)});for(let B=0;B<a.numberOfInputs;B+=1)for(let X=0;X<d[B];X+=1)G[B][X].byteLength===0&&(G[B][X]=new Float32Array(128));try{let B=D.map((Y,Q)=>P.activeInputs[Q].size===0?[]:Y),X=k(V/s.sampleRate,s.sampleRate,()=>F.process(B,G,N));if(j!==null)for(let Y=0,Q=0;Y<a.numberOfOutputs;Y+=1){for(let J=0;J<d[Y];J+=1)Ba(j,G[Y],J,Q+J,V);Q+=d[Y]}if(!X)break}catch(B){l.dispatchEvent(new ErrorEvent("processorerror",{colno:B.colno,filename:B.filename,lineno:B.lineno,message:B.message}));break}}return j},Hh={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Gh={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Yh={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Xh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Qh={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Zh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Js=(l,e,s)=>{let a=e[s];if(a===void 0)throw l();return a},Jh={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},$h={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},gt=()=>new DOMException("","InvalidStateError"),$s=()=>new DOMException("","InvalidAccessError"),Kh={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},za=(l,e,s,a,d,b,k,A,O,E,j)=>{let P=E.length,F=A;for(let D=0;D<P;D+=1){let G=s[0]*E[D];for(let N=1;N<d;N+=1){let V=F-N&O-1;G+=s[N]*b[V],G-=l[N]*k[V]}for(let N=d;N<a;N+=1)G+=s[N]*b[F-N&O-1];for(let N=d;N<e;N+=1)G-=l[N]*k[F-N&O-1];b[F]=E[D],k[F]=G,F=F+1&O-1,j[D]=G}return F},ed={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},xs=l=>{let e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{let s=l.decodeAudioData(e.buffer,()=>{});return s!==void 0&&(s.catch(()=>{}),!0)}catch{}return!1},y0={numberOfChannels:1},at=(l,e,s)=>{let a=e[s];a!==void 0&&a!==l[s]&&(l[s]=a)},bt=(l,e)=>{at(l,e,"channelCount"),at(l,e,"channelCountMode"),at(l,e,"channelInterpretation")},Ua=l=>typeof l.getFloatTimeDomainData=="function",ut=(l,e,s)=>{let a=e[s];a!==void 0&&a!==l[s].value&&(l[s].value=a)},Po=l=>{var e;l.start=(e=l.start,(s=0,a=0,d)=>{if(typeof d=="number"&&d<0||a<0||s<0)throw new RangeError("The parameters can't be negative.");e.call(l,s,a,d)})},Do=l=>{var e;l.stop=(e=l.stop,(s=0)=>{if(s<0)throw new RangeError("The parameter can't be negative.");e.call(l,s)})},Ha=(l,e)=>l===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(l*e))))),td=async(l,e)=>new l(await(s=>new Promise((a,d)=>{let{port1:b,port2:k}=new MessageChannel;b.onmessage=({data:A})=>{b.close(),k.close(),a(A)},b.onmessageerror=({data:A})=>{b.close(),k.close(),d(A)},k.postMessage(s)}))(e)),Ga=(l,e)=>{let s=l.createBiquadFilter();return bt(s,e),ut(s,e,"Q"),ut(s,e,"detune"),ut(s,e,"frequency"),ut(s,e,"gain"),at(s,e,"type"),s},Ts=(l,e)=>{let s=l.createChannelSplitter(e.numberOfOutputs);return bt(s,e),(a=>{let d=a.numberOfOutputs;Object.defineProperty(a,"channelCount",{get:()=>d,set:b=>{if(b!==d)throw gt()}}),Object.defineProperty(a,"channelCountMode",{get:()=>"explicit",set:b=>{if(b!=="explicit")throw gt()}}),Object.defineProperty(a,"channelInterpretation",{get:()=>"discrete",set:b=>{if(b!=="discrete")throw gt()}})})(s),s},Di=(l,e)=>(l.connect=e.connect.bind(e),l.disconnect=e.disconnect.bind(e),l),Ya=(l,e)=>{let s=l.createDelay(e.maxDelayTime);return bt(s,e),ut(s,e,"delayTime"),s},Wt=(l,e)=>{let s=l.createGain();return bt(s,e),ut(s,e,"gain"),s};function nd(l,e){let s=e[0]*e[0]+e[1]*e[1];return[(l[0]*e[0]+l[1]*e[1])/s,(l[1]*e[0]-l[0]*e[1])/s]}function Xa(l,e){let s=[0,0];for(let b=l.length-1;b>=0;b-=1)d=e,s=[(a=s)[0]*d[0]-a[1]*d[1],a[0]*d[1]+a[1]*d[0]],s[0]+=l[b];var a,d;return s}let Ss=(l,e,s,a)=>l.createScriptProcessor(e,s,a),qt=()=>new DOMException("","NotSupportedError"),id={numberOfChannels:1},sd={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},rd={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},od={disableNormalization:!1},ad={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Qa=()=>new DOMException("","UnknownError"),cd={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Za=l=>{if(l===null)return!1;let e=l.length;return e%2!=0?l[Math.floor(e/2)]!==0:l[e/2-1]+l[e/2]!==0},Ks=(l,e,s,a)=>{let d=Object.getPrototypeOf(l);for(;!d.hasOwnProperty(e);)d=Object.getPrototypeOf(d);let{get:b,set:k}=Object.getOwnPropertyDescriptor(d,e);Object.defineProperty(l,e,{get:s(b),set:a(k)})},Ja=(l,e,s)=>{try{l.setValueAtTime(e,s)}catch(a){if(a.code!==9)throw a;Ja(l,e,s+1e-7)}},Io=l=>{let e=l.createOscillator();try{e.start(-1)}catch(s){return s instanceof RangeError}return!1},$a=l=>{let e=l.createBuffer(1,1,44100),s=l.createBufferSource();s.buffer=e,s.start(),s.stop();try{return s.stop(),!0}catch{return!1}},jo=l=>{let e=l.createOscillator();try{e.stop(-1)}catch(s){return s instanceof RangeError}return!1},ld=()=>{try{new DOMException}catch{return!1}return!0},ud=()=>new Promise(l=>{let e=new ArrayBuffer(0),{port1:s,port2:a}=new MessageChannel;s.onmessage=({data:d})=>l(d!==null),a.postMessage(e,[e])}),Ka=(l,e)=>{let s=e.createGain();l.connect(s);let a=(d=l.disconnect,()=>{d.call(l,s),l.removeEventListener("ended",a)});var d;l.addEventListener("ended",a),Di(l,s),l.stop=(b=>{let k=!1;return(A=0)=>{if(k)try{b.call(l,A)}catch{s.gain.setValueAtTime(0,A)}else b.call(l,A),k=!0}})(l.stop)},Ii=(l,e)=>s=>{let a={value:l};return Object.defineProperties(s,{currentTarget:a,target:a}),typeof e=="function"?e.call(l,s):e.handleEvent.call(l,s)},hd=(ec=Tn,(l,e,[s,a,d],b)=>{ec(l[a],[e,s,d],k=>k[0]===e&&k[1]===s,b)});var ec;let dd=(l=>(e,s,[a,d,b],k)=>{let A=e.get(a);A===void 0?e.set(a,new Set([[d,s,b]])):l(A,[d,s,b],O=>O[0]===d&&O[1]===s,k)})(Tn),pd=(l=>(e,s,a,d)=>l(e[d],b=>b[0]===s&&b[1]===a))(L),tc=new WeakMap,fd=(l=>e=>{var s;return(s=l.get(e))!==null&&s!==void 0?s:0})(tc),Qt=(er=new Map,Cs=new WeakMap,(l,e)=>{let s=Cs.get(l);if(s!==void 0)return s;let a=er.get(l);if(a!==void 0)return a;try{let d=e();return d instanceof Promise?(er.set(l,d),d.catch(()=>!1).then(b=>(er.delete(l),Cs.set(l,b),b))):(Cs.set(l,d),d)}catch{return Cs.set(l,!1),!1}});var er,Cs;let fn=typeof window=="undefined"?null:window,nc=(ic=Qt,sc=re,(l,e)=>{let s=l.createAnalyser();if(bt(s,e),!(e.maxDecibels>e.minDecibels))throw sc();return at(s,e,"fftSize"),at(s,e,"maxDecibels"),at(s,e,"minDecibels"),at(s,e,"smoothingTimeConstant"),ic(Ua,()=>Ua(s))||(a=>{a.getFloatTimeDomainData=d=>{let b=new Uint8Array(d.length);a.getByteTimeDomainData(b);let k=Math.max(b.length,a.fftSize);for(let A=0;A<k;A+=1)d[A]=.0078125*(b[A]-128);return d}})(s),s});var ic,sc;let Lo=(rc=lt,l=>{let e=rc(l);if(e.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer});var rc;let Rt=((l,e,s)=>async(a,d,b,k)=>{let A=l(a),O=[...k,a];await Promise.all(A.activeInputs.map((E,j)=>Array.from(E).filter(([P])=>!O.includes(P)).map(async([P,F])=>{let D=e(P),G=await D.render(P,d,O),N=a.context.destination;s(P)||a===N&&s(a)||G.connect(b,F,j)})).reduce((E,j)=>[...E,...j],[]))})(lt,Lo,_i),md=(oc=nc,ac=Ze,cc=Rt,()=>{let l=new WeakMap;return{render(e,s,a){let d=l.get(s);return d!==void 0?Promise.resolve(d):(async(b,k,A)=>{let O=ac(b);if(!$(O,k)){let E={channelCount:O.channelCount,channelCountMode:O.channelCountMode,channelInterpretation:O.channelInterpretation,fftSize:O.fftSize,maxDecibels:O.maxDecibels,minDecibels:O.minDecibels,smoothingTimeConstant:O.smoothingTimeConstant};O=oc(k,E)}return l.set(k,O),await cc(b,k,O,A),O})(e,s,a)}}});var oc,ac,cc;let et=(lc=f,l=>{let e=lc.get(l);if(e===void 0)throw gt();return e});var lc;let Tt=(l=>l===null?null:l.hasOwnProperty("OfflineAudioContext")?l.OfflineAudioContext:l.hasOwnProperty("webkitOfflineAudioContext")?l.webkitOfflineAudioContext:null)(fn),Qe=(Fo=Tt,l=>Fo!==null&&l instanceof Fo);var Fo;let uc=new WeakMap,hc=(dc=Ii,class{constructor(l){this._nativeEventTarget=l,this._listeners=new WeakMap}addEventListener(l,e,s){if(e!==null){let a=this._listeners.get(e);a===void 0&&(a=dc(this,e),typeof e=="function"&&this._listeners.set(e,a)),this._nativeEventTarget.addEventListener(l,a,s)}}dispatchEvent(l){return this._nativeEventTarget.dispatchEvent(l)}removeEventListener(l,e,s){let a=e===null?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(l,a===void 0?null:a,s)}});var dc;let qn=(l=>l===null?null:l.hasOwnProperty("AudioContext")?l.AudioContext:l.hasOwnProperty("webkitAudioContext")?l.webkitAudioContext:null)(fn),qo=(Vo=qn,l=>Vo!==null&&l instanceof Vo);var Vo;let No=(l=>e=>l!==null&&typeof l.AudioNode=="function"&&e instanceof l.AudioNode)(fn),pc=(l=>e=>l!==null&&typeof l.AudioParam=="function"&&e instanceof l.AudioParam)(fn),ft=((l,e,s,a,d,b,k,A,O,E,j,P,F,D,G)=>class extends E{constructor(N,V,B,X){super(B),this._context=N,this._nativeAudioNode=B;let Y=j(N);P(Y)&&s(Na,()=>Na(Y))!==!0&&(Q=>{let J=new Map;var Z,K;Q.connect=(Z=Q.connect.bind(Q),(le,te=0,ne=0)=>{let se=Xs(le)?Z(le,te,ne):Z(le,te),fe=J.get(le);return fe===void 0?J.set(le,[{input:ne,output:te}]):fe.every(Te=>Te.input!==ne||Te.output!==te)&&fe.push({input:ne,output:te}),se}),Q.disconnect=(K=Q.disconnect,(le,te,ne)=>{if(K.apply(Q),le===void 0)J.clear();else if(typeof le=="number")for(let[se,fe]of J){let Te=fe.filter(We=>We.output!==le);Te.length===0?J.delete(se):J.set(se,Te)}else if(J.has(le))if(te===void 0)J.delete(le);else{let se=J.get(le);if(se!==void 0){let fe=se.filter(Te=>Te.output!==te&&(Te.input!==ne||ne===void 0));fe.length===0?J.delete(le):J.set(le,fe)}}for(let[se,fe]of J)fe.forEach(Te=>{Xs(se)?Q.connect(se,Te.output,Te.input):Q.connect(se,Te.output)})})})(B),S.set(this,B),v.set(this,new Set),N.state!=="closed"&&V&&U(this),l(this,X,B)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(N){this._nativeAudioNode.channelCount=N}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(N){this._nativeAudioNode.channelCountMode=N}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(N){this._nativeAudioNode.channelInterpretation=N}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(N,V=0,B=0){if(V<0||V>=this._nativeAudioNode.numberOfOutputs)throw d();let X=j(this._context),Y=G(X);if(F(N)||D(N))throw b();if(Ln(N)){let J=Ze(N);try{let Z=Kn(this._nativeAudioNode,J,V,B),K=Ys(this);(Y||K)&&this._nativeAudioNode.disconnect(...Z),this.context.state!=="closed"&&!K&&Ys(N)&&U(N)}catch(Z){throw Z.code===12?b():Z}if(e(this,N,V,B,Y)){let Z=O([this],N);Oo(Z,a(Y))}return N}let Q=ws(N);if(Q.name==="playbackRate")throw k();try{this._nativeAudioNode.connect(Q,V),(Y||Ys(this))&&this._nativeAudioNode.disconnect(Q,V)}catch(J){throw J.code===12?b():J}if(Bh(this,N,V,Y)){let J=O([this],N);Oo(J,a(Y))}}disconnect(N,V,B){let X,Y=j(this._context),Q=G(Y);if(N===void 0)X=((J,Z)=>{let K=lt(J),le=[];for(let te of K.outputs)$n(te)?Ro(J,Z,...te):Eo(J,Z,...te),le.push(te[0]);return K.outputs.clear(),le})(this,Q);else if(typeof N=="number"){if(N<0||N>=this.numberOfOutputs)throw d();X=((J,Z,K)=>{let le=lt(J),te=[];for(let ne of le.outputs)ne[1]===K&&($n(ne)?Ro(J,Z,...ne):Eo(J,Z,...ne),te.push(ne[0]),le.outputs.delete(ne));return te})(this,Q,N)}else{if(V!==void 0&&(V<0||V>=this.numberOfOutputs)||Ln(N)&&B!==void 0&&(B<0||B>=N.numberOfInputs))throw d();if(X=((J,Z,K,le,te)=>{let ne=lt(J);return Array.from(ne.outputs).filter(se=>!(se[0]!==K||le!==void 0&&se[1]!==le||te!==void 0&&se[2]!==te)).map(se=>($n(se)?Ro(J,Z,...se):Eo(J,Z,...se),ne.outputs.delete(se),se[0]))})(this,Q,N,V,B),X.length===0)throw b()}for(let J of X){let Z=O([this],J);Oo(Z,A)}}})((fc=g,(l,e,s)=>{let a=[];for(let d=0;d<s.numberOfInputs;d+=1)a.push(new Set);fc.set(l,{activeInputs:a,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((l,e,s,a,d,b,k,A,O,E,j,P,F)=>(D,G,N,V,B)=>{let{activeInputs:X,passiveInputs:Y}=b(G),{outputs:Q}=b(D),J=A(D),Z=K=>{let le=O(G),te=O(D);if(K){let ne=q(Y,D,N,V);l(X,D,ne,!1),B||P(D)||s(te,le,N,V),F(G)&&U(G)}else{let ne=a(X,D,N,V);e(Y,V,ne,!1),B||P(D)||d(te,le,N,V);let se=k(G);se===0?j(G)&&ie(G,X):setTimeout(()=>{j(G)&&ie(G,X)},1e3*se)}};return!!E(Q,[G,N,V],K=>K[0]===G&&K[1]===N&&K[2]===V,!0)&&(J.add(Z),j(D)?l(X,D,[N,V,Z],!0):e(Y,V,[D,N,Z],!0),!0)})(hd,dd,Kn,pd,mi,lt,fd,z,Ze,Tn,ot,_i,Ys),Qt,((l,e,s,a,d,b)=>k=>(A,O)=>{let E=l.get(A);if(E===void 0){if(!k&&b(A)){let j=a(A),{outputs:P}=s(A);for(let F of P)if($n(F)){let D=a(F[0]);e(j,D,F[1],F[2])}else{let D=d(F[0]);j.disconnect(D,F[1])}}l.set(A,O)}else l.set(A,E+O)})(x,mi,lt,Ze,ws,ot),re,$s,qt,((l,e,s,a,d,b,k,A)=>(O,E)=>{let j=e.get(O);if(j===void 0)throw new Error("Missing the expected cycle count.");let P=b(O.context),F=A(P);if(j===E){if(e.delete(O),!F&&k(O)){let D=a(O),{outputs:G}=s(O);for(let N of G)if($n(N)){let V=a(N[0]);l(D,V,N[1],N[2])}else{let V=d(N[0]);D.connect(V,N[1])}}}else e.set(O,j-E)})(Kn,x,lt,Ze,ws,et,ot,Qe),((l,e,s)=>function a(d,b){let k=Ln(b)?b:s(l,b);if((O=>"delayTime"in O)(k))return[];if(d[0]===k)return[d];if(d.includes(k))return[];let{outputs:A}=e(k);return Array.from(A).map(O=>a([...d,k],O[0])).reduce((O,E)=>O.concat(E),[])})(uc,lt,I),hc,et,qo,No,pc,Qe);var fc;let _d=((l,e,s,a,d,b)=>class extends l{constructor(k,A){let O=d(k),E={...ae,...A},j=a(O,E);super(k,!1,j,b(O)?e():null),this._nativeAnalyserNode=j}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(k){this._nativeAnalyserNode.fftSize=k}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(k){let A=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=k,!(k>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=A,s()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(k){let A=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=k,!(this._nativeAnalyserNode.maxDecibels>k))throw this._nativeAnalyserNode.minDecibels=A,s()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(k){this._nativeAnalyserNode.smoothingTimeConstant=k}getByteFrequencyData(k){this._nativeAnalyserNode.getByteFrequencyData(k)}getByteTimeDomainData(k){this._nativeAnalyserNode.getByteTimeDomainData(k)}getFloatFrequencyData(k){this._nativeAnalyserNode.getFloatFrequencyData(k)}getFloatTimeDomainData(k){this._nativeAnalyserNode.getFloatTimeDomainData(k)}})(ft,md,re,nc,et,Qe),Wo=new WeakSet,mc=(l=>l===null?null:l.hasOwnProperty("AudioBuffer")?l.AudioBuffer:null)(fn),_c=(Bo=new Uint32Array(1),l=>(Bo[0]=l,Bo[0]));var Bo;let zo=((l,e)=>s=>{s.copyFromChannel=(a,d,b=0)=>{let k=l(b),A=l(d);if(A>=s.numberOfChannels)throw e();let O=s.length,E=s.getChannelData(A),j=a.length;for(let P=k<0?-k:0;P+k<O&&P<j;P+=1)a[P]=E[P+k]},s.copyToChannel=(a,d,b=0)=>{let k=l(b),A=l(d);if(A>=s.numberOfChannels)throw e();let O=s.length,E=s.getChannelData(A),j=a.length;for(let P=k<0?-k:0;P+k<O&&P<j;P+=1)E[P+k]=a[P]}})(_c,re),Uo=(l=>e=>{e.copyFromChannel=(s=>(a,d,b=0)=>{let k=l(b),A=l(d);if(k<e.length)return s.call(e,a,A,k)})(e.copyFromChannel),e.copyToChannel=(s=>(a,d,b=0)=>{let k=l(b),A=l(d);if(k<e.length)return s.call(e,a,A,k)})(e.copyToChannel)})(_c),gd=((l,e,s,a,d,b,k,A)=>{let O=null;return class Rl{constructor(j){if(d===null)throw new Error("Missing the native OfflineAudioContext constructor.");let{length:P,numberOfChannels:F,sampleRate:D}={...he,...j};O===null&&(O=new d(1,1,44100));let G=a!==null&&e(b,b)?new a({length:P,numberOfChannels:F,sampleRate:D}):O.createBuffer(F,P,D);if(G.numberOfChannels===0)throw s();return typeof G.copyFromChannel!="function"?(k(G),qe(G)):e(ce,()=>ce(G))||A(G),l.add(G),G}static[Symbol.hasInstance](j){return j!==null&&typeof j=="object"&&Object.getPrototypeOf(j)===Rl.prototype||l.has(j)}}})(Wo,Qt,qt,mc,Tt,(Ho=mc,()=>{if(Ho===null)return!1;try{new Ho({length:1,sampleRate:44100})}catch{return!1}return!0}),zo,Uo);var Ho;let tr=(gc=Wt,(l,e)=>{let s=gc(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(s).connect(l.destination);let a=()=>{e.removeEventListener("ended",a),e.disconnect(s),s.disconnect()};e.addEventListener("ended",a)});var gc;let vc=((l,e,s)=>async(a,d,b,k)=>{let A=e(a);await Promise.all(Array.from(A.activeInputs).map(async([O,E])=>{let j=l(O),P=await j.render(O,d,k);s(O)||P.connect(b,E)}))})(Lo,kt,_i),Sn=(l=>(e,s,a,d)=>l(s,e,a,d))(vc),ji=((l,e,s,a,d,b,k,A,O,E,j)=>(P,F)=>{let D=P.createBufferSource();return bt(D,F),ut(D,F,"playbackRate"),at(D,F,"buffer"),at(D,F,"loop"),at(D,F,"loopEnd"),at(D,F,"loopStart"),e(s,()=>s(P))||(G=>{G.start=(N=>{let V=!1;return(B=0,X=0,Y)=>{if(V)throw gt();N.call(G,B,X,Y),V=!0}})(G.start)})(D),e(a,()=>a(P))||O(D),e(d,()=>d(P))||E(D,P),e(b,()=>b(P))||Po(D),e(k,()=>k(P))||j(D,P),e(A,()=>A(P))||Do(D),l(P,D),D})(tr,Qt,l=>{let e=l.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},l=>{let e=l.createBufferSource(),s=l.createBuffer(1,1,44100);e.buffer=s;try{e.start(0,1)}catch{return!1}return!0},l=>{let e=l.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Io,$a,jo,l=>{var e;l.start=(e=l.start,(s=0,a=0,d)=>{let b=l.buffer,k=b===null?a:Math.min(b.duration,a);b!==null&&k>b.duration-.5/l.context.sampleRate?e.call(l,s,0,0):e.call(l,s,k,d)})},(yc=Ks,(l,e)=>{let s=e.createBuffer(1,1,44100);l.buffer===null&&(l.buffer=s),yc(l,"buffer",a=>()=>{let d=a.call(l);return d===s?null:d},a=>d=>a.call(l,d===null?s:d))}),Ka);var yc;let Cn=((l,e)=>(s,a,d,b)=>(l(a).replay(d),e(a,s,d,b)))((l=>e=>{let s=l(e);if(s.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return s.renderer})(kt),vc),vd=((l,e,s,a,d)=>()=>{let b=new WeakMap,k=null,A=null;return{set start(O){k=O},set stop(O){A=O},render(O,E,j){let P=b.get(E);return P!==void 0?Promise.resolve(P):(async(F,D,G)=>{let N=s(F),V=$(N,D);if(!V){let B={buffer:N.buffer,channelCount:N.channelCount,channelCountMode:N.channelCountMode,channelInterpretation:N.channelInterpretation,loop:N.loop,loopEnd:N.loopEnd,loopStart:N.loopStart,playbackRate:N.playbackRate.value};N=e(D,B),k!==null&&N.start(...k),A!==null&&N.stop(A)}return b.set(D,N),V?await l(D,F.playbackRate,N.playbackRate,G):await a(D,F.playbackRate,N.playbackRate,G),await d(F,D,N,G),N})(O,E,j)}}})(Sn,ji,Ze,Cn,Rt),mn=((l,e,s,a,d,b,k,A,O,E,j,P,F)=>(D,G,N,V=null,B=null)=>{let X=new p.AutomationEventList(N.defaultValue),Y=G?a(X):null,Q={get defaultValue(){return N.defaultValue},get maxValue(){return V===null?N.maxValue:V},get minValue(){return B===null?N.minValue:B},get value(){return N.value},set value(J){N.value=J,Q.setValueAtTime(J,D.context.currentTime)},cancelAndHoldAtTime(J){if(typeof N.cancelAndHoldAtTime=="function")Y===null&&X.flush(D.context.currentTime),X.add(d(J)),N.cancelAndHoldAtTime(J);else{let Z=Array.from(X).pop();Y===null&&X.flush(D.context.currentTime),X.add(d(J));let K=Array.from(X).pop();N.cancelScheduledValues(J),Z!==K&&K!==void 0&&(K.type==="exponentialRampToValue"?N.exponentialRampToValueAtTime(K.value,K.endTime):K.type==="linearRampToValue"?N.linearRampToValueAtTime(K.value,K.endTime):K.type==="setValue"?N.setValueAtTime(K.value,K.startTime):K.type==="setValueCurve"&&N.setValueCurveAtTime(K.values,K.startTime,K.duration))}return Q},cancelScheduledValues:J=>(Y===null&&X.flush(D.context.currentTime),X.add(b(J)),N.cancelScheduledValues(J),Q),exponentialRampToValueAtTime(J,Z){if(J===0)throw new RangeError;if(!Number.isFinite(Z)||Z<0)throw new RangeError;return Y===null&&X.flush(D.context.currentTime),X.add(k(J,Z)),N.exponentialRampToValueAtTime(J,Z),Q},linearRampToValueAtTime:(J,Z)=>(Y===null&&X.flush(D.context.currentTime),X.add(A(J,Z)),N.linearRampToValueAtTime(J,Z),Q),setTargetAtTime:(J,Z,K)=>(Y===null&&X.flush(D.context.currentTime),X.add(O(J,Z,K)),N.setTargetAtTime(J,Z,K),Q),setValueAtTime:(J,Z)=>(Y===null&&X.flush(D.context.currentTime),X.add(E(J,Z)),N.setValueAtTime(J,Z),Q),setValueCurveAtTime(J,Z,K){let le=J instanceof Float32Array?J:new Float32Array(J);if(P!==null&&P.name==="webkitAudioContext"){let te=Z+K,ne=D.context.sampleRate,se=Math.ceil(Z*ne),fe=Math.floor(te*ne),Te=fe-se,We=new Float32Array(Te);for(let Ee=0;Ee<Te;Ee+=1){let Le=(le.length-1)/K*((se+Ee)/ne-Z),Ae=Math.floor(Le),Ie=Math.ceil(Le);We[Ee]=Ae===Ie?le[Ae]:(1-(Le-Ae))*le[Ae]+(1-(Ie-Le))*le[Ie]}Y===null&&X.flush(D.context.currentTime),X.add(j(We,Z,K)),N.setValueCurveAtTime(We,Z,K);let ye=fe/ne;ye<te&&F(Q,We[We.length-1],ye),F(Q,le[le.length-1],te)}else Y===null&&X.flush(D.context.currentTime),X.add(j(le,Z,K)),N.setValueCurveAtTime(le,Z,K);return Q}};return s.set(Q,N),e.set(Q,D),l(Q,Y),Q})((bc=o,(l,e)=>{bc.set(l,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),uc,h,l=>({replay(e){for(let s of l)if(s.type==="exponentialRampToValue"){let{endTime:a,value:d}=s;e.exponentialRampToValueAtTime(d,a)}else if(s.type==="linearRampToValue"){let{endTime:a,value:d}=s;e.linearRampToValueAtTime(d,a)}else if(s.type==="setTarget"){let{startTime:a,target:d,timeConstant:b}=s;e.setTargetAtTime(d,a,b)}else if(s.type==="setValue"){let{startTime:a,value:d}=s;e.setValueAtTime(d,a)}else{if(s.type!=="setValueCurve")throw new Error("Can't apply an unknown automation.");{let{duration:a,startTime:d,values:b}=s;e.setValueCurveAtTime(b,d,a)}}}}),p.createCancelAndHoldAutomationEvent,p.createCancelScheduledValuesAutomationEvent,p.createExponentialRampToValueAutomationEvent,p.createLinearRampToValueAutomationEvent,p.createSetTargetAutomationEvent,p.createSetValueAutomationEvent,p.createSetValueCurveAutomationEvent,qn,Ja);var bc;let yd=((l,e,s,a,d,b,k,A)=>class extends l{constructor(O,E){let j=b(O),P={..._t,...E},F=d(j,P),D=k(j),G=D?e():null;super(O,!1,F,G),this._audioBufferSourceNodeRenderer=G,this._isBufferNullified=!1,this._isBufferSet=P.buffer!==null,this._nativeAudioBufferSourceNode=F,this._onended=null,this._playbackRate=s(this,D,F.playbackRate,He,pe)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(O){if(this._nativeAudioBufferSourceNode.buffer=O,O!==null){if(this._isBufferSet)throw a();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(O){this._nativeAudioBufferSourceNode.loop=O}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(O){this._nativeAudioBufferSourceNode.loopEnd=O}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(O){this._nativeAudioBufferSourceNode.loopStart=O}get onended(){return this._onended}set onended(O){let E=typeof O=="function"?A(this,O):null;this._nativeAudioBufferSourceNode.onended=E;let j=this._nativeAudioBufferSourceNode.onended;this._onended=j!==null&&j===E?O:j}get playbackRate(){return this._playbackRate}start(O=0,E=0,j){if(this._nativeAudioBufferSourceNode.start(O,E,j),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=j===void 0?[O,E]:[O,E,j]),this.context.state!=="closed"){U(this);let P=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",P),ot(this)&&ee(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",P)}}stop(O=0){this._nativeAudioBufferSourceNode.stop(O),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=O)}})(ft,vd,mn,gt,ji,et,Qe,Ii),bd=((l,e,s,a,d,b,k,A)=>class extends l{constructor(O,E){let j=b(O),P=k(j),F=d(j,E,P);super(O,!1,F,P?e(A):null),this._isNodeOfNativeOfflineAudioContext=P,this._nativeAudioDestinationNode=F}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(O){if(this._isNodeOfNativeOfflineAudioContext)throw a();if(O>this._nativeAudioDestinationNode.maxChannelCount)throw s();this._nativeAudioDestinationNode.channelCount=O}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(O){if(this._isNodeOfNativeOfflineAudioContext)throw a();this._nativeAudioDestinationNode.channelCountMode=O}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(ft,l=>{let e=null;return{render:(s,a,d)=>(e===null&&(e=(async(b,k,A)=>{let O=k.destination;return await l(b,k,O,A),O})(s,a,d)),e)}},re,gt,((l,e)=>(s,a,d)=>{let b=s.destination;if(b.channelCount!==a)try{b.channelCount=a}catch{}d&&b.channelCountMode!=="explicit"&&(b.channelCountMode="explicit"),b.maxChannelCount===0&&Object.defineProperty(b,"maxChannelCount",{value:a});let k=l(s,{channelCount:a,channelCountMode:b.channelCountMode,channelInterpretation:b.channelInterpretation,gain:1});return e(k,"channelCount",A=>()=>A.call(k),A=>O=>{A.call(k,O);try{b.channelCount=O}catch(E){if(O>b.maxChannelCount)throw E}}),e(k,"channelCountMode",A=>()=>A.call(k),A=>O=>{A.call(k,O),b.channelCountMode=O}),e(k,"channelInterpretation",A=>()=>A.call(k),A=>O=>{A.call(k,O),b.channelInterpretation=O}),Object.defineProperty(k,"maxChannelCount",{get:()=>b.maxChannelCount}),k.connect(b),k})(Wt,Ks),et,Qe,Rt),wd=((l,e,s,a,d)=>()=>{let b=new WeakMap;return{render(k,A,O){let E=b.get(A);return E!==void 0?Promise.resolve(E):(async(j,P,F)=>{let D=s(j),G=$(D,P);if(!G){let N={Q:D.Q.value,channelCount:D.channelCount,channelCountMode:D.channelCountMode,channelInterpretation:D.channelInterpretation,detune:D.detune.value,frequency:D.frequency.value,gain:D.gain.value,type:D.type};D=e(P,N)}return b.set(P,D),G?(await l(P,j.Q,D.Q,F),await l(P,j.detune,D.detune,F),await l(P,j.frequency,D.frequency,F),await l(P,j.gain,D.gain,F)):(await a(P,j.Q,D.Q,F),await a(P,j.detune,D.detune,F),await a(P,j.frequency,D.frequency,F),await a(P,j.gain,D.gain,F)),await d(j,P,D,F),D})(k,A,O)}}})(Sn,Ga,Ze,Cn,Rt),gi=(l=>(e,s)=>l.set(e,s))(tc),xd=(wc=ft,ks=mn,xc=wd,Go=$s,Tc=Ga,Sc=et,Cc=Qe,kc=gi,class extends wc{constructor(l,e){let s=Sc(l),a={...Hh,...e},d=Tc(s,a),b=Cc(s);super(l,!1,d,b?xc():null),this._Q=ks(this,b,d.Q,He,pe),this._detune=ks(this,b,d.detune,1200*Math.log2(He),-1200*Math.log2(He)),this._frequency=ks(this,b,d.frequency,l.sampleRate/2,0),this._gain=ks(this,b,d.gain,40*Math.log10(He),pe),this._nativeBiquadFilterNode=d,kc(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(l){this._nativeBiquadFilterNode.type=l}getFrequencyResponse(l,e,s){try{this._nativeBiquadFilterNode.getFrequencyResponse(l,e,s)}catch(a){throw a.code===11?Go():a}if(l.length!==e.length||e.length!==s.length)throw Go()}});var wc,ks,xc,Go,Tc,Sc,Cc,kc;let ei=((l,e)=>(s,a,d)=>{let b=new Set;var k,A;return s.connect=(k=s.connect,(O,E=0,j=0)=>{let P=b.size===0;if(e(O))return k.call(s,O,E,j),l(b,[O,E,j],F=>F[0]===O&&F[1]===E&&F[2]===j,!0),P&&a(),O;k.call(s,O,E),l(b,[O,E],F=>F[0]===O&&F[1]===E,!0),P&&a()}),s.disconnect=(A=s.disconnect,(O,E,j)=>{let P=b.size>0;if(O===void 0)A.apply(s),b.clear();else if(typeof O=="number"){A.call(s,O);for(let D of b)D[1]===O&&b.delete(D)}else{e(O)?A.call(s,O,E,j):A.call(s,O,E);for(let D of b)D[0]!==O||E!==void 0&&D[1]!==E||j!==void 0&&D[2]!==j||b.delete(D)}let F=b.size===0;P&&F&&d()}),s})(Tn,No),Td=(Yo=gt,Mc=ei,(l,e)=>{e.channelCount=1,e.channelCountMode="explicit",Object.defineProperty(e,"channelCount",{get:()=>1,set:()=>{throw Yo()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:()=>{throw Yo()}});let s=l.createBufferSource();Mc(e,()=>{let a=e.numberOfInputs;for(let d=0;d<a;d+=1)s.connect(e,0,d)},()=>s.disconnect(e))});var Yo,Mc;let ti=((l,e)=>(s,a)=>{let d=s.createChannelMerger(a.numberOfInputs);return l!==null&&l.name==="webkitAudioContext"&&e(s,d),bt(d,a),d})(qn,Td),Sd=((l,e,s,a,d)=>class extends l{constructor(b,k){let A=a(b),O={...Gh,...k};super(b,!1,s(A,O),d(A)?e():null)}})(ft,((l,e,s)=>()=>{let a=new WeakMap;return{render(d,b,k){let A=a.get(b);return A!==void 0?Promise.resolve(A):(async(O,E,j)=>{let P=e(O);if(!$(P,E)){let F={channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,numberOfInputs:P.numberOfInputs};P=l(E,F)}return a.set(E,P),await s(O,E,P,j),P})(d,b,k)}}})(ti,Ze,Rt),ti,et,Qe),Cd=((l,e,s,a,d,b)=>class extends l{constructor(k,A){let O=a(k),E=b({...Yh,...A});super(k,!1,s(O,E),d(O)?e():null)}})(ft,((l,e,s)=>()=>{let a=new WeakMap;return{render(d,b,k){let A=a.get(b);return A!==void 0?Promise.resolve(A):(async(O,E,j)=>{let P=e(O);if(!$(P,E)){let F={channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,numberOfOutputs:P.numberOfOutputs};P=l(E,F)}return a.set(E,P),await s(O,E,P,j),P})(d,b,k)}}})(Ts,Ze,Rt),Ts,et,Qe,l=>({...l,channelCount:l.numberOfOutputs})),kd=((l,e,s,a)=>(d,{offset:b,...k})=>{let A=d.createBuffer(1,2,44100),O=e(d,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),E=s(d,{...k,gain:b}),j=A.getChannelData(0);j[0]=1,j[1]=1,O.buffer=A,O.loop=!0;let P={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(F){E.channelCount=F},get channelCountMode(){return E.channelCountMode},set channelCountMode(F){E.channelCountMode=F},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(F){E.channelInterpretation=F},get context(){return E.context},get inputs(){return[]},get numberOfInputs(){return O.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get offset(){return E.gain},get onended(){return O.onended},set onended(F){O.onended=F},addEventListener:(...F)=>O.addEventListener(F[0],F[1],F[2]),dispatchEvent:(...F)=>O.dispatchEvent(F[0]),removeEventListener:(...F)=>O.removeEventListener(F[0],F[1],F[2]),start(F=0){O.start.call(O,F)},stop(F=0){O.stop.call(O,F)}};return l(d,O),a(Di(P,E),()=>O.connect(E),()=>O.disconnect(E))})(tr,ji,Wt,ei),Li=((l,e,s,a,d)=>(b,k)=>{if(b.createConstantSource===void 0)return s(b,k);let A=b.createConstantSource();return bt(A,k),ut(A,k,"offset"),e(a,()=>a(b))||Po(A),e(d,()=>d(b))||Do(A),l(b,A),A})(tr,Qt,kd,Io,jo),Md=((l,e,s,a,d,b,k)=>class extends l{constructor(A,O){let E=d(A),j={...Xh,...O},P=a(E,j),F=b(E),D=F?s():null;super(A,!1,P,D),this._constantSourceNodeRenderer=D,this._nativeConstantSourceNode=P,this._offset=e(this,F,P.offset,He,pe),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(A){let O=typeof A=="function"?k(this,A):null;this._nativeConstantSourceNode.onended=O;let E=this._nativeConstantSourceNode.onended;this._onended=E!==null&&E===O?A:E}start(A=0){if(this._nativeConstantSourceNode.start(A),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=A),this.context.state!=="closed"){U(this);let O=()=>{this._nativeConstantSourceNode.removeEventListener("ended",O),ot(this)&&ee(this)};this._nativeConstantSourceNode.addEventListener("ended",O)}}stop(A=0){this._nativeConstantSourceNode.stop(A),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=A)}})(ft,mn,((l,e,s,a,d)=>()=>{let b=new WeakMap,k=null,A=null;return{set start(O){k=O},set stop(O){A=O},render(O,E,j){let P=b.get(E);return P!==void 0?Promise.resolve(P):(async(F,D,G)=>{let N=s(F),V=$(N,D);if(!V){let B={channelCount:N.channelCount,channelCountMode:N.channelCountMode,channelInterpretation:N.channelInterpretation,offset:N.offset.value};N=e(D,B),k!==null&&N.start(k),A!==null&&N.stop(A)}return b.set(D,N),V?await l(D,F.offset,N.offset,G):await a(D,F.offset,N.offset,G),await d(F,D,N,G),N})(O,E,j)}}})(Sn,Li,Ze,Cn,Rt),Li,et,Qe,Ii),Ac=((l,e)=>(s,a)=>{let d=s.createConvolver();if(bt(d,a),a.disableNormalization===d.normalize&&(d.normalize=!a.disableNormalization),at(d,a,"buffer"),a.channelCount>2||(e(d,"channelCount",b=>()=>b.call(d),b=>k=>{if(k>2)throw l();return b.call(d,k)}),a.channelCountMode==="max"))throw l();return e(d,"channelCountMode",b=>()=>b.call(d),b=>k=>{if(k==="max")throw l();return b.call(d,k)}),d})(qt,Ks),Ad=((l,e,s,a,d,b)=>class extends l{constructor(k,A){let O=a(k),E={...Qh,...A},j=s(O,E);super(k,!1,j,d(O)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=j,E.buffer!==null&&b(this,E.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(k){if(this._nativeConvolverNode.buffer=k,k===null&&this._nativeConvolverNode.buffer!==null){let A=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=A.createBuffer(1,1,44100),this._isBufferNullified=!0,b(this,0)}else this._isBufferNullified=!1,b(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(k){this._nativeConvolverNode.normalize=k}})(ft,((l,e,s)=>()=>{let a=new WeakMap;return{render(d,b,k){let A=a.get(b);return A!==void 0?Promise.resolve(A):(async(O,E,j)=>{let P=e(O);if(!$(P,E)){let F={buffer:P.buffer,channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,disableNormalization:!P.normalize};P=l(E,F)}return a.set(E,P),Xt(P)?await s(O,E,P.inputs[0],j):await s(O,E,P,j),P})(d,b,k)}}})(Ac,Ze,Rt),Ac,et,Qe,gi),Od=((l,e,s,a,d,b,k)=>class extends l{constructor(A,O){let E=d(A),j={...Zh,...O},P=a(E,j),F=b(E);super(A,!1,P,F?s(j.maxDelayTime):null),this._delayTime=e(this,F,P.delayTime),k(this,j.maxDelayTime)}get delayTime(){return this._delayTime}})(ft,mn,((l,e,s,a,d)=>b=>{let k=new WeakMap;return{render(A,O,E){let j=k.get(O);return j!==void 0?Promise.resolve(j):(async(P,F,D)=>{let G=s(P),N=$(G,F);if(!N){let V={channelCount:G.channelCount,channelCountMode:G.channelCountMode,channelInterpretation:G.channelInterpretation,delayTime:G.delayTime.value,maxDelayTime:b};G=e(F,V)}return k.set(F,G),N?await l(F,P.delayTime,G.delayTime,D):await a(F,P.delayTime,G.delayTime,D),await d(P,F,G,D),G})(A,O,E)}}})(Sn,Ya,Ze,Cn,Rt),Ya,et,Qe,gi),Oc=(Xo=qt,(l,e)=>{let s=l.createDynamicsCompressor();if(bt(s,e),e.channelCount>2||e.channelCountMode==="max")throw Xo();return ut(s,e,"attack"),ut(s,e,"knee"),ut(s,e,"ratio"),ut(s,e,"release"),ut(s,e,"threshold"),s});var Xo;let Rd=((l,e,s,a,d,b,k,A)=>class extends l{constructor(O,E){let j=b(O),P={...Jh,...E},F=a(j,P),D=k(j);super(O,!1,F,D?s():null),this._attack=e(this,D,F.attack),this._knee=e(this,D,F.knee),this._nativeDynamicsCompressorNode=F,this._ratio=e(this,D,F.ratio),this._release=e(this,D,F.release),this._threshold=e(this,D,F.threshold),A(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(O){let E=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=O,O>2)throw this._nativeDynamicsCompressorNode.channelCount=E,d()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(O){let E=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=O,O==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=E,d()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(ft,mn,((l,e,s,a,d)=>()=>{let b=new WeakMap;return{render(k,A,O){let E=b.get(A);return E!==void 0?Promise.resolve(E):(async(j,P,F)=>{let D=s(j),G=$(D,P);if(!G){let N={attack:D.attack.value,channelCount:D.channelCount,channelCountMode:D.channelCountMode,channelInterpretation:D.channelInterpretation,knee:D.knee.value,ratio:D.ratio.value,release:D.release.value,threshold:D.threshold.value};D=e(P,N)}return b.set(P,D),G?(await l(P,j.attack,D.attack,F),await l(P,j.knee,D.knee,F),await l(P,j.ratio,D.ratio,F),await l(P,j.release,D.release,F),await l(P,j.threshold,D.threshold,F)):(await a(P,j.attack,D.attack,F),await a(P,j.knee,D.knee,F),await a(P,j.ratio,D.ratio,F),await a(P,j.release,D.release,F),await a(P,j.threshold,D.threshold,F)),await d(j,P,D,F),D})(k,A,O)}}})(Sn,Oc,Ze,Cn,Rt),Oc,qt,et,Qe,gi),Ed=((l,e,s,a,d,b)=>class extends l{constructor(k,A){let O=d(k),E={...$h,...A},j=a(O,E),P=b(O);super(k,!1,j,P?s():null),this._gain=e(this,P,j.gain,He,pe)}get gain(){return this._gain}})(ft,mn,((l,e,s,a,d)=>()=>{let b=new WeakMap;return{render(k,A,O){let E=b.get(A);return E!==void 0?Promise.resolve(E):(async(j,P,F)=>{let D=s(j),G=$(D,P);if(!G){let N={channelCount:D.channelCount,channelCountMode:D.channelCountMode,channelInterpretation:D.channelInterpretation,gain:D.gain.value};D=e(P,N)}return b.set(P,D),G?await l(P,j.gain,D.gain,F):await a(P,j.gain,D.gain,F),await d(j,P,D,F),D})(k,A,O)}}})(Sn,Wt,Ze,Cn,Rt),Wt,et,Qe),Pd=((l,e,s,a)=>(d,b,{channelCount:k,channelCountMode:A,channelInterpretation:O,feedback:E,feedforward:j})=>{let P=Ha(b,d.sampleRate),F=E instanceof Float64Array?E:new Float64Array(E),D=j instanceof Float64Array?j:new Float64Array(j),G=F.length,N=D.length,V=Math.min(G,N);if(G===0||G>20)throw a();if(F[0]===0)throw e();if(N===0||N>20)throw a();if(D[0]===0)throw e();if(F[0]!==1){for(let Z=0;Z<N;Z+=1)D[Z]/=F[0];for(let Z=1;Z<G;Z+=1)F[Z]/=F[0]}let B=s(d,P,k,k);B.channelCount=k,B.channelCountMode=A,B.channelInterpretation=O;let X=[],Y=[],Q=[];for(let Z=0;Z<k;Z+=1){X.push(0);let K=new Float32Array(32),le=new Float32Array(32);K.fill(0),le.fill(0),Y.push(K),Q.push(le)}B.onaudioprocess=Z=>{let K=Z.inputBuffer,le=Z.outputBuffer,te=K.numberOfChannels;for(let ne=0;ne<te;ne+=1){let se=K.getChannelData(ne),fe=le.getChannelData(ne);X[ne]=za(F,G,D,N,V,Y[ne],Q[ne],X[ne],32,se,fe)}};let J=d.sampleRate/2;return Di({get bufferSize(){return P},get channelCount(){return B.channelCount},set channelCount(Z){B.channelCount=Z},get channelCountMode(){return B.channelCountMode},set channelCountMode(Z){B.channelCountMode=Z},get channelInterpretation(){return B.channelInterpretation},set channelInterpretation(Z){B.channelInterpretation=Z},get context(){return B.context},get inputs(){return[B]},get numberOfInputs(){return B.numberOfInputs},get numberOfOutputs(){return B.numberOfOutputs},addEventListener:(...Z)=>B.addEventListener(Z[0],Z[1],Z[2]),dispatchEvent:(...Z)=>B.dispatchEvent(Z[0]),getFrequencyResponse(Z,K,le){if(Z.length!==K.length||K.length!==le.length)throw l();let te=Z.length;for(let ne=0;ne<te;ne+=1){let se=-Math.PI*(Z[ne]/J),fe=[Math.cos(se),Math.sin(se)],Te=nd(Xa(D,fe),Xa(F,fe));K[ne]=Math.sqrt(Te[0]*Te[0]+Te[1]*Te[1]),le[ne]=Math.atan2(Te[1],Te[0])}},removeEventListener:(...Z)=>B.removeEventListener(Z[0],Z[1],Z[2])},B)})($s,gt,Ss,qt),nr=((l,e,s,a)=>d=>l(xs,()=>xs(d))?Promise.resolve(l(a,a)).then(b=>{if(!b){let k=s(d,512,0,1);d.oncomplete=()=>{k.onaudioprocess=null,k.disconnect()},k.onaudioprocess=()=>d.currentTime,k.connect(d.destination)}return d.startRendering()}):new Promise(b=>{let k=e(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});d.oncomplete=A=>{k.disconnect(),b(A.renderedBuffer)},k.connect(d.destination),d.startRendering()}))(Qt,Wt,Ss,((l,e)=>()=>{if(e===null)return Promise.resolve(!1);let s=new e(1,1,44100),a=l(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(d=>{s.oncomplete=()=>{a.disconnect(),d(s.currentTime!==0)},s.startRendering()})})(Wt,Tt)),Dd=((l,e,s,a,d)=>(b,k)=>{let A=new WeakMap,O=null,E=async(j,P,F)=>{let D=null,G=e(j),N=$(G,P);if(P.createIIRFilter===void 0?D=l(P,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):N||(G=P.createIIRFilter(k,b)),A.set(P,D===null?G:D),D!==null){if(O===null){if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");let B=new s(j.context.destination.channelCount,j.context.length,P.sampleRate);O=(async()=>(await a(j,B,B.destination,F),((X,Y,Q,J)=>{let Z=Q instanceof Float64Array?Q:new Float64Array(Q),K=J instanceof Float64Array?J:new Float64Array(J),le=Z.length,te=K.length,ne=Math.min(le,te);if(Z[0]!==1){for(let ye=0;ye<le;ye+=1)K[ye]/=Z[0];for(let ye=1;ye<te;ye+=1)Z[ye]/=Z[0]}let se=new Float32Array(32),fe=new Float32Array(32),Te=Y.createBuffer(X.numberOfChannels,X.length,X.sampleRate),We=X.numberOfChannels;for(let ye=0;ye<We;ye+=1){let Ee=X.getChannelData(ye),Le=Te.getChannelData(ye);se.fill(0),fe.fill(0),za(Z,le,K,te,ne,se,fe,0,32,Ee,Le)}return Te})(await d(B),P,b,k)))()}let V=await O;return D.buffer=V,D.start(0),D}return await a(j,P,G,F),G};return{render(j,P,F){let D=A.get(P);return D!==void 0?Promise.resolve(D):E(j,P,F)}}})(ji,Ze,Tt,Rt,nr);var Rc;let Id=((l,e,s,a,d,b)=>class extends l{constructor(k,A){let O=a(k),E=d(O),j={...Kh,...A},P=e(O,E?null:k.baseLatency,j);super(k,!1,P,E?s(j.feedback,j.feedforward):null),(F=>{var D;F.getFrequencyResponse=(D=F.getFrequencyResponse,(G,N,V)=>{if(G.length!==N.length||N.length!==V.length)throw $s();return D.call(F,G,N,V)})})(P),this._nativeIIRFilterNode=P,b(this,1)}getFrequencyResponse(k,A,O){return this._nativeIIRFilterNode.getFrequencyResponse(k,A,O)}})(ft,(Rc=Pd,(l,e,s)=>{if(l.createIIRFilter===void 0)return Rc(l,e,s);let a=l.createIIRFilter(s.feedforward,s.feedback);return bt(a,s),a}),Dd,et,Qe,gi),jd=((l,e,s,a,d)=>(b,k)=>{let A=k.listener,{forwardX:O,forwardY:E,forwardZ:j,positionX:P,positionY:F,positionZ:D,upX:G,upY:N,upZ:V}=A.forwardX===void 0?(()=>{let B=e(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),X=d(k),Y=a(k,256,9,0),Q=(K,le)=>{let te=s(k,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:le});return te.connect(B,0,K),te.start(),Object.defineProperty(te.offset,"defaultValue",{get:()=>le}),l({context:b},X,te.offset,He,pe)},J=[0,0,-1,0,1,0],Z=[0,0,0];return Y.onaudioprocess=({inputBuffer:K})=>{let le=[K.getChannelData(0)[0],K.getChannelData(1)[0],K.getChannelData(2)[0],K.getChannelData(3)[0],K.getChannelData(4)[0],K.getChannelData(5)[0]];le.some((ne,se)=>ne!==J[se])&&(A.setOrientation(...le),J=le);let te=[K.getChannelData(6)[0],K.getChannelData(7)[0],K.getChannelData(8)[0]];te.some((ne,se)=>ne!==Z[se])&&(A.setPosition(...te),Z=te)},B.connect(Y),{forwardX:Q(0,0),forwardY:Q(1,0),forwardZ:Q(2,-1),positionX:Q(6,0),positionY:Q(7,0),positionZ:Q(8,0),upX:Q(3,0),upY:Q(4,1),upZ:Q(5,0)}})():A;return{get forwardX(){return O},get forwardY(){return E},get forwardZ(){return j},get positionX(){return P},get positionY(){return F},get positionZ(){return D},get upX(){return G},get upY(){return N},get upZ(){return V}}})(mn,ti,Li,Ss,Qe),Ec=new WeakMap,Qo=((l,e,s,a,d,b)=>class extends s{constructor(k,A){super(k),this._nativeContext=k,f.set(this,k),a(k)&&d.set(k,new Set),this._destination=new l(this,A),this._listener=e(this,k),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(k){let A=typeof k=="function"?b(this,k):null;this._nativeContext.onstatechange=A;let O=this._nativeContext.onstatechange;this._onstatechange=O!==null&&O===A?k:O}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(bd,jd,hc,Qe,Ec,Ii),Pc=((l,e,s,a,d,b)=>(k,A)=>{let O=k.createOscillator();return bt(O,A),ut(O,A,"detune"),ut(O,A,"frequency"),A.periodicWave!==void 0?O.setPeriodicWave(A.periodicWave):at(O,A,"type"),e(s,()=>s(k))||Po(O),e(a,()=>a(k))||b(O,k),e(d,()=>d(k))||Do(O),l(k,O),O})(tr,Qt,Io,$a,jo,Ka),Ld=((l,e,s,a,d,b,k)=>class extends l{constructor(A,O){let E=d(A),j={...sd,...O},P=s(E,j),F=b(E),D=F?a():null,G=A.sampleRate/2;super(A,!1,P,D),this._detune=e(this,F,P.detune,153600,-153600),this._frequency=e(this,F,P.frequency,G,-G),this._nativeOscillatorNode=P,this._onended=null,this._oscillatorNodeRenderer=D,this._oscillatorNodeRenderer!==null&&j.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=j.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(A){let O=typeof A=="function"?k(this,A):null;this._nativeOscillatorNode.onended=O;let E=this._nativeOscillatorNode.onended;this._onended=E!==null&&E===O?A:E}get type(){return this._nativeOscillatorNode.type}set type(A){this._nativeOscillatorNode.type=A,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(A){this._nativeOscillatorNode.setPeriodicWave(A),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=A)}start(A=0){if(this._nativeOscillatorNode.start(A),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=A),this.context.state!=="closed"){U(this);let O=()=>{this._nativeOscillatorNode.removeEventListener("ended",O),ot(this)&&ee(this)};this._nativeOscillatorNode.addEventListener("ended",O)}}stop(A=0){this._nativeOscillatorNode.stop(A),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=A)}})(ft,mn,Pc,((l,e,s,a,d)=>()=>{let b=new WeakMap,k=null,A=null,O=null;return{set periodicWave(E){k=E},set start(E){A=E},set stop(E){O=E},render(E,j,P){let F=b.get(j);return F!==void 0?Promise.resolve(F):(async(D,G,N)=>{let V=s(D),B=$(V,G);if(!B){let X={channelCount:V.channelCount,channelCountMode:V.channelCountMode,channelInterpretation:V.channelInterpretation,detune:V.detune.value,frequency:V.frequency.value,periodicWave:k===null?void 0:k,type:V.type};V=e(G,X),A!==null&&V.start(A),O!==null&&V.stop(O)}return b.set(G,V),B?(await l(G,D.detune,V.detune,N),await l(G,D.frequency,V.frequency,N)):(await a(G,D.detune,V.detune,N),await a(G,D.frequency,V.frequency,N)),await d(D,G,V,N),V})(E,j,P)}}})(Sn,Pc,Ze,Cn,Rt),et,Qe,Ii),Dc=(Ic=ji,(l,e)=>{let s=Ic(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),a=l.createBuffer(1,2,44100);return s.buffer=a,s.loop=!0,s.connect(e),s.start(),()=>{s.stop(),s.disconnect(e)}});var Ic;let Fd=((l,e,s,a,d)=>(b,{curve:k,oversample:A,...O})=>{let E=b.createWaveShaper(),j=b.createWaveShaper();bt(E,O),bt(j,O);let P=s(b,{...O,gain:1}),F=s(b,{...O,gain:-1}),D=s(b,{...O,gain:1}),G=s(b,{...O,gain:-1}),N=null,V=!1,B=null,X={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(Y){P.channelCount=Y,F.channelCount=Y,E.channelCount=Y,D.channelCount=Y,j.channelCount=Y,G.channelCount=Y},get channelCountMode(){return E.channelCountMode},set channelCountMode(Y){P.channelCountMode=Y,F.channelCountMode=Y,E.channelCountMode=Y,D.channelCountMode=Y,j.channelCountMode=Y,G.channelCountMode=Y},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(Y){P.channelInterpretation=Y,F.channelInterpretation=Y,E.channelInterpretation=Y,D.channelInterpretation=Y,j.channelInterpretation=Y,G.channelInterpretation=Y},get context(){return E.context},get curve(){return B},set curve(Y){if(Y!==null&&Y.length<2)throw e();if(Y===null)E.curve=Y,j.curve=Y;else{let Q=Y.length,J=new Float32Array(Q+2-Q%2),Z=new Float32Array(Q+2-Q%2);J[0]=Y[0],Z[0]=-Y[Q-1];let K=Math.ceil((Q+1)/2),le=(Q+1)/2-1;for(let te=1;te<K;te+=1){let ne=te/K*le,se=Math.floor(ne),fe=Math.ceil(ne);J[te]=se===fe?Y[se]:(1-(ne-se))*Y[se]+(1-(fe-ne))*Y[fe],Z[te]=se===fe?-Y[Q-1-se]:-(1-(ne-se))*Y[Q-1-se]-(1-(fe-ne))*Y[Q-1-fe]}J[K]=Q%2==1?Y[K-1]:(Y[K-2]+Y[K-1])/2,E.curve=J,j.curve=Z}B=Y,V&&(a(B)&&N===null?N=l(b,P):N!==null&&(N(),N=null))},get inputs(){return[P]},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get oversample(){return E.oversample},set oversample(Y){E.oversample=Y,j.oversample=Y},addEventListener:(...Y)=>P.addEventListener(Y[0],Y[1],Y[2]),dispatchEvent:(...Y)=>P.dispatchEvent(Y[0]),removeEventListener:(...Y)=>P.removeEventListener(Y[0],Y[1],Y[2])};return k!==null&&(X.curve=k instanceof Float32Array?k:new Float32Array(k)),A!==X.oversample&&(X.oversample=A),d(Di(X,D),()=>{P.connect(E).connect(D),P.connect(F).connect(j).connect(G).connect(D),V=!0,a(B)&&(N=l(b,P))},()=>{P.disconnect(E),E.disconnect(D),P.disconnect(F),F.disconnect(j),j.disconnect(G),G.disconnect(D),V=!1,N!==null&&(N(),N=null)})})(Dc,gt,Wt,Za,ei),ir=((l,e,s,a,d,b,k)=>(A,O)=>{let E=A.createWaveShaper();if(b!==null&&b.name==="webkitAudioContext"&&A.createGain().gain.automationRate===void 0)return s(A,O);bt(E,O);let j=O.curve===null||O.curve instanceof Float32Array?O.curve:new Float32Array(O.curve);if(j!==null&&j.length<2)throw e();at(E,{curve:j},"curve"),at(E,O,"oversample");let P=null,F=!1;return k(E,"curve",D=>()=>D.call(E),D=>G=>(D.call(E,G),F&&(a(G)&&P===null?P=l(A,E):a(G)||P===null||(P(),P=null)),G)),d(E,()=>{F=!0,a(E.curve)&&(P=l(A,E))},()=>{F=!1,P!==null&&(P(),P=null)})})(Dc,gt,Fd,Za,ei,qn,Ks),qd=((l,e,s,a,d,b,k,A,O)=>(E,{coneInnerAngle:j,coneOuterAngle:P,coneOuterGain:F,distanceModel:D,maxDistance:G,orientationX:N,orientationY:V,orientationZ:B,panningModel:X,positionX:Y,positionY:Q,positionZ:J,refDistance:Z,rolloffFactor:K,...le})=>{let te=E.createPanner();if(le.channelCount>2||le.channelCountMode==="max")throw k();bt(te,le);let ne={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},se=s(E,{...ne,channelInterpretation:"speakers",numberOfInputs:6}),fe=a(E,{...le,gain:1}),Te=a(E,{...ne,gain:1}),We=a(E,{...ne,gain:0}),ye=a(E,{...ne,gain:0}),Ee=a(E,{...ne,gain:0}),Le=a(E,{...ne,gain:0}),Ae=a(E,{...ne,gain:0}),Ie=d(E,256,6,1),Be=b(E,{...ne,curve:new Float32Array([1,1]),oversample:"none"}),mt=[N,V,B],xt=[Y,Q,J];Ie.onaudioprocess=({inputBuffer:be})=>{let jt=[be.getChannelData(0)[0],be.getChannelData(1)[0],be.getChannelData(2)[0]];jt.some((tn,li)=>tn!==mt[li])&&(te.setOrientation(...jt),mt=jt);let En=[be.getChannelData(3)[0],be.getChannelData(4)[0],be.getChannelData(5)[0]];En.some((tn,li)=>tn!==xt[li])&&(te.setPosition(...En),xt=En)},Object.defineProperty(We.gain,"defaultValue",{get:()=>0}),Object.defineProperty(ye.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Ee.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Le.gain,"defaultValue",{get:()=>0}),Object.defineProperty(Ae.gain,"defaultValue",{get:()=>0});let Fe={get bufferSize(){},get channelCount(){return te.channelCount},set channelCount(be){if(be>2)throw k();fe.channelCount=be,te.channelCount=be},get channelCountMode(){return te.channelCountMode},set channelCountMode(be){if(be==="max")throw k();fe.channelCountMode=be,te.channelCountMode=be},get channelInterpretation(){return te.channelInterpretation},set channelInterpretation(be){fe.channelInterpretation=be,te.channelInterpretation=be},get coneInnerAngle(){return te.coneInnerAngle},set coneInnerAngle(be){te.coneInnerAngle=be},get coneOuterAngle(){return te.coneOuterAngle},set coneOuterAngle(be){te.coneOuterAngle=be},get coneOuterGain(){return te.coneOuterGain},set coneOuterGain(be){if(be<0||be>1)throw e();te.coneOuterGain=be},get context(){return te.context},get distanceModel(){return te.distanceModel},set distanceModel(be){te.distanceModel=be},get inputs(){return[fe]},get maxDistance(){return te.maxDistance},set maxDistance(be){if(be<0)throw new RangeError;te.maxDistance=be},get numberOfInputs(){return te.numberOfInputs},get numberOfOutputs(){return te.numberOfOutputs},get orientationX(){return Te.gain},get orientationY(){return We.gain},get orientationZ(){return ye.gain},get panningModel(){return te.panningModel},set panningModel(be){te.panningModel=be},get positionX(){return Ee.gain},get positionY(){return Le.gain},get positionZ(){return Ae.gain},get refDistance(){return te.refDistance},set refDistance(be){if(be<0)throw new RangeError;te.refDistance=be},get rolloffFactor(){return te.rolloffFactor},set rolloffFactor(be){if(be<0)throw new RangeError;te.rolloffFactor=be},addEventListener:(...be)=>fe.addEventListener(be[0],be[1],be[2]),dispatchEvent:(...be)=>fe.dispatchEvent(be[0]),removeEventListener:(...be)=>fe.removeEventListener(be[0],be[1],be[2])};return j!==Fe.coneInnerAngle&&(Fe.coneInnerAngle=j),P!==Fe.coneOuterAngle&&(Fe.coneOuterAngle=P),F!==Fe.coneOuterGain&&(Fe.coneOuterGain=F),D!==Fe.distanceModel&&(Fe.distanceModel=D),G!==Fe.maxDistance&&(Fe.maxDistance=G),N!==Fe.orientationX.value&&(Fe.orientationX.value=N),V!==Fe.orientationY.value&&(Fe.orientationY.value=V),B!==Fe.orientationZ.value&&(Fe.orientationZ.value=B),X!==Fe.panningModel&&(Fe.panningModel=X),Y!==Fe.positionX.value&&(Fe.positionX.value=Y),Q!==Fe.positionY.value&&(Fe.positionY.value=Q),J!==Fe.positionZ.value&&(Fe.positionZ.value=J),Z!==Fe.refDistance&&(Fe.refDistance=Z),K!==Fe.rolloffFactor&&(Fe.rolloffFactor=K),mt[0]===1&&mt[1]===0&&mt[2]===0||te.setOrientation(...mt),xt[0]===0&&xt[1]===0&&xt[2]===0||te.setPosition(...xt),O(Di(Fe,te),()=>{fe.connect(te),l(fe,Be,0,0),Be.connect(Te).connect(se,0,0),Be.connect(We).connect(se,0,1),Be.connect(ye).connect(se,0,2),Be.connect(Ee).connect(se,0,3),Be.connect(Le).connect(se,0,4),Be.connect(Ae).connect(se,0,5),se.connect(Ie).connect(E.destination)},()=>{fe.disconnect(te),A(fe,Be,0,0),Be.disconnect(Te),Te.disconnect(se),Be.disconnect(We),We.disconnect(se),Be.disconnect(ye),ye.disconnect(se),Be.disconnect(Ee),Ee.disconnect(se),Be.disconnect(Le),Le.disconnect(se),Be.disconnect(Ae),Ae.disconnect(se),se.disconnect(Ie),Ie.disconnect(E.destination)})})(Kn,gt,ti,Wt,Ss,ir,qt,mi,ei),jc=(Lc=qd,(l,e)=>{let s=l.createPanner();return s.orientationX===void 0?Lc(l,e):(bt(s,e),ut(s,e,"orientationX"),ut(s,e,"orientationY"),ut(s,e,"orientationZ"),ut(s,e,"positionX"),ut(s,e,"positionY"),ut(s,e,"positionZ"),at(s,e,"coneInnerAngle"),at(s,e,"coneOuterAngle"),at(s,e,"coneOuterGain"),at(s,e,"distanceModel"),at(s,e,"maxDistance"),at(s,e,"panningModel"),at(s,e,"refDistance"),at(s,e,"rolloffFactor"),s)});var Lc;let Vd=((l,e,s,a,d,b,k)=>class extends l{constructor(A,O){let E=d(A),j={...rd,...O},P=s(E,j),F=b(E);super(A,!1,P,F?a():null),this._nativePannerNode=P,this._orientationX=e(this,F,P.orientationX,He,pe),this._orientationY=e(this,F,P.orientationY,He,pe),this._orientationZ=e(this,F,P.orientationZ,He,pe),this._positionX=e(this,F,P.positionX,He,pe),this._positionY=e(this,F,P.positionY,He,pe),this._positionZ=e(this,F,P.positionZ,He,pe),k(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(A){this._nativePannerNode.coneInnerAngle=A}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(A){this._nativePannerNode.coneOuterAngle=A}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(A){this._nativePannerNode.coneOuterGain=A}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(A){this._nativePannerNode.distanceModel=A}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(A){this._nativePannerNode.maxDistance=A}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(A){this._nativePannerNode.panningModel=A}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(A){this._nativePannerNode.refDistance=A}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(A){this._nativePannerNode.rolloffFactor=A}})(ft,mn,jc,((l,e,s,a,d,b,k,A,O,E)=>()=>{let j=new WeakMap,P=null;return{render(F,D,G){let N=j.get(D);return N!==void 0?Promise.resolve(N):(async(V,B,X)=>{let Y=null,Q=b(V),J={channelCount:Q.channelCount,channelCountMode:Q.channelCountMode,channelInterpretation:Q.channelInterpretation},Z={...J,coneInnerAngle:Q.coneInnerAngle,coneOuterAngle:Q.coneOuterAngle,coneOuterGain:Q.coneOuterGain,distanceModel:Q.distanceModel,maxDistance:Q.maxDistance,panningModel:Q.panningModel,refDistance:Q.refDistance,rolloffFactor:Q.rolloffFactor},K=$(Q,B);if("bufferSize"in Q)Y=a(B,{...J,gain:1});else if(!K){let le={...Z,orientationX:Q.orientationX.value,orientationY:Q.orientationY.value,orientationZ:Q.orientationZ.value,positionX:Q.positionX.value,positionY:Q.positionY.value,positionZ:Q.positionZ.value};Q=d(B,le)}if(j.set(B,Y===null?Q:Y),Y!==null){if(P===null){if(k===null)throw new Error("Missing the native OfflineAudioContext constructor.");let ye=new k(6,V.context.length,B.sampleRate),Ee=e(ye,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});Ee.connect(ye.destination),P=(async()=>{let Le=await Promise.all([V.orientationX,V.orientationY,V.orientationZ,V.positionX,V.positionY,V.positionZ].map(async(Ae,Ie)=>{let Be=s(ye,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:Ie===0?1:0});return await A(ye,Ae,Be.offset,X),Be}));for(let Ae=0;Ae<6;Ae+=1)Le[Ae].connect(Ee,0,Ae),Le[Ae].start(0);return E(ye)})()}let le=await P,te=a(B,{...J,gain:1});await O(V,B,te,X);let ne=[];for(let ye=0;ye<le.numberOfChannels;ye+=1)ne.push(le.getChannelData(ye));let se=[ne[0][0],ne[1][0],ne[2][0]],fe=[ne[3][0],ne[4][0],ne[5][0]],Te=a(B,{...J,gain:1}),We=d(B,{...Z,orientationX:se[0],orientationY:se[1],orientationZ:se[2],positionX:fe[0],positionY:fe[1],positionZ:fe[2]});te.connect(Te).connect(We.inputs[0]),We.connect(Y);for(let ye=128;ye<le.length;ye+=128){let Ee=[ne[0][ye],ne[1][ye],ne[2][ye]],Le=[ne[3][ye],ne[4][ye],ne[5][ye]];if(Ee.some((Ae,Ie)=>Ae!==se[Ie])||Le.some((Ae,Ie)=>Ae!==fe[Ie])){se=Ee,fe=Le;let Ae=ye/B.sampleRate;Te.gain.setValueAtTime(0,Ae),Te=a(B,{...J,gain:0}),We=d(B,{...Z,orientationX:se[0],orientationY:se[1],orientationZ:se[2],positionX:fe[0],positionY:fe[1],positionZ:fe[2]}),Te.gain.setValueAtTime(1,Ae),te.connect(Te).connect(We.inputs[0]),We.connect(Y)}}return Y}return K?(await l(B,V.orientationX,Q.orientationX,X),await l(B,V.orientationY,Q.orientationY,X),await l(B,V.orientationZ,Q.orientationZ,X),await l(B,V.positionX,Q.positionX,X),await l(B,V.positionY,Q.positionY,X),await l(B,V.positionZ,Q.positionZ,X)):(await A(B,V.orientationX,Q.orientationX,X),await A(B,V.orientationY,Q.orientationY,X),await A(B,V.orientationZ,Q.orientationZ,X),await A(B,V.positionX,Q.positionX,X),await A(B,V.positionY,Q.positionY,X),await A(B,V.positionZ,Q.positionZ,X)),Xt(Q)?await O(V,B,Q.inputs[0],X):await O(V,B,Q,X),Q})(F,D,G)}}})(Sn,ti,Li,Wt,jc,Ze,Tt,Cn,Rt,nr),et,Qe,gi),Nd=((l,e,s,a)=>class El{constructor(b,k){let A=e(b),O=a({...od,...k}),E=l(A,O);return s.add(E),E}static[Symbol.hasInstance](b){return b!==null&&typeof b=="object"&&Object.getPrototypeOf(b)===El.prototype||s.has(b)}})((l=>(e,{disableNormalization:s,imag:a,real:d})=>{let b=a instanceof Float32Array?a:new Float32Array(a),k=d instanceof Float32Array?d:new Float32Array(d),A=e.createPeriodicWave(k,b,{disableNormalization:s});if(Array.from(a).length<2)throw l();return A})(re),et,new WeakSet,l=>{let{imag:e,real:s}=l;return e===void 0?s===void 0?{...l,imag:[0,0],real:[0,0]}:{...l,imag:Array.from(s,()=>0),real:s}:s===void 0?{...l,imag:e,real:Array.from(e,()=>0)}:{...l,imag:e,real:s}}),Fc=((l,e)=>(s,a)=>{let d=a.channelCountMode;if(d==="clamped-max")throw e();if(s.createStereoPanner===void 0)return l(s,a);let b=s.createStereoPanner();return bt(b,a),ut(b,a,"pan"),Object.defineProperty(b,"channelCountMode",{get:()=>d,set:k=>{if(k!==d)throw e()}}),b})(((l,e,s,a,d,b)=>{let k=new Float32Array([1,1]),A=Math.PI/2,O={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},E={...O,oversample:"none"},j=(P,F,D,G,N)=>{if(F===1)return((V,B,X,Y)=>{let Q=new Float32Array(16385),J=new Float32Array(16385);for(let se=0;se<16385;se+=1){let fe=se/16384*A;Q[se]=Math.cos(fe),J[se]=Math.sin(fe)}let Z=s(V,{...O,gain:0}),K=a(V,{...E,curve:Q}),le=a(V,{...E,curve:k}),te=s(V,{...O,gain:0}),ne=a(V,{...E,curve:J});return{connectGraph(){B.connect(Z),B.connect(le.inputs===void 0?le:le.inputs[0]),B.connect(te),le.connect(X),X.connect(K.inputs===void 0?K:K.inputs[0]),X.connect(ne.inputs===void 0?ne:ne.inputs[0]),K.connect(Z.gain),ne.connect(te.gain),Z.connect(Y,0,0),te.connect(Y,0,1)},disconnectGraph(){B.disconnect(Z),B.disconnect(le.inputs===void 0?le:le.inputs[0]),B.disconnect(te),le.disconnect(X),X.disconnect(K.inputs===void 0?K:K.inputs[0]),X.disconnect(ne.inputs===void 0?ne:ne.inputs[0]),K.disconnect(Z.gain),ne.disconnect(te.gain),Z.disconnect(Y,0,0),te.disconnect(Y,0,1)}}})(P,D,G,N);if(F===2)return((V,B,X,Y)=>{let Q=new Float32Array(16385),J=new Float32Array(16385),Z=new Float32Array(16385),K=new Float32Array(16385),le=Math.floor(8192.5);for(let Ie=0;Ie<16385;Ie+=1)if(Ie>le){let Be=(Ie-le)/(16384-le)*A;Q[Ie]=Math.cos(Be),J[Ie]=Math.sin(Be),Z[Ie]=0,K[Ie]=1}else{let Be=Ie/(16384-le)*A;Q[Ie]=1,J[Ie]=0,Z[Ie]=Math.cos(Be),K[Ie]=Math.sin(Be)}let te=e(V,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),ne=s(V,{...O,gain:0}),se=a(V,{...E,curve:Q}),fe=s(V,{...O,gain:0}),Te=a(V,{...E,curve:J}),We=a(V,{...E,curve:k}),ye=s(V,{...O,gain:0}),Ee=a(V,{...E,curve:Z}),Le=s(V,{...O,gain:0}),Ae=a(V,{...E,curve:K});return{connectGraph(){B.connect(te),B.connect(We.inputs===void 0?We:We.inputs[0]),te.connect(ne,0),te.connect(fe,0),te.connect(ye,1),te.connect(Le,1),We.connect(X),X.connect(se.inputs===void 0?se:se.inputs[0]),X.connect(Te.inputs===void 0?Te:Te.inputs[0]),X.connect(Ee.inputs===void 0?Ee:Ee.inputs[0]),X.connect(Ae.inputs===void 0?Ae:Ae.inputs[0]),se.connect(ne.gain),Te.connect(fe.gain),Ee.connect(ye.gain),Ae.connect(Le.gain),ne.connect(Y,0,0),ye.connect(Y,0,0),fe.connect(Y,0,1),Le.connect(Y,0,1)},disconnectGraph(){B.disconnect(te),B.disconnect(We.inputs===void 0?We:We.inputs[0]),te.disconnect(ne,0),te.disconnect(fe,0),te.disconnect(ye,1),te.disconnect(Le,1),We.disconnect(X),X.disconnect(se.inputs===void 0?se:se.inputs[0]),X.disconnect(Te.inputs===void 0?Te:Te.inputs[0]),X.disconnect(Ee.inputs===void 0?Ee:Ee.inputs[0]),X.disconnect(Ae.inputs===void 0?Ae:Ae.inputs[0]),se.disconnect(ne.gain),Te.disconnect(fe.gain),Ee.disconnect(ye.gain),Ae.disconnect(Le.gain),ne.disconnect(Y,0,0),ye.disconnect(Y,0,0),fe.disconnect(Y,0,1),Le.disconnect(Y,0,1)}}})(P,D,G,N);throw d()};return(P,{channelCount:F,channelCountMode:D,pan:G,...N})=>{if(D==="max")throw d();let V=l(P,{...N,channelCount:1,channelCountMode:D,numberOfInputs:2}),B=s(P,{...N,channelCount:F,channelCountMode:D,gain:1}),X=s(P,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:G}),{connectGraph:Y,disconnectGraph:Q}=j(P,F,B,X,V);Object.defineProperty(X.gain,"defaultValue",{get:()=>0}),Object.defineProperty(X.gain,"maxValue",{get:()=>1}),Object.defineProperty(X.gain,"minValue",{get:()=>-1});let J={get bufferSize(){},get channelCount(){return B.channelCount},set channelCount(K){B.channelCount!==K&&(Z&&Q(),{connectGraph:Y,disconnectGraph:Q}=j(P,K,B,X,V),Z&&Y()),B.channelCount=K},get channelCountMode(){return B.channelCountMode},set channelCountMode(K){if(K==="clamped-max"||K==="max")throw d();B.channelCountMode=K},get channelInterpretation(){return B.channelInterpretation},set channelInterpretation(K){B.channelInterpretation=K},get context(){return B.context},get inputs(){return[B]},get numberOfInputs(){return B.numberOfInputs},get numberOfOutputs(){return B.numberOfOutputs},get pan(){return X.gain},addEventListener:(...K)=>B.addEventListener(K[0],K[1],K[2]),dispatchEvent:(...K)=>B.dispatchEvent(K[0]),removeEventListener:(...K)=>B.removeEventListener(K[0],K[1],K[2])},Z=!1;return b(Di(J,V),()=>{Y(),Z=!0},()=>{Q(),Z=!1})}})(ti,Ts,Wt,ir,qt,ei),qt),Wd=((l,e,s,a,d,b)=>class extends l{constructor(k,A){let O=d(k),E={...ad,...A},j=s(O,E),P=b(O);super(k,!1,j,P?a():null),this._pan=e(this,P,j.pan)}get pan(){return this._pan}})(ft,mn,Fc,((l,e,s,a,d)=>()=>{let b=new WeakMap;return{render(k,A,O){let E=b.get(A);return E!==void 0?Promise.resolve(E):(async(j,P,F)=>{let D=s(j),G=$(D,P);if(!G){let N={channelCount:D.channelCount,channelCountMode:D.channelCountMode,channelInterpretation:D.channelInterpretation,pan:D.pan.value};D=e(P,N)}return b.set(P,D),G?await l(P,j.pan,D.pan,F):await a(P,j.pan,D.pan,F),Xt(D)?await d(j,P,D.inputs[0],F):await d(j,P,D,F),D})(k,A,O)}}})(Sn,Fc,Ze,Cn,Rt),et,Qe),Bd=((l,e,s)=>()=>{let a=new WeakMap;return{render(d,b,k){let A=a.get(b);return A!==void 0?Promise.resolve(A):(async(O,E,j)=>{let P=e(O);if(!$(P,E)){let F={channelCount:P.channelCount,channelCountMode:P.channelCountMode,channelInterpretation:P.channelInterpretation,curve:P.curve,oversample:P.oversample};P=l(E,F)}return a.set(E,P),Xt(P)?await s(O,E,P.inputs[0],j):await s(O,E,P,j),P})(d,b,k)}}})(ir,Ze,Rt),zd=((l,e,s,a,d,b,k)=>class extends l{constructor(A,O){let E=d(A),j={...cd,...O},P=s(E,j);super(A,!0,P,b(E)?a():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=P,k(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(A){if(A===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(A.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=A}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(A){this._nativeWaveShaperNode.oversample=A}})(ft,gt,ir,Bd,et,Qe,gi),qc=(l=>l!==null&&l.isSecureContext)(fn),Zo=(l=>(e,s,a)=>{Object.defineProperties(l,{currentFrame:{configurable:!0,get:()=>Math.round(e*s)},currentTime:{configurable:!0,get:()=>e}});try{return a()}finally{l!==null&&(delete l.currentFrame,delete l.currentTime)}})(fn),Vc=new WeakMap,Ud=((l,e)=>s=>{let a=l.get(s);if(a!==void 0)return a;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return a=new e(1,1,8e3),l.set(s,a),a})(Vc,Tt),sr=(l=>l===null?null:l.hasOwnProperty("AudioWorkletNode")?l.AudioWorkletNode:null)(fn),Hd=qc?((l,e,s,a,d,b,k,A,O,E,j,P)=>(F,D,G={credentials:"omit"})=>{let N=b(F);if(N.audioWorklet!==void 0)return Promise.all([d(D),Promise.resolve(l(j,j))]).then(([[Y,Q],J])=>{let[Z,K]=m(Y,Q),le=J?K:K.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),te=new Blob([`${Z};(registerProcessor=>{${le}
})((n,p)=>registerProcessor(n,class extends p{${J?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${J?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))`],{type:"application/javascript; charset=utf-8"}),ne=URL.createObjectURL(te);return N.audioWorklet.addModule(ne,G).then(()=>{if(!A(N))return k(N).audioWorklet.addModule(ne,G)}).finally(()=>URL.revokeObjectURL(ne))});let V=E.get(F);if(V!==void 0&&V.has(D))return Promise.resolve();let B=O.get(F);if(B!==void 0){let Y=B.get(D);if(Y!==void 0)return Y}let X=d(D).then(([Y,Q])=>{let[J,Z]=m(Y,Q);return s(`${J};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${Z}
})})(window,'_AWGS')`)}).then(()=>{let Y=P._AWGS.pop();if(Y===void 0)throw new SyntaxError;a(N.currentTime,N.sampleRate,()=>Y(class{},void 0,(Q,J)=>{if(Q.trim()==="")throw e();let Z=T.get(N);if(Z!==void 0){if(Z.has(Q))throw e();R(J),M(J.parameterDescriptors),Z.set(Q,J)}else R(J),M(J.parameterDescriptors),T.set(N,new Map([[Q,J]]))},N.sampleRate,void 0,void 0))});return B===void 0?O.set(F,new Map([[D,X]])):B.set(D,X),X.then(()=>{let Y=E.get(F);Y===void 0?E.set(F,new Set([D])):Y.add(D)}).finally(()=>{let Y=O.get(F);Y!==void 0&&Y.delete(D)}),X})(Qt,qt,(l=>e=>new Promise((s,a)=>{if(l===null)return void a(new SyntaxError);let d=l.document.head;if(d===null)a(new SyntaxError);else{let b=l.document.createElement("script"),k=new Blob([e],{type:"application/javascript"}),A=URL.createObjectURL(k),O=l.onerror,E=()=>{l.onerror=O,URL.revokeObjectURL(A)};l.onerror=(j,P,F,D,G)=>P===A||P===l.location.href&&F===1&&D===1?(E(),a(G),!1):O!==null?O(j,P,F,D,G):void 0,b.onerror=()=>{E(),a(new SyntaxError)},b.onload=()=>{E(),s()},b.src=A,b.type="module",d.appendChild(b)}}))(fn),Zo,(l=>async e=>{try{let s=await fetch(e);if(s.ok)return[await s.text(),s.url]}catch{}throw l()})(()=>new DOMException("","AbortError")),et,Ud,Qe,new WeakMap,new WeakMap,((l,e)=>async()=>{if(l===null)return!0;if(e===null)return!1;let s=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),a=new e(1,128,8e3),d=URL.createObjectURL(s),b=!1,k=!1;try{await a.audioWorklet.addModule(d);let A=new l(a,"a",{numberOfOutputs:0}),O=a.createOscillator();A.port.onmessage=()=>b=!0,A.onprocessorerror=()=>k=!0,O.connect(A),await a.startRendering()}catch{}finally{URL.revokeObjectURL(d)}return b&&!k})(sr,Tt),fn):void 0,Gd=((l,e)=>s=>l(s)||e(s))(qo,Qe),Nc=((l,e,s,a,d,b,k,A,O,E,j,P,F,D,G,N,V,B,X,Y)=>class extends G{constructor(Q,J){super(Q,J),this._nativeContext=Q,this._audioWorklet=l===void 0?void 0:{addModule:(Z,K)=>l(this,Z,K)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new d(this)}createBuffer(Q,J,Z){return new s({length:J,numberOfChannels:Q,sampleRate:Z})}createBufferSource(){return new a(this)}createChannelMerger(Q=6){return new b(this,{numberOfInputs:Q})}createChannelSplitter(Q=6){return new k(this,{numberOfOutputs:Q})}createConstantSource(){return new A(this)}createConvolver(){return new O(this)}createDelay(Q=1){return new j(this,{maxDelayTime:Q})}createDynamicsCompressor(){return new P(this)}createGain(){return new F(this)}createIIRFilter(Q,J){return new D(this,{feedback:J,feedforward:Q})}createOscillator(){return new N(this)}createPanner(){return new V(this)}createPeriodicWave(Q,J,Z={disableNormalization:!1}){return new B(this,{...Z,imag:J,real:Q})}createStereoPanner(){return new X(this)}createWaveShaper(){return new Y(this)}decodeAudioData(Q,J,Z){return E(this._nativeContext,Q).then(K=>(typeof J=="function"&&J(K),K)).catch(K=>{throw typeof Z=="function"&&Z(K),K})}})(Hd,_d,gd,yd,xd,Sd,Cd,Md,Ad,((l,e,s,a,d,b,k,A,O,E,j)=>(P,F)=>{let D=k(P)?P:b(P);if(d.has(F)){let G=s();return Promise.reject(G)}try{d.add(F)}catch{}return e(O,()=>O(D))?D.decodeAudioData(F).then(G=>(e(A,()=>A(G))||j(G),l.add(G),G)):new Promise((G,N)=>{let V=()=>{try{(X=>{let{port1:Y}=new MessageChannel;Y.postMessage(X,[X])})(F)}catch{}},B=X=>{N(X),V()};try{D.decodeAudioData(F,X=>{typeof X.copyFromChannel!="function"&&(E(X),qe(X)),l.add(X),V(),G(X)},X=>{B(X===null?a():X)})}catch(X){B(X)}})})(Wo,Qt,()=>new DOMException("","DataCloneError"),()=>new DOMException("","EncodingError"),new WeakSet,et,Gd,ce,xs,zo,Uo),Od,Rd,Ed,Id,Qo,Ld,Vd,Nd,Wd,zd),Yd=((l,e,s,a)=>class extends l{constructor(d,b){let k=s(d),A=e(k,b);if(a(k))throw TypeError();super(d,!0,A,null),this._nativeMediaElementAudioSourceNode=A}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(ft,(l,e)=>l.createMediaElementSource(e.mediaElement),et,Qe),Xd=((l,e,s,a)=>class extends l{constructor(d,b){let k=s(d);if(a(k))throw new TypeError;let A={...ed,...b},O=e(k,A);super(d,!1,O,null),this._nativeMediaStreamAudioDestinationNode=O}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(ft,(l,e)=>{let s=l.createMediaStreamDestination();return bt(s,e),s.numberOfOutputs===1&&Object.defineProperty(s,"numberOfOutputs",{get:()=>0}),s},et,Qe),Qd=((l,e,s,a)=>class extends l{constructor(d,b){let k=s(d),A=e(k,b);if(a(k))throw new TypeError;super(d,!0,A,null),this._nativeMediaStreamAudioSourceNode=A}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(ft,(l,{mediaStream:e})=>{let s=e.getAudioTracks();s.sort((b,k)=>b.id<k.id?-1:b.id>k.id?1:0);let a=s.slice(0,1),d=l.createMediaStreamSource(new MediaStream(a));return Object.defineProperty(d,"mediaStream",{value:e}),d},et,Qe),Zd=((l,e,s)=>class extends l{constructor(a,d){let b=s(a);super(a,!0,e(b,d),null)}})(ft,((l,e)=>(s,{mediaStreamTrack:a})=>{if(typeof s.createMediaStreamTrackSource=="function")return s.createMediaStreamTrackSource(a);let d=new MediaStream([a]),b=s.createMediaStreamSource(d);if(a.kind!=="audio")throw l();if(e(s))throw new TypeError;return b})(gt,Qe),et),Jd=((l,e,s,a,d,b,k,A,O)=>class extends l{constructor(E={}){if(O===null)throw new Error("Missing the native AudioContext constructor.");let j=new O(E);if(j===null)throw a();if(!Yt(E.latencyHint))throw new TypeError(`The provided value '${E.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(E.sampleRate!==void 0&&j.sampleRate!==E.sampleRate)throw s();super(j,2);let{latencyHint:P}=E,{sampleRate:F}=j;if(this._baseLatency=typeof j.baseLatency=="number"?j.baseLatency:P==="balanced"?512/F:P==="interactive"||P===void 0?256/F:P==="playback"?1024/F:128*Math.max(2,Math.min(128,Math.round(P*F/128)))/F,this._nativeAudioContext=j,O.name==="webkitAudioContext"?(this._nativeGainNode=j.createGain(),this._nativeOscillatorNode=j.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(j.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,j.state==="running"){this._state="suspended";let D=()=>{this._state==="suspended"&&(this._state=null),j.removeEventListener("statechange",D)};j.addEventListener("statechange",D)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),At(this)}))}createMediaElementSource(E){return new d(this,{mediaElement:E})}createMediaStreamDestination(){return new b(this)}createMediaStreamSource(E){return new k(this,{mediaStream:E})}createMediaStreamTrackSource(E){return new A(this,{mediaStreamTrack:E})}resume(){return this._state==="suspended"?new Promise((E,j)=>{let P=()=>{this._nativeAudioContext.removeEventListener("statechange",P),this._nativeAudioContext.state==="running"?E():this.resume().then(E,j)};this._nativeAudioContext.addEventListener("statechange",P)}):this._nativeAudioContext.resume().catch(E=>{throw E===void 0||E.code===15?e():E})}suspend(){return this._nativeAudioContext.suspend().catch(E=>{throw E===void 0?e():E})}})(Nc,gt,qt,Qa,Yd,Xd,Qd,Zd,qn),Jo=(Wc=Ec,l=>{let e=Wc.get(l);if(e===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return e});var Wc;let $d=(Bc=Jo,(l,e)=>{Bc(l).add(e)});var Bc;let zc=(l=>(e,s,a=0,d=0)=>{let b=e[a];if(b===void 0)throw l();return Xs(s)?b.connect(s,0,d):b.connect(s,0)})(re),Kd=(l=>(e,s)=>{l(e).delete(s)})(Jo),Uc=(l=>(e,s,a,d=0)=>s===void 0?e.forEach(b=>b.disconnect()):typeof s=="number"?Js(l,e,s).disconnect():Xs(s)?a===void 0?e.forEach(b=>b.disconnect(s)):d===void 0?Js(l,e,a).disconnect(s,0):Js(l,e,a).disconnect(s,0,d):a===void 0?e.forEach(b=>b.disconnect(s)):Js(l,e,a).disconnect(s,0))(re),Hc=new WeakMap,ep=((l,e)=>s=>e(l,s))(Hc,I),tp=((l,e,s,a,d,b,k,A,O,E,j,P,F)=>(D,G,N,V)=>{if(V.numberOfInputs===0&&V.numberOfOutputs===0)throw O();let B=Array.isArray(V.outputChannelCount)?V.outputChannelCount:Array.from(V.outputChannelCount);if(B.some(ue=>ue<1))throw O();if(B.length!==V.numberOfOutputs)throw e();if(V.channelCountMode!=="explicit")throw O();let X=V.channelCount*V.numberOfInputs,Y=B.reduce((ue,Ue)=>ue+Ue,0),Q=N.parameterDescriptors===void 0?0:N.parameterDescriptors.length;if(X+Q>6||Y>6)throw O();let J=new MessageChannel,Z=[],K=[];for(let ue=0;ue<V.numberOfInputs;ue+=1)Z.push(k(D,{channelCount:V.channelCount,channelCountMode:V.channelCountMode,channelInterpretation:V.channelInterpretation,gain:1})),K.push(d(D,{channelCount:V.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:V.channelCount}));let le=[];if(N.parameterDescriptors!==void 0)for(let{defaultValue:ue,maxValue:Ue,minValue:Lt,name:ct}of N.parameterDescriptors){let ze=b(D,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:V.parameterData[ct]!==void 0?V.parameterData[ct]:ue===void 0?0:ue});Object.defineProperties(ze.offset,{defaultValue:{get:()=>ue===void 0?0:ue},maxValue:{get:()=>Ue===void 0?He:Ue},minValue:{get:()=>Lt===void 0?pe:Lt}}),le.push(ze)}let te=a(D,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,X+Q)}),ne=Ha(G,D.sampleRate),se=A(D,ne,X+Q,Math.max(1,Y)),fe=d(D,{channelCount:Math.max(1,Y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,Y)}),Te=[];for(let ue=0;ue<V.numberOfOutputs;ue+=1)Te.push(a(D,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:B[ue]}));for(let ue=0;ue<V.numberOfInputs;ue+=1){Z[ue].connect(K[ue]);for(let Ue=0;Ue<V.channelCount;Ue+=1)K[ue].connect(te,Ue,ue*V.channelCount+Ue)}let We=new Wa(N.parameterDescriptors===void 0?[]:N.parameterDescriptors.map(({name:ue},Ue)=>{let Lt=le[Ue];return Lt.connect(te,0,X+Ue),Lt.start(0),[ue,Lt.offset]}));te.connect(se);let ye=V.channelInterpretation,Ee=null,Le=V.numberOfOutputs===0?[se]:Te,Ae={get bufferSize(){return ne},get channelCount(){return V.channelCount},set channelCount(ue){throw s()},get channelCountMode(){return V.channelCountMode},set channelCountMode(ue){throw s()},get channelInterpretation(){return ye},set channelInterpretation(ue){for(let Ue of Z)Ue.channelInterpretation=ue;ye=ue},get context(){return se.context},get inputs(){return Z},get numberOfInputs(){return V.numberOfInputs},get numberOfOutputs(){return V.numberOfOutputs},get onprocessorerror(){return Ee},set onprocessorerror(ue){typeof Ee=="function"&&Ae.removeEventListener("processorerror",Ee),Ee=typeof ue=="function"?ue:null,typeof Ee=="function"&&Ae.addEventListener("processorerror",Ee)},get parameters(){return We},get port(){return J.port2},addEventListener:(...ue)=>se.addEventListener(ue[0],ue[1],ue[2]),connect:l.bind(null,Le),disconnect:E.bind(null,Le),dispatchEvent:(...ue)=>se.dispatchEvent(ue[0]),removeEventListener:(...ue)=>se.removeEventListener(ue[0],ue[1],ue[2])},Ie=new Map;var Be,mt;J.port1.addEventListener=(Be=J.port1.addEventListener,(...ue)=>{if(ue[0]==="message"){let Ue=typeof ue[1]=="function"?ue[1]:typeof ue[1]=="object"&&ue[1]!==null&&typeof ue[1].handleEvent=="function"?ue[1].handleEvent:null;if(Ue!==null){let Lt=Ie.get(ue[1]);Lt!==void 0?ue[1]=Lt:(ue[1]=ct=>{j(D.currentTime,D.sampleRate,()=>Ue(ct))},Ie.set(Ue,ue[1]))}}return Be.call(J.port1,ue[0],ue[1],ue[2])}),J.port1.removeEventListener=(mt=J.port1.removeEventListener,(...ue)=>{if(ue[0]==="message"){let Ue=Ie.get(ue[1]);Ue!==void 0&&(Ie.delete(ue[1]),ue[1]=Ue)}return mt.call(J.port1,ue[0],ue[1],ue[2])});let xt=null;Object.defineProperty(J.port1,"onmessage",{get:()=>xt,set:ue=>{typeof xt=="function"&&J.port1.removeEventListener("message",xt),xt=typeof ue=="function"?ue:null,typeof xt=="function"&&(J.port1.addEventListener("message",xt),J.port1.start())}}),N.prototype.port=J.port1;let Fe=null;((ue,Ue,Lt,ct)=>{let ze=w.get(ue);ze===void 0&&(ze=new WeakMap,w.set(ue,ze));let st=td(Lt,ct);return ze.set(Ue,st),st})(D,Ae,N,V).then(ue=>Fe=ue);let be=Zs(V.numberOfInputs,V.channelCount),jt=Zs(V.numberOfOutputs,B),En=N.parameterDescriptors===void 0?[]:N.parameterDescriptors.reduce((ue,{name:Ue})=>({...ue,[Ue]:new Float32Array(128)}),{}),tn=!0,li=()=>{V.numberOfOutputs>0&&se.disconnect(fe);for(let ue=0,Ue=0;ue<V.numberOfOutputs;ue+=1){let Lt=Te[ue];for(let ct=0;ct<B[ue];ct+=1)fe.disconnect(Lt,Ue+ct,ct);Ue+=B[ue]}},ui=new Map;se.onaudioprocess=({inputBuffer:ue,outputBuffer:Ue})=>{if(Fe!==null){let Lt=P(Ae);for(let ct=0;ct<ne;ct+=128){for(let ze=0;ze<V.numberOfInputs;ze+=1)for(let st=0;st<V.channelCount;st+=1)Qs(ue,be[ze],st,st,ct);N.parameterDescriptors!==void 0&&N.parameterDescriptors.forEach(({name:ze},st)=>{Qs(ue,En,ze,X+st,ct)});for(let ze=0;ze<V.numberOfInputs;ze+=1)for(let st=0;st<B[ze];st+=1)jt[ze][st].byteLength===0&&(jt[ze][st]=new Float32Array(128));try{let ze=be.map((ln,hi)=>{if(Lt[hi].size>0)return ui.set(hi,ne/128),ln;let di=ui.get(hi);return di===void 0?[]:(ln.every(ef=>ef.every(tf=>tf===0))&&(di===1?ui.delete(hi):ui.set(hi,di-1)),ln)});tn=j(D.currentTime+ct/D.sampleRate,D.sampleRate,()=>Fe.process(ze,jt,En));for(let ln=0,hi=0;ln<V.numberOfOutputs;ln+=1){for(let di=0;di<B[ln];di+=1)Ba(Ue,jt[ln],di,hi+di,ct);hi+=B[ln]}}catch(ze){tn=!1,Ae.dispatchEvent(new ErrorEvent("processorerror",{colno:ze.colno,filename:ze.filename,lineno:ze.lineno,message:ze.message}))}if(!tn){for(let ze=0;ze<V.numberOfInputs;ze+=1){Z[ze].disconnect(K[ze]);for(let st=0;st<V.channelCount;st+=1)K[ct].disconnect(te,st,ze*V.channelCount+st)}if(N.parameterDescriptors!==void 0){let ze=N.parameterDescriptors.length;for(let st=0;st<ze;st+=1){let ln=le[st];ln.disconnect(te,0,X+st),ln.stop()}}te.disconnect(se),se.onaudioprocess=null,yt?li():Sl();break}}}};let yt=!1,Gt=k(D,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Tl=()=>se.connect(Gt).connect(D.destination),Sl=()=>{se.disconnect(Gt),Gt.disconnect()};return Tl(),F(Ae,()=>{if(tn){Sl(),V.numberOfOutputs>0&&se.connect(fe);for(let ue=0,Ue=0;ue<V.numberOfOutputs;ue+=1){let Lt=Te[ue];for(let ct=0;ct<B[ue];ct+=1)fe.connect(Lt,Ue+ct,ct);Ue+=B[ue]}}yt=!0},()=>{tn&&(Tl(),li()),yt=!1})})(zc,re,gt,ti,Ts,Li,Wt,Ss,qt,Uc,Zo,ep,ei),np=((l,e,s,a,d)=>(b,k,A,O,E,j)=>{if(A!==null)try{let D=new A(b,O,j),G=new Map,N=null;if(Object.defineProperties(D,{channelCount:{get:()=>j.channelCount,set:()=>{throw l()}},channelCountMode:{get:()=>"explicit",set:()=>{throw l()}},onprocessorerror:{get:()=>N,set:V=>{typeof N=="function"&&D.removeEventListener("processorerror",N),N=typeof V=="function"?V:null,typeof N=="function"&&D.addEventListener("processorerror",N)}}}),D.addEventListener=(F=D.addEventListener,(...V)=>{if(V[0]==="processorerror"){let B=typeof V[1]=="function"?V[1]:typeof V[1]=="object"&&V[1]!==null&&typeof V[1].handleEvent=="function"?V[1].handleEvent:null;if(B!==null){let X=G.get(V[1]);X!==void 0?V[1]=X:(V[1]=Y=>{Y.type==="error"?(Object.defineProperties(Y,{type:{value:"processorerror"}}),B(Y)):B(new ErrorEvent(V[0],{...Y}))},G.set(B,V[1]))}}return F.call(D,"error",V[1],V[2]),F.call(D,...V)}),D.removeEventListener=(P=D.removeEventListener,(...V)=>{if(V[0]==="processorerror"){let B=G.get(V[1]);B!==void 0&&(G.delete(V[1]),V[1]=B)}return P.call(D,"error",V[1],V[2]),P.call(D,V[0],V[1],V[2])}),j.numberOfOutputs!==0){let V=s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return D.connect(V).connect(b.destination),d(D,()=>V.disconnect(),()=>V.connect(b.destination))}return D}catch(D){throw D.code===11?a():D}var P,F;if(E===void 0)throw a();return(D=>{let{port1:G}=new MessageChannel;try{G.postMessage(D)}finally{G.close()}})(j),e(b,k,E,j)})(gt,tp,Wt,qt,ei),ip=((l,e,s,a,d,b,k,A,O,E,j,P,F,D,G,N)=>(V,B,X)=>{let Y=new WeakMap,Q=null;return{render(J,Z,K){A(Z,J);let le=Y.get(Z);return le!==void 0?Promise.resolve(le):(async(te,ne,se)=>{let fe=j(te),Te=null,We=$(fe,ne),ye=Array.isArray(B.outputChannelCount)?B.outputChannelCount:Array.from(B.outputChannelCount);if(P===null){let Ee=ye.reduce((Be,mt)=>Be+mt,0),Le=d(ne,{channelCount:Math.max(1,Ee),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,Ee)}),Ae=[];for(let Be=0;Be<te.numberOfOutputs;Be+=1)Ae.push(a(ne,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:ye[Be]}));let Ie=k(ne,{channelCount:B.channelCount,channelCountMode:B.channelCountMode,channelInterpretation:B.channelInterpretation,gain:1});Ie.connect=e.bind(null,Ae),Ie.disconnect=O.bind(null,Ae),Te=[Le,Ae,Ie]}else We||(fe=new P(ne,V));if(Y.set(ne,Te===null?fe:Te[2]),Te!==null){if(Q===null){if(X===void 0)throw new Error("Missing the processor constructor.");if(F===null)throw new Error("Missing the native OfflineAudioContext constructor.");let mt=te.channelCount*te.numberOfInputs,xt=X.parameterDescriptors===void 0?0:X.parameterDescriptors.length,Fe=mt+xt;Q=Uh(te,Fe===0?null:await(async()=>{let jt=new F(Fe,128*Math.ceil(te.context.length/128),ne.sampleRate),En=[],tn=[];for(let yt=0;yt<B.numberOfInputs;yt+=1)En.push(k(jt,{channelCount:B.channelCount,channelCountMode:B.channelCountMode,channelInterpretation:B.channelInterpretation,gain:1})),tn.push(d(jt,{channelCount:B.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:B.channelCount}));let li=await Promise.all(Array.from(te.parameters.values()).map(async yt=>{let Gt=b(jt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:yt.value});return await D(jt,yt,Gt.offset,se),Gt})),ui=a(jt,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,mt+xt)});for(let yt=0;yt<B.numberOfInputs;yt+=1){En[yt].connect(tn[yt]);for(let Gt=0;Gt<B.channelCount;Gt+=1)tn[yt].connect(ui,Gt,yt*B.channelCount+Gt)}for(let[yt,Gt]of li.entries())Gt.connect(ui,0,mt+yt),Gt.start(0);return ui.connect(jt.destination),await Promise.all(En.map(yt=>G(te,jt,yt,se))),N(jt)})(),ne,B,ye,X,E)}let Ee=await Q,Le=s(ne,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[Ae,Ie,Be]=Te;Ee!==null&&(Le.buffer=Ee,Le.start(0)),Le.connect(Ae);for(let mt=0,xt=0;mt<te.numberOfOutputs;mt+=1){let Fe=Ie[mt];for(let be=0;be<ye[mt];be+=1)Ae.connect(Fe,xt+be,be);xt+=ye[mt]}return Be}if(We)for(let[Ee,Le]of te.parameters.entries())await l(ne,Le,fe.parameters.get(Ee),se);else for(let[Ee,Le]of te.parameters.entries())await D(ne,Le,fe.parameters.get(Ee),se);return await G(te,ne,fe,se),fe})(J,Z,K)}}})(Sn,zc,ji,ti,Ts,Li,Wt,Kd,Uc,Zo,Ze,sr,Tt,Cn,Rt,nr),sp=(l=>e=>l.get(e))(Vc),rp=(l=>(e,s)=>{l.set(e,s)})(Hc),Gc=qc?((l,e,s,a,d,b,k,A,O,E,j,P,F)=>class extends e{constructor(D,G,N){var V;let B=A(D),X=O(B),Y=j({...zh,...N}),Q=T.get(B),J=Q==null?void 0:Q.get(G),Z=X||B.state!=="closed"?B:(V=k(B))!==null&&V!==void 0?V:B,K=d(Z,X?null:D.baseLatency,E,G,J,Y);super(D,!0,K,X?a(G,Y,J):null);let le=[];K.parameters.forEach((ne,se)=>{let fe=s(this,X,ne);le.push([se,fe])}),this._nativeAudioWorkletNode=K,this._onprocessorerror=null,this._parameters=new Wa(le),X&&l(B,this);let{activeInputs:te}=b(this);P(K,te)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(D){let G=typeof D=="function"?F(this,D):null;this._nativeAudioWorkletNode.onprocessorerror=G;let N=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=N!==null&&N===G?D:N}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})($d,ft,mn,ip,np,lt,sp,et,Qe,sr,l=>({...l,outputChannelCount:l.outputChannelCount!==void 0?l.outputChannelCount:l.numberOfInputs===1&&l.numberOfOutputs===1?[l.channelCount]:Array.from({length:l.numberOfOutputs},()=>1)}),rp,Ii):void 0,Yc=(((l,e,s,a,d)=>{})(gt,qt,Qa,Qo,qn),((l,e)=>(s,a,d)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(s,a,d)}catch(b){throw b.name==="SyntaxError"?l():b}})(qt,Tt)),Xc=((l,e,s,a,d,b,k,A)=>{let O=[];return(E,j)=>s(E).render(E,j,O).then(()=>Promise.all(Array.from(a(j)).map(P=>s(P).render(P,j,O)))).then(()=>d(j)).then(P=>(typeof P.copyFromChannel!="function"?(k(P),qe(P)):e(b,()=>b(P))||A(P),l.add(P),P))})(Wo,Qt,Lo,Jo,nr,ce,zo,Uo),op=(((l,e,s,a,d)=>{})(Qt,gt,Yc,Qo,Xc),((l,e,s,a,d)=>class extends l{constructor(b,k,A){let O;if(typeof b=="number"&&k!==void 0&&A!==void 0)O={length:k,numberOfChannels:b,sampleRate:A};else{if(typeof b!="object")throw new Error("The given parameters are not valid.");O=b}let{length:E,numberOfChannels:j,sampleRate:P}={...id,...O},F=a(j,E,P);e(xs,()=>xs(F))||F.addEventListener("statechange",(()=>{let D=0,G=N=>{this._state==="running"&&(D>0?(F.removeEventListener("statechange",G),N.stopImmediatePropagation(),this._waitForThePromiseToSettle(N)):D+=1)};return G})()),super(F,j),this._length=E,this._nativeOfflineAudioContext=F,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(s()):(this._state="running",d(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,At(this)}))}_waitForThePromiseToSettle(b){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(b):setTimeout(()=>this._waitForThePromiseToSettle(b))}})(Nc,Qt,gt,Yc,Xc)),ap=((l,e)=>s=>{let a=l.get(s);return e(a)||e(s)})(f,qo),cp=(Qc=S,Zc=No,l=>Qc.has(l)||Zc(l));var Qc,Zc;let lp=(Jc=h,$c=pc,l=>Jc.has(l)||$c(l));var Jc,$c;let up=((l,e)=>s=>{let a=l.get(s);return e(a)||e(s)})(f,Qe),hp=()=>(async(l,e,s,a,d,b,k,A,O,E,j,P,F,D,G,N)=>l(e,e)&&l(s,s)&&l(d,d)&&l(b,b)&&l(A,A)&&l(O,O)&&l(E,E)&&l(j,j)&&l(P,P)&&l(F,F)&&l(D,D)?(await Promise.all([l(a,a),l(k,k),l(G,G),l(N,N)])).every(V=>V):!1)(Qt,(l=>()=>{if(l===null)return!1;let e=new l(1,1,44100).createBuffer(1,1,44100);if(e.copyToChannel===void 0)return!0;let s=new Float32Array(2);try{e.copyFromChannel(s,0,0)}catch{return!1}return!0})(Tt),(l=>()=>{if(l===null)return!1;if(l.prototype!==void 0&&l.prototype.close!==void 0)return!0;let e=new l,s=e.close!==void 0;try{e.close()}catch{}return s})(qn),(l=>()=>{if(l===null)return Promise.resolve(!1);let e=new l(1,1,44100);return new Promise(s=>{let a=!0,d=k=>{a&&(a=!1,e.startRendering(),s(k instanceof TypeError))},b;try{b=e.decodeAudioData(null,()=>{},d)}catch(k){d(k)}b!==void 0&&b.catch(d)})})(Tt),(l=>()=>{if(l===null)return!1;let e;try{e=new l({latencyHint:"balanced"})}catch{return!1}return e.close(),!0})(qn),(l=>()=>{if(l===null)return!1;let e=new l(1,1,44100).createGain(),s=e.connect(e)===e;return e.disconnect(e),s})(Tt),((l,e)=>async()=>{if(l===null)return!0;if(e===null)return!1;let s=new Blob(['class A extends AudioWorkletProcessor{process(){this.port.postMessage(0)}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),a=new e(1,128,8e3),d=URL.createObjectURL(s),b=!1;try{await a.audioWorklet.addModule(d);let k=new l(a,"a",{numberOfOutputs:0}),A=a.createOscillator();k.port.onmessage=()=>b=!0,A.connect(k),A.start(0),await a.startRendering(),b||await new Promise(O=>setTimeout(O,5))}catch{}finally{URL.revokeObjectURL(d)}return b})(sr,Tt),(l=>()=>{if(l===null)return!1;let e=new l(1,1,44100).createChannelMerger();if(e.channelCountMode==="max")return!0;try{e.channelCount=2}catch{return!0}return!1})(Tt),(l=>()=>{if(l===null)return!1;let e=new l(1,1,44100);return e.createConstantSource===void 0?!0:e.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY})(Tt),(l=>()=>{if(l===null)return!1;let e=new l(1,1,44100),s=e.createConvolver();s.buffer=e.createBuffer(1,1,e.sampleRate);try{s.buffer=e.createBuffer(1,1,e.sampleRate)}catch{return!1}return!0})(Tt),(l=>()=>{if(l===null)return!1;let e=new l(1,1,44100).createConvolver();try{e.channelCount=1}catch{return!1}return!0})(Tt),ld,(l=>()=>l!==null&&l.hasOwnProperty("isSecureContext"))(fn),(l=>()=>{if(l===null)return!1;let e=new l;try{return e.createMediaStreamSource(new MediaStream),!1}catch(s){return!0}})(qn),(l=>()=>{if(l===null)return Promise.resolve(!1);let e=new l(1,1,44100);if(e.createStereoPanner===void 0||e.createConstantSource===void 0)return Promise.resolve(!0);let s=e.createConstantSource(),a=e.createStereoPanner();return s.channelCount=1,s.offset.value=1,a.channelCount=1,s.start(),s.connect(a).connect(e.destination),e.startRendering().then(d=>d.getChannelData(0)[0]!==1)})(Tt),ud);function _e(l,e){if(!l)throw new Error(e)}function Et(l,e,s=1/0){if(!(e<=l&&l<=s))throw new RangeError(`Value must be within [${e}, ${s}], got: ${l}`)}function $o(l){l.isOffline||l.state==="running"||Ms('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Ko=console;function dp(l){Ko=l}function Kc(...l){Ko.log(...l)}function Ms(...l){Ko.warn(...l)}function Bt(l){return l===void 0}function Pe(l){return!Bt(l)}function el(l){return typeof l=="function"}function Zt(l){return typeof l=="number"}function Vn(l){return Object.prototype.toString.call(l)==="[object Object]"&&l.constructor===Object}function ea(l){return typeof l=="boolean"}function Pt(l){return Array.isArray(l)}function rn(l){return typeof l=="string"}function As(l){return rn(l)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(l)}let Nn=typeof self=="object"?self:null,pp=Nn&&(Nn.hasOwnProperty("AudioContext")||Nn.hasOwnProperty("webkitAudioContext"));function _n(l,e,s,a){var d,b=arguments.length,k=b<3?e:a===null?a=Object.getOwnPropertyDescriptor(e,s):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(l,e,s,a);else for(var A=l.length-1;A>=0;A--)(d=l[A])&&(k=(b<3?d(k):b>3?d(e,s,k):d(e,s))||k);return b>3&&k&&Object.defineProperty(e,s,k),k}function Je(l,e,s,a){return new(s||(s=Promise))(function(d,b){function k(E){try{O(a.next(E))}catch(j){b(j)}}function A(E){try{O(a.throw(E))}catch(j){b(j)}}function O(E){var j;E.done?d(E.value):(j=E.value,j instanceof s?j:new s(function(P){P(j)})).then(k,A)}O((a=a.apply(l,e||[])).next())})}class fp{constructor(e,s,a){this._callback=e,this._type=s,this._updateInterval=a,this._createClock()}_createWorker(){let e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),s=URL.createObjectURL(e),a=new Worker(s);a.onmessage=this._callback.bind(this),this._worker=a}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},1e3*this._updateInterval)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch(e){this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),this._type==="worker"&&this._worker.postMessage(Math.max(1e3*e,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function vi(l){return lp(l)}function ni(l){return cp(l)}function rr(l){return up(l)}function Fi(l){return ap(l)}function tl(l){return l instanceof AudioBuffer}function mp(l,e){return l==="value"||vi(e)||ni(e)||tl(e)}function on(l,...e){if(!e.length)return l;let s=e.shift();if(Vn(l)&&Vn(s))for(let a in s)mp(a,s[a])?l[a]=s[a]:Vn(s[a])?(l[a]||Object.assign(l,{[a]:{}}),on(l[a],s[a])):Object.assign(l,{[a]:s[a]});return on(l,...e)}function W(l,e,s=[],a){let d={},b=Array.from(e);if(Vn(b[0])&&a&&!Reflect.has(b[0],a)&&(Object.keys(b[0]).some(k=>Reflect.has(l,k))||(on(d,{[a]:b[0]}),s.splice(s.indexOf(a),1),b.shift())),b.length===1&&Vn(b[0]))on(d,b[0]);else for(let k=0;k<s.length;k++)Pe(b[k])&&(d[s[k]]=b[k]);return on(l,d)}function an(l,e){return Bt(l)?e:l}function Dt(l,e){return e.forEach(s=>{Reflect.has(l,s)&&delete l[s]}),l}class Wn{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Nn&&this.toString()===Nn.TONE_DEBUG_CLASS)&&Kc(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Wn.version=u;function or(l,e){return l>e+1e-6}function ta(l,e){return or(l,e)||gn(l,e)}function nl(l,e){return l+1e-6<e}function gn(l,e){return Math.abs(l-e)<1e-6}function il(l,e,s){return Math.max(Math.min(l,s),e)}class vn extends Wn{constructor(){super(),this.name="Timeline",this._timeline=[];let e=W(vn.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(_e(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){let s=this._timeline[this.length-1];_e(ta(e.time,s.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{let s=this._search(e.time);this._timeline.splice(s+1,0,e)}if(this.length>this.memory){let s=this.length-this.memory;this._timeline.splice(0,s)}return this}remove(e){let s=this._timeline.indexOf(e);return s!==-1&&this._timeline.splice(s,1),this}get(e,s="time"){let a=this._search(e,s);return a!==-1?this._timeline[a]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,s="time"){let a=this._search(e,s);return a+1<this._timeline.length?this._timeline[a+1]:null}getBefore(e){let s=this._timeline.length;if(s>0&&this._timeline[s-1].time<e)return this._timeline[s-1];let a=this._search(e);return a-1>=0?this._timeline[a-1]:null}cancel(e){if(this._timeline.length>1){let s=this._search(e);if(s>=0)if(gn(this._timeline[s].time,e)){for(let a=s;a>=0&&gn(this._timeline[a].time,e);a--)s=a;this._timeline=this._timeline.slice(0,s)}else this._timeline=this._timeline.slice(0,s+1);else this._timeline=[]}else this._timeline.length===1&&ta(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){let s=this._search(e);return s>=0&&(this._timeline=this._timeline.slice(s+1)),this}previousEvent(e){let s=this._timeline.indexOf(e);return s>0?this._timeline[s-1]:null}_search(e,s="time"){if(this._timeline.length===0)return-1;let a=0,d=this._timeline.length,b=d;if(d>0&&this._timeline[d-1][s]<=e)return d-1;for(;a<b;){let k=Math.floor(a+(b-a)/2),A=this._timeline[k],O=this._timeline[k+1];if(gn(A[s],e)){for(let E=k;E<this._timeline.length&&gn(this._timeline[E][s],e);E++)k=E;return k}if(nl(A[s],e)&&or(O[s],e))return k;or(A[s],e)?b=k:a=k+1}return-1}_iterate(e,s=0,a=this._timeline.length-1){this._timeline.slice(s,a+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,s){let a=this._search(e);return a!==-1&&this._iterate(s,0,a),this}forEachAfter(e,s){let a=this._search(e);return this._iterate(s,a+1),this}forEachBetween(e,s,a){let d=this._search(e),b=this._search(s);return d!==-1&&b!==-1?(this._timeline[d].time!==e&&(d+=1),this._timeline[b].time===s&&(b-=1),this._iterate(a,d,b)):d===-1&&this._iterate(a,0,b),this}forEachFrom(e,s){let a=this._search(e);for(;a>=0&&this._timeline[a].time>=e;)a--;return this._iterate(s,a+1),this}forEachAtTime(e,s){let a=this._search(e);if(a!==-1&&gn(this._timeline[a].time,e)){let d=a;for(let b=a;b>=0&&gn(this._timeline[b].time,e);b--)d=b;this._iterate(b=>{s(b)},d,a)}return this}dispose(){return super.dispose(),this._timeline=[],this}}let sl=[];function ar(l){sl.push(l)}let rl=[];function cr(l){rl.push(l)}class qi extends Wn{constructor(){super(...arguments),this.name="Emitter"}on(e,s){return e.split(/\W+/).forEach(a=>{Bt(this._events)&&(this._events={}),this._events.hasOwnProperty(a)||(this._events[a]=[]),this._events[a].push(s)}),this}once(e,s){let a=(...d)=>{s(...d),this.off(e,a)};return this.on(e,a),this}off(e,s){return e.split(/\W+/).forEach(a=>{if(Bt(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(Bt(s))this._events[e]=[];else{let d=this._events[e];for(let b=d.length-1;b>=0;b--)d[b]===s&&d.splice(b,1)}}),this}emit(e,...s){if(this._events&&this._events.hasOwnProperty(e)){let a=this._events[e].slice(0);for(let d=0,b=a.length;d<b;d++)a[d].apply(this,s)}return this}static mixin(e){["on","once","off","emit"].forEach(s=>{let a=Object.getOwnPropertyDescriptor(qi.prototype,s);Object.defineProperty(e.prototype,s,a)})}dispose(){return super.dispose(),this._events=void 0,this}}class na extends qi{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Vi extends na{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new vn,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;let e=W(Vi.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=function(s){return new Jd(s)}({latencyHint:e.latencyHint}),this._ticker=new fp(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var e;return this._initialized||(e=this,sl.forEach(s=>s(e)),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,s,a){return this._context.createBuffer(e,s,a)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,s){return this._context.createIIRFilter(e,s)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,s,a){return this._context.createPeriodicWave(e,s,a)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return _e(Fi(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return _e(Fi(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return _e(Fi(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){_e(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){_e(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){_e(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){_e(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,s){return function(a,d,b){return _e(Pe(Gc),"This node only works in a secure context (https or localhost)"),new Gc(a,d,b)}(this.rawContext,e,s)}addAudioWorkletModule(e,s){return Je(this,void 0,void 0,function*(){_e(Pe(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(s)||this._workletModules.set(s,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(s)})}workletsAreReady(){return Je(this,void 0,void 0,function*(){let e=[];this._workletModules.forEach(s=>e.push(s)),yield Promise.all(e)})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let s=0;if(this._latencyHint=e,rn(e))switch(e){case"interactive":s=.1;break;case"playback":s=.5;break;case"balanced":s=.25}this.lookAhead=s,this.updateInterval=s/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return Fi(this._context)?this._context.resume():Promise.resolve()}close(){return Je(this,void 0,void 0,function*(){var e;Fi(this._context)&&(yield this._context.close()),this._initialized&&(e=this,rl.forEach(s=>s(e)))})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{let s=this._context.createBuffer(1,128,this._context.sampleRate),a=s.getChannelData(0);for(let b=0;b<a.length;b++)a[b]=e;let d=this._context.createBufferSource();return d.channelCount=1,d.channelCountMode="explicit",d.buffer=s,d.loop=!0,d.start(0),this._constants.set(e,d),d}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this}_timeoutLoop(){let e=this.now(),s=this._timeouts.peek();for(;this._timeouts.length&&s&&s.time<=e;)s.callback(),this._timeouts.shift(),s=this._timeouts.peek()}setTimeout(e,s){this._timeoutIds++;let a=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:a+s}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(s=>{s.id===e&&this._timeouts.remove(s)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,s){let a=++this._timeoutIds,d=()=>{let b=this.now();this._timeouts.add({callback:()=>{e(),d()},id:a,time:b+s})};return d(),a}}function xe(l,e){Pt(e)?e.forEach(s=>xe(l,s)):Object.defineProperty(l,e,{enumerable:!0,writable:!1})}function Os(l,e){Pt(e)?e.forEach(s=>Os(l,s)):Object.defineProperty(l,e,{writable:!0})}let je=()=>{};class Ne extends Wn{constructor(){super(),this.name="ToneAudioBuffer",this.onload=je;let e=W(Ne.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&tl(e.url)||e.url instanceof Ne?this.set(e.url):rn(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:je,onload:je,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:tt().sampleRate}set(e){return e instanceof Ne?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Je(this,void 0,void 0,function*(){let s=Ne.load(e).then(a=>{this.set(a),this.onload(this)});Ne.downloads.push(s);try{yield s}finally{let a=Ne.downloads.indexOf(s);Ne.downloads.splice(a,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){let s=Pt(e)&&e[0].length>0,a=s?e.length:1,d=s?e[0].length:e.length,b=tt(),k=b.createBuffer(a,d,b.sampleRate),A=s||a!==1?e:[e];for(let O=0;O<a;O++)k.copyToChannel(A[O],O);return this._buffer=k,this}toMono(e){if(Zt(e))this.fromArray(this.toArray(e));else{let s=new Float32Array(this.length),a=this.numberOfChannels;for(let d=0;d<a;d++){let b=this.toArray(d);for(let k=0;k<b.length;k++)s[k]+=b[k]}s=s.map(d=>d/a),this.fromArray(s)}return this}toArray(e){if(Zt(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{let s=[];for(let a=0;a<this.numberOfChannels;a++)s[a]=this.getChannelData(a);return s}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,s=this.duration){let a=Math.floor(e*this.sampleRate),d=Math.floor(s*this.sampleRate);_e(a<d,"The start time must be less than the end time");let b=d-a,k=tt().createBuffer(this.numberOfChannels,b,this.sampleRate);for(let A=0;A<this.numberOfChannels;A++)k.copyToChannel(this.getChannelData(A).subarray(a,d),A);return new Ne(k)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new Ne().fromArray(e)}static fromUrl(e){return Je(this,void 0,void 0,function*(){return yield new Ne().load(e)})}static load(e){return Je(this,void 0,void 0,function*(){let s=e.match(/\[([^\]\[]+\|.+)\]$/);if(s){let k=s[1].split("|"),A=k[0];for(let O of k)if(Ne.supportsType(O)){A=O;break}e=e.replace(s[0],A)}let a=Ne.baseUrl===""||Ne.baseUrl.endsWith("/")?Ne.baseUrl:Ne.baseUrl+"/",d=yield fetch(a+e);if(!d.ok)throw new Error("could not load url: "+e);let b=yield d.arrayBuffer();return yield tt().decodeAudioData(b)})}static supportsType(e){let s=e.split("."),a=s[s.length-1];return document.createElement("audio").canPlayType("audio/"+a)!==""}static loaded(){return Je(this,void 0,void 0,function*(){for(yield Promise.resolve();Ne.downloads.length;)yield Ne.downloads[0]})}}Ne.baseUrl="",Ne.downloads=[];class Ni extends Vi{constructor(){var e,s,a;super({clockSource:"offline",context:rr(arguments[0])?arguments[0]:(e=arguments[0],s=arguments[1]*arguments[2],a=arguments[2],new op(e,s,a)),lookAhead:0,updateInterval:rr(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=rr(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Je(this,void 0,void 0,function*(){let s=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,s++;let a=Math.floor(this.sampleRate/128);e&&s%a==0&&(yield new Promise(d=>setTimeout(d,1)))}})}render(e=!0){return Je(this,void 0,void 0,function*(){yield this.workletsAreReady(),yield this._renderClock(e);let s=yield this._context.startRendering();return new Ne(s)})}close(){return Promise.resolve()}}let ol=new class extends na{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(l,e,s){return{}}createChannelMerger(l){return{}}createChannelSplitter(l){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(l){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(l,e){return{}}createPanner(){return{}}createPeriodicWave(l,e,s){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(l){return{}}createMediaElementSource(l){return{}}createMediaStreamDestination(){return{}}decodeAudioData(l){return Promise.resolve({})}createAudioWorkletNode(l,e){return{}}get rawContext(){return{}}addAudioWorkletModule(l,e){return Je(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(l,e){return 0}clearTimeout(l){return this}setInterval(l,e){return 0}clearInterval(l){return this}getConstant(l){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(l){}get destination(){return{}}set destination(l){}now(){return 0}immediate(){return 0}},lr=ol;function tt(){return lr===ol&&pp&&ur(new Vi),lr}function ur(l){lr=Fi(l)?new Vi(l):rr(l)?new Ni(l):l}function _p(){return lr.resume()}if(Nn&&!Nn.TONE_SILENCE_LOGGING){let l="v";u==="dev"&&(l="");let e=` * Tone.js ${l}${u} * `;console.log("%c"+e,"background: #000; color: #fff")}function Wi(l){return Math.pow(10,l/20)}function Rs(l){return Math.log(l)/Math.LN10*20}function Bi(l){return Math.pow(2,l/12)}let hr=440;function ii(l){return Math.round(al(l))}function al(l){return 69+12*Math.log2(l/hr)}function ia(l){return hr*Math.pow(2,(l-69)/12)}class sa extends Wn{constructor(e,s,a){super(),this.defaultUnits="s",this._val=s,this._units=a,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,s)=>{let a=parseInt(e,10),d=s==="."?1.5:1;return a===1?this._beatsToUnits(this._getTimeSignature())*d:this._beatsToUnits(4/a)*d},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{let s=parseInt(e,10);return this._beatsToUnits(8/(3*Math.floor(s)))},regexp:/^(\d+)t$/i},tr:{method:(e,s,a)=>{let d=0;return e&&e!=="0"&&(d+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),s&&s!=="0"&&(d+=this._beatsToUnits(parseFloat(s))),a&&a!=="0"&&(d+=this._beatsToUnits(parseFloat(a)/4)),d},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof sa&&this.fromType(this._val),Bt(this._val))return this._noArg();if(rn(this._val)&&Bt(this._units)){for(let e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Vn(this._val)){let e=0;for(let s in this._val)if(Pe(this._val[s])){let a=this._val[s];e+=new this.constructor(this.context,s).valueOf()*a}return e}if(Pe(this._units)){let e=this._expressions[this._units],s=this._val.toString().trim().match(e.regexp);return s?e.method.apply(this,s.slice(1)):e.method.call(this,this._val)}return rn(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class Jt extends sa{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{let s=new Jt(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(s))},regexp:/^@(.+)/}})}quantize(e,s=1){let a=new this.constructor(this.context,e).valueOf(),d=this.valueOf();return d+(Math.round(d/a)*a-d)*s}toNotation(){let e=this.toSeconds(),s=["1m"];for(let b=1;b<9;b++){let k=Math.pow(2,b);s.push(k+"n."),s.push(k+"n"),s.push(k+"t")}s.push("0");let a=s[0],d=new Jt(this.context,s[0]).toSeconds();return s.forEach(b=>{let k=new Jt(this.context,b).toSeconds();Math.abs(k-e)<Math.abs(d-e)&&(a=b,d=k)}),a}toBarsBeatsSixteenths(){let e=this._beatsToUnits(1),s=this.valueOf()/e;s=parseFloat(s.toFixed(4));let a=Math.floor(s/this._getTimeSignature()),d=s%1*4;s=Math.floor(s)%this._getTimeSignature();let b=d.toString();return b.length>3&&(d=parseFloat(parseFloat(b).toFixed(3))),[a,s,d].join(":")}toTicks(){let e=this._beatsToUnits(1),s=this.valueOf()/e;return Math.round(s*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ii(this.toFrequency())}_now(){return this.context.now()}}function gp(l,e){return new Jt(tt(),l,e)}class Vt extends Jt{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return hr}static set A4(e){(function(s){hr=s})(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:Vt.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,s){let a=vp[e.toLowerCase()]+12*(parseInt(s,10)+1);return this.defaultUnits==="midi"?a:Vt.mtof(a)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,s,a){let d=1;return e&&e!=="0"&&(d*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),s&&s!=="0"&&(d*=this._beatsToUnits(parseFloat(s))),a&&a!=="0"&&(d*=this._beatsToUnits(parseFloat(a)/4)),d}}})}transpose(e){return new Vt(this.context,this.valueOf()*Bi(e))}harmonize(e){return e.map(s=>this.transpose(s))}toMidi(){return ii(this.valueOf())}toNote(){let e=this.toFrequency(),s=Math.log2(e/Vt.A4),a=Math.round(12*s)+57,d=Math.floor(a/12);return d<0&&(a+=-12*d),yp[a%12]+d.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){let e=this._beatsToUnits(1),s=this.valueOf()/e;return Math.floor(s*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return ia(e)}static ftom(e){return ii(e)}}let vp={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},yp=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function bp(l,e){return new Vt(tt(),l,e)}class vt extends Jt{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function wp(l,e){return new vt(tt(),l,e)}class St extends Wn{constructor(){super();let e=W(St.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:tt()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new Jt(this.context,e).toSeconds()}toFrequency(e){return new Vt(this.context,e).toFrequency()}toTicks(e){return new vt(this.context,e).toTicks()}_getPartialProperties(e){let s=this.get();return Object.keys(s).forEach(a=>{Bt(e[a])&&delete s[a]}),s}get(){let e=this.constructor.getDefaults();return Object.keys(e).forEach(s=>{if(Reflect.has(this,s)){let a=this[s];Pe(a)&&Pe(a.value)&&Pe(a.setValueAtTime)?e[s]=a.value:a instanceof St?e[s]=a._getPartialProperties(e[s]):Pt(a)||Zt(a)||rn(a)||ea(a)?e[s]=a:delete e[s]}}),e}set(e){return Object.keys(e).forEach(s=>{Reflect.has(this,s)&&Pe(this[s])&&(this[s]&&Pe(this[s].value)&&Pe(this[s].setValueAtTime)?this[s].value!==e[s]&&(this[s].value=e[s]):this[s]instanceof St?this[s].set(e[s]):this[s]=e[s])}),this}}class zi extends vn{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){let s=this.get(e);return s!==null?s.state:this._initial}setStateAtTime(e,s,a){return Et(s,0),this.add(Object.assign({},a,{state:e,time:s})),this}getLastState(e,s){for(let a=this._search(s);a>=0;a--){let d=this._timeline[a];if(d.state===e)return d}}getNextState(e,s){let a=this._search(s);if(a!==-1)for(let d=a;d<this._timeline.length;d++){let b=this._timeline[d];if(b.state===e)return b}}}class Me extends St{constructor(){super(W(Me.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;let e=W(Me.getDefaults(),arguments,["param","units","convert"]);for(_e(Pe(e.param)&&(vi(e.param)||e.param instanceof Me),"param must be an AudioParam");!vi(e.param);)e.param=e.param._param;this._swappable=!!Pe(e.swappable)&&e.swappable,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new vn(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,Pe(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(St.getDefaults(),{convert:!0,units:"number"})}get value(){let e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return Pe(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Pe(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,s){return this.units===s}_assertRange(e){return Pe(this.maxValue)&&Pe(this.minValue)&&Et(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?Wi(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Rs(e):e}setValueAtTime(e,s){let a=this.toSeconds(s),d=this._fromType(e);return _e(isFinite(d)&&isFinite(a),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._assertRange(d),this.log(this.units,"setValueAtTime",e,a),this._events.add({time:a,type:"setValueAtTime",value:d}),this._param.setValueAtTime(d,a),this}getValueAtTime(e){let s=Math.max(this.toSeconds(e),0),a=this._events.getAfter(s),d=this._events.get(s),b=this._initialValue;if(d===null)b=this._initialValue;else if(d.type!=="setTargetAtTime"||a!==null&&a.type!=="setValueAtTime")if(a===null)b=d.value;else if(a.type==="linearRampToValueAtTime"||a.type==="exponentialRampToValueAtTime"){let k=d.value;if(d.type==="setTargetAtTime"){let A=this._events.getBefore(d.time);k=A===null?this._initialValue:A.value}b=a.type==="linearRampToValueAtTime"?this._linearInterpolate(d.time,k,a.time,a.value,s):this._exponentialInterpolate(d.time,k,a.time,a.value,s)}else b=d.value;else{let k=this._events.getBefore(d.time),A;A=k===null?this._initialValue:k.value,d.type==="setTargetAtTime"&&(b=this._exponentialApproach(d.time,A,d.value,d.constant,s))}return this._toType(b)}setRampPoint(e){e=this.toSeconds(e);let s=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(s)===0&&(s=this._toType(this._minOutput)),this.setValueAtTime(s,e),this}linearRampToValueAtTime(e,s){let a=this._fromType(e),d=this.toSeconds(s);return _e(isFinite(a)&&isFinite(d),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._assertRange(a),this._events.add({time:d,type:"linearRampToValueAtTime",value:a}),this.log(this.units,"linearRampToValueAtTime",e,d),this._param.linearRampToValueAtTime(a,d),this}exponentialRampToValueAtTime(e,s){let a=this._fromType(e);a=gn(a,0)?this._minOutput:a,this._assertRange(a);let d=this.toSeconds(s);return _e(isFinite(a)&&isFinite(d),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._events.add({time:d,type:"exponentialRampToValueAtTime",value:a}),this.log(this.units,"exponentialRampToValueAtTime",e,d),this._param.exponentialRampToValueAtTime(a,d),this}exponentialRampTo(e,s,a){return a=this.toSeconds(a),this.setRampPoint(a),this.exponentialRampToValueAtTime(e,a+this.toSeconds(s)),this}linearRampTo(e,s,a){return a=this.toSeconds(a),this.setRampPoint(a),this.linearRampToValueAtTime(e,a+this.toSeconds(s)),this}targetRampTo(e,s,a){return a=this.toSeconds(a),this.setRampPoint(a),this.exponentialApproachValueAtTime(e,a,s),this}exponentialApproachValueAtTime(e,s,a){s=this.toSeconds(s),a=this.toSeconds(a);let d=Math.log(a+1)/Math.log(200);return this.setTargetAtTime(e,s,d),this.cancelAndHoldAtTime(s+.9*a),this.linearRampToValueAtTime(e,s+a),this}setTargetAtTime(e,s,a){let d=this._fromType(e);_e(isFinite(a)&&a>0,"timeConstant must be a number greater than 0");let b=this.toSeconds(s);return this._assertRange(d),_e(isFinite(d)&&isFinite(b),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._events.add({constant:a,time:b,type:"setTargetAtTime",value:d}),this.log(this.units,"setTargetAtTime",e,b,a),this._param.setTargetAtTime(d,b,a),this}setValueCurveAtTime(e,s,a,d=1){a=this.toSeconds(a),s=this.toSeconds(s);let b=this._fromType(e[0])*d;this.setValueAtTime(this._toType(b),s);let k=a/(e.length-1);for(let A=1;A<e.length;A++){let O=this._fromType(e[A])*d;this.linearRampToValueAtTime(this._toType(O),s+A*k)}return this}cancelScheduledValues(e){let s=this.toSeconds(e);return _e(isFinite(s),"Invalid argument to cancelScheduledValues: "+JSON.stringify(e)),this._events.cancel(s),this._param.cancelScheduledValues(s),this.log(this.units,"cancelScheduledValues",s),this}cancelAndHoldAtTime(e){let s=this.toSeconds(e),a=this._fromType(this.getValueAtTime(s));_e(isFinite(s),"Invalid argument to cancelAndHoldAtTime: "+JSON.stringify(e)),this.log(this.units,"cancelAndHoldAtTime",s,"value="+a);let d=this._events.get(s),b=this._events.getAfter(s);return d&&gn(d.time,s)?b?(this._param.cancelScheduledValues(b.time),this._events.cancel(b.time)):(this._param.cancelAndHoldAtTime(s),this._events.cancel(s+this.sampleTime)):b&&(this._param.cancelScheduledValues(b.time),this._events.cancel(b.time),b.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(a),s):b.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(a),s)),this._events.add({time:s,type:"setValueAtTime",value:a}),this._param.setValueAtTime(a,s),this}rampTo(e,s=.1,a){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,s,a):this.linearRampTo(e,s,a),this}apply(e){let s=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(s),s);let a=this._events.get(s);if(a&&a.type==="setTargetAtTime"){let d=this._events.getAfter(a.time),b=d?d.time:s+2,k=(b-s)/10;for(let A=s;A<b;A+=k)e.linearRampToValueAtTime(this.getValueAtTime(A),A)}return this._events.forEachAfter(this.context.currentTime,d=>{d.type==="cancelScheduledValues"?e.cancelScheduledValues(d.time):d.type==="setTargetAtTime"?e.setTargetAtTime(d.value,d.time,d.constant):e[d.type](d.value,d.time)}),this}setParam(e){_e(this._swappable,"The Param must be assigned as 'swappable' in the constructor");let s=this.input;return s.disconnect(this._param),this.apply(e),this._param=e,s.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,s,a,d,b){return a+(s-a)*Math.exp(-(b-e)/d)}_linearInterpolate(e,s,a,d,b){return s+(b-e)/(a-e)*(d-s)}_exponentialInterpolate(e,s,a,d,b){return s*Math.pow(d/s,(b-e)/(a-e))}}class oe extends St{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Pe(this.input)?vi(this.input)||this.input instanceof Me?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Pe(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return Pe(e)&&(e instanceof oe||ni(e))}_getInternalNodes(){let e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(s=>{s.channelCount=e.channelCount,s.channelCountMode=e.channelCountMode,s.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){let e=this._getInternalNodes();_e(e.length>0,"ToneAudioNode does not have any internal nodes");let s=e[0];return{channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){let s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){let s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){let s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelInterpretation:e}))}connect(e,s=0,a=0){return zt(this,e,s,a),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Ms("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,s=0,a=0){return ra(this,e,s,a),this}chain(...e){return $t(this,...e),this}fan(...e){return e.forEach(s=>this.connect(s)),this}dispose(){return super.dispose(),Pe(this.input)&&(this.input instanceof oe?this.input.dispose():ni(this.input)&&this.input.disconnect()),Pe(this.output)&&(this.output instanceof oe?this.output.dispose():ni(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function $t(...l){let e=l.shift();l.reduce((s,a)=>(s instanceof oe?s.connect(a):ni(s)&&zt(s,a),a),e)}function zt(l,e,s=0,a=0){for(_e(Pe(l),"Cannot connect from undefined node"),_e(Pe(e),"Cannot connect to undefined node"),(e instanceof oe||ni(e))&&_e(e.numberOfInputs>0,"Cannot connect to node with no inputs"),_e(l.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof oe||e instanceof Me;)Pe(e.input)&&(e=e.input);for(;l instanceof oe;)Pe(l.output)&&(l=l.output);vi(e)?l.connect(e,s):l.connect(e,s,a)}function ra(l,e,s=0,a=0){if(Pe(e))for(;e instanceof oe;)e=e.input;for(;!ni(l);)Pe(l.output)&&(l=l.output);vi(e)?l.disconnect(e,s):ni(e)?l.disconnect(e,s,a):l.disconnect()}class me extends oe{constructor(){super(W(me.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;let e=W(me.getDefaults(),arguments,["gain","units"]);this.gain=new Me({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),xe(this,"gain")}static getDefaults(){return Object.assign(oe.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Ui extends oe{constructor(e){super(e),this.onended=je,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new me({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(s){let a=this.toSeconds(s);return this._startTime!==-1&&a>=this._startTime&&(this._stopTime===-1||a<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(oe.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:je})}_startGain(e,s=1){_e(this._startTime===-1,"Source cannot be started more than once");let a=this.toSeconds(this._fadeIn);return this._startTime=e+a,this._startTime=Math.max(this._startTime,this.context.currentTime),a>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(s,e+a):this._gainNode.gain.exponentialApproachValueAtTime(s,e,a)):this._gainNode.gain.setValueAtTime(s,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){_e(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();let s=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+s,this._stopTime=Math.max(this._stopTime,this.context.currentTime),s>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,s,e):this._gainNode.gain.targetRampTo(0,s,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{let a=this._curve==="exponential"?2*s:0;this._stopSource(this.now()+a),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==je&&(this.onended(this),this.onended=je,!this.context.isOffline)){let e=()=>this.dispose();window.requestIdleCallback!==void 0?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),_e(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Es extends Ui{constructor(){super(W(Es.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();let e=W(Es.getDefaults(),arguments,["offset"]);zt(this._source,this._gainNode),this.offset=new Me({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Ui.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){let s=this.toSeconds(e);return this.log("start",s),this._startGain(s),this._source.start(s),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Se extends oe{constructor(){super(W(Se.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;let e=W(Se.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Es({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(oe.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,s=0,a=0){return Ps(this,e,s,a),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,s){return this._param.setValueAtTime(e,s),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,s){return this._param.linearRampToValueAtTime(e,s),this}exponentialRampToValueAtTime(e,s){return this._param.exponentialRampToValueAtTime(e,s),this}exponentialRampTo(e,s,a){return this._param.exponentialRampTo(e,s,a),this}linearRampTo(e,s,a){return this._param.linearRampTo(e,s,a),this}targetRampTo(e,s,a){return this._param.targetRampTo(e,s,a),this}exponentialApproachValueAtTime(e,s,a){return this._param.exponentialApproachValueAtTime(e,s,a),this}setTargetAtTime(e,s,a){return this._param.setTargetAtTime(e,s,a),this}setValueCurveAtTime(e,s,a,d){return this._param.setValueCurveAtTime(e,s,a,d),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,s,a){return this._param.rampTo(e,s,a),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Ps(l,e,s,a){(e instanceof Me||vi(e)||e instanceof Se&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Se&&(e.overridden=!0)),zt(l,e,s,a)}class dr extends Me{constructor(){super(W(dr.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new vn(1/0),this._multiplier=1;let e=W(dr.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Me.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,s,a){s=this.toSeconds(s),this.setRampPoint(s);let d=this._fromType(e),b=this._events.get(s),k=Math.round(Math.max(1/a,1));for(let A=0;A<=k;A++){let O=a*A+s,E=this._exponentialApproach(b.time,b.value,d,a,O);this.linearRampToValueAtTime(this._toType(E),O)}return this}setValueAtTime(e,s){let a=this.toSeconds(s);super.setValueAtTime(e,s);let d=this._events.get(a),b=this._events.previousEvent(d),k=this._getTicksUntilEvent(b,a);return d.ticks=Math.max(k,0),this}linearRampToValueAtTime(e,s){let a=this.toSeconds(s);super.linearRampToValueAtTime(e,s);let d=this._events.get(a),b=this._events.previousEvent(d),k=this._getTicksUntilEvent(b,a);return d.ticks=Math.max(k,0),this}exponentialRampToValueAtTime(e,s){s=this.toSeconds(s);let a=this._fromType(e),d=this._events.get(s),b=Math.round(Math.max(10*(s-d.time),1)),k=(s-d.time)/b;for(let A=0;A<=b;A++){let O=k*A+d.time,E=this._exponentialInterpolate(d.time,d.value,s,a,O);this.linearRampToValueAtTime(this._toType(E),O)}return this}_getTicksUntilEvent(e,s){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Bt(e.ticks)){let k=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(k,e.time)}let a=this._fromType(this.getValueAtTime(e.time)),d=this._fromType(this.getValueAtTime(s)),b=this._events.get(s);return b&&b.time===s&&b.type==="setValueAtTime"&&(d=this._fromType(this.getValueAtTime(s-this.sampleTime))),.5*(s-e.time)*(a+d)+e.ticks}getTicksAtTime(e){let s=this.toSeconds(e),a=this._events.get(s);return Math.max(this._getTicksUntilEvent(a,s),0)}getDurationOfTicks(e,s){let a=this.toSeconds(s),d=this.getTicksAtTime(s);return this.getTimeOfTick(d+e)-a}getTimeOfTick(e){let s=this._events.get(e,"ticks"),a=this._events.getAfter(e,"ticks");if(s&&s.ticks===e)return s.time;if(s&&a&&a.type==="linearRampToValueAtTime"&&s.value!==a.value){let d=this._fromType(this.getValueAtTime(s.time)),b=(this._fromType(this.getValueAtTime(a.time))-d)/(a.time-s.time),k=Math.sqrt(Math.pow(d,2)-2*b*(s.ticks-e)),A=(-d+k)/b,O=(-d-k)/b;return(A>0?A:O)+s.time}return s?s.value===0?1/0:s.time+(e-s.ticks)/s.value:e/this._initialValue}ticksToTime(e,s){return this.getDurationOfTicks(e,s)}timeToTicks(e,s){let a=this.toSeconds(s),d=this.toSeconds(e),b=this.getTicksAtTime(a);return this.getTicksAtTime(a+d)-b}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){let s=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(s,0)}}class pr extends Se{constructor(){super(W(pr.getDefaults(),arguments,["value"])),this.name="TickSignal";let e=W(pr.getDefaults(),arguments,["value"]);this.input=this._param=new dr({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Se.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,s){return this._param.ticksToTime(e,s)}timeToTicks(e,s){return this._param.timeToTicks(e,s)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,s){return this._param.getDurationOfTicks(e,s)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class fr extends St{constructor(){super(W(fr.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new zi,this._tickOffset=new vn;let e=W(fr.getDefaults(),arguments,["frequency"]);this.frequency=new pr({context:this.context,units:e.units,value:e.frequency}),xe(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},St.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,s){let a=this.toSeconds(e);return this._state.getValueAtTime(a)!=="started"&&(this._state.setStateAtTime("started",a),Pe(s)&&this.setTicksAtTime(s,a)),this}stop(e){let s=this.toSeconds(e);if(this._state.getValueAtTime(s)==="stopped"){let a=this._state.get(s);a&&a.time>0&&(this._tickOffset.cancel(a.time),this._state.cancel(a.time))}return this._state.cancel(s),this._state.setStateAtTime("stopped",s),this.setTicksAtTime(0,s),this}pause(e){let s=this.toSeconds(e);return this._state.getValueAtTime(s)==="started"&&this._state.setStateAtTime("paused",s),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){let s=this.toSeconds(e),a=this._state.getLastState("stopped",s),d={state:"paused",time:s};this._state.add(d);let b=a,k=0;return this._state.forEachBetween(a.time,s+this.sampleTime,A=>{let O=b.time,E=this._tickOffset.get(A.time);E&&E.time>=b.time&&(k=E.ticks,O=E.time),b.state==="started"&&A.state!=="started"&&(k+=this.frequency.getTicksAtTime(A.time)-this.frequency.getTicksAtTime(O)),b=A}),this._state.remove(d),k}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){let s=this.now(),a=this.frequency.timeToTicks(e,s);this.setTicksAtTime(a,s)}getSecondsAtTime(e){e=this.toSeconds(e);let s=this._state.getLastState("stopped",e),a={state:"paused",time:e};this._state.add(a);let d=s,b=0;return this._state.forEachBetween(s.time,e+this.sampleTime,k=>{let A=d.time,O=this._tickOffset.get(k.time);O&&O.time>=d.time&&(b=O.seconds,A=O.time),d.state==="started"&&k.state!=="started"&&(b+=k.time-A),d=k}),this._state.remove(a),b}setTicksAtTime(e,s){return s=this.toSeconds(s),this._tickOffset.cancel(s),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,s),ticks:e,time:s}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,s=this.now()){let a=this._tickOffset.get(s),d=this._state.get(s),b=Math.max(a.time,d.time),k=this.frequency.getTicksAtTime(b)+e-a.ticks;return this.frequency.getTimeOfTick(k)}forEachTickBetween(e,s,a){let d=this._state.get(e);this._state.forEachBetween(e,s,k=>{d&&d.state==="started"&&k.state!=="started"&&this.forEachTickBetween(Math.max(d.time,e),k.time-this.sampleTime,a),d=k});let b=null;if(d&&d.state==="started"){let k=Math.max(d.time,e),A=this.frequency.getTicksAtTime(k),O=A-this.frequency.getTicksAtTime(d.time),E=Math.ceil(O)-O;E=gn(E,1)?0:E;let j=this.frequency.getTimeOfTick(A+E);for(;j<s;){try{a(j,Math.round(this.getTicksAtTime(j)))}catch(P){b=P;break}j+=this.frequency.getDurationOfTicks(1,j)}}if(b)throw b;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class yi extends St{constructor(){super(W(yi.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=je,this._lastUpdate=0,this._state=new zi("stopped"),this._boundLoop=this._loop.bind(this);let e=W(yi.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new fr({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,xe(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(St.getDefaults(),{callback:je,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,s){$o(this.context);let a=this.toSeconds(e);return this.log("start",a),this._state.getValueAtTime(a)!=="started"&&(this._state.setStateAtTime("started",a),this._tickSource.start(a,s),a<this._lastUpdate&&this.emit("start",a,s)),this}stop(e){let s=this.toSeconds(e);return this.log("stop",s),this._state.cancel(s),this._state.setStateAtTime("stopped",s),this._tickSource.stop(s),s<this._lastUpdate&&this.emit("stop",s),this}pause(e){let s=this.toSeconds(e);return this._state.getValueAtTime(s)==="started"&&(this._state.setStateAtTime("paused",s),this._tickSource.pause(s),s<this._lastUpdate&&this.emit("pause",s)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,s){return this._tickSource.setTicksAtTime(e,s),this}getTimeOfTick(e,s=this.now()){return this._tickSource.getTimeOfTick(e,s)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,s){let a=this.toSeconds(s),d=this.getTicksAtTime(a);return this._tickSource.getTimeOfTick(d+e,a)}_loop(){let e=this._lastUpdate,s=this.now();this._lastUpdate=s,this.log("loop",e,s),e!==s&&(this._state.forEachBetween(e,s,a=>{switch(a.state){case"started":let d=this._tickSource.getTicksAtTime(a.time);this.emit("start",a.time,d);break;case"stopped":a.time!==0&&this.emit("stop",a.time);break;case"paused":this.emit("pause",a.time)}}),this._tickSource.forEachTickBetween(e,s,(a,d)=>{this.callback(a,d)}))}getStateAtTime(e){let s=this.toSeconds(e);return this._state.getValueAtTime(s)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}qi.mixin(yi);class Ut extends oe{constructor(){super(W(Ut.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";let e=W(Ut.getDefaults(),arguments,["delayTime","maxDelay"]),s=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(s,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(s),this.delayTime=new Me({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),xe(this,"delayTime")}static getDefaults(){return Object.assign(oe.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}function xp(l,e,s=2,a=tt().sampleRate){return Je(this,void 0,void 0,function*(){let d=tt(),b=new Ni(s,e,a);ur(b),yield l(b);let k=b.render();ur(d);let A=yield k;return new Ne(A)})}class Hi extends Wn{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;let e=W(Hi.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(s=>{this._loadingCount++;let a=e.urls[s];this.add(s,a,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:je,onload:je,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return _e(this.has(e),"ToneAudioBuffers has no buffer named: "+e),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,s])=>s.loaded)}add(e,s,a=je,d=je){return rn(s)?this._buffers.set(e.toString(),new Ne(this.baseUrl+s,a,d)):this._buffers.set(e.toString(),new Ne(s,a,d)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Gi extends Vt{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return ii(super._frequencyToUnits(e))}_ticksToUnits(e){return ii(super._ticksToUnits(e))}_beatsToUnits(e){return ii(super._beatsToUnits(e))}_secondsToUnits(e){return ii(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return ia(this.toMidi())}transpose(e){return new Gi(this.context,this.toMidi()+e)}}function Tp(l,e){return new Gi(tt(),l,e)}class $e extends vt{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function Sp(l,e){return new $e(tt(),l,e)}class Cp extends St{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new vn,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,s){return this._events.add({callback:e,time:this.toSeconds(s)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){let e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){let s=this._events.shift();s&&e-s.time<=this.expiration&&s.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}ar(l=>{l.draw=new Cp({context:l})}),cr(l=>{l.draw.dispose()});class cl extends Wn{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){_e(Pe(e.time),"Events must have a time property"),_e(Pe(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let s=new kp(e.time,e.time+e.duration,e);for(this._root===null?this._root=s:this._root.insert(s),this._length++;s!==null;)s.updateHeight(),s.updateMax(),this._rebalance(s),s=s.parent;return this}remove(e){if(this._root!==null){let s=[];this._root.search(e.time,s);for(let a of s)if(a.event===e){this._removeNode(a),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,s=>this.remove(s)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,s){e.parent!==null?(e.isLeftChild()?e.parent.left=s:e.parent.right=s,this._rebalance(e.parent)):this._setRoot(s)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{let s,a=null;if(e.getBalance()>0)if(e.left.right===null)s=e.left,s.right=e.right,a=s;else{for(s=e.left.right;s.right!==null;)s=s.right;s.parent&&(s.parent.right=s.left,a=s.parent,s.left=e.left,s.right=e.right)}else if(e.right.left===null)s=e.right,s.left=e.left,a=s;else{for(s=e.right.left;s.left!==null;)s=s.left;s.parent&&(s.parent.left=s.right,a=s.parent,s.left=e.left,s.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=s:e.parent.right=s:this._setRoot(s),a&&this._rebalance(a)}e.dispose()}_rotateLeft(e){let s=e.parent,a=e.isLeftChild(),d=e.right;d&&(e.right=d.left,d.left=e),s!==null?a?s.left=d:s.right=d:this._setRoot(d)}_rotateRight(e){let s=e.parent,a=e.isLeftChild(),d=e.left;d&&(e.left=d.right,d.right=e),s!==null?a?s.left=d:s.right=d:this._setRoot(d)}_rebalance(e){let s=e.getBalance();s>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):s<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){let s=[];if(this._root.search(e,s),s.length>0){let a=s[0];for(let d=1;d<s.length;d++)s[d].low>a.low&&(a=s[d]);return a.event}}return null}forEach(e){if(this._root!==null){let s=[];this._root.traverse(a=>s.push(a)),s.forEach(a=>{a.event&&e(a.event)})}return this}forEachAtTime(e,s){if(this._root!==null){let a=[];this._root.search(e,a),a.forEach(d=>{d.event&&s(d.event)})}return this}forEachFrom(e,s){if(this._root!==null){let a=[];this._root.searchAfter(e,a),a.forEach(d=>{d.event&&s(d.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class kp{constructor(e,s,a){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=a,this.low=e,this.high=s,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,s){e>this.max||(this.left!==null&&this.left.search(e,s),this.low<=e&&this.high>e&&s.push(this),this.low>e||this.right!==null&&this.right.search(e,s))}searchAfter(e,s){this.low>=e&&(s.push(this),this.left!==null&&this.left.searchAfter(e,s)),this.right!==null&&this.right.searchAfter(e,s)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class kn extends oe{constructor(){super(W(kn.getDefaults(),arguments,["volume"])),this.name="Volume";let e=W(kn.getDefaults(),arguments,["volume"]);this.input=this.output=new me({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,xe(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(oe.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class mr extends oe{constructor(){super(W(mr.getDefaults(),arguments)),this.name="Destination",this.input=new kn({context:this.context}),this.output=new me({context:this.context}),this.volume=this.input.volume;let e=W(mr.getDefaults(),arguments);$t(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(oe.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),$t(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}ar(l=>{l.destination=new mr({context:l})}),cr(l=>{l.destination.dispose()});class Mp extends Wn{constructor(e){super(),this.name="TimelineValue",this._timeline=new vn({memory:10}),this._initialValue=e}set(e,s){return this._timeline.add({value:e,time:s}),this}get(e){let s=this._timeline.get(e);return s?s.value:this._initialValue}}class si{constructor(e,s){this.id=si._eventId++;let a=Object.assign(si.getDefaults(),s);this.transport=e,this.callback=a.callback,this._once=a.once,this.time=a.time}static getDefaults(){return{callback:je,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}si._eventId=0;class oa extends si{constructor(e,s){super(e,s),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);let a=Object.assign(oa.getDefaults(),s);this.duration=new $e(e.context,a.duration).valueOf(),this._interval=new $e(e.context,a.interval).valueOf(),this._nextTick=a.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},si.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){let s=this.transport.getTicksAtTime(e);s>=this.time&&s>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new $e(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;let s=this.transport.getTicksAtTime(e);s>this.time&&(this._nextTick=this.time+Math.ceil((s-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new $e(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new $e(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Ds extends St{constructor(){super(W(Ds.getDefaults(),arguments)),this.name="Transport",this._loop=new Mp(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new vn,this._repeatedEvents=new cl,this._syncedSignals=[],this._swingAmount=0;let e=W(Ds.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new yi({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),xe(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(St.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,s){if(this._loop.get(e)&&s>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),s=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&s%this._ppq!=0&&s%(2*this._swingTicks)!=0){let a=s%(2*this._swingTicks)/(2*this._swingTicks),d=Math.sin(a*Math.PI)*this._swingAmount;e+=new $e(this.context,2*this._swingTicks/3).toSeconds()*d}this._timeline.forEachAtTime(s,a=>a.invoke(e))}schedule(e,s){let a=new si(this,{callback:e,time:new vt(this.context,s).toTicks()});return this._addEvent(a,this._timeline)}scheduleRepeat(e,s,a,d=1/0){let b=new oa(this,{callback:e,duration:new Jt(this.context,d).toTicks(),interval:new Jt(this.context,s).toTicks(),time:new vt(this.context,a).toTicks()});return this._addEvent(b,this._repeatedEvents)}scheduleOnce(e,s){let a=new si(this,{callback:e,once:!0,time:new vt(this.context,s).toTicks()});return this._addEvent(a,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){let s=this._scheduledEvents[e.toString()];s.timeline.remove(s.event),s.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,s){return this._scheduledEvents[e.id.toString()]={event:e,timeline:s},s.add(e),e.id}cancel(e=0){let s=this.toTicks(e);return this._timeline.forEachFrom(s,a=>this.clear(a.id)),this._repeatedEvents.forEachFrom(s,a=>this.clear(a.id)),this}_bindClockEvents(){this._clock.on("start",(e,s)=>{s=new $e(this.context,s).toSeconds(),this.emit("start",e,s)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,s){let a;return Pe(s)&&(a=this.toTicks(s)),this._clock.start(e,a),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Pt(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Jt(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Jt(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,s){return this.loopStart=e,this.loopEnd=s,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new $e(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){let e=this.now(),s=this._clock.getTicksAtTime(e);return new $e(this.context,s).toBarsBeatsSixteenths()}set position(e){let s=this.toTicks(e);this.ticks=s}get seconds(){return this._clock.seconds}set seconds(e){let s=this.now(),a=this._clock.frequency.timeToTicks(e,s);this.ticks=a}get progress(){if(this.loop){let e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){let s=this.now();if(this.state==="started"){let a=this._clock.getTicksAtTime(s),d=s+this._clock.frequency.getDurationOfTicks(Math.ceil(a)-a,s);this.emit("stop",d),this._clock.setTicksAtTime(e,d),this.emit("start",d,this._clock.getSecondsAtTime(d))}else this._clock.setTicksAtTime(e,s)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{let s=this.now(),a=e-this.getTicksAtTime(s)%e;return this._clock.nextTickTime(a,s)}}syncSignal(e,s){if(!s){let d=this.now();if(e.getValueAtTime(d)!==0){let b=1/(60/this.bpm.getValueAtTime(d)/this.PPQ);s=e.getValueAtTime(d)/b}else s=0}let a=new me(s);return this.bpm.connect(a),a.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:a,signal:e}),e.value=0,this}unsyncSignal(e){for(let s=this._syncedSignals.length-1;s>=0;s--){let a=this._syncedSignals[s];a.signal===e&&(a.ratio.dispose(),a.signal.value=a.initial,this._syncedSignals.splice(s,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Os(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}qi.mixin(Ds),ar(l=>{l.transport=new Ds({context:l})}),cr(l=>{l.transport.dispose()});class ht extends oe{constructor(e){super(e),this.input=void 0,this._state=new zi("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=je,this._syncedStop=je,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new kn({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,xe(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(oe.getDefaults(),{mute:!1,onstop:je,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,s,a){let d=Bt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(d=this._clampToCurrentTime(d),this._synced||this._state.getValueAtTime(d)!=="started")if(this.log("start",d),this._state.setStateAtTime("started",d),this._synced){let b=this._state.get(d);b&&(b.offset=this.toSeconds(an(s,0)),b.duration=a?this.toSeconds(a):void 0);let k=this.context.transport.schedule(A=>{this._start(A,s,a)},d);this._scheduled.push(k),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>d&&this._syncedStart(this.now(),this.context.transport.seconds)}else $o(this.context),this._start(d,s,a);else _e(or(d,this._state.get(d).time),"Start time must be strictly greater than previous start time"),this._state.cancel(d),this._state.setStateAtTime("started",d),this.log("restart",d),this.restart(d,s,a);return this}stop(e){let s=Bt(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(s=this._clampToCurrentTime(s),this._state.getValueAtTime(s)==="started"||Pe(this._state.getNextState("started",s))){if(this.log("stop",s),this._synced){let a=this.context.transport.schedule(this._stop.bind(this),s);this._scheduled.push(a)}else this._stop(s);this._state.cancel(s),this._state.setStateAtTime("stopped",s)}return this}restart(e,s,a){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,s,a)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,s)=>{if(s>0){let a=this._state.get(s);if(a&&a.state==="started"&&a.time!==s){let d=s-this.toSeconds(a.time),b;a.duration&&(b=this.toSeconds(a.duration)-d),this._start(e,this.toSeconds(a.offset)+d,b)}}},this._syncedStop=e=>{let s=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(s)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=je,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class Bn extends Ui{constructor(){super(W(Bn.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;let e=W(Bn.getDefaults(),arguments,["url","onload"]);zt(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Me({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Ne(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Ui.getDefaults(),{url:new Ne,loop:!1,loopEnd:0,loopStart:0,onload:je,onerror:je,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,s,a,d=1){_e(this.buffer.loaded,"buffer is either not set or not loaded");let b=this.toSeconds(e);this._startGain(b,d),s=this.loop?an(s,this.loopStart):an(s,0);let k=Math.max(this.toSeconds(s),0);if(this.loop){let A=this.toSeconds(this.loopEnd)||this.buffer.duration,O=this.toSeconds(this.loopStart),E=A-O;ta(k,A)&&(k=(k-O)%E+O),gn(k,this.buffer.duration)&&(k=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,nl(k,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(b,k)),Pe(a)){let A=this.toSeconds(a);A=Math.max(A,0),this.stop(b+A)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class zn extends ht{constructor(){super(W(zn.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;let e=W(zn.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ht.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(_e(e in ll,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){let s=this.now();this._stop(s),this._start(s)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){let s=ll[this._type];this._source=new Bn({url:s,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(s.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}let Un={brown:null,pink:null,white:null},ll={get brown(){if(!Un.brown){let l=[];for(let e=0;e<2;e++){let s=new Float32Array(220500);l[e]=s;let a=0;for(let d=0;d<220500;d++){let b=2*Math.random()-1;s[d]=(a+.02*b)/1.02,a=s[d],s[d]*=3.5}}Un.brown=new Ne().fromArray(l)}return Un.brown},get pink(){if(!Un.pink){let l=[];for(let e=0;e<2;e++){let s=new Float32Array(220500),a,d,b,k,A,O,E;l[e]=s,a=d=b=k=A=O=E=0;for(let j=0;j<220500;j++){let P=2*Math.random()-1;a=.99886*a+.0555179*P,d=.99332*d+.0750759*P,b=.969*b+.153852*P,k=.8665*k+.3104856*P,A=.55*A+.5329522*P,O=-.7616*O-.016898*P,s[j]=a+d+b+k+A+O+E+.5362*P,s[j]*=.11,E=.115926*P}}Un.pink=new Ne().fromArray(l)}return Un.pink},get white(){if(!Un.white){let l=[];for(let e=0;e<2;e++){let s=new Float32Array(220500);l[e]=s;for(let a=0;a<220500;a++)s[a]=2*Math.random()-1}Un.white=new Ne().fromArray(l)}return Un.white}};class Yi extends oe{constructor(){super(W(Yi.getDefaults(),arguments,["volume"])),this.name="UserMedia";let e=W(Yi.getDefaults(),arguments,["volume"]);this._volume=this.output=new kn({context:this.context,volume:e.volume}),this.volume=this._volume.volume,xe(this,"volume"),this.mute=e.mute}static getDefaults(){return Object.assign(oe.getDefaults(),{mute:!1,volume:0})}open(e){return Je(this,void 0,void 0,function*(){_e(Yi.supported,"UserMedia is not supported"),this.state==="started"&&this.close();let s=yield Yi.enumerateDevices();Zt(e)?this._device=s[e]:(this._device=s.find(b=>b.label===e||b.deviceId===e),!this._device&&s.length>0&&(this._device=s[0]),_e(Pe(this._device),"No matching device "+e));let a={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(a.audio.deviceId=this._device.deviceId);let d=yield navigator.mediaDevices.getUserMedia(a);if(!this._stream){this._stream=d;let b=this.context.createMediaStreamSource(d);zt(b,this.output),this._mediaStream=b}return this})}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach(e=>{e.stop()}),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return Je(this,void 0,void 0,function*(){return(yield navigator.mediaDevices.enumerateDevices()).filter(e=>e.kind==="audioinput")})}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return Pe(navigator.mediaDevices)&&Pe(navigator.mediaDevices.getUserMedia)}}function bi(l,e){return Je(this,void 0,void 0,function*(){let s=e/l.context.sampleRate,a=new Ni(1,s,l.context.sampleRate);return new l.constructor(Object.assign(l.get(),{frequency:2/s,detune:0,context:a})).toDestination().start(0),(yield a.render()).getChannelData(0)})}class Xi extends Ui{constructor(){super(W(Xi.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];let e=W(Xi.getDefaults(),arguments,["frequency","type"]);zt(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Me({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Me({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),xe(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ui.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){let s=this.toSeconds(e);return this.log("start",s),this._startGain(s),this._oscillator.start(s),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class nt extends ht{constructor(){super(W(nt.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;let e=W(nt.getDefaults(),arguments,["frequency","type"]);this.frequency=new Se({context:this.context,units:"frequency",value:e.frequency}),xe(this,"frequency"),this.detune=new Se({context:this.context,units:"cents",value:e.detune}),xe(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(ht.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){let s=this.toSeconds(e),a=new Xi({context:this.context,onended:()=>this.onstop(this)});this._oscillator=a,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(s)}_stop(e){let s=this.toSeconds(e);this._oscillator&&this._oscillator.stop(s)}_restart(e){let s=this.toSeconds(e);return this.log("restart",s),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(s),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return nt._periodicWaveCache.find(e=>{return e.phase===this._phase&&(s=e.partials,a=this._partials,s.length===a.length&&s.every((d,b)=>a[b]===d));var s,a});{let e=nt._periodicWaveCache.find(s=>s.type===this._type&&s.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;let s=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&s)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{let a=this._getCachedPeriodicWave();if(Pe(a)){let{partials:d,wave:b}=a;this._wave=b,this._partials=d,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{let[d,b]=this._getRealImaginary(e,this._phase),k=this.context.createPeriodicWave(d,b);this._wave=k,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),nt._periodicWaveCache.push({imag:b,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:d,type:this._type,wave:this._wave}),nt._periodicWaveCache.length>100&&nt._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Et(e,0);let s=this._type,a=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(a&&(s=a[1]),this._type!=="custom")this.type=e===0?s:s+e.toString();else{let d=new Float32Array(e);this._partials.forEach((b,k)=>d[k]=b),this._partials=Array.from(d),this.type=this._type}}_getRealImaginary(e,s){let a=2048,d=new Float32Array(a),b=new Float32Array(a),k=1;if(e==="custom"){if(k=this._partials.length+1,this._partialCount=this._partials.length,a=k,this._partials.length===0)return[d,b]}else{let A=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);A?(k=parseInt(A[2],10)+1,this._partialCount=parseInt(A[2],10),e=A[1],k=Math.max(k,2),a=k):this._partialCount=0,this._partials=[]}for(let A=1;A<a;++A){let O=2/(A*Math.PI),E;switch(e){case"sine":E=A<=k?1:0,this._partials[A-1]=E;break;case"square":E=1&A?2*O:0,this._partials[A-1]=E;break;case"sawtooth":E=O*(1&A?1:-1),this._partials[A-1]=E;break;case"triangle":E=1&A?O*O*2*(A-1>>1&1?-1:1):0,this._partials[A-1]=E;break;case"custom":E=this._partials[A-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}E!==0?(d[A]=-E*Math.sin(s*A),b[A]=E*Math.cos(s*A)):(d[A]=0,b[A]=0)}return[d,b]}_inverseFFT(e,s,a){let d=0,b=e.length;for(let k=0;k<b;k++)d+=e[k]*Math.cos(k*a)+s[k]*Math.sin(k*a);return d}getInitialValue(){let[e,s]=this._getRealImaginary(this._type,0),a=0,d=2*Math.PI;for(let b=0;b<32;b++)a=Math.max(this._inverseFFT(e,s,b/32*d),a);return il(-this._inverseFFT(e,s,this._phase)/a,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return Je(this,void 0,void 0,function*(){return bi(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}nt._periodicWaveCache=[];class Kt extends oe{constructor(){super(Object.assign(W(Kt.getDefaults(),arguments,["context"])))}connect(e,s=0,a=0){return Ps(this,e,s,a),this}}class cn extends Kt{constructor(){super(Object.assign(W(cn.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;let e=W(cn.getDefaults(),arguments,["mapping","length"]);Pt(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):el(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Se.getDefaults(),{length:1024})}setMap(e,s=1024){let a=new Float32Array(s);for(let d=0,b=s;d<b;d++){let k=d/(b-1)*2-1;a[d]=e(k,d)}return this.curve=a,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){_e(["none","2x","4x"].some(s=>s.includes(e)),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class _r extends Kt{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new cn({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class it extends Se{constructor(){super(Object.assign(W(it.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;let e=W(it.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new me({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Se.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Qi extends ht{constructor(){super(W(Qi.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new _r({context:this.context}),this._modulationNode=new me({context:this.context});let e=W(Qi.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new nt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new nt({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new it({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),xe(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(nt.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Je(this,void 0,void 0,function*(){return bi(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class wi extends ht{constructor(){super(W(wi.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new me({context:this.context,gain:0});let e=W(wi.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new nt({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Se({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new nt({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new it({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new it({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),xe(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(nt.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return Je(this,void 0,void 0,function*(){return bi(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class xi extends ht{constructor(){super(W(xi.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new me({context:this.context,gain:0}),this._thresh=new cn({context:this.context,mapping:s=>s<=0?-1:1});let e=W(xi.getDefaults(),arguments,["frequency","width"]);this.width=new Se({context:this.context,units:"audioRange",value:e.width}),this._triangle=new nt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),xe(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(ht.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return Je(this,void 0,void 0,function*(){return bi(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Zi extends ht{constructor(){super(W(Zi.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];let e=W(Zi.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Se({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Se({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,xe(this,["frequency","detune"])}static getDefaults(){return Object.assign(nt.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(s=>s.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(s=>s.stop(e))}_restart(e){this._forEach(s=>s.restart(e))}_forEach(e){for(let s=0;s<this._oscillators.length;s++)e(this._oscillators[s],s)}get type(){return this._type}set type(e){this._type=e,this._forEach(s=>s.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){let s=-e/2,a=e/(this._oscillators.length-1);this._forEach((d,b)=>d.detune.value=s+a*b)}}get count(){return this._oscillators.length}set count(e){if(Et(e,1),this._oscillators.length!==e){this._forEach(s=>s.dispose()),this._oscillators=[];for(let s=0;s<e;s++){let a=new nt({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+s/e*360,partialCount:this._partialCount,onstop:s===0?()=>this.onstop(this):je});this.type==="custom"&&(a.partials=this._partials),this.frequency.connect(a.frequency),this.detune.connect(a.detune),a.detune.overridden=!1,a.connect(this.output),this._oscillators[s]=a}this.spread=this._spread,this.state==="started"&&this._forEach(s=>s.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((s,a)=>s.phase=this._phase+a/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(s=>s.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(s=>s.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(s=>s.partialCount=e),this._type=this._oscillators[0].type}asArray(e=1024){return Je(this,void 0,void 0,function*(){return bi(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class Ji extends ht{constructor(){super(W(Ji.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new it({context:this.context,value:2});let e=W(Ji.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new xi({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new nt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),xe(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(ht.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return Je(this,void 0,void 0,function*(){return bi(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}let ul={am:Qi,fat:Zi,fm:wi,oscillator:nt,pulse:xi,pwm:Ji};class Mn extends ht{constructor(){super(W(Mn.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";let e=W(Mn.getDefaults(),arguments,["frequency","type"]);this.frequency=new Se({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Se({context:this.context,units:"cents",value:e.detune}),xe(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(nt.getDefaults(),wi.getDefaults(),Qi.getDefaults(),Zi.getDefaults(),xi.getDefaults(),Ji.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(s=>this._sourceType===s)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;let s=ul[e],a=this.now();if(this._oscillator){let d=this._oscillator;d.stop(a),this.context.setTimeout(()=>d.dispose(),this.blockTime)}this._oscillator=new s({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(a)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let s="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(s=this._oscillator.type),e==="fm"?this.type="fm"+s:e==="am"?this.type="am"+s:e==="fat"?this.type="fat"+s:e==="oscillator"?this.type=s:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,s){return e instanceof ul[s]}get baseType(){return this._oscillator.baseType}set baseType(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||e==="pulse"||e==="pwm"||(this._oscillator.baseType=e)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(e){this._getOscType(this._oscillator,"fat")&&Zt(e)&&(this._oscillator.count=e)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(e){this._getOscType(this._oscillator,"fat")&&Zt(e)&&(this._oscillator.spread=e)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&rn(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(e=1024){return Je(this,void 0,void 0,function*(){return bi(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class Ti extends Se{constructor(){super(Object.assign(W(Ti.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new me({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,$t(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Se.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class An extends Kt{constructor(){super(Object.assign(W(An.getDefaults(),arguments,["min","max"]))),this.name="Scale";let e=W(An.getDefaults(),arguments,["min","max"]);this._mult=this.input=new it({context:this.context,value:e.max-e.min}),this._add=this.output=new Ti({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(Kt.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class gr extends Kt{constructor(){super(Object.assign(W(gr.getDefaults(),arguments))),this.name="Zero",this._gain=new me({context:this.context}),this.output=this._gain,this.input=void 0,zt(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),ra(this.context.getConstant(0),this._gain),this}}class Ft extends oe{constructor(){super(W(Ft.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Me.prototype._fromType,this._toType=Me.prototype._toType,this._is=Me.prototype._is,this._clampValue=Me.prototype._clampValue;let e=W(Ft.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new nt(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new me({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Se({context:this.context,units:"audioRange",value:0}),this._zeros=new gr({context:this.context}),this._a2g=new _r({context:this.context}),this._scaler=this.output=new An({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),xe(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(nt.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){let s=this.min,a=this.max;this._units=e,this.min=s,this.max=a}get state(){return this._oscillator.state}connect(e,s,a){return(e instanceof Me||e instanceof Se)&&(this.convert=e.convert,this.units=e.units),Ps(this,e,s,a),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function hl(l,e=1/0){let s=new WeakMap;return function(a,d){Reflect.defineProperty(a,d,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(b){Et(b,l,e),s.set(this,b)}})}}function Hn(l,e=1/0){let s=new WeakMap;return function(a,d){Reflect.defineProperty(a,d,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(b){Et(this.toSeconds(b),l,e),s.set(this,b)}})}}class Si extends ht{constructor(){super(W(Si.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;let e=W(Si.getDefaults(),arguments,["url","onload"]);this._buffer=new Ne({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ht.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:je,onerror:je,playbackRate:1,reverse:!1})}load(e){return Je(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=je){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size!==0||this._synced||this._state.getValueAtTime(this.now())!=="started"||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,s,a){return super.start(e,s,a),this}_start(e,s,a){s=this._loop?an(s,this._loopStart):an(s,0);let d=this.toSeconds(s),b=a;a=an(a,Math.max(this._buffer.duration-d,0));let k=this.toSeconds(a);k/=this._playbackRate,e=this.toSeconds(e);let A=new Bn({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(e+k),this._state.setStateAtTime("stopped",e+k,{implicitEnd:!0})),this._activeSources.add(A),this._loop&&Bt(b)?A.start(e,d):A.start(e,d,k-this.toSeconds(this.fadeOut))}_stop(e){let s=this.toSeconds(e);this._activeSources.forEach(a=>a.stop(s))}restart(e,s,a){return super.restart(e,s,a),this}_restart(e,s,a){this._stop(e),this._start(e,s,a)}seek(e,s){let a=this.toSeconds(s);if(this._state.getValueAtTime(a)==="started"){let d=this.toSeconds(e);this._stop(a),this._start(a,d)}return this}setLoopPoints(e,s){return this.loopStart=e,this.loopEnd=s,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Et(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(s=>{s.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Et(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(s=>{s.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(s=>{s.loop=e}),e)){let s=this._state.getNextState("stopped",this.now());s&&this._state.cancel(s.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;let s=this.now(),a=this._state.getNextState("stopped",s);a&&a.implicitEnd&&(this._state.cancel(a.time),this._activeSources.forEach(d=>d.cancelStop())),this._activeSources.forEach(d=>{d.playbackRate.setValueAtTime(e,s)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}_n([Hn(0)],Si.prototype,"fadeIn",void 0),_n([Hn(0)],Si.prototype,"fadeOut",void 0);class vr extends oe{constructor(){super(W(vr.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;let e=W(vr.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new kn({context:this.context,volume:e.volume}),this.volume=this._volume.volume,xe(this,"volume"),this._buffers=new Hi({urls:e.urls,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.mute=e.mute,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ht.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:je,onerror:je,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._players.forEach(s=>{s.fadeIn=e})}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._players.forEach(s=>{s.fadeOut=e})}get state(){return Array.from(this._players).some(([e,s])=>s.state==="started")?"started":"stopped"}has(e){return this._buffers.has(e)}player(e){if(_e(this.has(e),`No Player with the name ${e} exists on this object`),!this._players.has(e)){let s=new Si({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(e)}).connect(this.output);this._players.set(e,s)}return this._players.get(e)}get loaded(){return this._buffers.loaded}add(e,s,a){return _e(!this._buffers.has(e),"A buffer with that name already exists on this object"),this._buffers.add(e,s,a),this}stopAll(e){return this._players.forEach(s=>s.stop(e)),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach(e=>e.dispose()),this._buffers.dispose(),this}}class yr extends ht{constructor(){super(W(yr.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];let e=W(yr.getDefaults(),arguments,["url","onload"]);this.buffer=new Ne({onload:e.onload,onerror:e.onerror,reverse:e.reverse,url:e.url}),this._clock=new yi({context:this.context,callback:this._tick.bind(this),frequency:1/e.grainSize}),this._playbackRate=e.playbackRate,this._grainSize=e.grainSize,this._overlap=e.overlap,this.detune=e.detune,this.overlap=e.overlap,this.loop=e.loop,this.playbackRate=e.playbackRate,this.grainSize=e.grainSize,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.reverse=e.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(ht.getDefaults(),{onload:je,onerror:je,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(e,s,a){s=an(s,0),s=this.toSeconds(s),e=this.toSeconds(e);let d=1/this._clock.frequency.getValueAtTime(e);this._clock.start(e,s/d),a&&this.stop(e+this.toSeconds(a))}restart(e,s,a){return super.restart(e,s,a),this}_restart(e,s,a){this._stop(e),this._start(e,s,a)}_stop(e){this._clock.stop(e)}_onstop(e){this._activeSources.forEach(s=>{s.fadeOut=0,s.stop(e)}),this.onstop(this)}_tick(e){let s=this._clock.getTicksAtTime(e),a=s*this._grainSize;if(this.log("offset",a),!this.loop&&a>this.buffer.duration)return void this.stop(e);let d=a<this._overlap?0:this._overlap,b=new Bn({context:this.context,url:this.buffer,fadeIn:d,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:Bi(this.detune/100)}).connect(this.output);b.start(e,this._grainSize*s),b.stop(e+this._grainSize/this.playbackRate),this._activeSources.push(b),b.onended=()=>{let k=this._activeSources.indexOf(b);k!==-1&&this._activeSources.splice(k,1)}}get playbackRate(){return this._playbackRate}set playbackRate(e){Et(e,.001),this._playbackRate=e,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(e){this.buffer.loaded&&Et(this.toSeconds(e),0,this.buffer.duration),this._loopStart=this.toSeconds(e)}get loopEnd(){return this._loopEnd}set loopEnd(e){this.buffer.loaded&&Et(this.toSeconds(e),0,this.buffer.duration),this._loopEnd=this.toSeconds(e)}get reverse(){return this.buffer.reverse}set reverse(e){this.buffer.reverse=e}get grainSize(){return this._grainSize}set grainSize(e){this._grainSize=this.toSeconds(e),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(e){let s=this.toSeconds(e);Et(s,0),this._overlap=s}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(e=>e.dispose()),this}}class dl extends Kt{constructor(){super(...arguments),this.name="Abs",this._abs=new cn({context:this.context,mapping:e=>Math.abs(e)<.001?0:Math.abs(e)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class pl extends Kt{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new cn({context:this.context,mapping:e=>2*Math.abs(e)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class aa extends Kt{constructor(){super(...arguments),this.name="Negate",this._multiply=new it({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class Ci extends Se{constructor(){super(Object.assign(W(Ci.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new me({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new aa({context:this.context}),this.subtrahend=this._param,$t(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(Se.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class br extends Kt{constructor(){super(Object.assign(W(br.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new cn({context:this.context,length:127,mapping:e=>e<=0?0:1}),this._scale=this.input=new it({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class Is extends Se{constructor(){super(Object.assign(W(Is.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;let e=W(Is.getDefaults(),arguments,["value"]);this._subtract=this.input=new Ci({context:this.context,value:e.value}),this._gtz=this.output=new br({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,xe(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(Se.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class $i extends Kt{constructor(){super(Object.assign(W($i.getDefaults(),arguments,["value"]))),this.name="Pow";let e=W($i.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new cn({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(Kt.getDefaults(),{value:1})}_expFunc(e){return s=>Math.pow(Math.abs(s),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class js extends An{constructor(){super(Object.assign(W(js.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";let e=W(js.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new $i({context:this.context,value:e.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(An.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(e){this._exp.value=e}dispose(){return super.dispose(),this._exp.dispose(),this}}class Ap extends Se{constructor(){super(W(Se.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;let e=W(Se.getDefaults(),arguments,["value","units"]);this._lastVal=e.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new Es({context:this.context,offset:e.value,units:e.units}).start(0),this.setValueAtTime(e.value,0)}_onTick(e){let s=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==s&&(this._lastVal=s,this._constantSource.offset.setValueAtTime(s,e))}_anchorValue(e){let s=super.getValueAtTime(this.context.transport.seconds);this._lastVal=s,this._constantSource.offset.cancelAndHoldAtTime(e),this._constantSource.offset.setValueAtTime(s,e)}getValueAtTime(e){let s=new vt(this.context,e).toSeconds();return super.getValueAtTime(s)}setValueAtTime(e,s){let a=new vt(this.context,s).toSeconds();return super.setValueAtTime(e,a),this}linearRampToValueAtTime(e,s){let a=new vt(this.context,s).toSeconds();return super.linearRampToValueAtTime(e,a),this}exponentialRampToValueAtTime(e,s){let a=new vt(this.context,s).toSeconds();return super.exponentialRampToValueAtTime(e,a),this}setTargetAtTime(e,s,a){let d=new vt(this.context,s).toSeconds();return super.setTargetAtTime(e,d,a),this}cancelScheduledValues(e){let s=new vt(this.context,e).toSeconds();return super.cancelScheduledValues(s),this}setValueCurveAtTime(e,s,a,d){let b=new vt(this.context,s).toSeconds();return a=this.toSeconds(a),super.setValueCurveAtTime(e,b,a,d),this}cancelAndHoldAtTime(e){let s=new vt(this.context,e).toSeconds();return super.cancelAndHoldAtTime(s),this}setRampPoint(e){let s=new vt(this.context,e).toSeconds();return super.setRampPoint(s),this}exponentialRampTo(e,s,a){let d=new vt(this.context,a).toSeconds();return super.exponentialRampTo(e,s,d),this}linearRampTo(e,s,a){let d=new vt(this.context,a).toSeconds();return super.linearRampTo(e,s,d),this}targetRampTo(e,s,a){let d=new vt(this.context,a).toSeconds();return super.targetRampTo(e,s,d),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class Ct extends oe{constructor(){super(W(Ct.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Se({context:this.context,value:0}),this.output=this._sig,this.input=void 0;let e=W(Ct.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(oe.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,s){if(rn(e))return e;{let a;for(a in wr)if(wr[a][s]===e)return a;return e}}_setCurve(e,s,a){if(rn(a)&&Reflect.has(wr,a)){let d=wr[a];Vn(d)?e!=="_decayCurve"&&(this[e]=d[s]):this[e]=d}else{if(!Pt(a)||e==="_decayCurve")throw new Error("Envelope: invalid curve: "+a);this[e]=a}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){_e(["linear","exponential"].some(s=>s===e),"Invalid envelope curve: "+e),this._decayCurve=e}triggerAttack(e,s=1){this.log("triggerAttack",e,s),e=this.toSeconds(e);let a=this.toSeconds(this.attack),d=this.toSeconds(this.decay),b=this.getValueAtTime(e);if(b>0&&(a=(1-b)/(1/a)),a<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(s,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(s,a,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(s,a,e);else{this._sig.cancelAndHoldAtTime(e);let k=this._attackCurve;for(let A=1;A<k.length;A++)if(k[A-1]<=b&&b<=k[A]){k=this._attackCurve.slice(A),k[0]=b;break}this._sig.setValueCurveAtTime(k,e,a,s)}if(d&&this.sustain<1){let k=s*this.sustain,A=e+a;this.log("decay",A),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(k,d+A):this._sig.exponentialApproachValueAtTime(k,A,d)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);let s=this.getValueAtTime(e);if(s>0){let a=this.toSeconds(this.release);a<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,a,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,a,e):(_e(Pt(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,a,s))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,s,a=1){return s=this.toSeconds(s),this.triggerAttack(s,a),this.triggerRelease(s+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,s=0,a=0){return Ps(this,e,s,a),this}asArray(e=1024){return Je(this,void 0,void 0,function*(){let s=e/this.context.sampleRate,a=new Ni(1,s,this.context.sampleRate),d=this.toSeconds(this.attack)+this.toSeconds(this.decay),b=d+this.toSeconds(this.release),k=.1*b,A=b+k,O=new this.constructor(Object.assign(this.get(),{attack:s*this.toSeconds(this.attack)/A,decay:s*this.toSeconds(this.decay)/A,release:s*this.toSeconds(this.release)/A,context:a}));return O._sig.toDestination(),O.triggerAttackRelease(s*(d+k)/A,0),(yield a.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}_n([Hn(0)],Ct.prototype,"attack",void 0),_n([Hn(0)],Ct.prototype,"decay",void 0),_n([hl(0,1)],Ct.prototype,"sustain",void 0),_n([Hn(0)],Ct.prototype,"release",void 0);let wr=(()=>{let l,e,s=[];for(l=0;l<128;l++)s[l]=Math.sin(l/127*(Math.PI/2));let a=[];for(l=0;l<127;l++){e=l/127;let E=Math.sin(e*(2*Math.PI)*6.4-Math.PI/2)+1;a[l]=E/10+.83*e}a[127]=1;let d=[];for(l=0;l<128;l++)d[l]=Math.ceil(l/127*5)/5;let b=[];for(l=0;l<128;l++)e=l/127,b[l]=.5*(1-Math.cos(Math.PI*e));let k=[];for(l=0;l<128;l++){e=l/127;let E=4*Math.pow(e,3)+.2,j=Math.cos(E*Math.PI*2*e);k[l]=Math.abs(j*(1-e))}function A(E){let j=new Array(E.length);for(let P=0;P<E.length;P++)j[P]=1-E[P];return j}return{bounce:{In:A(k),Out:k},cosine:{In:s,Out:(O=s,O.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:a,Out:A(a)},sine:{In:b,Out:A(b)},step:{In:d,Out:A(d)}};var O})();class en extends oe{constructor(){super(W(en.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;let e=W(en.getDefaults(),arguments);this._volume=this.output=new kn({context:this.context,volume:e.volume}),this.volume=this._volume.volume,xe(this,"volume")}static getDefaults(){return Object.assign(oe.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,s){let a=this["_original_"+e]=this[e];this[e]=(...d)=>{let b=d[s],k=this.context.transport.schedule(A=>{d[s]=A,a.apply(this,d)},b);this._scheduledEvents.push(k)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,s,a,d){let b=this.toSeconds(a),k=this.toSeconds(s);return this.triggerAttack(e,b,d),this.triggerRelease(b+k),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class It extends en{constructor(){super(W(It.getDefaults(),arguments));let e=W(It.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(en.getDefaults(),{detune:0,onsilence:je,portamento:0})}triggerAttack(e,s,a=1){this.log("triggerAttack",e,s,a);let d=this.toSeconds(s);return this._triggerEnvelopeAttack(d,a),this.setNote(e,d),this}triggerRelease(e){this.log("triggerRelease",e);let s=this.toSeconds(e);return this._triggerEnvelopeRelease(s),this}setNote(e,s){let a=this.toSeconds(s),d=e instanceof Vt?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(a)>.05){let b=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(d,b,a)}else this.frequency.setValueAtTime(d,a);return this}}_n([Hn(0)],It.prototype,"portamento",void 0);class Ki extends Ct{constructor(){super(W(Ki.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new me({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Gn extends It{constructor(){super(W(Gn.getDefaults(),arguments)),this.name="Synth";let e=W(Gn.getDefaults(),arguments);this.oscillator=new Mn(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Ki(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),xe(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(It.getDefaults(),{envelope:Object.assign(Dt(Ct.getDefaults(),Object.keys(oe.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Dt(Mn.getDefaults(),[...Object.keys(ht.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,s){if(this.envelope.triggerAttack(e,s),this.oscillator.start(e),this.envelope.sustain===0){let a=this.toSeconds(this.envelope.attack),d=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+a+d)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class es extends It{constructor(){super(W(es.getDefaults(),arguments)),this.name="ModulationSynth";let e=W(es.getDefaults(),arguments);this._carrier=new Gn({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new Gn({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new Se({context:this.context,units:"frequency"}),this.detune=new Se({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new it({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new me({context:this.context,gain:0}),xe(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(It.getDefaults(),{harmonicity:3,oscillator:Object.assign(Dt(Mn.getDefaults(),[...Object.keys(ht.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(Dt(Ct.getDefaults(),Object.keys(oe.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(Dt(Mn.getDefaults(),[...Object.keys(ht.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(Dt(Ct.getDefaults(),Object.keys(oe.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,s){this._carrier._triggerEnvelopeAttack(e,s),this._modulator._triggerEnvelopeAttack(e,s)}_triggerEnvelopeRelease(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class ca extends es{constructor(){super(W(ca.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new _r({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class ts extends oe{constructor(){super(W(ts.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";let e=W(ts.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Me({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new Me({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new Me({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new Me({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(oe.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){_e(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,"Invalid filter type: "+e),this._filter.type=e}getFrequencyResponse(e=128){let s=new Float32Array(e);for(let k=0;k<e;k++){let A=19980*Math.pow(k/e,2)+20;s[k]=A}let a=new Float32Array(e),d=new Float32Array(e),b=this.context.createBiquadFilter();return b.type=this.type,b.Q.value=this.Q.value,b.frequency.value=this.frequency.value,b.gain.value=this.gain.value,b.getFrequencyResponse(s,a,d),a}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Ht extends oe{constructor(){super(W(Ht.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new me({context:this.context}),this.output=new me({context:this.context}),this._filters=[];let e=W(Ht.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new Se({context:this.context,units:"positive",value:e.Q}),this.frequency=new Se({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Se({context:this.context,units:"cents",value:e.detune}),this.gain=new Se({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,xe(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(oe.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){_e(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,"Invalid filter type: "+e),this._type=e,this._filters.forEach(s=>s.type=e)}get rolloff(){return this._rolloff}set rolloff(e){let s=Zt(e)?e:parseInt(e,10),a=[-12,-24,-48,-96],d=a.indexOf(s);_e(d!==-1,"rolloff can only be "+a.join(", ")),d+=1,this._rolloff=s,this.input.disconnect(),this._filters.forEach(b=>b.disconnect()),this._filters=new Array(d);for(let b=0;b<d;b++){let k=new ts({context:this.context});k.type=this._type,this.frequency.connect(k.frequency),this.detune.connect(k.detune),this.Q.connect(k.Q),this.gain.connect(k.gain),this._filters[b]=k}this._internalChannels=this._filters,$t(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){let s=new ts({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),a=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{s.getFrequencyResponse(e).forEach((d,b)=>a[b]*=d)}),s.dispose(),a}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),Os(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class ns extends Ct{constructor(){super(W(ns.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";let e=W(ns.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new $i({context:this.context,value:e.exponent}),this._scale=this.output=new An({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Ct.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){let s=this.toFrequency(e);Et(s,0),this._baseFrequency=s,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class ri extends It{constructor(){super(W(ri.getDefaults(),arguments)),this.name="MonoSynth";let e=W(ri.getDefaults(),arguments);this.oscillator=new Mn(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Ht(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new ns(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new Ki(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),xe(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(It.getDefaults(),{envelope:Object.assign(Dt(Ct.getDefaults(),Object.keys(oe.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(Dt(Ht.getDefaults(),Object.keys(oe.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(Dt(ns.getDefaults(),Object.keys(oe.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(Dt(Mn.getDefaults(),Object.keys(ht.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(e,s=1){if(this.envelope.triggerAttack(e,s),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),this.envelope.sustain===0){let a=this.toSeconds(this.envelope.attack),d=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+a+d)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class xr extends It{constructor(){super(W(xr.getDefaults(),arguments)),this.name="DuoSynth";let e=W(xr.getDefaults(),arguments);this.voice0=new ri(Object.assign(e.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new ri(Object.assign(e.voice1,{context:this.context})),this.harmonicity=new it({context:this.context,units:"positive",value:e.harmonicity}),this._vibrato=new Ft({frequency:e.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new me({context:this.context,units:"normalRange",gain:e.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new Se({context:this.context,units:"frequency",value:440}),this.detune=new Se({context:this.context,units:"cents",value:e.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),xe(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(e){return e=this.toSeconds(e),this.voice0.envelope.getValueAtTime(e)+this.voice1.envelope.getValueAtTime(e)}static getDefaults(){return on(It.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:on(Dt(ri.getDefaults(),Object.keys(It.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:on(Dt(ri.getDefaults(),Object.keys(It.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(e,s){this.voice0._triggerEnvelopeAttack(e,s),this.voice1._triggerEnvelopeAttack(e,s)}_triggerEnvelopeRelease(e){return this.voice0._triggerEnvelopeRelease(e),this.voice1._triggerEnvelopeRelease(e),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class Tr extends es{constructor(){super(W(Tr.getDefaults(),arguments)),this.name="FMSynth";let e=W(Tr.getDefaults(),arguments);this.modulationIndex=new it({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(es.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}let fl=[1,1.483,1.932,2.546,2.63,3.897];class Sr extends It{constructor(){super(W(Sr.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];let e=W(Sr.getDefaults(),arguments);this.detune=new Se({context:this.context,units:"cents",value:e.detune}),this.frequency=new Se({context:this.context,units:"frequency"}),this._amplitude=new me({context:this.context,gain:0}).connect(this.output),this._highpass=new Ht({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let s=0;s<fl.length;s++){let a=new wi({context:this.context,harmonicity:e.harmonicity,modulationIndex:e.modulationIndex,modulationType:"square",onstop:s===0?()=>this.onsilence(this):je,type:"square"});a.connect(this._highpass),this._oscillators[s]=a;let d=new it({context:this.context,value:fl[s]});this._freqMultipliers[s]=d,this.frequency.chain(d,a.frequency),this.detune.connect(a.detune)}this._filterFreqScaler=new An({context:this.context,max:7e3,min:this.toFrequency(e.resonance)}),this.envelope=new Ct({attack:e.envelope.attack,attackCurve:"linear",context:this.context,decay:e.envelope.decay,release:e.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=e.octaves,this.octaves=e.octaves}static getDefaults(){return on(It.getDefaults(),{envelope:Object.assign(Dt(Ct.getDefaults(),Object.keys(oe.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(e,s=1){return this.envelope.triggerAttack(e,s),this._oscillators.forEach(a=>a.start(e)),this.envelope.sustain===0&&this._oscillators.forEach(a=>{a.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))}),this}_triggerEnvelopeRelease(e){return this.envelope.triggerRelease(e),this._oscillators.forEach(s=>s.stop(e+this.toSeconds(this.envelope.release))),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(e){this._oscillators.forEach(s=>s.modulationIndex.value=e)}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(e){this._oscillators.forEach(s=>s.harmonicity.value=e)}get resonance(){return this._filterFreqScaler.min}set resonance(e){this._filterFreqScaler.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}dispose(){return super.dispose(),this._oscillators.forEach(e=>e.dispose()),this._freqMultipliers.forEach(e=>e.dispose()),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class is extends Gn{constructor(){super(W(is.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;let e=W(is.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,xe(this,["oscillator","envelope"])}static getDefaults(){return on(It.getDefaults(),Gn.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,s){let a=this.toSeconds(s),d=this.toFrequency(e instanceof Vt?e.toFrequency():e),b=d*this.octaves;return this.oscillator.frequency.setValueAtTime(b,a),this.oscillator.frequency.exponentialRampToValueAtTime(d,a+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}_n([hl(0)],is.prototype,"octaves",void 0),_n([Hn(0)],is.prototype,"pitchDecay",void 0);class Cr extends en{constructor(){super(W(Cr.getDefaults(),arguments)),this.name="NoiseSynth";let e=W(Cr.getDefaults(),arguments);this.noise=new zn(Object.assign({context:this.context},e.noise)),this.envelope=new Ki(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(en.getDefaults(),{envelope:Object.assign(Dt(Ct.getDefaults(),Object.keys(oe.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(Dt(zn.getDefaults(),Object.keys(ht.getDefaults())),{type:"white"})})}triggerAttack(e,s=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,s),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,s,a=1){return s=this.toSeconds(s),e=this.toSeconds(e),this.triggerAttack(s,a),this.triggerRelease(s+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}let la=new Set;function ua(l){la.add(l)}function ml(l,e){let s=`registerProcessor("${l}", ${e})`;la.add(s)}class ha extends oe{constructor(e){super(e),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=je;let s=URL.createObjectURL(new Blob([Array.from(la).join(`
`)],{type:"text/javascript"})),a=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(s,a).then(()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(a,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))})}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}ua(`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`),ua(`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`),ua(`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`),ml("feedback-comb-filter",`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`);class ss extends ha{constructor(){super(W(ss.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";let e=W(ss.getDefaults(),arguments,["delayTime","resonance"]);this.input=new me({context:this.context}),this.output=new me({context:this.context}),this.delayTime=new Me({context:this.context,value:e.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new Me({context:this.context,value:e.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),xe(this,["resonance","delayTime"])}_audioWorkletName(){return"feedback-comb-filter"}static getDefaults(){return Object.assign(oe.getDefaults(),{delayTime:.1,resonance:.5})}onReady(e){$t(this.input,e,this.output);let s=e.parameters.get("delayTime");this.delayTime.setParam(s);let a=e.parameters.get("feedback");this.resonance.setParam(a)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class rs extends oe{constructor(){super(W(rs.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";let e=W(rs.getDefaults(),arguments,["frequency","type"]);this._frequency=e.frequency,this._type=e.type,this.input=new me({context:this.context}),this.output=new me({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(oe.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){let e=this._filter,s=this.toFrequency(this._frequency),a=1/(2*Math.PI*s);if(this._type==="lowpass"){let d=1/(a*this.context.sampleRate),b=d-1;this._filter=this.context.createIIRFilter([d,0],[1,b])}else{let d=1/(a*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,d])}this.input.chain(this._filter,this.output),e&&this.context.setTimeout(()=>{this.disposed||(this.input.disconnect(e),e.disconnect())},this.blockTime)}get frequency(){return this._frequency}set frequency(e){this._frequency=e,this._createFilter()}get type(){return this._type}set type(e){this._type=e,this._createFilter()}getFrequencyResponse(e=128){let s=new Float32Array(e);for(let b=0;b<e;b++){let k=19980*Math.pow(b/e,2)+20;s[b]=k}let a=new Float32Array(e),d=new Float32Array(e);return this._filter.getFrequencyResponse(s,a,d),a}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class os extends oe{constructor(){super(W(os.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";let e=W(os.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new ss({context:this.context,delayTime:e.delayTime,resonance:e.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new rs({context:this.context,frequency:e.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(oe.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(e){this._lowpass.frequency=e}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class kr extends en{constructor(){super(W(kr.getDefaults(),arguments)),this.name="PluckSynth";let e=W(kr.getDefaults(),arguments);this._noise=new zn({context:this.context,type:"pink"}),this.attackNoise=e.attackNoise,this._lfcf=new os({context:this.context,dampening:e.dampening,resonance:e.resonance}),this.resonance=e.resonance,this.release=e.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return on(en.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(e){this._lfcf.dampening=e}triggerAttack(e,s){let a=this.toFrequency(e);s=this.toSeconds(s);let d=1/a;return this._lfcf.delayTime.setValueAtTime(d,s),this._noise.start(s),this._noise.stop(s+d*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(s),this._lfcf.resonance.setValueAtTime(this.resonance,s),this}triggerRelease(e){return this._lfcf.resonance.linearRampTo(0,this.release,e),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class Mr extends en{constructor(){super(W(Mr.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;let e=W(Mr.getDefaults(),arguments,["voice","options"]);_e(!Zt(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");let s=e.voice.getDefaults();this.options=Object.assign(s,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();let a=this._voices.indexOf(this._dummyVoice);this._voices.splice(a,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(en.getDefaults(),{maxPolyphony:32,options:{},voice:Gn})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);let s=this._activeVoices.findIndex(a=>a.voice===e);this._activeVoices.splice(s,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){let e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return e.connect(this.output),this._voices.push(e),e}Ms("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){let e=this._availableVoices.shift(),s=this._voices.indexOf(e);this._voices.splice(s,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,s,a){e.forEach(d=>{let b=new Gi(this.context,d).toMidi(),k=this._getNextAvailableVoice();k&&(k.triggerAttack(d,s,a),this._activeVoices.push({midi:b,voice:k,released:!1}),this.log("triggerAttack",d,s))})}_triggerRelease(e,s){e.forEach(a=>{let d=new Gi(this.context,a).toMidi(),b=this._activeVoices.find(({midi:k,released:A})=>k===d&&!A);b&&(b.voice.triggerRelease(s),b.released=!0,this.log("triggerRelease",a,s))})}_scheduleEvent(e,s,a,d){_e(!this.disposed,"Synth was already disposed"),a<=this.now()?e==="attack"?this._triggerAttack(s,a,d):this._triggerRelease(s,a):this.context.setTimeout(()=>{this._scheduleEvent(e,s,a,d)},a-this.now())}triggerAttack(e,s,a){Array.isArray(e)||(e=[e]);let d=this.toSeconds(s);return this._scheduleEvent("attack",e,d,a),this}triggerRelease(e,s){Array.isArray(e)||(e=[e]);let a=this.toSeconds(s);return this._scheduleEvent("release",e,a),this}triggerAttackRelease(e,s,a,d){let b=this.toSeconds(a);if(this.triggerAttack(e,b,d),Pt(s)){_e(Pt(e),"If the duration is an array, the notes must also be an array"),e=e;for(let k=0;k<e.length;k++){let A=s[Math.min(k,s.length-1)],O=this.toSeconds(A);_e(O>0,"The duration must be greater than 0"),this.triggerRelease(e[k],b+O)}}else{let k=this.toSeconds(s);_e(k>0,"The duration must be greater than 0"),this.triggerRelease(e,b+k)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(e){let s=Dt(e,["onsilence","context"]);return this.options=on(this.options,s),this._voices.forEach(a=>a.set(s)),this._dummyVoice.set(s),this}get(){return this._dummyVoice.get()}releaseAll(e){let s=this.toSeconds(e);return this._activeVoices.forEach(({voice:a})=>{a.triggerRelease(s)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class as extends en{constructor(){super(W(as.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;let e=W(as.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),s={};Object.keys(e.urls).forEach(a=>{let d=parseInt(a,10);if(_e(As(a)||Zt(d)&&isFinite(d),"url key is neither a note or midi pitch: "+a),As(a)){let b=new Vt(this.context,a).toMidi();s[b]=e.urls[a]}else Zt(d)&&isFinite(d)&&(s[d]=e.urls[d])}),this._buffers=new Hi({urls:s,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(en.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:je,onerror:je,release:.1,urls:{}})}_findClosest(e){let s=0;for(;s<96;){if(this._buffers.has(e+s))return-s;if(this._buffers.has(e-s))return s;s++}throw new Error("No available buffers for note: "+e)}triggerAttack(e,s,a=1){return this.log("triggerAttack",e,s,a),Array.isArray(e)||(e=[e]),e.forEach(d=>{let b=al(new Vt(this.context,d).toFrequency()),k=Math.round(b),A=b-k,O=this._findClosest(k),E=k-O,j=this._buffers.get(E),P=Bi(O+A),F=new Bn({url:j,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:P}).connect(this.output);F.start(s,0,j.duration/P,a),Pt(this._activeSources.get(k))||this._activeSources.set(k,[]),this._activeSources.get(k).push(F),F.onended=()=>{if(this._activeSources&&this._activeSources.has(k)){let D=this._activeSources.get(k),G=D.indexOf(F);G!==-1&&D.splice(G,1)}}}),this}triggerRelease(e,s){return this.log("triggerRelease",e,s),Array.isArray(e)||(e=[e]),e.forEach(a=>{let d=new Vt(this.context,a).toMidi();if(this._activeSources.has(d)&&this._activeSources.get(d).length){let b=this._activeSources.get(d);s=this.toSeconds(s),b.forEach(k=>{k.stop(s)}),this._activeSources.set(d,[])}}),this}releaseAll(e){let s=this.toSeconds(e);return this._activeSources.forEach(a=>{for(;a.length;)a.shift().stop(s)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,s,a,d=1){let b=this.toSeconds(a);return this.triggerAttack(e,b,d),Pt(s)?(_e(Pt(e),"notes must be an array when duration is array"),e.forEach((k,A)=>{let O=s[Math.min(A,s.length-1)];this.triggerRelease(k,b+this.toSeconds(O))})):this.triggerRelease(e,b+this.toSeconds(s)),this}add(e,s,a){if(_e(As(e)||isFinite(e),"note must be a pitch or midi: "+e),As(e)){let d=new Vt(this.context,e).toMidi();this._buffers.add(d,s,a)}else this._buffers.add(e,s,a);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(s=>s.dispose())}),this._activeSources.clear(),this}}_n([Hn(0)],as.prototype,"attack",void 0),_n([Hn(0)],as.prototype,"release",void 0);class yn extends St{constructor(){super(W(yn.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new zi("stopped"),this._startOffset=0;let e=W(yn.getDefaults(),arguments,["callback","value"]);this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this._playbackRate=e.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(St.getDefaults(),{callback:je,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(e=-1){this._state.forEachFrom(e,s=>{let a;if(s.state==="started"){s.id!==-1&&this.context.transport.clear(s.id);let d=s.time+Math.round(this.startOffset/this._playbackRate);if(this._loop===!0||Zt(this._loop)&&this._loop>1){a=1/0,Zt(this._loop)&&(a=this._loop*this._getLoopDuration());let b=this._state.getAfter(d);b!==null&&(a=Math.min(a,b.time-d)),a!==1/0&&(this._state.setStateAtTime("stopped",d+a+1,{id:-1}),a=new $e(this.context,a));let k=new $e(this.context,this._getLoopDuration());s.id=this.context.transport.scheduleRepeat(this._tick.bind(this),k,new $e(this.context,d),a)}else s.id=this.context.transport.schedule(this._tick.bind(this),new $e(this.context,d))}})}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e}get probability(){return this._probability}set probability(e){this._probability=e}get humanize(){return this._humanize}set humanize(e){this._humanize=e}start(e){let s=this.toTicks(e);return this._state.getValueAtTime(s)==="stopped"&&(this._state.add({id:-1,state:"started",time:s}),this._rescheduleEvents(s)),this}stop(e){this.cancel(e);let s=this.toTicks(e);if(this._state.getValueAtTime(s)==="started"){this._state.setStateAtTime("stopped",s,{id:-1});let a=this._state.getBefore(s),d=s;a!==null&&(d=a.time),this._rescheduleEvents(d)}return this}cancel(e){e=an(e,-1/0);let s=this.toTicks(e);return this._state.forEachFrom(s,a=>{this.context.transport.clear(a.id)}),this._state.cancel(s),this}_tick(e){let s=this.context.transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(s)==="started"){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let a=.02;ea(this.humanize)||(a=this.toSeconds(this.humanize)),e+=(2*Math.random()-1)*a}this.callback(e,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(e){this._loop=e,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._rescheduleEvents()}get loopEnd(){return new $e(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}get loopStart(){return new $e(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){let e=this.context.transport.ticks,s=this._state.get(e);if(s!==null&&s.state==="started"){let a=this._getLoopDuration();return(e-s.time)%a/a}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class cs extends St{constructor(){super(W(cs.getDefaults(),arguments,["callback","interval"])),this.name="Loop";let e=W(cs.getDefaults(),arguments,["callback","interval"]);this._event=new yn({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:e.interval,playbackRate:e.playbackRate,probability:e.probability}),this.callback=e.callback,this.iterations=e.iterations}static getDefaults(){return Object.assign(St.getDefaults(),{interval:"4n",callback:je,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(e){return this._event.start(e),this}stop(e){return this._event.stop(e),this}cancel(e){return this._event.cancel(e),this}_tick(e){this.callback(e)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(e){this._event.loopEnd=e}get playbackRate(){return this._event.playbackRate}set playbackRate(e){this._event.playbackRate=e}get humanize(){return this._event.humanize}set humanize(e){this._event.humanize=e}get probability(){return this._event.probability}set probability(e){this._event.probability=e}get mute(){return this._event.mute}set mute(e){this._event.mute=e}get iterations(){return this._event.loop===!0?1/0:this._event.loop}set iterations(e){this._event.loop=e===1/0||e}dispose(){return super.dispose(),this._event.dispose(),this}}class ls extends yn{constructor(){super(W(ls.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new zi("stopped"),this._events=new Set;let e=W(ls.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,e.events.forEach(s=>{Pt(s)?this.add(s[0],s[1]):this.add(s)})}static getDefaults(){return Object.assign(yn.getDefaults(),{events:[]})}start(e,s){let a=this.toTicks(e);if(this._state.getValueAtTime(a)!=="started"){s=an(s,this._loop?this._loopStart:0),s=this._loop?an(s,this._loopStart):an(s,0);let d=this.toTicks(s);this._state.add({id:-1,offset:d,state:"started",time:a}),this._forEach(b=>{this._startNote(b,a,d)})}return this}_startNote(e,s,a){s-=a,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<a&&(s+=this._getLoopDuration()),e.start(new $e(this.context,s))):e.startOffset<this._loopStart&&e.startOffset>=a&&(e.loop=!1,e.start(new $e(this.context,s))):e.startOffset>=a&&e.start(new $e(this.context,s))}get startOffset(){return this._startOffset}set startOffset(e){this._startOffset=e,this._forEach(s=>{s.startOffset+=this._startOffset})}stop(e){let s=this.toTicks(e);return this._state.cancel(s),this._state.setStateAtTime("stopped",s),this._forEach(a=>{a.stop(e)}),this}at(e,s){let a=new vt(this.context,e).toTicks(),d=new $e(this.context,1).toSeconds(),b=this._events.values(),k=b.next();for(;!k.done;){let A=k.value;if(Math.abs(a-A.startOffset)<d)return Pe(s)&&(A.value=s),A;k=b.next()}return Pe(s)?(this.add(e,s),this.at(e)):null}add(e,s){e instanceof Object&&Reflect.has(e,"time")&&(e=(s=e).time);let a=this.toTicks(e),d;return s instanceof yn?(d=s,d.callback=this._tick.bind(this)):d=new yn({callback:this._tick.bind(this),context:this.context,value:s}),d.startOffset=a,d.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(d),this._restartEvent(d),this}_restartEvent(e){this._state.forEach(s=>{s.state==="started"?this._startNote(e,s.time,s.offset):e.stop(new $e(this.context,s.time))})}remove(e,s){return Vn(e)&&e.hasOwnProperty("time")&&(e=(s=e).time),e=this.toTicks(e),this._events.forEach(a=>{a.startOffset===e&&(Bt(s)||Pe(s)&&a.value===s)&&(this._events.delete(a),a.dispose())}),this}clear(){return this._forEach(e=>e.dispose()),this._events.clear(),this}cancel(e){return this._forEach(s=>s.cancel(e)),this._state.cancel(this.toTicks(e)),this}_forEach(e){return this._events&&this._events.forEach(s=>{s instanceof ls?s._forEach(e):e(s)}),this}_setAll(e,s){this._forEach(a=>{a[e]=s})}_tick(e,s){this.mute||this.callback(e,s)}_testLoopBoundries(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):e.state==="stopped"&&this._restartEvent(e)}get probability(){return this._probability}set probability(e){this._probability=e,this._setAll("probability",e)}get humanize(){return this._humanize}set humanize(e){this._humanize=e,this._setAll("humanize",e)}get loop(){return this._loop}set loop(e){this._loop=e,this._forEach(s=>{s.loopStart=this.loopStart,s.loopEnd=this.loopEnd,s.loop=e,this._testLoopBoundries(s)})}get loopEnd(){return new $e(this.context,this._loopEnd).toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e),this._loop&&this._forEach(s=>{s.loopEnd=e,this._testLoopBoundries(s)})}get loopStart(){return new $e(this.context,this._loopStart).toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e),this._loop&&this._forEach(s=>{s.loopStart=this.loopStart,this._testLoopBoundries(s)})}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._setAll("playbackRate",e)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*Op(l){let e=0;for(;e<l.length;)e=us(e,l),yield l[e],e++}function*Rp(l){let e=l.length-1;for(;e>=0;)e=us(e,l),yield l[e],e--}function*Ls(l,e){for(;;)yield*e(l)}function us(l,e){return il(l,0,e.length-1)}function*_l(l,e){let s=e?0:l.length-1;for(;;)s=us(s,l),yield l[s],e?(s++,s>=l.length-1&&(e=!1)):(s--,s<=0&&(e=!0))}function*Ep(l){let e=0,s=0;for(;e<l.length;)e=us(e,l),yield l[e],s++,e+=s%2?2:-1}function*Pp(l){let e=l.length-1,s=0;for(;e>=0;)e=us(e,l),yield l[e],s++,e+=s%2?-2:1}function*Dp(l){let e=[];for(let s=0;s<l.length;s++)e.push(s);for(;e.length>0;){let s=us(e.splice(Math.floor(e.length*Math.random()),1)[0],l);yield l[s]}}function*gl(l,e="up",s=0){switch(_e(l.length>0,"The array must have more than one value in it"),e){case"up":yield*Ls(l,Op);case"down":yield*Ls(l,Rp);case"upDown":yield*_l(l,!0);case"downUp":yield*_l(l,!1);case"alternateUp":yield*Ls(l,Ep);case"alternateDown":yield*Ls(l,Pp);case"random":yield*function*(a){for(;;){let d=Math.floor(Math.random()*a.length);yield a[d]}}(l);case"randomOnce":yield*Ls(l,Dp);case"randomWalk":yield*function*(a){let d=Math.floor(Math.random()*a.length);for(;;)d===0?d++:d===a.length-1||Math.random()<.5?d--:d++,yield a[d]}(l)}}class Ar extends cs{constructor(){super(W(Ar.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";let e=W(Ar.getDefaults(),arguments,["callback","values","pattern"]);this.callback=e.callback,this._values=e.values,this._pattern=gl(e.values,e.pattern),this._type=e.pattern}static getDefaults(){return Object.assign(cs.getDefaults(),{pattern:"up",values:[],callback:je})}_tick(e){let s=this._pattern.next();this._value=s.value,this.callback(e,this._value)}get values(){return this._values}set values(e){this._values=e,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(e){this._type=e,this._pattern=gl(this._values,this._type)}}class Or extends yn{constructor(){super(W(Or.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new ls({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];let e=W(Or.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(e.subdivision),this.events=e.events,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.playbackRate=e.playbackRate,this.probability=e.probability,this.humanize=e.humanize,this.mute=e.mute,this.playbackRate=e.playbackRate}static getDefaults(){return Object.assign(Dt(yn.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(e,s){s!==null&&this.callback(e,s)}get events(){return this._events}set events(e){this.clear(),this._eventsArray=e,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(e,s){return this._part.start(e,s&&this._indexTime(s)),this}stop(e){return this._part.stop(e),this}get subdivision(){return new $e(this.context,this._subdivision).toSeconds()}_createSequence(e){return new Proxy(e,{get:(s,a)=>s[a],set:(s,a,d)=>(rn(a)&&isFinite(parseInt(a,10))&&Pt(d)?s[a]=this._createSequence(d):s[a]=d,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(e,s,a){e.forEach((d,b)=>{let k=b*s+a;if(Pt(d))this._rescheduleSequence(d,s/d.length,k);else{let A=new $e(this.context,k,"i").toSeconds();this._part.add(A,d)}})}_indexTime(e){return new $e(this.context,e*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(e){this._part.loop=e}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this._part.loopStart=this._indexTime(e)}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this._part.loopEnd=e===0?this._indexTime(this._eventsArray.length):this._indexTime(e)}get startOffset(){return this._part.startOffset}set startOffset(e){this._part.startOffset=e}get playbackRate(){return this._part.playbackRate}set playbackRate(e){this._part.playbackRate=e}get probability(){return this._part.probability}set probability(e){this._part.probability=e}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(e){this._part.humanize=e}get length(){return this._part.length}}class ki extends oe{constructor(){super(Object.assign(W(ki.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new pl({context:this.context}),this.a=new me({context:this.context,gain:0}),this.b=new me({context:this.context,gain:0}),this.output=new me({context:this.context}),this._internalChannels=[this.a,this.b];let e=W(ki.getDefaults(),arguments,["fade"]);this.fade=new Se({context:this.context,units:"normalRange",value:e.fade}),xe(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",zt(this._split,this.a.gain,0),zt(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(oe.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class wt extends oe{constructor(e){super(e),this.name="Effect",this._dryWet=new ki({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new me({context:this.context}),this.effectReturn=new me({context:this.context}),this.input=new me({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],xe(this,"wet")}static getDefaults(){return Object.assign(oe.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Rr extends wt{constructor(e){super(e),this.name="LFOEffect",this._lfo=new Ft({context:this.context,frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=e.type,xe(this,["frequency","depth"])}static getDefaults(){return Object.assign(wt.getDefaults(),{frequency:1,type:"sine",depth:1})}start(e){return this._lfo.start(e),this}stop(e){return this._lfo.stop(e),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Er extends Rr{constructor(){super(W(Er.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";let e=W(Er.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new Ht(Object.assign(e.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency}static getDefaults(){return Object.assign(Rr.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}dispose(){return super.dispose(),this.filter.dispose(),this}}class hs extends oe{constructor(){super(Object.assign(W(hs.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;let e=W(hs.getDefaults(),arguments,["pan"]);this.pan=new Me({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",xe(this,"pan")}static getDefaults(){return Object.assign(oe.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class Pr extends Rr{constructor(){super(W(Pr.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";let e=W(Pr.getDefaults(),arguments,["frequency"]);this._panner=new hs({context:this.context,channelCount:e.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(Rr.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class ds extends oe{constructor(){super(W(ds.getDefaults(),arguments,["smoothing"])),this.name="Follower";let e=W(ds.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new dl({context:this.context}),this._lowpass=this.output=new rs({context:this.context,frequency:1/this.toSeconds(e.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=e.smoothing}static getDefaults(){return Object.assign(oe.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(e){this._smoothing=e,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class Dr extends wt{constructor(){super(W(Dr.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";let e=W(Dr.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new ds({context:this.context,smoothing:e.follower}),this._sweepRange=new js({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this._inputBoost=new me({context:this.context}),this._bandpass=new Ht({context:this.context,rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new Ht({context:this.context,type:"peaking"}),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,xe(this,["gain","Q"])}static getDefaults(){return Object.assign(wt.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(e){this._follower.smoothing=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._setSweepRange()}get sensitivity(){return Rs(1/this._inputBoost.gain.value)}set sensitivity(e){this._inputBoost.gain.value=1/Wi(e)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}ml("bit-crusher",`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`);class Ir extends wt{constructor(){super(W(Ir.getDefaults(),arguments,["bits"])),this.name="BitCrusher";let e=W(Ir.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new jr({context:this.context,bits:e.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(wt.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class jr extends ha{constructor(){super(W(jr.getDefaults(),arguments)),this.name="BitCrusherWorklet";let e=W(jr.getDefaults(),arguments);this.input=new me({context:this.context}),this.output=new me({context:this.context}),this.bits=new Me({context:this.context,value:e.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(ha.getDefaults(),{bits:12})}_audioWorkletName(){return"bit-crusher"}onReady(e){$t(this.input,e,this.output);let s=e.parameters.get("bits");this.bits.setParam(s)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class Lr extends wt{constructor(){super(W(Lr.getDefaults(),arguments,["order"])),this.name="Chebyshev";let e=W(Lr.getDefaults(),arguments,["order"]);this._shaper=new cn({context:this.context,length:4096}),this._order=e.order,this.connectEffect(this._shaper),this.order=e.order,this.oversample=e.oversample}static getDefaults(){return Object.assign(wt.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(e,s,a){return a.has(s)||(s===0?a.set(s,0):s===1?a.set(s,e):a.set(s,2*e*this._getCoefficient(e,s-1,a)-this._getCoefficient(e,s-2,a))),a.get(s)}get order(){return this._order}set order(e){this._order=e,this._shaper.setMap(s=>this._getCoefficient(s,e,new Map))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class oi extends oe{constructor(){super(W(oi.getDefaults(),arguments,["channels"])),this.name="Split";let e=W(oi.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(oe.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Yn extends oe{constructor(){super(W(Yn.getDefaults(),arguments,["channels"])),this.name="Merge";let e=W(Yn.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(oe.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class On extends oe{constructor(e){super(e),this.name="StereoEffect",this.input=new me({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new ki({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new oi({context:this.context,channels:2}),this._merge=new Yn({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),xe(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),$t(...e),zt(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),$t(...e),zt(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(oe.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class da extends On{constructor(e){super(e),this.feedback=new Se({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new me({context:this.context}),this._feedbackR=new me({context:this.context}),this._feedbackSplit=new oi({context:this.context,channels:2}),this._feedbackMerge=new Yn({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),xe(this,["feedback"])}static getDefaults(){return Object.assign(On.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class Fr extends da{constructor(){super(W(Fr.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";let e=W(Fr.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new Ft({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new Ft({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new Ut({context:this.context}),this._delayNodeR=new Ut({context:this.context}),this.frequency=this._lfoL.frequency,xe(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=e.type,this.spread=e.spread}static getDefaults(){return Object.assign(da.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(e){this._depth=e;let s=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-s,0),this._lfoL.max=this._delayTime+s,this._lfoR.min=Math.max(this._delayTime-s,0),this._lfoR.max=this._delayTime+s}get delayTime(){return 1e3*this._delayTime}set delayTime(e){this._delayTime=e/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class qr extends wt{constructor(){super(W(qr.getDefaults(),arguments,["distortion"])),this.name="Distortion";let e=W(qr.getDefaults(),arguments,["distortion"]);this._shaper=new cn({context:this.context,length:4096}),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample}static getDefaults(){return Object.assign(wt.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(e){this._distortion=e;let s=100*e,a=Math.PI/180;this._shaper.setMap(d=>Math.abs(d)<.001?0:(3+s)*d*20*a/(Math.PI+s*Math.abs(d)))}get oversample(){return this._shaper.oversample}set oversample(e){this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.dispose(),this}}class Vr extends wt{constructor(e){super(e),this.name="FeedbackEffect",this._feedbackGain=new me({context:this.context,gain:e.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,xe(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(wt.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Nr extends Vr{constructor(){super(W(Nr.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";let e=W(Nr.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new Ut({context:this.context,delayTime:e.delayTime,maxDelay:e.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),xe(this,"delayTime")}static getDefaults(){return Object.assign(Vr.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class Ip extends oe{constructor(e){super(e),this.name="PhaseShiftAllpass",this.input=new me({context:this.context}),this.output=new me({context:this.context}),this.offset90=new me({context:this.context}),this._bank0=this._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),this._bank1=this._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),$t(this.input,...this._bank0,this._oneSampleDelay,this.output),$t(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(e){return e.map(s=>{let a=[[s*s,0,-1],[1,0,-s*s]];return this.context.createIIRFilter(a[0],a[1])})}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach(e=>e.disconnect()),this._bank1.forEach(e=>e.disconnect()),this._oneSampleDelay.disconnect(),this}}class Wr extends wt{constructor(){super(W(Wr.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";let e=W(Wr.getDefaults(),arguments,["frequency"]);this.frequency=new Se({context:this.context,units:"frequency",value:e.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new Xi({context:this.context,type:"sine"}),this._cosine=new nt({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new it({context:this.context}),this._cosineMultiply=new it({context:this.context}),this._negate=new aa({context:this.context}),this._add=new Ti({context:this.context}),this._phaseShifter=new Ip({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);let s=this.immediate();this._sine.start(s),this._cosine.start(s)}static getDefaults(){return Object.assign(wt.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}let vl=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],yl=[225,556,441,341];class Br extends On{constructor(){super(W(Br.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];let e=W(Br.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new Se({context:this.context,value:e.roomSize,units:"normalRange"}),this._allpassFiltersL=yl.map(s=>{let a=this.context.createBiquadFilter();return a.type="allpass",a.frequency.value=s,a}),this._allpassFiltersR=yl.map(s=>{let a=this.context.createBiquadFilter();return a.type="allpass",a.frequency.value=s,a}),this._combFilters=vl.map((s,a)=>{let d=new os({context:this.context,dampening:e.dampening,delayTime:s});return a<vl.length/2?this.connectEffectLeft(d,...this._allpassFiltersL):this.connectEffectRight(d,...this._allpassFiltersR),this.roomSize.connect(d.resonance),d}),xe(this,["roomSize"])}static getDefaults(){return Object.assign(On.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(e){this._combFilters.forEach(s=>s.dampening=e)}dispose(){return super.dispose(),this._allpassFiltersL.forEach(e=>e.disconnect()),this._allpassFiltersR.forEach(e=>e.disconnect()),this._combFilters.forEach(e=>e.dispose()),this.roomSize.dispose(),this}}let bl=[.06748,.06404,.08212,.09004],jp=[.773,.802,.753,.733],Lp=[347,113,37];class zr extends On{constructor(){super(W(zr.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];let e=W(zr.getDefaults(),arguments,["roomSize"]);this.roomSize=new Se({context:this.context,value:e.roomSize,units:"normalRange"}),this._scaleRoomSize=new An({context:this.context,min:-.733,max:.197}),this._allpassFilters=Lp.map(s=>{let a=this.context.createBiquadFilter();return a.type="allpass",a.frequency.value=s,a}),this._feedbackCombFilters=bl.map((s,a)=>{let d=new ss({context:this.context,delayTime:s});return this._scaleRoomSize.connect(d.resonance),d.resonance.value=jp[a],a<bl.length/2?this.connectEffectLeft(...this._allpassFilters,d):this.connectEffectRight(...this._allpassFilters,d),d}),this.roomSize.connect(this._scaleRoomSize),xe(this,["roomSize"])}static getDefaults(){return Object.assign(On.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach(e=>e.disconnect()),this._feedbackCombFilters.forEach(e=>e.dispose()),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class wl extends da{constructor(e){super(e),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),xe(this,["feedback"])}}class Ur extends wl{constructor(){super(W(Ur.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";let e=W(Ur.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new Ut({context:this.context,maxDelay:e.maxDelay}),this._rightDelay=new Ut({context:this.context,maxDelay:e.maxDelay}),this._rightPreDelay=new Ut({context:this.context,maxDelay:e.maxDelay}),this.delayTime=new Se({context:this.context,units:"time",value:e.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),xe(this,["delayTime"])}static getDefaults(){return Object.assign(wl.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class Hr extends Vr{constructor(){super(W(Hr.getDefaults(),arguments,["pitch"])),this.name="PitchShift";let e=W(Hr.getDefaults(),arguments,["pitch"]);this._frequency=new Se({context:this.context}),this._delayA=new Ut({maxDelay:1,context:this.context}),this._lfoA=new Ft({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Ut({maxDelay:1,context:this.context}),this._lfoB=new Ft({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new ki({context:this.context}),this._crossFadeLFO=new Ft({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Ut({delayTime:e.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,xe(this,"delayTime"),this._pitch=e.pitch,this._windowSize=e.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);let s=this.now();this._lfoA.start(s),this._lfoB.start(s),this._crossFadeLFO.start(s),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Vr.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(e){this._pitch=e;let s=0;e<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,s=Bi(e-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,s=Bi(e)-1),this._frequency.value=s*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(e){this._windowSize=this.toSeconds(e),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class Gr extends On{constructor(){super(W(Gr.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";let e=W(Gr.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new Ft({context:this.context,frequency:e.frequency,min:0,max:1}),this._lfoR=new Ft({context:this.context,frequency:e.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(e.baseFrequency),this._octaves=e.octaves,this.Q=new Se({context:this.context,value:e.Q,units:"positive"}),this._filtersL=this._makeFilters(e.stages,this._lfoL),this._filtersR=this._makeFilters(e.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),xe(this,["frequency","Q"])}static getDefaults(){return Object.assign(On.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(e,s){let a=[];for(let d=0;d<e;d++){let b=this.context.createBiquadFilter();b.type="allpass",this.Q.connect(b.Q),s.connect(b.frequency),a.push(b)}return a}get octaves(){return this._octaves}set octaves(e){this._octaves=e;let s=this._baseFrequency*Math.pow(2,e);this._lfoL.max=s,this._lfoR.max=s}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){this._baseFrequency=this.toFrequency(e),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach(e=>e.disconnect()),this._filtersR.forEach(e=>e.disconnect()),this.frequency.dispose(),this}}class Yr extends wt{constructor(){super(W(Yr.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();let e=W(Yr.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(wt.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){Et(e=this.toSeconds(e),.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){Et(e=this.toSeconds(e),0),this._preDelay=e,this.generate()}generate(){return Je(this,void 0,void 0,function*(){let e=this.ready,s=new Ni(2,this._decay+this._preDelay,this.context.sampleRate),a=new zn({context:s}),d=new zn({context:s}),b=new Yn({context:s});a.connect(b,0,0),d.connect(b,0,1);let k=new me({context:s}).toDestination();b.connect(k),a.start(0),d.start(0),k.gain.setValueAtTime(0,0),k.gain.setValueAtTime(1,this._preDelay),k.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);let A=s.render();return this.ready=A.then(je),yield e,this._convolver.buffer=(yield A).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Fs extends oe{constructor(){super(W(Fs.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new oi({channels:2,context:this.context}),this._midAdd=new Ti({context:this.context}),this.mid=new it({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new Ci({context:this.context}),this.side=new it({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class qs extends oe{constructor(){super(W(qs.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new me({context:this.context}),this.side=new me({context:this.context}),this._left=new Ti({context:this.context}),this._leftMult=new it({context:this.context,value:Math.SQRT1_2}),this._right=new Ci({context:this.context}),this._rightMult=new it({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new Yn({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class xl extends wt{constructor(e){super(e),this.name="MidSideEffect",this._midSideMerge=new qs({context:this.context}),this._midSideSplit=new Fs({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...e){this._midSend.chain(...e,this._midReturn)}connectEffectSide(...e){this._sideSend.chain(...e,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class Xr extends xl{constructor(){super(W(Xr.getDefaults(),arguments,["width"])),this.name="StereoWidener";let e=W(Xr.getDefaults(),arguments,["width"]);this.width=new Se({context:this.context,value:e.width,units:"normalRange"}),xe(this,["width"]),this._twoTimesWidthMid=new it({context:this.context,value:2}),this._twoTimesWidthSide=new it({context:this.context,value:2}),this._midMult=new it({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new Ci({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),zt(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new it({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(xl.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class Qr extends On{constructor(){super(W(Qr.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";let e=W(Qr.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new Ft({context:this.context,type:e.type,min:1,max:0}),this._lfoR=new Ft({context:this.context,type:e.type,min:1,max:0}),this._amplitudeL=new me({context:this.context}),this._amplitudeR=new me({context:this.context}),this.frequency=new Se({context:this.context,value:e.frequency,units:"frequency"}),this.depth=new Se({context:this.context,value:e.depth,units:"normalRange"}),xe(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=e.spread}static getDefaults(){return Object.assign(On.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(e){return this._lfoL.start(e),this._lfoR.start(e),this}stop(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(e){this._lfoL.type=e,this._lfoR.type=e}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class Zr extends wt{constructor(){super(W(Zr.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";let e=W(Zr.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new Ut({context:this.context,delayTime:0,maxDelay:e.maxDelay}),this._lfo=new Ft({context:this.context,type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,xe(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(wt.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class ps extends oe{constructor(){super(W(ps.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];let e=W(ps.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new me({context:this.context}),this._split=new oi({context:this.context,channels:e.channels}),this.input.connect(this._split),Et(e.channels,1);for(let s=0;s<e.channels;s++)this._analysers[s]=this.context.createAnalyser(),this._split.connect(this._analysers[s],s,0);this.size=e.size,this.type=e.type}static getDefaults(){return Object.assign(oe.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach((e,s)=>{let a=this._buffers[s];this._type==="fft"?e.getFloatFrequencyData(a):this._type==="waveform"&&e.getFloatTimeDomainData(a)}),this.channels===1?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(e){this._analysers.forEach((s,a)=>{s.fftSize=2*e,this._buffers[a]=new Float32Array(e)})}get channels(){return this._analysers.length}get type(){return this._type}set type(e){_e(e==="waveform"||e==="fft","Analyser: invalid type: "+e),this._type=e}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(e){this._analysers.forEach(s=>s.smoothingTimeConstant=e)}dispose(){return super.dispose(),this._analysers.forEach(e=>e.disconnect()),this._split.dispose(),this._gain.dispose(),this}}class ai extends oe{constructor(){super(W(ai.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new ps({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class Jr extends ai{constructor(){super(W(Jr.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;let e=W(Jr.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new ps({context:this.context,size:256,type:"waveform",channels:e.channels}),this.smoothing=e.smoothing,this.normalRange=e.normalRange}static getDefaults(){return Object.assign(ai.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return Ms("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){let e=this._analyser.getValue(),s=(this.channels===1?[e]:e).map(a=>{let d=a.reduce((k,A)=>k+A*A,0),b=Math.sqrt(d/a.length);return this._rms=Math.max(b,this._rms*this.smoothing),this.normalRange?this._rms:Rs(this._rms)});return this.channels===1?s[0]:s}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class $r extends ai{constructor(){super(W($r.getDefaults(),arguments,["size"])),this.name="FFT";let e=W($r.getDefaults(),arguments,["size"]);this.normalRange=e.normalRange,this._analyser.type="fft",this.size=e.size}static getDefaults(){return Object.assign(oe.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){return this._analyser.getValue().map(e=>this.normalRange?Wi(e):e)}get size(){return this._analyser.size}set size(e){this._analyser.size=e}get smoothing(){return this._analyser.smoothing}set smoothing(e){this._analyser.smoothing=e}getFrequencyOfIndex(e){return _e(0<=e&&e<this.size,"index must be greater than or equal to 0 and less than "+this.size),e*this.context.sampleRate/(2*this.size)}}class pa extends ai{constructor(){super(W(pa.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){return this._analyser.getValue()[0]}}class Kr extends ai{constructor(){super(W(Kr.getDefaults(),arguments,["size"])),this.name="Waveform";let e=W(Kr.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=e.size}static getDefaults(){return Object.assign(ai.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(e){this._analyser.size=e}}class dt extends oe{constructor(){super(W(dt.getDefaults(),arguments,["solo"])),this.name="Solo";let e=W(dt.getDefaults(),arguments,["solo"]);this.input=this.output=new me({context:this.context}),dt._allSolos.has(this.context)||dt._allSolos.set(this.context,new Set),dt._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(oe.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),dt._allSolos.get(this.context).forEach(s=>s._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){dt._soloed.has(this.context)||dt._soloed.set(this.context,new Set),dt._soloed.get(this.context).add(this)}_removeSolo(){dt._soloed.has(this.context)&&dt._soloed.get(this.context).delete(this)}_isSoloed(){return dt._soloed.has(this.context)&&dt._soloed.get(this.context).has(this)}_noSolos(){return!dt._soloed.has(this.context)||dt._soloed.has(this.context)&&dt._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),dt._allSolos.get(this.context).delete(this),this._removeSolo(),this}}dt._allSolos=new Map,dt._soloed=new Map;class Vs extends oe{constructor(){super(W(Vs.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";let e=W(Vs.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new hs({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new kn({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,xe(this,["pan","volume"])}static getDefaults(){return Object.assign(oe.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class ci extends oe{constructor(){super(W(ci.getDefaults(),arguments,["volume","pan"])),this.name="Channel";let e=W(ci.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new dt({solo:e.solo,context:this.context}),this._panVol=this.output=new Vs({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),xe(this,["pan","volume"])}static getDefaults(){return Object.assign(oe.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return ci.buses.has(e)||ci.buses.set(e,new me({context:this.context})),ci.buses.get(e)}send(e,s=0){let a=this._getBus(e),d=new me({context:this.context,units:"decibels",gain:s});return this.connect(d),d.connect(a),d}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}ci.buses=new Map;class fa extends oe{constructor(){super(W(fa.getDefaults(),arguments)),this.name="Mono",this.input=new me({context:this.context}),this._merge=this.output=new Yn({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class fs extends oe{constructor(){super(W(fs.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new me({context:this.context}),this.output=void 0,this.low=new Ht({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Ht({context:this.context,frequency:0,type:"highpass"}),this.mid=new Ht({context:this.context,frequency:0,type:"lowpass"}),this.high=new Ht({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];let e=W(fs.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new Se({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new Se({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new Se({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),xe(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(oe.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Os(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class Fp extends oe{constructor(){super(...arguments),this.name="Listener",this.positionX=new Me({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Me({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Me({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Me({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Me({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Me({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Me({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Me({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Me({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(oe.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}ar(l=>{l.listener=new Fp({context:l})}),cr(l=>{l.listener.dispose()});class eo extends oe{constructor(){super(W(eo.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";let e=W(eo.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=e.panningModel,this.maxDistance=e.maxDistance,this.distanceModel=e.distanceModel,this.coneOuterGain=e.coneOuterGain,this.coneOuterAngle=e.coneOuterAngle,this.coneInnerAngle=e.coneInnerAngle,this.refDistance=e.refDistance,this.rolloffFactor=e.rolloffFactor,this.positionX=new Me({context:this.context,param:this._panner.positionX,value:e.positionX}),this.positionY=new Me({context:this.context,param:this._panner.positionY,value:e.positionY}),this.positionZ=new Me({context:this.context,param:this._panner.positionZ,value:e.positionZ}),this.orientationX=new Me({context:this.context,param:this._panner.orientationX,value:e.orientationX}),this.orientationY=new Me({context:this.context,param:this._panner.orientationY,value:e.orientationY}),this.orientationZ=new Me({context:this.context,param:this._panner.orientationZ,value:e.orientationZ})}static getDefaults(){return Object.assign(oe.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(e,s,a){return this.positionX.value=e,this.positionY.value=s,this.positionZ.value=a,this}setOrientation(e,s,a){return this.orientationX.value=e,this.orientationY.value=s,this.orientationZ.value=a,this}get panningModel(){return this._panner.panningModel}set panningModel(e){this._panner.panningModel=e}get refDistance(){return this._panner.refDistance}set refDistance(e){this._panner.refDistance=e}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(e){this._panner.rolloffFactor=e}get distanceModel(){return this._panner.distanceModel}set distanceModel(e){this._panner.distanceModel=e}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(e){this._panner.coneInnerAngle=e}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(e){this._panner.coneOuterAngle=e}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(e){this._panner.coneOuterGain=e}get maxDistance(){return this._panner.maxDistance}set maxDistance(e){this._panner.maxDistance=e}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class Ns extends oe{constructor(){super(W(Ns.getDefaults(),arguments)),this.name="Recorder";let e=W(Ns.getDefaults(),arguments);this.input=new me({context:this.context}),_e(Ns.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:e.mimeType})}static getDefaults(){return oe.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return Nn!==null&&Reflect.has(Nn,"MediaRecorder")}get state(){return this._recorder.state==="inactive"?"stopped":this._recorder.state==="paused"?"paused":"started"}start(){return Je(this,void 0,void 0,function*(){_e(this.state!=="started","Recorder is already started");let e=new Promise(s=>{let a=()=>{this._recorder.removeEventListener("start",a,!1),s()};this._recorder.addEventListener("start",a,!1)});return this._recorder.start(),yield e})}stop(){return Je(this,void 0,void 0,function*(){_e(this.state!=="stopped","Recorder is not started");let e=new Promise(s=>{let a=d=>{this._recorder.removeEventListener("dataavailable",a,!1),s(d.data)};this._recorder.addEventListener("dataavailable",a,!1)});return this._recorder.stop(),yield e})}pause(){return _e(this.state==="started","Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class Rn extends oe{constructor(){super(W(Rn.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;let e=W(Rn.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new Me({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new Me({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new Me({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new Me({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new Me({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),xe(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(oe.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class to extends oe{constructor(){super(Object.assign(W(to.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";let e=W(to.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new ds({context:this.context,smoothing:e.smoothing}),this._gt=new Is({context:this.context,value:Wi(e.threshold)}),this.input=new me({context:this.context}),this._gate=this.output=new me({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(oe.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return Rs(this._gt.value)}set threshold(e){this._gt.value=Wi(e)}get smoothing(){return this._follower.smoothing}set smoothing(e){this._follower.smoothing=e}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class no extends oe{constructor(){super(Object.assign(W(no.getDefaults(),arguments,["threshold"]))),this.name="Limiter";let e=W(no.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new Rn({context:this.context,ratio:20,attack:.003,release:.01,threshold:e.threshold}),this.threshold=this._compressor.threshold,xe(this,"threshold")}static getDefaults(){return Object.assign(oe.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class io extends oe{constructor(){super(Object.assign(W(io.getDefaults(),arguments))),this.name="MidSideCompressor";let e=W(io.getDefaults(),arguments);this._midSideSplit=this.input=new Fs({context:this.context}),this._midSideMerge=this.output=new qs({context:this.context}),this.mid=new Rn(Object.assign(e.mid,{context:this.context})),this.side=new Rn(Object.assign(e.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),xe(this,["mid","side"])}static getDefaults(){return Object.assign(oe.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class so extends oe{constructor(){super(Object.assign(W(so.getDefaults(),arguments))),this.name="MultibandCompressor";let e=W(so.getDefaults(),arguments);this._splitter=this.input=new fs({context:this.context,lowFrequency:e.lowFrequency,highFrequency:e.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new me({context:this.context}),this.low=new Rn(Object.assign(e.low,{context:this.context})),this.mid=new Rn(Object.assign(e.mid,{context:this.context})),this.high=new Rn(Object.assign(e.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),xe(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(oe.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class ro extends oe{constructor(){super(W(ro.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new me({context:this.context}),this._internalChannels=[];let e=W(ro.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new fs({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new me({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new me({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new me({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),xe(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(oe.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Os(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class oo extends oe{constructor(){super(W(oo.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();let e=W(oo.getDefaults(),arguments,["url","onload"]);this._buffer=new Ne(e.url,s=>{this.buffer=s,e.onload()}),this.input=new me({context:this.context}),this.output=new me({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=e.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(oe.getDefaults(),{normalize:!0,onload:je})}load(e){return Je(this,void 0,void 0,function*(){this.buffer=yield this._buffer.load(e)})}get buffer(){return this._buffer.length?this._buffer:null}set buffer(e){e&&this._buffer.set(e),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));let s=this._buffer.get();this._convolver.buffer=s||null}get normalize(){return this._convolver.normalize}set normalize(e){this._convolver.normalize=e}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function qp(){return tt().now()}function Vp(){return tt().immediate()}let Np=tt().transport;function Wp(){return tt().transport}let Bp=tt().destination,zp=tt().destination;function Up(){return tt().destination}let Hp=tt().listener;function Gp(){return tt().listener}let Yp=tt().draw;function Xp(){return tt().draw}let Qp=tt();function Zp(){return Ne.loaded()}let Jp=Ne,$p=Hi,Kp=Bn}])})});var Il=Ye((Dl,ga)=>{parcelRequire=function(t,n,i,r){var c,u=typeof parcelRequire=="function"&&parcelRequire,p=typeof ma=="function"&&ma;function _(o,h){if(!n[o]){if(!t[o]){var f=typeof parcelRequire=="function"&&parcelRequire;if(!h&&f)return f(o,!0);if(u)return u(o,!0);if(p&&typeof o=="string")return p(o);var v=new Error("Cannot find module '"+o+"'");throw v.code="MODULE_NOT_FOUND",v}T.resolve=function(w){return t[o][1][w]||w},T.cache={};var x=n[o]=new _.Module(o);t[o][0].call(x.exports,T,x,x.exports,this)}return n[o].exports;function T(w){return _(T.resolve(w))}}_.isParcelRequire=!0,_.Module=function(o){this.id=o,this.bundle=_,this.exports={}},_.modules=t,_.cache=n,_.parent=u,_.register=function(o,h){t[o]=[function(f,v){v.exports=h},{}]};for(var g=0;g<i.length;g++)try{_(i[g])}catch(o){c||(c=o)}if(i.length){var S=_(i[i.length-1]);typeof Dl=="object"&&typeof ga!="undefined"?ga.exports=S:typeof define=="function"&&define.amd?define(function(){return S}):r&&(this[r]=S)}if(parcelRequire=_,c)throw c;return _}({EgBh:[function(t,n,i){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch(p){return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch(p){return!0}}(),n.exports.binaryFeatures=r;var c=n.exports.BlobBuilder;function u(){this._pieces=[],this._parts=[]}typeof window!="undefined"&&(c=n.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),u.prototype.append=function(p){typeof p=="number"?this._pieces.push(p):(this.flush(),this._parts.push(p))},u.prototype.flush=function(){if(this._pieces.length>0){var p=new Uint8Array(this._pieces);r.useArrayBufferView||(p=p.buffer),this._parts.push(p),this._pieces=[]}},u.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var p=new c,_=0,g=this._parts.length;_<g;_++)p.append(this._parts[_]);return p.getBlob()}return new Blob(this._parts)},n.exports.BufferBuilder=u},{}],kdPp:[function(t,n,i){var r=t("./bufferbuilder").BufferBuilder,c=t("./bufferbuilder").binaryFeatures,u={unpack:function(o){return new p(o).unpack()},pack:function(o){var h=new _;return h.pack(o),h.getBuffer()}};function p(o){this.index=0,this.dataBuffer=o,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function _(){this.bufferBuilder=new r}function g(o){var h=o.charCodeAt(0);return h<=2047?"00":h<=65535?"000":h<=2097151?"0000":h<=67108863?"00000":"000000"}function S(o){return o.length>600?new Blob([o]).size:o.replace(/[^\u0000-\u007F]/g,g).length}n.exports=u,p.prototype.unpack=function(){var o,h=this.unpack_uint8();if(h<128)return h;if((224^h)<32)return(224^h)-32;if((o=160^h)<=15)return this.unpack_raw(o);if((o=176^h)<=15)return this.unpack_string(o);if((o=144^h)<=15)return this.unpack_array(o);if((o=128^h)<=15)return this.unpack_map(o);switch(h){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return o=this.unpack_uint16(),this.unpack_string(o);case 217:return o=this.unpack_uint32(),this.unpack_string(o);case 218:return o=this.unpack_uint16(),this.unpack_raw(o);case 219:return o=this.unpack_uint32(),this.unpack_raw(o);case 220:return o=this.unpack_uint16(),this.unpack_array(o);case 221:return o=this.unpack_uint32(),this.unpack_array(o);case 222:return o=this.unpack_uint16(),this.unpack_map(o);case 223:return o=this.unpack_uint32(),this.unpack_map(o)}},p.prototype.unpack_uint8=function(){var o=255&this.dataView[this.index];return this.index++,o},p.prototype.unpack_uint16=function(){var o=this.read(2),h=256*(255&o[0])+(255&o[1]);return this.index+=2,h},p.prototype.unpack_uint32=function(){var o=this.read(4),h=256*(256*(256*o[0]+o[1])+o[2])+o[3];return this.index+=4,h},p.prototype.unpack_uint64=function(){var o=this.read(8),h=256*(256*(256*(256*(256*(256*(256*o[0]+o[1])+o[2])+o[3])+o[4])+o[5])+o[6])+o[7];return this.index+=8,h},p.prototype.unpack_int8=function(){var o=this.unpack_uint8();return o<128?o:o-256},p.prototype.unpack_int16=function(){var o=this.unpack_uint16();return o<32768?o:o-65536},p.prototype.unpack_int32=function(){var o=this.unpack_uint32();return o<Math.pow(2,31)?o:o-Math.pow(2,32)},p.prototype.unpack_int64=function(){var o=this.unpack_uint64();return o<Math.pow(2,63)?o:o-Math.pow(2,64)},p.prototype.unpack_raw=function(o){if(this.length<this.index+o)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+o+" "+this.length);var h=this.dataBuffer.slice(this.index,this.index+o);return this.index+=o,h},p.prototype.unpack_string=function(o){for(var h,f,v=this.read(o),x=0,T="";x<o;)(h=v[x])<128?(T+=String.fromCharCode(h),x++):(192^h)<32?(f=(192^h)<<6|63&v[x+1],T+=String.fromCharCode(f),x+=2):(f=(15&h)<<12|(63&v[x+1])<<6|63&v[x+2],T+=String.fromCharCode(f),x+=3);return this.index+=o,T},p.prototype.unpack_array=function(o){for(var h=new Array(o),f=0;f<o;f++)h[f]=this.unpack();return h},p.prototype.unpack_map=function(o){for(var h={},f=0;f<o;f++){var v=this.unpack(),x=this.unpack();h[v]=x}return h},p.prototype.unpack_float=function(){var o=this.unpack_uint32(),h=(o>>23&255)-127;return(o>>31==0?1:-1)*(8388607&o|8388608)*Math.pow(2,h-23)},p.prototype.unpack_double=function(){var o=this.unpack_uint32(),h=this.unpack_uint32(),f=(o>>20&2047)-1023;return(o>>31==0?1:-1)*((1048575&o|1048576)*Math.pow(2,f-20)+h*Math.pow(2,f-52))},p.prototype.read=function(o){var h=this.index;if(h+o<=this.length)return this.dataView.subarray(h,h+o);throw new Error("BinaryPackFailure: read index out of range")},_.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},_.prototype.pack=function(o){var h=typeof o;if(h==="string")this.pack_string(o);else if(h==="number")Math.floor(o)===o?this.pack_integer(o):this.pack_double(o);else if(h==="boolean")o===!0?this.bufferBuilder.append(195):o===!1&&this.bufferBuilder.append(194);else if(h==="undefined")this.bufferBuilder.append(192);else{if(h!=="object")throw new Error('Type "'+h+'" not yet supported');if(o===null)this.bufferBuilder.append(192);else{var f=o.constructor;if(f==Array)this.pack_array(o);else if(f==Blob||f==File||o instanceof Blob||o instanceof File)this.pack_bin(o);else if(f==ArrayBuffer)c.useArrayBufferView?this.pack_bin(new Uint8Array(o)):this.pack_bin(o);else if("BYTES_PER_ELEMENT"in o)c.useArrayBufferView?this.pack_bin(new Uint8Array(o.buffer)):this.pack_bin(o.buffer);else if(f==Object||f.toString().startsWith("class"))this.pack_object(o);else if(f==Date)this.pack_string(o.toString());else{if(typeof o.toBinaryPack!="function")throw new Error('Type "'+f.toString()+'" not yet supported');this.bufferBuilder.append(o.toBinaryPack())}}}this.bufferBuilder.flush()},_.prototype.pack_bin=function(o){var h=o.length||o.byteLength||o.size;if(h<=15)this.pack_uint8(160+h);else if(h<=65535)this.bufferBuilder.append(218),this.pack_uint16(h);else{if(!(h<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(h)}this.bufferBuilder.append(o)},_.prototype.pack_string=function(o){var h=S(o);if(h<=15)this.pack_uint8(176+h);else if(h<=65535)this.bufferBuilder.append(216),this.pack_uint16(h);else{if(!(h<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(h)}this.bufferBuilder.append(o)},_.prototype.pack_array=function(o){var h=o.length;if(h<=15)this.pack_uint8(144+h);else if(h<=65535)this.bufferBuilder.append(220),this.pack_uint16(h);else{if(!(h<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(h)}for(var f=0;f<h;f++)this.pack(o[f])},_.prototype.pack_integer=function(o){if(o>=-32&&o<=127)this.bufferBuilder.append(255&o);else if(o>=0&&o<=255)this.bufferBuilder.append(204),this.pack_uint8(o);else if(o>=-128&&o<=127)this.bufferBuilder.append(208),this.pack_int8(o);else if(o>=0&&o<=65535)this.bufferBuilder.append(205),this.pack_uint16(o);else if(o>=-32768&&o<=32767)this.bufferBuilder.append(209),this.pack_int16(o);else if(o>=0&&o<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(o);else if(o>=-2147483648&&o<=2147483647)this.bufferBuilder.append(210),this.pack_int32(o);else if(o>=-9223372036854776e3&&o<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(o);else{if(!(o>=0&&o<=18446744073709552e3))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(o)}},_.prototype.pack_double=function(o){var h=0;o<0&&(h=1,o=-o);var f=Math.floor(Math.log(o)/Math.LN2),v=o/Math.pow(2,f)-1,x=Math.floor(v*Math.pow(2,52)),T=Math.pow(2,32),w=h<<31|f+1023<<20|x/T&1048575,y=x%T;this.bufferBuilder.append(203),this.pack_int32(w),this.pack_int32(y)},_.prototype.pack_object=function(o){var h=Object.keys(o).length;if(h<=15)this.pack_uint8(128+h);else if(h<=65535)this.bufferBuilder.append(222),this.pack_uint16(h);else{if(!(h<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(h)}for(var f in o)o.hasOwnProperty(f)&&(this.pack(f),this.pack(o[f]))},_.prototype.pack_uint8=function(o){this.bufferBuilder.append(o)},_.prototype.pack_uint16=function(o){this.bufferBuilder.append(o>>8),this.bufferBuilder.append(255&o)},_.prototype.pack_uint32=function(o){var h=4294967295&o;this.bufferBuilder.append((4278190080&h)>>>24),this.bufferBuilder.append((16711680&h)>>>16),this.bufferBuilder.append((65280&h)>>>8),this.bufferBuilder.append(255&h)},_.prototype.pack_uint64=function(o){var h=o/Math.pow(2,32),f=o%Math.pow(2,32);this.bufferBuilder.append((4278190080&h)>>>24),this.bufferBuilder.append((16711680&h)>>>16),this.bufferBuilder.append((65280&h)>>>8),this.bufferBuilder.append(255&h),this.bufferBuilder.append((4278190080&f)>>>24),this.bufferBuilder.append((16711680&f)>>>16),this.bufferBuilder.append((65280&f)>>>8),this.bufferBuilder.append(255&f)},_.prototype.pack_int8=function(o){this.bufferBuilder.append(255&o)},_.prototype.pack_int16=function(o){this.bufferBuilder.append((65280&o)>>8),this.bufferBuilder.append(255&o)},_.prototype.pack_int32=function(o){this.bufferBuilder.append(o>>>24&255),this.bufferBuilder.append((16711680&o)>>>16),this.bufferBuilder.append((65280&o)>>>8),this.bufferBuilder.append(255&o)},_.prototype.pack_int64=function(o){var h=Math.floor(o/Math.pow(2,32)),f=o%Math.pow(2,32);this.bufferBuilder.append((4278190080&h)>>>24),this.bufferBuilder.append((16711680&h)>>>16),this.bufferBuilder.append((65280&h)>>>8),this.bufferBuilder.append(255&h),this.bufferBuilder.append((4278190080&f)>>>24),this.bufferBuilder.append((16711680&f)>>>16),this.bufferBuilder.append((65280&f)>>>8),this.bufferBuilder.append(255&f)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(t,n,i){"use strict";function r(C,m,M){return m in C?Object.defineProperty(C,m,{value:M,enumerable:!0,configurable:!0,writable:!0}):C[m]=M,C}function c(C){return(c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m})(C)}Object.defineProperty(i,"__esModule",{value:!0}),i.extractVersion=_,i.wrapPeerConnectionEvent=g,i.disableLog=S,i.disableWarnings=o,i.log=h,i.deprecated=f,i.detectBrowser=v,i.compactObject=T,i.walkStats=w,i.filterStats=y;var u=!0,p=!0;function _(C,m,M){var R=C.match(m);return R&&R.length>=M&&parseInt(R[M],10)}function g(C,m,M){if(C.RTCPeerConnection){var R=C.RTCPeerConnection.prototype,I=R.addEventListener;R.addEventListener=function(q,z){if(q!==m)return I.apply(this,arguments);var U=function(H){var ee=M(H);ee&&z(ee)};return this._eventMap=this._eventMap||{},this._eventMap[z]=U,I.apply(this,[q,U])};var L=R.removeEventListener;R.removeEventListener=function(q,z){if(q!==m||!this._eventMap||!this._eventMap[z])return L.apply(this,arguments);var U=this._eventMap[z];return delete this._eventMap[z],L.apply(this,[q,U])},Object.defineProperty(R,"on"+m,{get:function(){return this["_on"+m]},set:function(q){this["_on"+m]&&(this.removeEventListener(m,this["_on"+m]),delete this["_on"+m]),q&&this.addEventListener(m,this["_on"+m]=q)},enumerable:!0,configurable:!0})}}function S(C){return typeof C!="boolean"?new Error("Argument type: "+c(C)+". Please use a boolean."):(u=C,C?"adapter.js logging disabled":"adapter.js logging enabled")}function o(C){return typeof C!="boolean"?new Error("Argument type: "+c(C)+". Please use a boolean."):(p=!C,"adapter.js deprecation warnings "+(C?"disabled":"enabled"))}function h(){if((typeof window=="undefined"?"undefined":c(window))==="object"){if(u)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function f(C,m){p&&console.warn(C+" is deprecated, please use "+m+" instead.")}function v(C){var{navigator:m}=C,M={browser:null,version:null};if(C===void 0||!C.navigator)return M.browser="Not a browser.",M;if(m.mozGetUserMedia)M.browser="firefox",M.version=_(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||C.isSecureContext===!1&&C.webkitRTCPeerConnection&&!C.RTCIceGatherer)M.browser="chrome",M.version=_(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(m.mediaDevices&&m.userAgent.match(/Edge\/(\d+).(\d+)$/))M.browser="edge",M.version=_(m.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!C.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return M.browser="Not a supported browser.",M;M.browser="safari",M.version=_(m.userAgent,/AppleWebKit\/(\d+)\./,1),M.supportsUnifiedPlan=C.RTCRtpTransceiver&&"currentDirection"in C.RTCRtpTransceiver.prototype}return M}function x(C){return Object.prototype.toString.call(C)==="[object Object]"}function T(C){return x(C)?Object.keys(C).reduce(function(m,M){var R=x(C[M]),I=R?T(C[M]):C[M],L=R&&!Object.keys(I).length;return I===void 0||L?m:Object.assign(m,r({},M,I))},{}):C}function w(C,m,M){m&&!M.has(m.id)&&(M.set(m.id,m),Object.keys(m).forEach(function(R){R.endsWith("Id")?w(C,C.get(m[R]),M):R.endsWith("Ids")&&m[R].forEach(function(I){w(C,C.get(I),M)})}))}function y(C,m,M){var R=M?"outbound-rtp":"inbound-rtp",I=new Map;if(m===null)return I;var L=[];return C.forEach(function(q){q.type==="track"&&q.trackIdentifier===m.id&&L.push(q)}),L.forEach(function(q){C.forEach(function(z){z.type===R&&z.trackId===q.id&&w(C,z,I)})}),I}},{}],s6SN:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=g;var r=u(t("../utils.js"));function c(){if(typeof WeakMap!="function")return null;var S=new WeakMap;return c=function(){return S},S}function u(S){if(S&&S.__esModule)return S;if(S===null||typeof S!="object"&&typeof S!="function")return{default:S};var o=c();if(o&&o.has(S))return o.get(S);var h={},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var v in S)if(Object.prototype.hasOwnProperty.call(S,v)){var x=f?Object.getOwnPropertyDescriptor(S,v):null;x&&(x.get||x.set)?Object.defineProperty(h,v,x):h[v]=S[v]}return h.default=S,o&&o.set(S,h),h}function p(S){return(p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(S)}var _=r.log;function g(S){var o=S&&S.navigator;if(o.mediaDevices){var h=r.detectBrowser(S),f=function(w){if(p(w)!=="object"||w.mandatory||w.optional)return w;var y={};return Object.keys(w).forEach(function(C){if(C!=="require"&&C!=="advanced"&&C!=="mediaSource"){var m=p(w[C])==="object"?w[C]:{ideal:w[C]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);var M=function(I,L){return I?I+L.charAt(0).toUpperCase()+L.slice(1):L==="deviceId"?"sourceId":L};if(m.ideal!==void 0){y.optional=y.optional||[];var R={};typeof m.ideal=="number"?(R[M("min",C)]=m.ideal,y.optional.push(R),(R={})[M("max",C)]=m.ideal,y.optional.push(R)):(R[M("",C)]=m.ideal,y.optional.push(R))}m.exact!==void 0&&typeof m.exact!="number"?(y.mandatory=y.mandatory||{},y.mandatory[M("",C)]=m.exact):["min","max"].forEach(function(I){m[I]!==void 0&&(y.mandatory=y.mandatory||{},y.mandatory[M(I,C)]=m[I])})}}),w.advanced&&(y.optional=(y.optional||[]).concat(w.advanced)),y},v=function(w,y){if(h.version>=61)return y(w);if((w=JSON.parse(JSON.stringify(w)))&&p(w.audio)==="object"){var C=function(I,L,q){L in I&&!(q in I)&&(I[q]=I[L],delete I[L])};C((w=JSON.parse(JSON.stringify(w))).audio,"autoGainControl","googAutoGainControl"),C(w.audio,"noiseSuppression","googNoiseSuppression"),w.audio=f(w.audio)}if(w&&p(w.video)==="object"){var m=w.video.facingMode;m=m&&(p(m)==="object"?m:{ideal:m});var M,R=h.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!o.mediaDevices.getSupportedConstraints||!o.mediaDevices.getSupportedConstraints().facingMode||R)&&(delete w.video.facingMode,m.exact==="environment"||m.ideal==="environment"?M=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(M=["front"]),M))return o.mediaDevices.enumerateDevices().then(function(I){var L=(I=I.filter(function(q){return q.kind==="videoinput"})).find(function(q){return M.some(function(z){return q.label.toLowerCase().includes(z)})});return!L&&I.length&&M.includes("back")&&(L=I[I.length-1]),L&&(w.video.deviceId=m.exact?{exact:L.deviceId}:{ideal:L.deviceId}),w.video=f(w.video),_("chrome: "+JSON.stringify(w)),y(w)});w.video=f(w.video)}return _("chrome: "+JSON.stringify(w)),y(w)},x=function(w){return h.version>=64?w:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[w.name]||w.name,message:w.message,constraint:w.constraint||w.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(o.getUserMedia=function(w,y,C){v(w,function(m){o.webkitGetUserMedia(m,y,function(M){C&&C(x(M))})})}.bind(o),o.mediaDevices.getUserMedia){var T=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(w){return v(w,function(y){return T(y).then(function(C){if(y.audio&&!C.getAudioTracks().length||y.video&&!C.getVideoTracks().length)throw C.getTracks().forEach(function(m){m.stop()}),new DOMException("","NotFoundError");return C},function(C){return Promise.reject(x(C))})})}}}}},{"../utils.js":"iSxC"}],VHa8:[function(t,n,i){"use strict";function r(c,u){c.navigator.mediaDevices&&"getDisplayMedia"in c.navigator.mediaDevices||c.navigator.mediaDevices&&(typeof u=="function"?c.navigator.mediaDevices.getDisplayMedia=function(p){return u(p).then(function(_){var g=p.video&&p.video.width,S=p.video&&p.video.height,o=p.video&&p.video.frameRate;return p.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:_,maxFrameRate:o||3}},g&&(p.video.mandatory.maxWidth=g),S&&(p.video.mandatory.maxHeight=S),c.navigator.mediaDevices.getUserMedia(p)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],uI5X:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimMediaStream=o,i.shimOnTrack=h,i.shimGetSendersWithDtmf=f,i.shimGetStats=v,i.shimSenderReceiverGetStats=x,i.shimAddTrackRemoveTrackWithNative=T,i.shimAddTrackRemoveTrack=w,i.shimPeerConnection=y,i.fixNegotiationNeeded=C,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return c.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return u.shimGetDisplayMedia}});var r=_(t("../utils.js")),c=t("./getusermedia"),u=t("./getdisplaymedia");function p(){if(typeof WeakMap!="function")return null;var m=new WeakMap;return p=function(){return m},m}function _(m){if(m&&m.__esModule)return m;if(m===null||typeof m!="object"&&typeof m!="function")return{default:m};var M=p();if(M&&M.has(m))return M.get(m);var R={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in m)if(Object.prototype.hasOwnProperty.call(m,L)){var q=I?Object.getOwnPropertyDescriptor(m,L):null;q&&(q.get||q.set)?Object.defineProperty(R,L,q):R[L]=m[L]}return R.default=m,M&&M.set(m,R),R}function g(m,M,R){return M in m?Object.defineProperty(m,M,{value:R,enumerable:!0,configurable:!0,writable:!0}):m[M]=R,m}function S(m){return(S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(m)}function o(m){m.MediaStream=m.MediaStream||m.webkitMediaStream}function h(m){if(S(m)!=="object"||!m.RTCPeerConnection||"ontrack"in m.RTCPeerConnection.prototype)r.wrapPeerConnectionEvent(m,"track",function(R){return R.transceiver||Object.defineProperty(R,"transceiver",{value:{receiver:R.receiver}}),R});else{Object.defineProperty(m.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(R){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=R)},enumerable:!0,configurable:!0});var M=m.RTCPeerConnection.prototype.setRemoteDescription;m.RTCPeerConnection.prototype.setRemoteDescription=function(){var R=this;return this._ontrackpoly||(this._ontrackpoly=function(I){I.stream.addEventListener("addtrack",function(L){var q;q=m.RTCPeerConnection.prototype.getReceivers?R.getReceivers().find(function(U){return U.track&&U.track.id===L.track.id}):{track:L.track};var z=new Event("track");z.track=L.track,z.receiver=q,z.transceiver={receiver:q},z.streams=[I.stream],R.dispatchEvent(z)}),I.stream.getTracks().forEach(function(L){var q;q=m.RTCPeerConnection.prototype.getReceivers?R.getReceivers().find(function(U){return U.track&&U.track.id===L.id}):{track:L};var z=new Event("track");z.track=L,z.receiver=q,z.transceiver={receiver:q},z.streams=[I.stream],R.dispatchEvent(z)})},this.addEventListener("addstream",this._ontrackpoly)),M.apply(this,arguments)}}}function f(m){if(S(m)==="object"&&m.RTCPeerConnection&&!("getSenders"in m.RTCPeerConnection.prototype)&&"createDTMFSender"in m.RTCPeerConnection.prototype){var M=function(U,H){return{track:H,get dtmf(){return this._dtmf===void 0&&(H.kind==="audio"?this._dtmf=U.createDTMFSender(H):this._dtmf=null),this._dtmf},_pc:U}};if(!m.RTCPeerConnection.prototype.getSenders){m.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var R=m.RTCPeerConnection.prototype.addTrack;m.RTCPeerConnection.prototype.addTrack=function(U,H){var ee=R.apply(this,arguments);return ee||(ee=M(this,U),this._senders.push(ee)),ee};var I=m.RTCPeerConnection.prototype.removeTrack;m.RTCPeerConnection.prototype.removeTrack=function(U){I.apply(this,arguments);var H=this._senders.indexOf(U);H!==-1&&this._senders.splice(H,1)}}var L=m.RTCPeerConnection.prototype.addStream;m.RTCPeerConnection.prototype.addStream=function(U){var H=this;this._senders=this._senders||[],L.apply(this,[U]),U.getTracks().forEach(function(ee){H._senders.push(M(H,ee))})};var q=m.RTCPeerConnection.prototype.removeStream;m.RTCPeerConnection.prototype.removeStream=function(U){var H=this;this._senders=this._senders||[],q.apply(this,[U]),U.getTracks().forEach(function(ee){var ie=H._senders.find(function(ae){return ae.track===ee});ie&&H._senders.splice(H._senders.indexOf(ie),1)})}}else if(S(m)==="object"&&m.RTCPeerConnection&&"getSenders"in m.RTCPeerConnection.prototype&&"createDTMFSender"in m.RTCPeerConnection.prototype&&m.RTCRtpSender&&!("dtmf"in m.RTCRtpSender.prototype)){var z=m.RTCPeerConnection.prototype.getSenders;m.RTCPeerConnection.prototype.getSenders=function(){var U=this,H=z.apply(this,[]);return H.forEach(function(ee){return ee._pc=U}),H},Object.defineProperty(m.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function v(m){if(m.RTCPeerConnection){var M=m.RTCPeerConnection.prototype.getStats;m.RTCPeerConnection.prototype.getStats=function(){var R=this,[I,L,q]=arguments;if(arguments.length>0&&typeof I=="function")return M.apply(this,arguments);if(M.length===0&&(arguments.length===0||typeof I!="function"))return M.apply(this,[]);var z=function(H){var ee={};return H.result().forEach(function(ie){var ae={id:ie.id,timestamp:ie.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[ie.type]||ie.type};ie.names().forEach(function($){ae[$]=ie.stat($)}),ee[ae.id]=ae}),ee},U=function(H){return new Map(Object.keys(H).map(function(ee){return[ee,H[ee]]}))};return arguments.length>=2?M.apply(this,[function(H){L(U(z(H)))},I]):new Promise(function(H,ee){M.apply(R,[function(ie){H(U(z(ie)))},ee])}).then(L,q)}}}function x(m){if(S(m)==="object"&&m.RTCPeerConnection&&m.RTCRtpSender&&m.RTCRtpReceiver){if(!("getStats"in m.RTCRtpSender.prototype)){var M=m.RTCPeerConnection.prototype.getSenders;M&&(m.RTCPeerConnection.prototype.getSenders=function(){var q=this,z=M.apply(this,[]);return z.forEach(function(U){return U._pc=q}),z});var R=m.RTCPeerConnection.prototype.addTrack;R&&(m.RTCPeerConnection.prototype.addTrack=function(){var q=R.apply(this,arguments);return q._pc=this,q}),m.RTCRtpSender.prototype.getStats=function(){var q=this;return this._pc.getStats().then(function(z){return r.filterStats(z,q.track,!0)})}}if(!("getStats"in m.RTCRtpReceiver.prototype)){var I=m.RTCPeerConnection.prototype.getReceivers;I&&(m.RTCPeerConnection.prototype.getReceivers=function(){var q=this,z=I.apply(this,[]);return z.forEach(function(U){return U._pc=q}),z}),r.wrapPeerConnectionEvent(m,"track",function(q){return q.receiver._pc=q.srcElement,q}),m.RTCRtpReceiver.prototype.getStats=function(){var q=this;return this._pc.getStats().then(function(z){return r.filterStats(z,q.track,!1)})}}if("getStats"in m.RTCRtpSender.prototype&&"getStats"in m.RTCRtpReceiver.prototype){var L=m.RTCPeerConnection.prototype.getStats;m.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof m.MediaStreamTrack){var q,z,U,H=arguments[0];return this.getSenders().forEach(function(ee){ee.track===H&&(q?U=!0:q=ee)}),this.getReceivers().forEach(function(ee){return ee.track===H&&(z?U=!0:z=ee),ee.track===H}),U||q&&z?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):q?q.getStats():z?z.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return L.apply(this,arguments)}}}}function T(m){m.RTCPeerConnection.prototype.getLocalStreams=function(){var q=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(z){return q._shimmedLocalStreams[z][0]})};var M=m.RTCPeerConnection.prototype.addTrack;m.RTCPeerConnection.prototype.addTrack=function(q,z){if(!z)return M.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var U=M.apply(this,arguments);return this._shimmedLocalStreams[z.id]?this._shimmedLocalStreams[z.id].indexOf(U)===-1&&this._shimmedLocalStreams[z.id].push(U):this._shimmedLocalStreams[z.id]=[z,U],U};var R=m.RTCPeerConnection.prototype.addStream;m.RTCPeerConnection.prototype.addStream=function(q){var z=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},q.getTracks().forEach(function(ee){if(z.getSenders().find(function(ie){return ie.track===ee}))throw new DOMException("Track already exists.","InvalidAccessError")});var U=this.getSenders();R.apply(this,arguments);var H=this.getSenders().filter(function(ee){return U.indexOf(ee)===-1});this._shimmedLocalStreams[q.id]=[q].concat(H)};var I=m.RTCPeerConnection.prototype.removeStream;m.RTCPeerConnection.prototype.removeStream=function(q){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[q.id],I.apply(this,arguments)};var L=m.RTCPeerConnection.prototype.removeTrack;m.RTCPeerConnection.prototype.removeTrack=function(q){var z=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},q&&Object.keys(this._shimmedLocalStreams).forEach(function(U){var H=z._shimmedLocalStreams[U].indexOf(q);H!==-1&&z._shimmedLocalStreams[U].splice(H,1),z._shimmedLocalStreams[U].length===1&&delete z._shimmedLocalStreams[U]}),L.apply(this,arguments)}}function w(m){if(m.RTCPeerConnection){var M=r.detectBrowser(m);if(m.RTCPeerConnection.prototype.addTrack&&M.version>=65)return T(m);var R=m.RTCPeerConnection.prototype.getLocalStreams;m.RTCPeerConnection.prototype.getLocalStreams=function(){var H=this,ee=R.apply(this);return this._reverseStreams=this._reverseStreams||{},ee.map(function(ie){return H._reverseStreams[ie.id]})};var I=m.RTCPeerConnection.prototype.addStream;m.RTCPeerConnection.prototype.addStream=function(H){var ee=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},H.getTracks().forEach(function(ae){if(ee.getSenders().find(function($){return $.track===ae}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[H.id]){var ie=new m.MediaStream(H.getTracks());this._streams[H.id]=ie,this._reverseStreams[ie.id]=H,H=ie}I.apply(this,[H])};var L=m.RTCPeerConnection.prototype.removeStream;m.RTCPeerConnection.prototype.removeStream=function(H){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},L.apply(this,[this._streams[H.id]||H]),delete this._reverseStreams[this._streams[H.id]?this._streams[H.id].id:H.id],delete this._streams[H.id]},m.RTCPeerConnection.prototype.addTrack=function(H,ee){var ie=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var ae=[].slice.call(arguments,1);if(ae.length!==1||!ae[0].getTracks().find(function(re){return re===H}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(re){return re.track===H}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var $=this._streams[ee.id];if($)$.addTrack(H),Promise.resolve().then(function(){ie.dispatchEvent(new Event("negotiationneeded"))});else{var ce=new m.MediaStream([H]);this._streams[ee.id]=ce,this._reverseStreams[ce.id]=ee,this.addStream(ce)}return this.getSenders().find(function(re){return re.track===H})},["createOffer","createAnswer"].forEach(function(H){var ee=m.RTCPeerConnection.prototype[H],ie=g({},H,function(){var ae=this,$=arguments;return arguments.length&&typeof arguments[0]=="function"?ee.apply(this,[function(ce){var re=U(ae,ce);$[0].apply(null,[re])},function(ce){$[1]&&$[1].apply(null,ce)},arguments[2]]):ee.apply(this,arguments).then(function(ce){return U(ae,ce)})});m.RTCPeerConnection.prototype[H]=ie[H]});var q=m.RTCPeerConnection.prototype.setLocalDescription;m.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(H=this,ee=arguments[0],ie=ee.sdp,Object.keys(H._reverseStreams||[]).forEach(function(ae){var $=H._reverseStreams[ae],ce=H._streams[$.id];ie=ie.replace(new RegExp($.id,"g"),ce.id)}),new RTCSessionDescription({type:ee.type,sdp:ie})),q.apply(this,arguments)):q.apply(this,arguments);var H,ee,ie};var z=Object.getOwnPropertyDescriptor(m.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(m.RTCPeerConnection.prototype,"localDescription",{get:function(){var H=z.get.apply(this);return H.type===""?H:U(this,H)}}),m.RTCPeerConnection.prototype.removeTrack=function(H){var ee,ie=this;if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!H._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(H._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(ae){ie._streams[ae].getTracks().find(function($){return H.track===$})&&(ee=ie._streams[ae])}),ee&&(ee.getTracks().length===1?this.removeStream(this._reverseStreams[ee.id]):ee.removeTrack(H.track),this.dispatchEvent(new Event("negotiationneeded")))}}function U(H,ee){var ie=ee.sdp;return Object.keys(H._reverseStreams||[]).forEach(function(ae){var $=H._reverseStreams[ae],ce=H._streams[$.id];ie=ie.replace(new RegExp(ce.id,"g"),$.id)}),new RTCSessionDescription({type:ee.type,sdp:ie})}}function y(m){var M=r.detectBrowser(m);if(!m.RTCPeerConnection&&m.webkitRTCPeerConnection&&(m.RTCPeerConnection=m.webkitRTCPeerConnection),m.RTCPeerConnection){M.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(I){var L=m.RTCPeerConnection.prototype[I],q=g({},I,function(){return arguments[0]=new(I==="addIceCandidate"?m.RTCIceCandidate:m.RTCSessionDescription)(arguments[0]),L.apply(this,arguments)});m.RTCPeerConnection.prototype[I]=q[I]});var R=m.RTCPeerConnection.prototype.addIceCandidate;m.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?M.version<78&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():R.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}function C(m){r.wrapPeerConnectionEvent(m,"negotiationneeded",function(M){if(M.target.signalingState==="stable")return M})}},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.filterIceServers=p;var r=u(t("../utils"));function c(){if(typeof WeakMap!="function")return null;var _=new WeakMap;return c=function(){return _},_}function u(_){if(_&&_.__esModule)return _;if(_===null||typeof _!="object"&&typeof _!="function")return{default:_};var g=c();if(g&&g.has(_))return g.get(_);var S={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in _)if(Object.prototype.hasOwnProperty.call(_,h)){var f=o?Object.getOwnPropertyDescriptor(_,h):null;f&&(f.get||f.set)?Object.defineProperty(S,h,f):S[h]=_[h]}return S.default=_,g&&g.set(_,S),S}function p(_,g){var S=!1;return(_=JSON.parse(JSON.stringify(_))).filter(function(o){if(o&&(o.urls||o.url)){var h=o.urls||o.url;o.url&&!o.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var f=typeof h=="string";return f&&(h=[h]),h=h.filter(function(v){if(v.indexOf("stun:")===0)return!1;var x=v.startsWith("turn")&&!v.startsWith("turn:[")&&v.includes("transport=udp");return x&&!S?(S=!0,!0):x&&!S}),delete o.url,o.urls=f?h[0]:h,!!h.length}})}},{"../utils":"iSxC"}],YHvh:[function(t,n,i){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(c){return c.trim().split(`
`).map(function(u){return u.trim()})},r.splitSections=function(c){return c.split(`
m=`).map(function(u,p){return(p>0?"m="+u:u).trim()+`\r
`})},r.getDescription=function(c){var u=r.splitSections(c);return u&&u[0]},r.getMediaSections=function(c){var u=r.splitSections(c);return u.shift(),u},r.matchPrefix=function(c,u){return r.splitLines(c).filter(function(p){return p.indexOf(u)===0})},r.parseCandidate=function(c){for(var u,p={foundation:(u=c.indexOf("a=candidate:")===0?c.substring(12).split(" "):c.substring(10).split(" "))[0],component:parseInt(u[1],10),protocol:u[2].toLowerCase(),priority:parseInt(u[3],10),ip:u[4],address:u[4],port:parseInt(u[5],10),type:u[7]},_=8;_<u.length;_+=2)switch(u[_]){case"raddr":p.relatedAddress=u[_+1];break;case"rport":p.relatedPort=parseInt(u[_+1],10);break;case"tcptype":p.tcpType=u[_+1];break;case"ufrag":p.ufrag=u[_+1],p.usernameFragment=u[_+1];break;default:p[u[_]]=u[_+1]}return p},r.writeCandidate=function(c){var u=[];u.push(c.foundation),u.push(c.component),u.push(c.protocol.toUpperCase()),u.push(c.priority),u.push(c.address||c.ip),u.push(c.port);var p=c.type;return u.push("typ"),u.push(p),p!=="host"&&c.relatedAddress&&c.relatedPort&&(u.push("raddr"),u.push(c.relatedAddress),u.push("rport"),u.push(c.relatedPort)),c.tcpType&&c.protocol.toLowerCase()==="tcp"&&(u.push("tcptype"),u.push(c.tcpType)),(c.usernameFragment||c.ufrag)&&(u.push("ufrag"),u.push(c.usernameFragment||c.ufrag)),"candidate:"+u.join(" ")},r.parseIceOptions=function(c){return c.substr(14).split(" ")},r.parseRtpMap=function(c){var u=c.substr(9).split(" "),p={payloadType:parseInt(u.shift(),10)};return u=u[0].split("/"),p.name=u[0],p.clockRate=parseInt(u[1],10),p.channels=u.length===3?parseInt(u[2],10):1,p.numChannels=p.channels,p},r.writeRtpMap=function(c){var u=c.payloadType;c.preferredPayloadType!==void 0&&(u=c.preferredPayloadType);var p=c.channels||c.numChannels||1;return"a=rtpmap:"+u+" "+c.name+"/"+c.clockRate+(p!==1?"/"+p:"")+`\r
`},r.parseExtmap=function(c){var u=c.substr(9).split(" ");return{id:parseInt(u[0],10),direction:u[0].indexOf("/")>0?u[0].split("/")[1]:"sendrecv",uri:u[1]}},r.writeExtmap=function(c){return"a=extmap:"+(c.id||c.preferredId)+(c.direction&&c.direction!=="sendrecv"?"/"+c.direction:"")+" "+c.uri+`\r
`},r.parseFmtp=function(c){for(var u,p={},_=c.substr(c.indexOf(" ")+1).split(";"),g=0;g<_.length;g++)p[(u=_[g].trim().split("="))[0].trim()]=u[1];return p},r.writeFmtp=function(c){var u="",p=c.payloadType;if(c.preferredPayloadType!==void 0&&(p=c.preferredPayloadType),c.parameters&&Object.keys(c.parameters).length){var _=[];Object.keys(c.parameters).forEach(function(g){c.parameters[g]?_.push(g+"="+c.parameters[g]):_.push(g)}),u+="a=fmtp:"+p+" "+_.join(";")+`\r
`}return u},r.parseRtcpFb=function(c){var u=c.substr(c.indexOf(" ")+1).split(" ");return{type:u.shift(),parameter:u.join(" ")}},r.writeRtcpFb=function(c){var u="",p=c.payloadType;return c.preferredPayloadType!==void 0&&(p=c.preferredPayloadType),c.rtcpFeedback&&c.rtcpFeedback.length&&c.rtcpFeedback.forEach(function(_){u+="a=rtcp-fb:"+p+" "+_.type+(_.parameter&&_.parameter.length?" "+_.parameter:"")+`\r
`}),u},r.parseSsrcMedia=function(c){var u=c.indexOf(" "),p={ssrc:parseInt(c.substr(7,u-7),10)},_=c.indexOf(":",u);return _>-1?(p.attribute=c.substr(u+1,_-u-1),p.value=c.substr(_+1)):p.attribute=c.substr(u+1),p},r.parseSsrcGroup=function(c){var u=c.substr(13).split(" ");return{semantics:u.shift(),ssrcs:u.map(function(p){return parseInt(p,10)})}},r.getMid=function(c){var u=r.matchPrefix(c,"a=mid:")[0];if(u)return u.substr(6)},r.parseFingerprint=function(c){var u=c.substr(14).split(" ");return{algorithm:u[0].toLowerCase(),value:u[1]}},r.getDtlsParameters=function(c,u){return{role:"auto",fingerprints:r.matchPrefix(c+u,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(c,u){var p="a=setup:"+u+`\r
`;return c.fingerprints.forEach(function(_){p+="a=fingerprint:"+_.algorithm+" "+_.value+`\r
`}),p},r.getIceParameters=function(c,u){var p=r.splitLines(c);return{usernameFragment:(p=p.concat(r.splitLines(u))).filter(function(_){return _.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:p.filter(function(_){return _.indexOf("a=ice-pwd:")===0})[0].substr(10)}},r.writeIceParameters=function(c){return"a=ice-ufrag:"+c.usernameFragment+`\r
a=ice-pwd:`+c.password+`\r
`},r.parseRtpParameters=function(c){for(var u={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},p=r.splitLines(c)[0].split(" "),_=3;_<p.length;_++){var g=p[_],S=r.matchPrefix(c,"a=rtpmap:"+g+" ")[0];if(S){var o=r.parseRtpMap(S),h=r.matchPrefix(c,"a=fmtp:"+g+" ");switch(o.parameters=h.length?r.parseFmtp(h[0]):{},o.rtcpFeedback=r.matchPrefix(c,"a=rtcp-fb:"+g+" ").map(r.parseRtcpFb),u.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":u.fecMechanisms.push(o.name.toUpperCase())}}}return r.matchPrefix(c,"a=extmap:").forEach(function(f){u.headerExtensions.push(r.parseExtmap(f))}),u},r.writeRtpDescription=function(c,u){var p="";p+="m="+c+" ",p+=u.codecs.length>0?"9":"0",p+=" UDP/TLS/RTP/SAVPF ",p+=u.codecs.map(function(g){return g.preferredPayloadType!==void 0?g.preferredPayloadType:g.payloadType}).join(" ")+`\r
`,p+=`c=IN IP4 0.0.0.0\r
`,p+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,u.codecs.forEach(function(g){p+=r.writeRtpMap(g),p+=r.writeFmtp(g),p+=r.writeRtcpFb(g)});var _=0;return u.codecs.forEach(function(g){g.maxptime>_&&(_=g.maxptime)}),_>0&&(p+="a=maxptime:"+_+`\r
`),p+=`a=rtcp-mux\r
`,u.headerExtensions&&u.headerExtensions.forEach(function(g){p+=r.writeExtmap(g)}),p},r.parseRtpEncodingParameters=function(c){var u,p=[],_=r.parseRtpParameters(c),g=_.fecMechanisms.indexOf("RED")!==-1,S=_.fecMechanisms.indexOf("ULPFEC")!==-1,o=r.matchPrefix(c,"a=ssrc:").map(function(x){return r.parseSsrcMedia(x)}).filter(function(x){return x.attribute==="cname"}),h=o.length>0&&o[0].ssrc,f=r.matchPrefix(c,"a=ssrc-group:FID").map(function(x){return x.substr(17).split(" ").map(function(T){return parseInt(T,10)})});f.length>0&&f[0].length>1&&f[0][0]===h&&(u=f[0][1]),_.codecs.forEach(function(x){if(x.name.toUpperCase()==="RTX"&&x.parameters.apt){var T={ssrc:h,codecPayloadType:parseInt(x.parameters.apt,10)};h&&u&&(T.rtx={ssrc:u}),p.push(T),g&&((T=JSON.parse(JSON.stringify(T))).fec={ssrc:h,mechanism:S?"red+ulpfec":"red"},p.push(T))}}),p.length===0&&h&&p.push({ssrc:h});var v=r.matchPrefix(c,"b=");return v.length&&(v=v[0].indexOf("b=TIAS:")===0?parseInt(v[0].substr(7),10):v[0].indexOf("b=AS:")===0?1e3*parseInt(v[0].substr(5),10)*.95-16e3:void 0,p.forEach(function(x){x.maxBitrate=v})),p},r.parseRtcpParameters=function(c){var u={},p=r.matchPrefix(c,"a=ssrc:").map(function(S){return r.parseSsrcMedia(S)}).filter(function(S){return S.attribute==="cname"})[0];p&&(u.cname=p.value,u.ssrc=p.ssrc);var _=r.matchPrefix(c,"a=rtcp-rsize");u.reducedSize=_.length>0,u.compound=_.length===0;var g=r.matchPrefix(c,"a=rtcp-mux");return u.mux=g.length>0,u},r.parseMsid=function(c){var u,p=r.matchPrefix(c,"a=msid:");if(p.length===1)return{stream:(u=p[0].substr(7).split(" "))[0],track:u[1]};var _=r.matchPrefix(c,"a=ssrc:").map(function(g){return r.parseSsrcMedia(g)}).filter(function(g){return g.attribute==="msid"});return _.length>0?{stream:(u=_[0].value.split(" "))[0],track:u[1]}:void 0},r.parseSctpDescription=function(c){var u,p=r.parseMLine(c),_=r.matchPrefix(c,"a=max-message-size:");_.length>0&&(u=parseInt(_[0].substr(19),10)),isNaN(u)&&(u=65536);var g=r.matchPrefix(c,"a=sctp-port:");if(g.length>0)return{port:parseInt(g[0].substr(12),10),protocol:p.fmt,maxMessageSize:u};if(r.matchPrefix(c,"a=sctpmap:").length>0){var S=r.matchPrefix(c,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(S[0],10),protocol:S[1],maxMessageSize:u}}},r.writeSctpDescription=function(c,u){var p=[];return p=c.protocol!=="DTLS/SCTP"?["m="+c.kind+" 9 "+c.protocol+" "+u.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+u.port+`\r
`]:["m="+c.kind+" 9 "+c.protocol+" "+u.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+u.port+" "+u.protocol+` 65535\r
`],u.maxMessageSize!==void 0&&p.push("a=max-message-size:"+u.maxMessageSize+`\r
`),p.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(c,u,p){var _=u!==void 0?u:2;return`v=0\r
o=`+(p||"thisisadapterortc")+" "+(c||r.generateSessionId())+" "+_+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.writeMediaSection=function(c,u,p,_){var g=r.writeRtpDescription(c.kind,u);if(g+=r.writeIceParameters(c.iceGatherer.getLocalParameters()),g+=r.writeDtlsParameters(c.dtlsTransport.getLocalParameters(),p==="offer"?"actpass":"active"),g+="a=mid:"+c.mid+`\r
`,c.direction?g+="a="+c.direction+`\r
`:c.rtpSender&&c.rtpReceiver?g+=`a=sendrecv\r
`:c.rtpSender?g+=`a=sendonly\r
`:c.rtpReceiver?g+=`a=recvonly\r
`:g+=`a=inactive\r
`,c.rtpSender){var S="msid:"+_.id+" "+c.rtpSender.track.id+`\r
`;g+="a="+S,g+="a=ssrc:"+c.sendEncodingParameters[0].ssrc+" "+S,c.sendEncodingParameters[0].rtx&&(g+="a=ssrc:"+c.sendEncodingParameters[0].rtx.ssrc+" "+S,g+="a=ssrc-group:FID "+c.sendEncodingParameters[0].ssrc+" "+c.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return g+="a=ssrc:"+c.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,c.rtpSender&&c.sendEncodingParameters[0].rtx&&(g+="a=ssrc:"+c.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),g},r.getDirection=function(c,u){for(var p=r.splitLines(c),_=0;_<p.length;_++)switch(p[_]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return p[_].substr(2)}return u?r.getDirection(u):"sendrecv"},r.getKind=function(c){return r.splitLines(c)[0].split(" ")[0].substr(2)},r.isRejected=function(c){return c.split(" ",2)[1]==="0"},r.parseMLine=function(c){var u=r.splitLines(c)[0].substr(2).split(" ");return{kind:u[0],port:parseInt(u[1],10),protocol:u[2],fmt:u.slice(3).join(" ")}},r.parseOLine=function(c){var u=r.matchPrefix(c,"o=")[0].substr(2).split(" ");return{username:u[0],sessionId:u[1],sessionVersion:parseInt(u[2],10),netType:u[3],addressType:u[4],address:u[5]}},r.isValidSDP=function(c){if(typeof c!="string"||c.length===0)return!1;for(var u=r.splitLines(c),p=0;p<u.length;p++)if(u[p].length<2||u[p].charAt(1)!=="=")return!1;return!0},typeof n=="object"&&(n.exports=r)},{}],NJ2u:[function(t,n,i){"use strict";var r=t("sdp");function c(h){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[h.type]||h.type}function u(h,f,v,x,T){var w=r.writeRtpDescription(h.kind,f);if(w+=r.writeIceParameters(h.iceGatherer.getLocalParameters()),w+=r.writeDtlsParameters(h.dtlsTransport.getLocalParameters(),v==="offer"?"actpass":T||"active"),w+="a=mid:"+h.mid+`\r
`,h.rtpSender&&h.rtpReceiver?w+=`a=sendrecv\r
`:h.rtpSender?w+=`a=sendonly\r
`:h.rtpReceiver?w+=`a=recvonly\r
`:w+=`a=inactive\r
`,h.rtpSender){var y=h.rtpSender._initialTrackId||h.rtpSender.track.id;h.rtpSender._initialTrackId=y;var C="msid:"+(x?x.id:"-")+" "+y+`\r
`;w+="a="+C,w+="a=ssrc:"+h.sendEncodingParameters[0].ssrc+" "+C,h.sendEncodingParameters[0].rtx&&(w+="a=ssrc:"+h.sendEncodingParameters[0].rtx.ssrc+" "+C,w+="a=ssrc-group:FID "+h.sendEncodingParameters[0].ssrc+" "+h.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return w+="a=ssrc:"+h.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,h.rtpSender&&h.sendEncodingParameters[0].rtx&&(w+="a=ssrc:"+h.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),w}function p(h,f){var v=!1;return(h=JSON.parse(JSON.stringify(h))).filter(function(x){if(x&&(x.urls||x.url)){var T=x.urls||x.url;x.url&&!x.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var w=typeof T=="string";return w&&(T=[T]),T=T.filter(function(y){return y.indexOf("turn:")===0&&y.indexOf("transport=udp")!==-1&&y.indexOf("turn:[")===-1&&!v?(v=!0,!0):y.indexOf("stun:")===0&&f>=14393&&y.indexOf("?transport=udp")===-1}),delete x.url,x.urls=w?T[0]:T,!!T.length}})}function _(h,f){var v={codecs:[],headerExtensions:[],fecMechanisms:[]},x=function(w,y){w=parseInt(w,10);for(var C=0;C<y.length;C++)if(y[C].payloadType===w||y[C].preferredPayloadType===w)return y[C]},T=function(w,y,C,m){var M=x(w.parameters.apt,C),R=x(y.parameters.apt,m);return M&&R&&M.name.toLowerCase()===R.name.toLowerCase()};return h.codecs.forEach(function(w){for(var y=0;y<f.codecs.length;y++){var C=f.codecs[y];if(w.name.toLowerCase()===C.name.toLowerCase()&&w.clockRate===C.clockRate){if(w.name.toLowerCase()==="rtx"&&w.parameters&&C.parameters.apt&&!T(w,C,h.codecs,f.codecs))continue;(C=JSON.parse(JSON.stringify(C))).numChannels=Math.min(w.numChannels,C.numChannels),v.codecs.push(C),C.rtcpFeedback=C.rtcpFeedback.filter(function(m){for(var M=0;M<w.rtcpFeedback.length;M++)if(w.rtcpFeedback[M].type===m.type&&w.rtcpFeedback[M].parameter===m.parameter)return!0;return!1});break}}}),h.headerExtensions.forEach(function(w){for(var y=0;y<f.headerExtensions.length;y++){var C=f.headerExtensions[y];if(w.uri===C.uri){v.headerExtensions.push(C);break}}}),v}function g(h,f,v){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[f][h].indexOf(v)!==-1}function S(h,f){var v=h.getRemoteCandidates().find(function(x){return f.foundation===x.foundation&&f.ip===x.ip&&f.port===x.port&&f.priority===x.priority&&f.protocol===x.protocol&&f.type===x.type});return v||h.addRemoteCandidate(f),!v}function o(h,f){var v=new Error(f);return v.name=h,v.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[h],v}n.exports=function(h,f){function v(y,C){C.addTrack(y),C.dispatchEvent(new h.MediaStreamTrackEvent("addtrack",{track:y}))}function x(y,C,m,M){var R=new Event("track");R.track=C,R.receiver=m,R.transceiver={receiver:m},R.streams=M,h.setTimeout(function(){y._dispatchEvent("track",R)})}var T=function(y){var C=this,m=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(R){C[R]=m[R].bind(m)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",y=JSON.parse(JSON.stringify(y||{})),this.usingBundle=y.bundlePolicy==="max-bundle",y.rtcpMuxPolicy==="negotiate")throw o("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(y.rtcpMuxPolicy||(y.rtcpMuxPolicy="require"),y.iceTransportPolicy){case"all":case"relay":break;default:y.iceTransportPolicy="all"}switch(y.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:y.bundlePolicy="balanced"}if(y.iceServers=p(y.iceServers||[],f),this._iceGatherers=[],y.iceCandidatePoolSize)for(var M=y.iceCandidatePoolSize;M>0;M--)this._iceGatherers.push(new h.RTCIceGatherer({iceServers:y.iceServers,gatherPolicy:y.iceTransportPolicy}));else y.iceCandidatePoolSize=0;this._config=y,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(T.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(T.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),T.prototype.onicecandidate=null,T.prototype.onaddstream=null,T.prototype.ontrack=null,T.prototype.onremovestream=null,T.prototype.onsignalingstatechange=null,T.prototype.oniceconnectionstatechange=null,T.prototype.onconnectionstatechange=null,T.prototype.onicegatheringstatechange=null,T.prototype.onnegotiationneeded=null,T.prototype.ondatachannel=null,T.prototype._dispatchEvent=function(y,C){this._isClosed||(this.dispatchEvent(C),typeof this["on"+y]=="function"&&this["on"+y](C))},T.prototype._emitGatheringStateChange=function(){var y=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",y)},T.prototype.getConfiguration=function(){return this._config},T.prototype.getLocalStreams=function(){return this.localStreams},T.prototype.getRemoteStreams=function(){return this.remoteStreams},T.prototype._createTransceiver=function(y,C){var m=this.transceivers.length>0,M={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:y,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&m)M.iceTransport=this.transceivers[0].iceTransport,M.dtlsTransport=this.transceivers[0].dtlsTransport;else{var R=this._createIceAndDtlsTransports();M.iceTransport=R.iceTransport,M.dtlsTransport=R.dtlsTransport}return C||this.transceivers.push(M),M},T.prototype.addTrack=function(y,C){if(this._isClosed)throw o("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var m;if(this.transceivers.find(function(R){return R.track===y}))throw o("InvalidAccessError","Track already exists.");for(var M=0;M<this.transceivers.length;M++)this.transceivers[M].track||this.transceivers[M].kind!==y.kind||(m=this.transceivers[M]);return m||(m=this._createTransceiver(y.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(C)===-1&&this.localStreams.push(C),m.track=y,m.stream=C,m.rtpSender=new h.RTCRtpSender(y,m.dtlsTransport),m.rtpSender},T.prototype.addStream=function(y){var C=this;if(f>=15025)y.getTracks().forEach(function(M){C.addTrack(M,y)});else{var m=y.clone();y.getTracks().forEach(function(M,R){var I=m.getTracks()[R];M.addEventListener("enabled",function(L){I.enabled=L.enabled})}),m.getTracks().forEach(function(M){C.addTrack(M,m)})}},T.prototype.removeTrack=function(y){if(this._isClosed)throw o("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(y instanceof h.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var C=this.transceivers.find(function(M){return M.rtpSender===y});if(!C)throw o("InvalidAccessError","Sender was not created by this connection.");var m=C.stream;C.rtpSender.stop(),C.rtpSender=null,C.track=null,C.stream=null,this.transceivers.map(function(M){return M.stream}).indexOf(m)===-1&&this.localStreams.indexOf(m)>-1&&this.localStreams.splice(this.localStreams.indexOf(m),1),this._maybeFireNegotiationNeeded()},T.prototype.removeStream=function(y){var C=this;y.getTracks().forEach(function(m){var M=C.getSenders().find(function(R){return R.track===m});M&&C.removeTrack(M)})},T.prototype.getSenders=function(){return this.transceivers.filter(function(y){return!!y.rtpSender}).map(function(y){return y.rtpSender})},T.prototype.getReceivers=function(){return this.transceivers.filter(function(y){return!!y.rtpReceiver}).map(function(y){return y.rtpReceiver})},T.prototype._createIceGatherer=function(y,C){var m=this;if(C&&y>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var M=new h.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(M,"state",{value:"new",writable:!0}),this.transceivers[y].bufferedCandidateEvents=[],this.transceivers[y].bufferCandidates=function(R){var I=!R.candidate||Object.keys(R.candidate).length===0;M.state=I?"completed":"gathering",m.transceivers[y].bufferedCandidateEvents!==null&&m.transceivers[y].bufferedCandidateEvents.push(R)},M.addEventListener("localcandidate",this.transceivers[y].bufferCandidates),M},T.prototype._gather=function(y,C){var m=this,M=this.transceivers[C].iceGatherer;if(!M.onlocalcandidate){var R=this.transceivers[C].bufferedCandidateEvents;this.transceivers[C].bufferedCandidateEvents=null,M.removeEventListener("localcandidate",this.transceivers[C].bufferCandidates),M.onlocalcandidate=function(I){if(!(m.usingBundle&&C>0)){var L=new Event("icecandidate");L.candidate={sdpMid:y,sdpMLineIndex:C};var q=I.candidate,z=!q||Object.keys(q).length===0;if(z)M.state!=="new"&&M.state!=="gathering"||(M.state="completed");else{M.state==="new"&&(M.state="gathering"),q.component=1,q.ufrag=M.getLocalParameters().usernameFragment;var U=r.writeCandidate(q);L.candidate=Object.assign(L.candidate,r.parseCandidate(U)),L.candidate.candidate=U,L.candidate.toJSON=function(){return{candidate:L.candidate.candidate,sdpMid:L.candidate.sdpMid,sdpMLineIndex:L.candidate.sdpMLineIndex,usernameFragment:L.candidate.usernameFragment}}}var H=r.getMediaSections(m._localDescription.sdp);H[L.candidate.sdpMLineIndex]+=z?`a=end-of-candidates\r
`:"a="+L.candidate.candidate+`\r
`,m._localDescription.sdp=r.getDescription(m._localDescription.sdp)+H.join("");var ee=m.transceivers.every(function(ie){return ie.iceGatherer&&ie.iceGatherer.state==="completed"});m.iceGatheringState!=="gathering"&&(m.iceGatheringState="gathering",m._emitGatheringStateChange()),z||m._dispatchEvent("icecandidate",L),ee&&(m._dispatchEvent("icecandidate",new Event("icecandidate")),m.iceGatheringState="complete",m._emitGatheringStateChange())}},h.setTimeout(function(){R.forEach(function(I){M.onlocalcandidate(I)})},0)}},T.prototype._createIceAndDtlsTransports=function(){var y=this,C=new h.RTCIceTransport(null);C.onicestatechange=function(){y._updateIceConnectionState(),y._updateConnectionState()};var m=new h.RTCDtlsTransport(C);return m.ondtlsstatechange=function(){y._updateConnectionState()},m.onerror=function(){Object.defineProperty(m,"state",{value:"failed",writable:!0}),y._updateConnectionState()},{iceTransport:C,dtlsTransport:m}},T.prototype._disposeIceAndDtlsTransports=function(y){var C=this.transceivers[y].iceGatherer;C&&(delete C.onlocalcandidate,delete this.transceivers[y].iceGatherer);var m=this.transceivers[y].iceTransport;m&&(delete m.onicestatechange,delete this.transceivers[y].iceTransport);var M=this.transceivers[y].dtlsTransport;M&&(delete M.ondtlsstatechange,delete M.onerror,delete this.transceivers[y].dtlsTransport)},T.prototype._transceive=function(y,C,m){var M=_(y.localCapabilities,y.remoteCapabilities);C&&y.rtpSender&&(M.encodings=y.sendEncodingParameters,M.rtcp={cname:r.localCName,compound:y.rtcpParameters.compound},y.recvEncodingParameters.length&&(M.rtcp.ssrc=y.recvEncodingParameters[0].ssrc),y.rtpSender.send(M)),m&&y.rtpReceiver&&M.codecs.length>0&&(y.kind==="video"&&y.recvEncodingParameters&&f<15019&&y.recvEncodingParameters.forEach(function(R){delete R.rtx}),y.recvEncodingParameters.length?M.encodings=y.recvEncodingParameters:M.encodings=[{}],M.rtcp={compound:y.rtcpParameters.compound},y.rtcpParameters.cname&&(M.rtcp.cname=y.rtcpParameters.cname),y.sendEncodingParameters.length&&(M.rtcp.ssrc=y.sendEncodingParameters[0].ssrc),y.rtpReceiver.receive(M))},T.prototype.setLocalDescription=function(y){var C,m,M=this;if(["offer","answer"].indexOf(y.type)===-1)return Promise.reject(o("TypeError",'Unsupported type "'+y.type+'"'));if(!g("setLocalDescription",y.type,M.signalingState)||M._isClosed)return Promise.reject(o("InvalidStateError","Can not set local "+y.type+" in state "+M.signalingState));if(y.type==="offer")C=r.splitSections(y.sdp),m=C.shift(),C.forEach(function(I,L){var q=r.parseRtpParameters(I);M.transceivers[L].localCapabilities=q}),M.transceivers.forEach(function(I,L){M._gather(I.mid,L)});else if(y.type==="answer"){C=r.splitSections(M._remoteDescription.sdp),m=C.shift();var R=r.matchPrefix(m,"a=ice-lite").length>0;C.forEach(function(I,L){var q=M.transceivers[L],z=q.iceGatherer,U=q.iceTransport,H=q.dtlsTransport,ee=q.localCapabilities,ie=q.remoteCapabilities;if(!(r.isRejected(I)&&r.matchPrefix(I,"a=bundle-only").length===0)&&!q.rejected){var ae=r.getIceParameters(I,m),$=r.getDtlsParameters(I,m);R&&($.role="server"),M.usingBundle&&L!==0||(M._gather(q.mid,L),U.state==="new"&&U.start(z,ae,R?"controlling":"controlled"),H.state==="new"&&H.start($));var ce=_(ee,ie);M._transceive(q,ce.codecs.length>0,!1)}})}return M._localDescription={type:y.type,sdp:y.sdp},y.type==="offer"?M._updateSignalingState("have-local-offer"):M._updateSignalingState("stable"),Promise.resolve()},T.prototype.setRemoteDescription=function(y){var C=this;if(["offer","answer"].indexOf(y.type)===-1)return Promise.reject(o("TypeError",'Unsupported type "'+y.type+'"'));if(!g("setRemoteDescription",y.type,C.signalingState)||C._isClosed)return Promise.reject(o("InvalidStateError","Can not set remote "+y.type+" in state "+C.signalingState));var m={};C.remoteStreams.forEach(function(U){m[U.id]=U});var M=[],R=r.splitSections(y.sdp),I=R.shift(),L=r.matchPrefix(I,"a=ice-lite").length>0,q=r.matchPrefix(I,"a=group:BUNDLE ").length>0;C.usingBundle=q;var z=r.matchPrefix(I,"a=ice-options:")[0];return C.canTrickleIceCandidates=!!z&&z.substr(14).split(" ").indexOf("trickle")>=0,R.forEach(function(U,H){var ee=r.splitLines(U),ie=r.getKind(U),ae=r.isRejected(U)&&r.matchPrefix(U,"a=bundle-only").length===0,$=ee[0].substr(2).split(" ")[2],ce=r.getDirection(U,I),re=r.parseMsid(U),qe=r.getMid(U)||r.generateIdentifier();if(ae||ie==="application"&&($==="DTLS/SCTP"||$==="UDP/DTLS/SCTP"))C.transceivers[H]={mid:qe,kind:ie,protocol:$,rejected:!0};else{var he,pe,He,ot,_t,lt,kt,Mt,At;!ae&&C.transceivers[H]&&C.transceivers[H].rejected&&(C.transceivers[H]=C._createTransceiver(ie,!0));var Yt,Ln,$n=r.parseRtpParameters(U);ae||(Yt=r.getIceParameters(U,I),(Ln=r.getDtlsParameters(U,I)).role="client"),kt=r.parseRtpEncodingParameters(U);var Tn=r.parseRtcpParameters(U),ys=r.matchPrefix(U,"a=end-of-candidates",I).length>0,Fn=r.matchPrefix(U,"a=candidate:").map(function(Ot){return r.parseCandidate(Ot)}).filter(function(Ot){return Ot.component===1});if((y.type==="offer"||y.type==="answer")&&!ae&&q&&H>0&&C.transceivers[H]&&(C._disposeIceAndDtlsTransports(H),C.transceivers[H].iceGatherer=C.transceivers[0].iceGatherer,C.transceivers[H].iceTransport=C.transceivers[0].iceTransport,C.transceivers[H].dtlsTransport=C.transceivers[0].dtlsTransport,C.transceivers[H].rtpSender&&C.transceivers[H].rtpSender.setTransport(C.transceivers[0].dtlsTransport),C.transceivers[H].rtpReceiver&&C.transceivers[H].rtpReceiver.setTransport(C.transceivers[0].dtlsTransport)),y.type!=="offer"||ae)y.type==="answer"&&!ae&&(pe=(he=C.transceivers[H]).iceGatherer,He=he.iceTransport,ot=he.dtlsTransport,_t=he.rtpReceiver,lt=he.sendEncodingParameters,Mt=he.localCapabilities,C.transceivers[H].recvEncodingParameters=kt,C.transceivers[H].remoteCapabilities=$n,C.transceivers[H].rtcpParameters=Tn,Fn.length&&He.state==="new"&&(!L&&!ys||q&&H!==0?Fn.forEach(function(Ot){S(he.iceTransport,Ot)}):He.setRemoteCandidates(Fn)),q&&H!==0||(He.state==="new"&&He.start(pe,Yt,"controlling"),ot.state==="new"&&ot.start(Ln)),!_(he.localCapabilities,he.remoteCapabilities).codecs.filter(function(Ot){return Ot.name.toLowerCase()==="rtx"}).length&&he.sendEncodingParameters[0].rtx&&delete he.sendEncodingParameters[0].rtx,C._transceive(he,ce==="sendrecv"||ce==="recvonly",ce==="sendrecv"||ce==="sendonly"),!_t||ce!=="sendrecv"&&ce!=="sendonly"?delete he.rtpReceiver:(At=_t.track,re?(m[re.stream]||(m[re.stream]=new h.MediaStream),v(At,m[re.stream]),M.push([At,_t,m[re.stream]])):(m.default||(m.default=new h.MediaStream),v(At,m.default),M.push([At,_t,m.default]))));else{(he=C.transceivers[H]||C._createTransceiver(ie)).mid=qe,he.iceGatherer||(he.iceGatherer=C._createIceGatherer(H,q)),Fn.length&&he.iceTransport.state==="new"&&(!ys||q&&H!==0?Fn.forEach(function(Ot){S(he.iceTransport,Ot)}):he.iceTransport.setRemoteCandidates(Fn)),Mt=h.RTCRtpReceiver.getCapabilities(ie),f<15019&&(Mt.codecs=Mt.codecs.filter(function(Ot){return Ot.name!=="rtx"})),lt=he.sendEncodingParameters||[{ssrc:1001*(2*H+2)}];var Xt,Kn=!1;ce==="sendrecv"||ce==="sendonly"?(Kn=!he.rtpReceiver,_t=he.rtpReceiver||new h.RTCRtpReceiver(he.dtlsTransport,ie),Kn&&(At=_t.track,re&&re.stream==="-"||(re?(m[re.stream]||(m[re.stream]=new h.MediaStream,Object.defineProperty(m[re.stream],"id",{get:function(){return re.stream}})),Object.defineProperty(At,"id",{get:function(){return re.track}}),Xt=m[re.stream]):(m.default||(m.default=new h.MediaStream),Xt=m.default)),Xt&&(v(At,Xt),he.associatedRemoteMediaStreams.push(Xt)),M.push([At,_t,Xt]))):he.rtpReceiver&&he.rtpReceiver.track&&(he.associatedRemoteMediaStreams.forEach(function(Ot){var Pi,bs,mi=Ot.getTracks().find(function(Ze){return Ze.id===he.rtpReceiver.track.id});mi&&(Pi=mi,(bs=Ot).removeTrack(Pi),bs.dispatchEvent(new h.MediaStreamTrackEvent("removetrack",{track:Pi})))}),he.associatedRemoteMediaStreams=[]),he.localCapabilities=Mt,he.remoteCapabilities=$n,he.rtpReceiver=_t,he.rtcpParameters=Tn,he.sendEncodingParameters=lt,he.recvEncodingParameters=kt,C._transceive(C.transceivers[H],!1,Kn)}}}),C._dtlsRole===void 0&&(C._dtlsRole=y.type==="offer"?"active":"passive"),C._remoteDescription={type:y.type,sdp:y.sdp},y.type==="offer"?C._updateSignalingState("have-remote-offer"):C._updateSignalingState("stable"),Object.keys(m).forEach(function(U){var H=m[U];if(H.getTracks().length){if(C.remoteStreams.indexOf(H)===-1){C.remoteStreams.push(H);var ee=new Event("addstream");ee.stream=H,h.setTimeout(function(){C._dispatchEvent("addstream",ee)})}M.forEach(function(ie){var ae=ie[0],$=ie[1];H.id===ie[2].id&&x(C,ae,$,[H])})}}),M.forEach(function(U){U[2]||x(C,U[0],U[1],[])}),h.setTimeout(function(){C&&C.transceivers&&C.transceivers.forEach(function(U){U.iceTransport&&U.iceTransport.state==="new"&&U.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),U.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},T.prototype.close=function(){this.transceivers.forEach(function(y){y.iceTransport&&y.iceTransport.stop(),y.dtlsTransport&&y.dtlsTransport.stop(),y.rtpSender&&y.rtpSender.stop(),y.rtpReceiver&&y.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},T.prototype._updateSignalingState=function(y){this.signalingState=y;var C=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",C)},T.prototype._maybeFireNegotiationNeeded=function(){var y=this;this.signalingState==="stable"&&this.needNegotiation!==!0&&(this.needNegotiation=!0,h.setTimeout(function(){if(y.needNegotiation){y.needNegotiation=!1;var C=new Event("negotiationneeded");y._dispatchEvent("negotiationneeded",C)}},0))},T.prototype._updateIceConnectionState=function(){var y,C={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(M){M.iceTransport&&!M.rejected&&C[M.iceTransport.state]++}),y="new",C.failed>0?y="failed":C.checking>0?y="checking":C.disconnected>0?y="disconnected":C.new>0?y="new":C.connected>0?y="connected":C.completed>0&&(y="completed"),y!==this.iceConnectionState){this.iceConnectionState=y;var m=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",m)}},T.prototype._updateConnectionState=function(){var y,C={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(M){M.iceTransport&&M.dtlsTransport&&!M.rejected&&(C[M.iceTransport.state]++,C[M.dtlsTransport.state]++)}),C.connected+=C.completed,y="new",C.failed>0?y="failed":C.connecting>0?y="connecting":C.disconnected>0?y="disconnected":C.new>0?y="new":C.connected>0&&(y="connected"),y!==this.connectionState){this.connectionState=y;var m=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",m)}},T.prototype.createOffer=function(){var y=this;if(y._isClosed)return Promise.reject(o("InvalidStateError","Can not call createOffer after close"));var C=y.transceivers.filter(function(L){return L.kind==="audio"}).length,m=y.transceivers.filter(function(L){return L.kind==="video"}).length,M=arguments[0];if(M){if(M.mandatory||M.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");M.offerToReceiveAudio!==void 0&&(C=M.offerToReceiveAudio===!0?1:M.offerToReceiveAudio===!1?0:M.offerToReceiveAudio),M.offerToReceiveVideo!==void 0&&(m=M.offerToReceiveVideo===!0?1:M.offerToReceiveVideo===!1?0:M.offerToReceiveVideo)}for(y.transceivers.forEach(function(L){L.kind==="audio"?--C<0&&(L.wantReceive=!1):L.kind==="video"&&--m<0&&(L.wantReceive=!1)});C>0||m>0;)C>0&&(y._createTransceiver("audio"),C--),m>0&&(y._createTransceiver("video"),m--);var R=r.writeSessionBoilerplate(y._sdpSessionId,y._sdpSessionVersion++);y.transceivers.forEach(function(L,q){var z=L.track,U=L.kind,H=L.mid||r.generateIdentifier();L.mid=H,L.iceGatherer||(L.iceGatherer=y._createIceGatherer(q,y.usingBundle));var ee=h.RTCRtpSender.getCapabilities(U);f<15019&&(ee.codecs=ee.codecs.filter(function(ae){return ae.name!=="rtx"})),ee.codecs.forEach(function(ae){ae.name==="H264"&&ae.parameters["level-asymmetry-allowed"]===void 0&&(ae.parameters["level-asymmetry-allowed"]="1"),L.remoteCapabilities&&L.remoteCapabilities.codecs&&L.remoteCapabilities.codecs.forEach(function($){ae.name.toLowerCase()===$.name.toLowerCase()&&ae.clockRate===$.clockRate&&(ae.preferredPayloadType=$.payloadType)})}),ee.headerExtensions.forEach(function(ae){(L.remoteCapabilities&&L.remoteCapabilities.headerExtensions||[]).forEach(function($){ae.uri===$.uri&&(ae.id=$.id)})});var ie=L.sendEncodingParameters||[{ssrc:1001*(2*q+1)}];z&&f>=15019&&U==="video"&&!ie[0].rtx&&(ie[0].rtx={ssrc:ie[0].ssrc+1}),L.wantReceive&&(L.rtpReceiver=new h.RTCRtpReceiver(L.dtlsTransport,U)),L.localCapabilities=ee,L.sendEncodingParameters=ie}),y._config.bundlePolicy!=="max-compat"&&(R+="a=group:BUNDLE "+y.transceivers.map(function(L){return L.mid}).join(" ")+`\r
`),R+=`a=ice-options:trickle\r
`,y.transceivers.forEach(function(L,q){R+=u(L,L.localCapabilities,"offer",L.stream,y._dtlsRole),R+=`a=rtcp-rsize\r
`,!L.iceGatherer||y.iceGatheringState==="new"||q!==0&&y.usingBundle||(L.iceGatherer.getLocalCandidates().forEach(function(z){z.component=1,R+="a="+r.writeCandidate(z)+`\r
`}),L.iceGatherer.state==="completed"&&(R+=`a=end-of-candidates\r
`))});var I=new h.RTCSessionDescription({type:"offer",sdp:R});return Promise.resolve(I)},T.prototype.createAnswer=function(){var y=this;if(y._isClosed)return Promise.reject(o("InvalidStateError","Can not call createAnswer after close"));if(y.signalingState!=="have-remote-offer"&&y.signalingState!=="have-local-pranswer")return Promise.reject(o("InvalidStateError","Can not call createAnswer in signalingState "+y.signalingState));var C=r.writeSessionBoilerplate(y._sdpSessionId,y._sdpSessionVersion++);y.usingBundle&&(C+="a=group:BUNDLE "+y.transceivers.map(function(R){return R.mid}).join(" ")+`\r
`),C+=`a=ice-options:trickle\r
`;var m=r.getMediaSections(y._remoteDescription.sdp).length;y.transceivers.forEach(function(R,I){if(!(I+1>m)){if(R.rejected)return R.kind==="application"?R.protocol==="DTLS/SCTP"?C+=`m=application 0 DTLS/SCTP 5000\r
`:C+="m=application 0 "+R.protocol+` webrtc-datachannel\r
`:R.kind==="audio"?C+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:R.kind==="video"&&(C+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),void(C+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+R.mid+`\r
`);var L;R.stream&&(R.kind==="audio"?L=R.stream.getAudioTracks()[0]:R.kind==="video"&&(L=R.stream.getVideoTracks()[0]),L&&f>=15019&&R.kind==="video"&&!R.sendEncodingParameters[0].rtx&&(R.sendEncodingParameters[0].rtx={ssrc:R.sendEncodingParameters[0].ssrc+1}));var q=_(R.localCapabilities,R.remoteCapabilities);!q.codecs.filter(function(z){return z.name.toLowerCase()==="rtx"}).length&&R.sendEncodingParameters[0].rtx&&delete R.sendEncodingParameters[0].rtx,C+=u(R,q,"answer",R.stream,y._dtlsRole),R.rtcpParameters&&R.rtcpParameters.reducedSize&&(C+=`a=rtcp-rsize\r
`)}});var M=new h.RTCSessionDescription({type:"answer",sdp:C});return Promise.resolve(M)},T.prototype.addIceCandidate=function(y){var C,m=this;return y&&y.sdpMLineIndex===void 0&&!y.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(M,R){if(!m._remoteDescription)return R(o("InvalidStateError","Can not add ICE candidate without a remote description"));if(y&&y.candidate!==""){var I=y.sdpMLineIndex;if(y.sdpMid){for(var L=0;L<m.transceivers.length;L++)if(m.transceivers[L].mid===y.sdpMid){I=L;break}}var q=m.transceivers[I];if(!q)return R(o("OperationError","Can not add ICE candidate"));if(q.rejected)return M();var z=Object.keys(y.candidate).length>0?r.parseCandidate(y.candidate):{};if(z.protocol==="tcp"&&(z.port===0||z.port===9)||z.component&&z.component!==1)return M();if((I===0||I>0&&q.iceTransport!==m.transceivers[0].iceTransport)&&!S(q.iceTransport,z))return R(o("OperationError","Can not add ICE candidate"));var U=y.candidate.trim();U.indexOf("a=")===0&&(U=U.substr(2)),(C=r.getMediaSections(m._remoteDescription.sdp))[I]+="a="+(z.type?U:"end-of-candidates")+`\r
`,m._remoteDescription.sdp=r.getDescription(m._remoteDescription.sdp)+C.join("")}else for(var H=0;H<m.transceivers.length&&(m.transceivers[H].rejected||(m.transceivers[H].iceTransport.addRemoteCandidate({}),(C=r.getMediaSections(m._remoteDescription.sdp))[H]+=`a=end-of-candidates\r
`,m._remoteDescription.sdp=r.getDescription(m._remoteDescription.sdp)+C.join(""),!m.usingBundle));H++);M()})},T.prototype.getStats=function(y){if(y&&y instanceof h.MediaStreamTrack){var C=null;if(this.transceivers.forEach(function(M){M.rtpSender&&M.rtpSender.track===y?C=M.rtpSender:M.rtpReceiver&&M.rtpReceiver.track===y&&(C=M.rtpReceiver)}),!C)throw o("InvalidAccessError","Invalid selector.");return C.getStats()}var m=[];return this.transceivers.forEach(function(M){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(R){M[R]&&m.push(M[R].getStats())})}),Promise.all(m).then(function(M){var R=new Map;return M.forEach(function(I){I.forEach(function(L){R.set(L.id,L)})}),R})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(y){var C=h[y];if(C&&C.prototype&&C.prototype.getStats){var m=C.prototype.getStats;C.prototype.getStats=function(){return m.apply(this).then(function(M){var R=new Map;return Object.keys(M).forEach(function(I){M[I].type=c(M[I]),R.set(I,M[I])}),R})}}});var w=["createOffer","createAnswer"];return w.forEach(function(y){var C=T.prototype[y];T.prototype[y]=function(){var m=arguments;return typeof m[0]=="function"||typeof m[1]=="function"?C.apply(this,[arguments[2]]).then(function(M){typeof m[0]=="function"&&m[0].apply(null,[M])},function(M){typeof m[1]=="function"&&m[1].apply(null,[M])}):C.apply(this,arguments)}}),(w=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(y){var C=T.prototype[y];T.prototype[y]=function(){var m=arguments;return typeof m[1]=="function"||typeof m[2]=="function"?C.apply(this,arguments).then(function(){typeof m[1]=="function"&&m[1].apply(null)},function(M){typeof m[2]=="function"&&m[2].apply(null,[M])}):C.apply(this,arguments)}}),["getStats"].forEach(function(y){var C=T.prototype[y];T.prototype[y]=function(){var m=arguments;return typeof m[1]=="function"?C.apply(this,arguments).then(function(){typeof m[1]=="function"&&m[1].apply(null)}):C.apply(this,arguments)}}),T}},{sdp:"YHvh"}],YdKx:[function(t,n,i){"use strict";function r(c){var u=c&&c.navigator,p=u.mediaDevices.getUserMedia.bind(u.mediaDevices);u.mediaDevices.getUserMedia=function(_){return p(_).catch(function(g){return Promise.reject(function(S){return{name:{PermissionDeniedError:"NotAllowedError"}[S.name]||S.name,message:S.message,constraint:S.constraint,toString:function(){return this.name}}}(g))})}}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=r},{}],P3bV:[function(t,n,i){"use strict";function r(c){"getDisplayMedia"in c.navigator&&c.navigator.mediaDevices&&(c.navigator.mediaDevices&&"getDisplayMedia"in c.navigator.mediaDevices||(c.navigator.mediaDevices.getDisplayMedia=c.navigator.getDisplayMedia.bind(c.navigator)))}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],XRic:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimPeerConnection=h,i.shimReplaceTrack=f,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return p.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return _.shimGetDisplayMedia}});var r=o(t("../utils")),c=t("./filtericeservers"),u=g(t("rtcpeerconnection-shim")),p=t("./getusermedia"),_=t("./getdisplaymedia");function g(v){return v&&v.__esModule?v:{default:v}}function S(){if(typeof WeakMap!="function")return null;var v=new WeakMap;return S=function(){return v},v}function o(v){if(v&&v.__esModule)return v;if(v===null||typeof v!="object"&&typeof v!="function")return{default:v};var x=S();if(x&&x.has(v))return x.get(v);var T={},w=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in v)if(Object.prototype.hasOwnProperty.call(v,y)){var C=w?Object.getOwnPropertyDescriptor(v,y):null;C&&(C.get||C.set)?Object.defineProperty(T,y,C):T[y]=v[y]}return T.default=v,x&&x.set(v,T),T}function h(v){var x=r.detectBrowser(v);if(v.RTCIceGatherer&&(v.RTCIceCandidate||(v.RTCIceCandidate=function(y){return y}),v.RTCSessionDescription||(v.RTCSessionDescription=function(y){return y}),x.version<15025)){var T=Object.getOwnPropertyDescriptor(v.MediaStreamTrack.prototype,"enabled");Object.defineProperty(v.MediaStreamTrack.prototype,"enabled",{set:function(y){T.set.call(this,y);var C=new Event("enabled");C.enabled=y,this.dispatchEvent(C)}})}!v.RTCRtpSender||"dtmf"in v.RTCRtpSender.prototype||Object.defineProperty(v.RTCRtpSender.prototype,"dtmf",{get:function(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new v.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),v.RTCDtmfSender&&!v.RTCDTMFSender&&(v.RTCDTMFSender=v.RTCDtmfSender);var w=(0,u.default)(v,x.version);v.RTCPeerConnection=function(y){return y&&y.iceServers&&(y.iceServers=(0,c.filterIceServers)(y.iceServers,x.version),r.log("ICE servers after filtering:",y.iceServers)),new w(y)},v.RTCPeerConnection.prototype=w.prototype}function f(v){!v.RTCRtpSender||"replaceTrack"in v.RTCRtpSender.prototype||(v.RTCRtpSender.prototype.replaceTrack=v.RTCRtpSender.prototype.setTrack)}},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=_;var r=u(t("../utils"));function c(){if(typeof WeakMap!="function")return null;var g=new WeakMap;return c=function(){return g},g}function u(g){if(g&&g.__esModule)return g;if(g===null||typeof g!="object"&&typeof g!="function")return{default:g};var S=c();if(S&&S.has(g))return S.get(g);var o={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in g)if(Object.prototype.hasOwnProperty.call(g,f)){var v=h?Object.getOwnPropertyDescriptor(g,f):null;v&&(v.get||v.set)?Object.defineProperty(o,f,v):o[f]=g[f]}return o.default=g,S&&S.set(g,o),o}function p(g){return(p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S})(g)}function _(g){var S=r.detectBrowser(g),o=g&&g.navigator,h=g&&g.MediaStreamTrack;if(o.getUserMedia=function(w,y,C){r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(w).then(y,C)},!(S.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){var f=function(w,y,C){y in w&&!(C in w)&&(w[C]=w[y],delete w[y])},v=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(w){return p(w)==="object"&&p(w.audio)==="object"&&(w=JSON.parse(JSON.stringify(w)),f(w.audio,"autoGainControl","mozAutoGainControl"),f(w.audio,"noiseSuppression","mozNoiseSuppression")),v(w)},h&&h.prototype.getSettings){var x=h.prototype.getSettings;h.prototype.getSettings=function(){var w=x.apply(this,arguments);return f(w,"mozAutoGainControl","autoGainControl"),f(w,"mozNoiseSuppression","noiseSuppression"),w}}if(h&&h.prototype.applyConstraints){var T=h.prototype.applyConstraints;h.prototype.applyConstraints=function(w){return this.kind==="audio"&&p(w)==="object"&&(w=JSON.parse(JSON.stringify(w)),f(w,"autoGainControl","mozAutoGainControl"),f(w,"noiseSuppression","mozNoiseSuppression")),T.apply(this,[w])}}}}},{"../utils":"iSxC"}],UuGU:[function(t,n,i){"use strict";function r(c,u){c.navigator.mediaDevices&&"getDisplayMedia"in c.navigator.mediaDevices||c.navigator.mediaDevices&&(c.navigator.mediaDevices.getDisplayMedia=function(p){if(!p||!p.video){var _=new DOMException("getDisplayMedia without video constraints is undefined");return _.name="NotFoundError",_.code=8,Promise.reject(_)}return p.video===!0?p.video={mediaSource:u}:p.video.mediaSource=u,c.navigator.mediaDevices.getUserMedia(p)})}Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=r},{}],Fzdr:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimOnTrack=o,i.shimPeerConnection=h,i.shimSenderGetStats=f,i.shimReceiverGetStats=v,i.shimRemoveStream=x,i.shimRTCDataChannel=T,i.shimAddTransceiver=w,i.shimCreateOffer=y,i.shimCreateAnswer=C,Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return c.shimGetUserMedia}}),Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return u.shimGetDisplayMedia}});var r=_(t("../utils")),c=t("./getusermedia"),u=t("./getdisplaymedia");function p(){if(typeof WeakMap!="function")return null;var m=new WeakMap;return p=function(){return m},m}function _(m){if(m&&m.__esModule)return m;if(m===null||typeof m!="object"&&typeof m!="function")return{default:m};var M=p();if(M&&M.has(m))return M.get(m);var R={},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var L in m)if(Object.prototype.hasOwnProperty.call(m,L)){var q=I?Object.getOwnPropertyDescriptor(m,L):null;q&&(q.get||q.set)?Object.defineProperty(R,L,q):R[L]=m[L]}return R.default=m,M&&M.set(m,R),R}function g(m,M,R){return M in m?Object.defineProperty(m,M,{value:R,enumerable:!0,configurable:!0,writable:!0}):m[M]=R,m}function S(m){return(S=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M})(m)}function o(m){S(m)==="object"&&m.RTCTrackEvent&&"receiver"in m.RTCTrackEvent.prototype&&!("transceiver"in m.RTCTrackEvent.prototype)&&Object.defineProperty(m.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function h(m){var M=r.detectBrowser(m);if(S(m)==="object"&&(m.RTCPeerConnection||m.mozRTCPeerConnection)){if(!m.RTCPeerConnection&&m.mozRTCPeerConnection&&(m.RTCPeerConnection=m.mozRTCPeerConnection),M.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(q){var z=m.RTCPeerConnection.prototype[q],U=g({},q,function(){return arguments[0]=new(q==="addIceCandidate"?m.RTCIceCandidate:m.RTCSessionDescription)(arguments[0]),z.apply(this,arguments)});m.RTCPeerConnection.prototype[q]=U[q]}),M.version<68){var R=m.RTCPeerConnection.prototype.addIceCandidate;m.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&arguments[0].candidate===""?Promise.resolve():R.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var I={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},L=m.RTCPeerConnection.prototype.getStats;m.RTCPeerConnection.prototype.getStats=function(){var[q,z,U]=arguments;return L.apply(this,[q||null]).then(function(H){if(M.version<53&&!z)try{H.forEach(function(ee){ee.type=I[ee.type]||ee.type})}catch(ee){if(ee.name!=="TypeError")throw ee;H.forEach(function(ie,ae){H.set(ae,Object.assign({},ie,{type:I[ie.type]||ie.type}))})}return H}).then(z,U)}}}function f(m){if(S(m)==="object"&&m.RTCPeerConnection&&m.RTCRtpSender&&!(m.RTCRtpSender&&"getStats"in m.RTCRtpSender.prototype)){var M=m.RTCPeerConnection.prototype.getSenders;M&&(m.RTCPeerConnection.prototype.getSenders=function(){var I=this,L=M.apply(this,[]);return L.forEach(function(q){return q._pc=I}),L});var R=m.RTCPeerConnection.prototype.addTrack;R&&(m.RTCPeerConnection.prototype.addTrack=function(){var I=R.apply(this,arguments);return I._pc=this,I}),m.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function v(m){if(S(m)==="object"&&m.RTCPeerConnection&&m.RTCRtpSender&&!(m.RTCRtpSender&&"getStats"in m.RTCRtpReceiver.prototype)){var M=m.RTCPeerConnection.prototype.getReceivers;M&&(m.RTCPeerConnection.prototype.getReceivers=function(){var R=this,I=M.apply(this,[]);return I.forEach(function(L){return L._pc=R}),I}),r.wrapPeerConnectionEvent(m,"track",function(R){return R.receiver._pc=R.srcElement,R}),m.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function x(m){!m.RTCPeerConnection||"removeStream"in m.RTCPeerConnection.prototype||(m.RTCPeerConnection.prototype.removeStream=function(M){var R=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(I){I.track&&M.getTracks().includes(I.track)&&R.removeTrack(I)})})}function T(m){m.DataChannel&&!m.RTCDataChannel&&(m.RTCDataChannel=m.DataChannel)}function w(m){if(S(m)==="object"&&m.RTCPeerConnection){var M=m.RTCPeerConnection.prototype.addTransceiver;M&&(m.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var R=arguments[1],I=R&&"sendEncodings"in R;I&&R.sendEncodings.forEach(function(U){if("rid"in U&&!/^[a-z0-9]{0,16}$/i.test(U.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in U&&!(parseFloat(U.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in U&&!(parseFloat(U.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var L=M.apply(this,arguments);if(I){var{sender:q}=L,z=q.getParameters();"encodings"in z||(z.encodings=R.sendEncodings,this.setParametersPromises.push(q.setParameters(z).catch(function(){})))}return L})}}function y(m){if(S(m)==="object"&&m.RTCPeerConnection){var M=m.RTCPeerConnection.prototype.createOffer;m.RTCPeerConnection.prototype.createOffer=function(){var R=arguments,I=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return M.apply(I,R)}).finally(function(){I.setParametersPromises=[]}):M.apply(this,arguments)}}}function C(m){if(S(m)==="object"&&m.RTCPeerConnection){var M=m.RTCPeerConnection.prototype.createAnswer;m.RTCPeerConnection.prototype.createAnswer=function(){var R=arguments,I=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return M.apply(I,R)}).finally(function(){I.setParametersPromises=[]}):M.apply(this,arguments)}}}},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimLocalStreamsAPI=_,i.shimRemoteStreamsAPI=g,i.shimCallbacksAPI=S,i.shimGetUserMedia=o,i.shimConstraints=h,i.shimRTCIceServerUrls=f,i.shimTrackEventTransceiver=v,i.shimCreateOfferLegacy=x;var r=u(t("../utils"));function c(){if(typeof WeakMap!="function")return null;var T=new WeakMap;return c=function(){return T},T}function u(T){if(T&&T.__esModule)return T;if(T===null||typeof T!="object"&&typeof T!="function")return{default:T};var w=c();if(w&&w.has(T))return w.get(T);var y={},C=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var m in T)if(Object.prototype.hasOwnProperty.call(T,m)){var M=C?Object.getOwnPropertyDescriptor(T,m):null;M&&(M.get||M.set)?Object.defineProperty(y,m,M):y[m]=T[m]}return y.default=T,w&&w.set(T,y),y}function p(T){return(p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w})(T)}function _(T){if(p(T)==="object"&&T.RTCPeerConnection){if("getLocalStreams"in T.RTCPeerConnection.prototype||(T.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in T.RTCPeerConnection.prototype)){var w=T.RTCPeerConnection.prototype.addTrack;T.RTCPeerConnection.prototype.addStream=function(y){var C=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(y)||this._localStreams.push(y),y.getAudioTracks().forEach(function(m){return w.call(C,m,y)}),y.getVideoTracks().forEach(function(m){return w.call(C,m,y)})},T.RTCPeerConnection.prototype.addTrack=function(y){var C=arguments[1];return C&&(this._localStreams?this._localStreams.includes(C)||this._localStreams.push(C):this._localStreams=[C]),w.apply(this,arguments)}}"removeStream"in T.RTCPeerConnection.prototype||(T.RTCPeerConnection.prototype.removeStream=function(y){var C=this;this._localStreams||(this._localStreams=[]);var m=this._localStreams.indexOf(y);if(m!==-1){this._localStreams.splice(m,1);var M=y.getTracks();this.getSenders().forEach(function(R){M.includes(R.track)&&C.removeTrack(R)})}})}}function g(T){if(p(T)==="object"&&T.RTCPeerConnection&&("getRemoteStreams"in T.RTCPeerConnection.prototype||(T.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in T.RTCPeerConnection.prototype))){Object.defineProperty(T.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(y){var C=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=y),this.addEventListener("track",this._onaddstreampoly=function(m){m.streams.forEach(function(M){if(C._remoteStreams||(C._remoteStreams=[]),!C._remoteStreams.includes(M)){C._remoteStreams.push(M);var R=new Event("addstream");R.stream=M,C.dispatchEvent(R)}})})}});var w=T.RTCPeerConnection.prototype.setRemoteDescription;T.RTCPeerConnection.prototype.setRemoteDescription=function(){var y=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(C){C.streams.forEach(function(m){if(y._remoteStreams||(y._remoteStreams=[]),!(y._remoteStreams.indexOf(m)>=0)){y._remoteStreams.push(m);var M=new Event("addstream");M.stream=m,y.dispatchEvent(M)}})}),w.apply(y,arguments)}}}function S(T){if(p(T)==="object"&&T.RTCPeerConnection){var w=T.RTCPeerConnection.prototype,y=w.createOffer,C=w.createAnswer,m=w.setLocalDescription,M=w.setRemoteDescription,R=w.addIceCandidate;w.createOffer=function(L,q){var z=arguments.length>=2?arguments[2]:arguments[0],U=y.apply(this,[z]);return q?(U.then(L,q),Promise.resolve()):U},w.createAnswer=function(L,q){var z=arguments.length>=2?arguments[2]:arguments[0],U=C.apply(this,[z]);return q?(U.then(L,q),Promise.resolve()):U};var I=function(L,q,z){var U=m.apply(this,[L]);return z?(U.then(q,z),Promise.resolve()):U};w.setLocalDescription=I,I=function(L,q,z){var U=M.apply(this,[L]);return z?(U.then(q,z),Promise.resolve()):U},w.setRemoteDescription=I,I=function(L,q,z){var U=R.apply(this,[L]);return z?(U.then(q,z),Promise.resolve()):U},w.addIceCandidate=I}}function o(T){var w=T&&T.navigator;if(w.mediaDevices&&w.mediaDevices.getUserMedia){var y=w.mediaDevices,C=y.getUserMedia.bind(y);w.mediaDevices.getUserMedia=function(m){return C(h(m))}}!w.getUserMedia&&w.mediaDevices&&w.mediaDevices.getUserMedia&&(w.getUserMedia=function(m,M,R){w.mediaDevices.getUserMedia(m).then(M,R)}.bind(w))}function h(T){return T&&T.video!==void 0?Object.assign({},T,{video:r.compactObject(T.video)}):T}function f(T){var w=T.RTCPeerConnection;T.RTCPeerConnection=function(y,C){if(y&&y.iceServers){for(var m=[],M=0;M<y.iceServers.length;M++){var R=y.iceServers[M];!R.hasOwnProperty("urls")&&R.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),(R=JSON.parse(JSON.stringify(R))).urls=R.url,delete R.url,m.push(R)):m.push(y.iceServers[M])}y.iceServers=m}return new w(y,C)},T.RTCPeerConnection.prototype=w.prototype,"generateCertificate"in T.RTCPeerConnection&&Object.defineProperty(T.RTCPeerConnection,"generateCertificate",{get:function(){return w.generateCertificate}})}function v(T){p(T)==="object"&&T.RTCTrackEvent&&"receiver"in T.RTCTrackEvent.prototype&&!("transceiver"in T.RTCTrackEvent.prototype)&&Object.defineProperty(T.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function x(T){var w=T.RTCPeerConnection.prototype.createOffer;T.RTCPeerConnection.prototype.createOffer=function(y){if(y){y.offerToReceiveAudio!==void 0&&(y.offerToReceiveAudio=!!y.offerToReceiveAudio);var C=this.getTransceivers().find(function(M){return M.receiver.track.kind==="audio"});y.offerToReceiveAudio===!1&&C?C.direction==="sendrecv"?C.setDirection?C.setDirection("sendonly"):C.direction="sendonly":C.direction==="recvonly"&&(C.setDirection?C.setDirection("inactive"):C.direction="inactive"):y.offerToReceiveAudio!==!0||C||this.addTransceiver("audio"),y.offerToReceiveVideo!==void 0&&(y.offerToReceiveVideo=!!y.offerToReceiveVideo);var m=this.getTransceivers().find(function(M){return M.receiver.track.kind==="video"});y.offerToReceiveVideo===!1&&m?m.direction==="sendrecv"?m.setDirection?m.setDirection("sendonly"):m.direction="sendonly":m.direction==="recvonly"&&(m.setDirection?m.setDirection("inactive"):m.direction="inactive"):y.offerToReceiveVideo!==!0||m||this.addTransceiver("video")}return w.apply(this,arguments)}}},{"../utils":"iSxC"}],GOQK:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.shimRTCIceCandidate=S,i.shimMaxMessageSize=o,i.shimSendThrowTypeError=h,i.shimConnectionState=f,i.removeAllowExtmapMixed=v;var r=_(t("sdp")),c=p(t("./utils"));function u(){if(typeof WeakMap!="function")return null;var x=new WeakMap;return u=function(){return x},x}function p(x){if(x&&x.__esModule)return x;if(x===null||typeof x!="object"&&typeof x!="function")return{default:x};var T=u();if(T&&T.has(x))return T.get(x);var w={},y=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var C in x)if(Object.prototype.hasOwnProperty.call(x,C)){var m=y?Object.getOwnPropertyDescriptor(x,C):null;m&&(m.get||m.set)?Object.defineProperty(w,C,m):w[C]=x[C]}return w.default=x,T&&T.set(x,w),w}function _(x){return x&&x.__esModule?x:{default:x}}function g(x){return(g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T})(x)}function S(x){if(x.RTCIceCandidate&&!(x.RTCIceCandidate&&"foundation"in x.RTCIceCandidate.prototype)){var T=x.RTCIceCandidate;x.RTCIceCandidate=function(w){if(g(w)==="object"&&w.candidate&&w.candidate.indexOf("a=")===0&&((w=JSON.parse(JSON.stringify(w))).candidate=w.candidate.substr(2)),w.candidate&&w.candidate.length){var y=new T(w),C=r.default.parseCandidate(w.candidate),m=Object.assign(y,C);return m.toJSON=function(){return{candidate:m.candidate,sdpMid:m.sdpMid,sdpMLineIndex:m.sdpMLineIndex,usernameFragment:m.usernameFragment}},m}return new T(w)},x.RTCIceCandidate.prototype=T.prototype,c.wrapPeerConnectionEvent(x,"icecandidate",function(w){return w.candidate&&Object.defineProperty(w,"candidate",{value:new x.RTCIceCandidate(w.candidate),writable:"false"}),w})}}function o(x){if(x.RTCPeerConnection){var T=c.detectBrowser(x);"sctp"in x.RTCPeerConnection.prototype||Object.defineProperty(x.RTCPeerConnection.prototype,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp}});var w=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,T.browser==="chrome"&&T.version>=76){var{sdpSemantics:y}=this.getConfiguration();y==="plan-b"&&Object.defineProperty(this,"sctp",{get:function(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(function(z){if(!z||!z.sdp)return!1;var U=r.default.splitSections(z.sdp);return U.shift(),U.some(function(H){var ee=r.default.parseMLine(H);return ee&&ee.kind==="application"&&ee.protocol.indexOf("SCTP")!==-1})}(arguments[0])){var C,m=function(z){var U=z.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(U===null||U.length<2)return-1;var H=parseInt(U[1],10);return H!=H?-1:H}(arguments[0]),M=(L=m,q=65536,T.browser==="firefox"&&(q=T.version<57?L===-1?16384:2147483637:T.version<60?T.version===57?65535:65536:2147483637),q),R=function(z,U){var H=65536;T.browser==="firefox"&&T.version===57&&(H=65535);var ee=r.default.matchPrefix(z.sdp,"a=max-message-size:");return ee.length>0?H=parseInt(ee[0].substr(19),10):T.browser==="firefox"&&U!==-1&&(H=2147483637),H}(arguments[0],m);C=M===0&&R===0?Number.POSITIVE_INFINITY:M===0||R===0?Math.max(M,R):Math.min(M,R);var I={};Object.defineProperty(I,"maxMessageSize",{get:function(){return C}}),this._sctp=I}var L,q;return w.apply(this,arguments)}}}function h(x){if(x.RTCPeerConnection&&"createDataChannel"in x.RTCPeerConnection.prototype){var T=x.RTCPeerConnection.prototype.createDataChannel;x.RTCPeerConnection.prototype.createDataChannel=function(){var y=T.apply(this,arguments);return w(y,this),y},c.wrapPeerConnectionEvent(x,"datachannel",function(y){return w(y.channel,y.target),y})}function w(y,C){var m=y.send;y.send=function(){var M=arguments[0],R=M.length||M.size||M.byteLength;if(y.readyState==="open"&&C.sctp&&R>C.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+C.sctp.maxMessageSize+" bytes)");return m.apply(y,arguments)}}}function f(x){if(x.RTCPeerConnection&&!("connectionState"in x.RTCPeerConnection.prototype)){var T=x.RTCPeerConnection.prototype;Object.defineProperty(T,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(T,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(w){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),w&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=w)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(w){var y=T[w];T[w]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(C){var m=C.target;if(m._lastConnectionState!==m.connectionState){m._lastConnectionState=m.connectionState;var M=new Event("connectionstatechange",C);m.dispatchEvent(M)}return C},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),y.apply(this,arguments)}})}}function v(x){if(x.RTCPeerConnection){var T=c.detectBrowser(x);if(!(T.browser==="chrome"&&T.version>=71)){var w=x.RTCPeerConnection.prototype.setRemoteDescription;x.RTCPeerConnection.prototype.setRemoteDescription=function(y){return y&&y.sdp&&y.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1&&(y.sdp=y.sdp.split(`
`).filter(function(C){return C.trim()!=="a=extmap-allow-mixed"}).join(`
`)),w.apply(this,arguments)}}}}},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.adapterFactory=h;var r=o(t("./utils")),c=o(t("./chrome/chrome_shim")),u=o(t("./edge/edge_shim")),p=o(t("./firefox/firefox_shim")),_=o(t("./safari/safari_shim")),g=o(t("./common_shim"));function S(){if(typeof WeakMap!="function")return null;var f=new WeakMap;return S=function(){return f},f}function o(f){if(f&&f.__esModule)return f;if(f===null||typeof f!="object"&&typeof f!="function")return{default:f};var v=S();if(v&&v.has(f))return v.get(f);var x={},T=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var w in f)if(Object.prototype.hasOwnProperty.call(f,w)){var y=T?Object.getOwnPropertyDescriptor(f,w):null;y&&(y.get||y.set)?Object.defineProperty(x,w,y):x[w]=f[w]}return x.default=f,v&&v.set(f,x),x}function h(){var{window:f}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},x=r.log,T=r.detectBrowser(f),w={browserDetails:T,commonShim:g,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(T.browser){case"chrome":if(!c||!c.shimPeerConnection||!v.shimChrome)return x("Chrome shim is not included in this adapter release."),w;x("adapter.js shimming chrome."),w.browserShim=c,c.shimGetUserMedia(f),c.shimMediaStream(f),c.shimPeerConnection(f),c.shimOnTrack(f),c.shimAddTrackRemoveTrack(f),c.shimGetSendersWithDtmf(f),c.shimGetStats(f),c.shimSenderReceiverGetStats(f),c.fixNegotiationNeeded(f),g.shimRTCIceCandidate(f),g.shimConnectionState(f),g.shimMaxMessageSize(f),g.shimSendThrowTypeError(f),g.removeAllowExtmapMixed(f);break;case"firefox":if(!p||!p.shimPeerConnection||!v.shimFirefox)return x("Firefox shim is not included in this adapter release."),w;x("adapter.js shimming firefox."),w.browserShim=p,p.shimGetUserMedia(f),p.shimPeerConnection(f),p.shimOnTrack(f),p.shimRemoveStream(f),p.shimSenderGetStats(f),p.shimReceiverGetStats(f),p.shimRTCDataChannel(f),p.shimAddTransceiver(f),p.shimCreateOffer(f),p.shimCreateAnswer(f),g.shimRTCIceCandidate(f),g.shimConnectionState(f),g.shimMaxMessageSize(f),g.shimSendThrowTypeError(f);break;case"edge":if(!u||!u.shimPeerConnection||!v.shimEdge)return x("MS edge shim is not included in this adapter release."),w;x("adapter.js shimming edge."),w.browserShim=u,u.shimGetUserMedia(f),u.shimGetDisplayMedia(f),u.shimPeerConnection(f),u.shimReplaceTrack(f),g.shimMaxMessageSize(f),g.shimSendThrowTypeError(f);break;case"safari":if(!_||!v.shimSafari)return x("Safari shim is not included in this adapter release."),w;x("adapter.js shimming safari."),w.browserShim=_,_.shimRTCIceServerUrls(f),_.shimCreateOfferLegacy(f),_.shimCallbacksAPI(f),_.shimLocalStreamsAPI(f),_.shimRemoteStreamsAPI(f),_.shimTrackEventTransceiver(f),_.shimGetUserMedia(f),g.shimRTCIceCandidate(f),g.shimMaxMessageSize(f),g.shimSendThrowTypeError(f),g.removeAllowExtmapMixed(f);break;default:x("Unsupported browser!")}return w}},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var r=t("./adapter_factory.js"),c=(0,r.adapterFactory)({window}),u=c;i.default=u},{"./adapter_factory.js":"KtlG"}],sXtV:[function(t,n,i){"use strict";var r=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(i,"__esModule",{value:!0});var c=r(t("webrtc-adapter"));i.webRTCAdapter=c.default},{"webrtc-adapter":"tI1X"}],I31f:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./adapter");i.Supports=new(function(){function c(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return c.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection!="undefined"},c.prototype.isBrowserSupported=function(){var u=this.getBrowser(),p=this.getVersion();return!!this.supportedBrowsers.includes(u)&&(u==="chrome"?p>=this.minChromeVersion:u==="firefox"?p>=this.minFirefoxVersion:u==="safari"&&!this.isIOS&&p>=this.minSafariVersion)},c.prototype.getBrowser=function(){return r.webRTCAdapter.browserDetails.browser},c.prototype.getVersion=function(){return r.webRTCAdapter.browserDetails.version||0},c.prototype.isUnifiedPlanSupported=function(){var u,p=this.getBrowser(),_=r.webRTCAdapter.browserDetails.version||0;if(p==="chrome"&&_<72)return!1;if(p==="firefox"&&_>=59)return!0;if(!(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype))return!1;var g=!1;try{(u=new RTCPeerConnection).addTransceiver("audio"),g=!0}catch(S){}finally{u&&u.close()}return g},c.prototype.toString=function(){return`Supports: 
    browser:`+this.getBrowser()+` 
    version:`+this.getVersion()+` 
    isIOS:`+this.isIOS+` 
    isWebRTCSupported:`+this.isWebRTCSupported()+` 
    isBrowserSupported:`+this.isBrowserSupported()+` 
    isUnifiedPlanSupported:`+this.isUnifiedPlanSupported()},c}())},{"./adapter":"sXtV"}],BHXf:[function(t,n,i){"use strict";var r=this&&this.__importStar||function(_){if(_&&_.__esModule)return _;var g={};if(_!=null)for(var S in _)Object.hasOwnProperty.call(_,S)&&(g[S]=_[S]);return g.default=_,g};Object.defineProperty(i,"__esModule",{value:!0});var c=r(t("peerjs-js-binarypack")),u=t("./supports"),p={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};i.util=new(function(){function _(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=p,this.browser=u.Supports.getBrowser(),this.browserVersion=u.Supports.getVersion(),this.supports=function(){var g,S={browser:u.Supports.isBrowserSupported(),webRTC:u.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!S.webRTC)return S;try{g=new RTCPeerConnection(p),S.audioVideo=!0;var o=void 0;try{o=g.createDataChannel("_PEERJSTEST",{ordered:!0}),S.data=!0,S.reliable=!!o.ordered;try{o.binaryType="blob",S.binaryBlob=!u.Supports.isIOS}catch(h){}}catch(h){}finally{o&&o.close()}}catch(h){}finally{g&&g.close()}return S}(),this.pack=c.pack,this.unpack=c.unpack,this._dataCount=1}return _.prototype.noop=function(){},_.prototype.validateId=function(g){return!g||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(g)},_.prototype.chunk=function(g){for(var S=[],o=g.size,h=Math.ceil(o/i.util.chunkedMTU),f=0,v=0;v<o;){var x=Math.min(o,v+i.util.chunkedMTU),T=g.slice(v,x),w={__peerData:this._dataCount,n:f,data:T,total:h};S.push(w),v=x,f++}return this._dataCount++,S},_.prototype.blobToArrayBuffer=function(g,S){var o=new FileReader;return o.onload=function(h){h.target&&S(h.target.result)},o.readAsArrayBuffer(g),o},_.prototype.binaryStringToArrayBuffer=function(g){for(var S=new Uint8Array(g.length),o=0;o<g.length;o++)S[o]=255&g.charCodeAt(o);return S.buffer},_.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},_.prototype.isSecure=function(){return location.protocol==="https:"},_}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(t,n,i){"use strict";var r=Object.prototype.hasOwnProperty,c="~";function u(){}function p(o,h,f){this.fn=o,this.context=h,this.once=f||!1}function _(o,h,f,v,x){if(typeof f!="function")throw new TypeError("The listener must be a function");var T=new p(f,v||o,x),w=c?c+h:h;return o._events[w]?o._events[w].fn?o._events[w]=[o._events[w],T]:o._events[w].push(T):(o._events[w]=T,o._eventsCount++),o}function g(o,h){--o._eventsCount==0?o._events=new u:delete o._events[h]}function S(){this._events=new u,this._eventsCount=0}Object.create&&(u.prototype=Object.create(null),new u().__proto__||(c=!1)),S.prototype.eventNames=function(){var o,h,f=[];if(this._eventsCount===0)return f;for(h in o=this._events)r.call(o,h)&&f.push(c?h.slice(1):h);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(o)):f},S.prototype.listeners=function(o){var h=c?c+o:o,f=this._events[h];if(!f)return[];if(f.fn)return[f.fn];for(var v=0,x=f.length,T=new Array(x);v<x;v++)T[v]=f[v].fn;return T},S.prototype.listenerCount=function(o){var h=c?c+o:o,f=this._events[h];return f?f.fn?1:f.length:0},S.prototype.emit=function(o,h,f,v,x,T){var w=c?c+o:o;if(!this._events[w])return!1;var y,C,m=this._events[w],M=arguments.length;if(m.fn){switch(m.once&&this.removeListener(o,m.fn,void 0,!0),M){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,f),!0;case 4:return m.fn.call(m.context,h,f,v),!0;case 5:return m.fn.call(m.context,h,f,v,x),!0;case 6:return m.fn.call(m.context,h,f,v,x,T),!0}for(C=1,y=new Array(M-1);C<M;C++)y[C-1]=arguments[C];m.fn.apply(m.context,y)}else{var R,I=m.length;for(C=0;C<I;C++)switch(m[C].once&&this.removeListener(o,m[C].fn,void 0,!0),M){case 1:m[C].fn.call(m[C].context);break;case 2:m[C].fn.call(m[C].context,h);break;case 3:m[C].fn.call(m[C].context,h,f);break;case 4:m[C].fn.call(m[C].context,h,f,v);break;default:if(!y)for(R=1,y=new Array(M-1);R<M;R++)y[R-1]=arguments[R];m[C].fn.apply(m[C].context,y)}}return!0},S.prototype.on=function(o,h,f){return _(this,o,h,f,!1)},S.prototype.once=function(o,h,f){return _(this,o,h,f,!0)},S.prototype.removeListener=function(o,h,f,v){var x=c?c+o:o;if(!this._events[x])return this;if(!h)return g(this,x),this;var T=this._events[x];if(T.fn)T.fn!==h||v&&!T.once||f&&T.context!==f||g(this,x);else{for(var w=0,y=[],C=T.length;w<C;w++)(T[w].fn!==h||v&&!T[w].once||f&&T[w].context!==f)&&y.push(T[w]);y.length?this._events[x]=y.length===1?y[0]:y:g(this,x)}return this},S.prototype.removeAllListeners=function(o){var h;return o?(h=c?c+o:o,this._events[h]&&g(this,h)):(this._events=new u,this._eventsCount=0),this},S.prototype.off=S.prototype.removeListener,S.prototype.addListener=S.prototype.on,S.prefixed=c,S.EventEmitter=S,typeof n!="undefined"&&(n.exports=S)},{}],WOs9:[function(t,n,i){"use strict";var r=this&&this.__read||function(g,S){var o=typeof Symbol=="function"&&g[Symbol.iterator];if(!o)return g;var h,f,v=o.call(g),x=[];try{for(;(S===void 0||S-- >0)&&!(h=v.next()).done;)x.push(h.value)}catch(T){f={error:T}}finally{try{h&&!h.done&&(o=v.return)&&o.call(v)}finally{if(f)throw f.error}}return x},c=this&&this.__spread||function(){for(var g=[],S=0;S<arguments.length;S++)g=g.concat(r(arguments[S]));return g};Object.defineProperty(i,"__esModule",{value:!0});var u,p="PeerJS: ";(function(g){g[g.Disabled=0]="Disabled",g[g.Errors=1]="Errors",g[g.Warnings=2]="Warnings",g[g.All=3]="All"})(u=i.LogLevel||(i.LogLevel={}));var _=function(){function g(){this._logLevel=u.Disabled}return Object.defineProperty(g.prototype,"logLevel",{get:function(){return this._logLevel},set:function(S){this._logLevel=S},enumerable:!0,configurable:!0}),g.prototype.log=function(){for(var S=[],o=0;o<arguments.length;o++)S[o]=arguments[o];this._logLevel>=u.All&&this._print.apply(this,c([u.All],S))},g.prototype.warn=function(){for(var S=[],o=0;o<arguments.length;o++)S[o]=arguments[o];this._logLevel>=u.Warnings&&this._print.apply(this,c([u.Warnings],S))},g.prototype.error=function(){for(var S=[],o=0;o<arguments.length;o++)S[o]=arguments[o];this._logLevel>=u.Errors&&this._print.apply(this,c([u.Errors],S))},g.prototype.setLogFunction=function(S){this._print=S},g.prototype._print=function(S){for(var o=[],h=1;h<arguments.length;h++)o[h-1]=arguments[h];var f=c([p],o);for(var v in f)f[v]instanceof Error&&(f[v]="("+f[v].name+") "+f[v].message);S>=u.All?console.log.apply(console,c(f)):S>=u.Warnings?console.warn.apply(console,c(["WARNING"],f)):S>=u.Errors&&console.error.apply(console,c(["ERROR"],f))},g}();i.default=new _},{}],ZRYf:[function(t,n,i){"use strict";var r,c,u,p,_,g,S;Object.defineProperty(i,"__esModule",{value:!0}),function(o){o.Open="open",o.Stream="stream",o.Data="data",o.Close="close",o.Error="error",o.IceStateChanged="iceStateChanged"}(r=i.ConnectionEventType||(i.ConnectionEventType={})),function(o){o.Data="data",o.Media="media"}(c=i.ConnectionType||(i.ConnectionType={})),function(o){o.Open="open",o.Close="close",o.Connection="connection",o.Call="call",o.Disconnected="disconnected",o.Error="error"}(u=i.PeerEventType||(i.PeerEventType={})),function(o){o.BrowserIncompatible="browser-incompatible",o.Disconnected="disconnected",o.InvalidID="invalid-id",o.InvalidKey="invalid-key",o.Network="network",o.PeerUnavailable="peer-unavailable",o.SslUnavailable="ssl-unavailable",o.ServerError="server-error",o.SocketError="socket-error",o.SocketClosed="socket-closed",o.UnavailableID="unavailable-id",o.WebRTC="webrtc"}(p=i.PeerErrorType||(i.PeerErrorType={})),function(o){o.Binary="binary",o.BinaryUTF8="binary-utf8",o.JSON="json"}(_=i.SerializationType||(i.SerializationType={})),function(o){o.Message="message",o.Disconnected="disconnected",o.Error="error",o.Close="close"}(g=i.SocketEventType||(i.SocketEventType={})),function(o){o.Heartbeat="HEARTBEAT",o.Candidate="CANDIDATE",o.Offer="OFFER",o.Answer="ANSWER",o.Open="OPEN",o.Error="ERROR",o.IdTaken="ID-TAKEN",o.InvalidKey="INVALID-KEY",o.Leave="LEAVE",o.Expire="EXPIRE"}(S=i.ServerMessageType||(i.ServerMessageType={}))},{}],wJlv:[function(t,n,i){"use strict";var r=this&&this.__extends||function(){var f=function(v,x){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(T,w){T.__proto__=w}||function(T,w){for(var y in w)w.hasOwnProperty(y)&&(T[y]=w[y])})(v,x)};return function(v,x){function T(){this.constructor=v}f(v,x),v.prototype=x===null?Object.create(x):(T.prototype=x.prototype,new T)}}(),c=this&&this.__read||function(f,v){var x=typeof Symbol=="function"&&f[Symbol.iterator];if(!x)return f;var T,w,y=x.call(f),C=[];try{for(;(v===void 0||v-- >0)&&!(T=y.next()).done;)C.push(T.value)}catch(m){w={error:m}}finally{try{T&&!T.done&&(x=y.return)&&x.call(y)}finally{if(w)throw w.error}}return C},u=this&&this.__spread||function(){for(var f=[],v=0;v<arguments.length;v++)f=f.concat(c(arguments[v]));return f},p=this&&this.__values||function(f){var v=typeof Symbol=="function"&&Symbol.iterator,x=v&&f[v],T=0;if(x)return x.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&T>=f.length&&(f=void 0),{value:f&&f[T++],done:!f}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")},_=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(i,"__esModule",{value:!0});var g=t("eventemitter3"),S=_(t("./logger")),o=t("./enums"),h=function(f){function v(x,T,w,y,C,m){m===void 0&&(m=5e3);var M=f.call(this)||this;M.pingInterval=m,M._disconnected=!0,M._messagesQueue=[];var R=x?"wss://":"ws://";return M._baseUrl=R+T+":"+w+y+"peerjs?key="+C,M}return r(v,f),v.prototype.start=function(x,T){var w=this;this._id=x;var y=this._baseUrl+"&id="+x+"&token="+T;!this._socket&&this._disconnected&&(this._socket=new WebSocket(y),this._disconnected=!1,this._socket.onmessage=function(C){var m;try{m=JSON.parse(C.data),S.default.log("Server message received:",m)}catch(M){return void S.default.log("Invalid server message",C.data)}w.emit(o.SocketEventType.Message,m)},this._socket.onclose=function(C){w._disconnected||(S.default.log("Socket closed.",C),w._cleanup(),w._disconnected=!0,w.emit(o.SocketEventType.Disconnected))},this._socket.onopen=function(){w._disconnected||(w._sendQueuedMessages(),S.default.log("Socket open"),w._scheduleHeartbeat())})},v.prototype._scheduleHeartbeat=function(){var x=this;this._wsPingTimer=setTimeout(function(){x._sendHeartbeat()},this.pingInterval)},v.prototype._sendHeartbeat=function(){if(this._wsOpen()){var x=JSON.stringify({type:o.ServerMessageType.Heartbeat});this._socket.send(x),this._scheduleHeartbeat()}else S.default.log("Cannot send heartbeat, because socket closed")},v.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},v.prototype._sendQueuedMessages=function(){var x,T,w=u(this._messagesQueue);this._messagesQueue=[];try{for(var y=p(w),C=y.next();!C.done;C=y.next()){var m=C.value;this.send(m)}}catch(M){x={error:M}}finally{try{C&&!C.done&&(T=y.return)&&T.call(y)}finally{if(x)throw x.error}}},v.prototype.send=function(x){if(!this._disconnected)if(this._id)if(x.type){if(this._wsOpen()){var T=JSON.stringify(x);this._socket.send(T)}}else this.emit(o.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(x)},v.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},v.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},v}(g.EventEmitter);i.Socket=h},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(t,n,i){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(h){for(var f,v=1,x=arguments.length;v<x;v++)for(var T in f=arguments[v])Object.prototype.hasOwnProperty.call(f,T)&&(h[T]=f[T]);return h}).apply(this,arguments)},c=this&&this.__awaiter||function(h,f,v,x){return new(v||(v=Promise))(function(T,w){function y(M){try{m(x.next(M))}catch(R){w(R)}}function C(M){try{m(x.throw(M))}catch(R){w(R)}}function m(M){var R;M.done?T(M.value):(R=M.value,R instanceof v?R:new v(function(I){I(R)})).then(y,C)}m((x=x.apply(h,f||[])).next())})},u=this&&this.__generator||function(h,f){var v,x,T,w,y={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]};return w={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function C(m){return function(M){return function(R){if(v)throw new TypeError("Generator is already executing.");for(;y;)try{if(v=1,x&&(T=2&R[0]?x.return:R[0]?x.throw||((T=x.return)&&T.call(x),0):x.next)&&!(T=T.call(x,R[1])).done)return T;switch(x=0,T&&(R=[2&R[0],T.value]),R[0]){case 0:case 1:T=R;break;case 4:return y.label++,{value:R[1],done:!1};case 5:y.label++,x=R[1],R=[0];continue;case 7:R=y.ops.pop(),y.trys.pop();continue;default:if(!(T=(T=y.trys).length>0&&T[T.length-1])&&(R[0]===6||R[0]===2)){y=0;continue}if(R[0]===3&&(!T||R[1]>T[0]&&R[1]<T[3])){y.label=R[1];break}if(R[0]===6&&y.label<T[1]){y.label=T[1],T=R;break}if(T&&y.label<T[2]){y.label=T[2],y.ops.push(R);break}T[2]&&y.ops.pop(),y.trys.pop();continue}R=f.call(h,y)}catch(I){R=[6,I],x=0}finally{v=T=0}if(5&R[0])throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}([m,M])}}},p=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(i,"__esModule",{value:!0});var _=t("./util"),g=p(t("./logger")),S=t("./enums"),o=function(){function h(f){this.connection=f}return h.prototype.startConnection=function(f){var v=this._startPeerConnection();if(this.connection.peerConnection=v,this.connection.type===S.ConnectionType.Media&&f._stream&&this._addTracksToConnection(f._stream,v),f.originator){if(this.connection.type===S.ConnectionType.Data){var x=this.connection,T={ordered:!!f.reliable},w=v.createDataChannel(x.label,T);x.initialize(w)}this._makeOffer()}else this.handleSDP("OFFER",f.sdp)},h.prototype._startPeerConnection=function(){g.default.log("Creating RTCPeerConnection.");var f=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(f),f},h.prototype._setupListeners=function(f){var v=this,x=this.connection.peer,T=this.connection.connectionId,w=this.connection.type,y=this.connection.provider;g.default.log("Listening for ICE candidates."),f.onicecandidate=function(C){C.candidate&&C.candidate.candidate&&(g.default.log("Received ICE candidates for "+x+":",C.candidate),y.socket.send({type:S.ServerMessageType.Candidate,payload:{candidate:C.candidate,type:w,connectionId:T},dst:x}))},f.oniceconnectionstatechange=function(){switch(f.iceConnectionState){case"failed":g.default.log("iceConnectionState is failed, closing connections to "+x),v.connection.emit(S.ConnectionEventType.Error,new Error("Negotiation of connection to "+x+" failed.")),v.connection.close();break;case"closed":g.default.log("iceConnectionState is closed, closing connections to "+x),v.connection.emit(S.ConnectionEventType.Error,new Error("Connection to "+x+" closed.")),v.connection.close();break;case"disconnected":g.default.log("iceConnectionState changed to disconnected on the connection with "+x);break;case"completed":f.onicecandidate=_.util.noop}v.connection.emit(S.ConnectionEventType.IceStateChanged,f.iceConnectionState)},g.default.log("Listening for data channel"),f.ondatachannel=function(C){g.default.log("Received data channel");var m=C.channel;y.getConnection(x,T).initialize(m)},g.default.log("Listening for remote stream"),f.ontrack=function(C){g.default.log("Received remote stream");var m=C.streams[0],M=y.getConnection(x,T);if(M.type===S.ConnectionType.Media){var R=M;v._addStreamToMediaConnection(m,R)}}},h.prototype.cleanup=function(){g.default.log("Cleaning up PeerConnection to "+this.connection.peer);var f=this.connection.peerConnection;if(f){this.connection.peerConnection=null,f.onicecandidate=f.oniceconnectionstatechange=f.ondatachannel=f.ontrack=function(){};var v=f.signalingState!=="closed",x=!1;if(this.connection.type===S.ConnectionType.Data){var T=this.connection.dataChannel;T&&(x=!!T.readyState&&T.readyState!=="closed")}(v||x)&&f.close()}},h.prototype._makeOffer=function(){return c(this,void 0,Promise,function(){var f,v,x,T,w,y,C;return u(this,function(m){switch(m.label){case 0:f=this.connection.peerConnection,v=this.connection.provider,m.label=1;case 1:return m.trys.push([1,7,,8]),[4,f.createOffer(this.connection.options.constraints)];case 2:x=m.sent(),g.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(x.sdp=this.connection.options.sdpTransform(x.sdp)||x.sdp),m.label=3;case 3:return m.trys.push([3,5,,6]),[4,f.setLocalDescription(x)];case 4:return m.sent(),g.default.log("Set localDescription:",x,"for:"+this.connection.peer),T={sdp:x,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:_.util.browser},this.connection.type===S.ConnectionType.Data&&(w=this.connection,T=r(r({},T),{label:w.label,reliable:w.reliable,serialization:w.serialization})),v.socket.send({type:S.ServerMessageType.Offer,payload:T,dst:this.connection.peer}),[3,6];case 5:return(y=m.sent())!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(v.emitError(S.PeerErrorType.WebRTC,y),g.default.log("Failed to setLocalDescription, ",y)),[3,6];case 6:return[3,8];case 7:return C=m.sent(),v.emitError(S.PeerErrorType.WebRTC,C),g.default.log("Failed to createOffer, ",C),[3,8];case 8:return[2]}})})},h.prototype._makeAnswer=function(){return c(this,void 0,Promise,function(){var f,v,x,T,w;return u(this,function(y){switch(y.label){case 0:f=this.connection.peerConnection,v=this.connection.provider,y.label=1;case 1:return y.trys.push([1,7,,8]),[4,f.createAnswer()];case 2:x=y.sent(),g.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(x.sdp=this.connection.options.sdpTransform(x.sdp)||x.sdp),y.label=3;case 3:return y.trys.push([3,5,,6]),[4,f.setLocalDescription(x)];case 4:return y.sent(),g.default.log("Set localDescription:",x,"for:"+this.connection.peer),v.socket.send({type:S.ServerMessageType.Answer,payload:{sdp:x,type:this.connection.type,connectionId:this.connection.connectionId,browser:_.util.browser},dst:this.connection.peer}),[3,6];case 5:return T=y.sent(),v.emitError(S.PeerErrorType.WebRTC,T),g.default.log("Failed to setLocalDescription, ",T),[3,6];case 6:return[3,8];case 7:return w=y.sent(),v.emitError(S.PeerErrorType.WebRTC,w),g.default.log("Failed to create answer, ",w),[3,8];case 8:return[2]}})})},h.prototype.handleSDP=function(f,v){return c(this,void 0,Promise,function(){var x,T,w,y;return u(this,function(C){switch(C.label){case 0:v=new RTCSessionDescription(v),x=this.connection.peerConnection,T=this.connection.provider,g.default.log("Setting remote description",v),w=this,C.label=1;case 1:return C.trys.push([1,5,,6]),[4,x.setRemoteDescription(v)];case 2:return C.sent(),g.default.log("Set remoteDescription:"+f+" for:"+this.connection.peer),f!=="OFFER"?[3,4]:[4,w._makeAnswer()];case 3:C.sent(),C.label=4;case 4:return[3,6];case 5:return y=C.sent(),T.emitError(S.PeerErrorType.WebRTC,y),g.default.log("Failed to setRemoteDescription, ",y),[3,6];case 6:return[2]}})})},h.prototype.handleCandidate=function(f){return c(this,void 0,Promise,function(){var v,x,T,w,y,C;return u(this,function(m){switch(m.label){case 0:g.default.log("handleCandidate:",f),v=f.candidate,x=f.sdpMLineIndex,T=f.sdpMid,w=this.connection.peerConnection,y=this.connection.provider,m.label=1;case 1:return m.trys.push([1,3,,4]),[4,w.addIceCandidate(new RTCIceCandidate({sdpMid:T,sdpMLineIndex:x,candidate:v}))];case 2:return m.sent(),g.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return C=m.sent(),y.emitError(S.PeerErrorType.WebRTC,C),g.default.log("Failed to handleCandidate, ",C),[3,4];case 4:return[2]}})})},h.prototype._addTracksToConnection=function(f,v){if(g.default.log("add tracks from stream "+f.id+" to peer connection"),!v.addTrack)return g.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");f.getTracks().forEach(function(x){v.addTrack(x,f)})},h.prototype._addStreamToMediaConnection=function(f,v){g.default.log("add stream "+f.id+" to media connection "+v.connectionId),v.addStream(f)},h}();i.Negotiator=o},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(t,n,i){"use strict";var r=this&&this.__extends||function(){var p=function(_,g){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,o){S.__proto__=o}||function(S,o){for(var h in o)o.hasOwnProperty(h)&&(S[h]=o[h])})(_,g)};return function(_,g){function S(){this.constructor=_}p(_,g),_.prototype=g===null?Object.create(g):(S.prototype=g.prototype,new S)}}();Object.defineProperty(i,"__esModule",{value:!0});var c=t("eventemitter3"),u=function(p){function _(g,S,o){var h=p.call(this)||this;return h.peer=g,h.provider=S,h.options=o,h._open=!1,h.metadata=o.metadata,h}return r(_,p),Object.defineProperty(_.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),_}(c.EventEmitter);i.BaseConnection=u},{eventemitter3:"JJlS"}],dbHP:[function(t,n,i){"use strict";var r=this&&this.__extends||function(){var v=function(x,T){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,y){w.__proto__=y}||function(w,y){for(var C in y)y.hasOwnProperty(C)&&(w[C]=y[C])})(x,T)};return function(x,T){function w(){this.constructor=x}v(x,T),x.prototype=T===null?Object.create(T):(w.prototype=T.prototype,new w)}}(),c=this&&this.__assign||function(){return(c=Object.assign||function(v){for(var x,T=1,w=arguments.length;T<w;T++)for(var y in x=arguments[T])Object.prototype.hasOwnProperty.call(x,y)&&(v[y]=x[y]);return v}).apply(this,arguments)},u=this&&this.__values||function(v){var x=typeof Symbol=="function"&&Symbol.iterator,T=x&&v[x],w=0;if(T)return T.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&w>=v.length&&(v=void 0),{value:v&&v[w++],done:!v}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},p=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(i,"__esModule",{value:!0});var _=t("./util"),g=p(t("./logger")),S=t("./negotiator"),o=t("./enums"),h=t("./baseconnection"),f=function(v){function x(T,w,y){var C=v.call(this,T,w,y)||this;return C._localStream=C.options._stream,C.connectionId=C.options.connectionId||x.ID_PREFIX+_.util.randomToken(),C._negotiator=new S.Negotiator(C),C._localStream&&C._negotiator.startConnection({_stream:C._localStream,originator:!0}),C}return r(x,v),Object.defineProperty(x.prototype,"type",{get:function(){return o.ConnectionType.Media},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"localStream",{get:function(){return this._localStream},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!0,configurable:!0}),x.prototype.addStream=function(T){g.default.log("Receiving stream",T),this._remoteStream=T,v.prototype.emit.call(this,o.ConnectionEventType.Stream,T)},x.prototype.handleMessage=function(T){var w=T.type,y=T.payload;switch(T.type){case o.ServerMessageType.Answer:this._negotiator.handleSDP(w,y.sdp),this._open=!0;break;case o.ServerMessageType.Candidate:this._negotiator.handleCandidate(y.candidate);break;default:g.default.warn("Unrecognized message type:"+w+" from peer:"+this.peer)}},x.prototype.answer=function(T,w){var y,C;if(w===void 0&&(w={}),this._localStream)g.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=T,w&&w.sdpTransform&&(this.options.sdpTransform=w.sdpTransform),this._negotiator.startConnection(c(c({},this.options._payload),{_stream:T}));var m=this.provider._getMessages(this.connectionId);try{for(var M=u(m),R=M.next();!R.done;R=M.next()){var I=R.value;this.handleMessage(I)}}catch(L){y={error:L}}finally{try{R&&!R.done&&(C=M.return)&&C.call(M)}finally{if(y)throw y.error}}this._open=!0}},x.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,v.prototype.emit.call(this,o.ConnectionEventType.Close))},x.ID_PREFIX="mc_",x}(h.BaseConnection);i.MediaConnection=f},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(t,n,i){"use strict";var r=this&&this.__extends||function(){var g=function(S,o){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,f){h.__proto__=f}||function(h,f){for(var v in f)f.hasOwnProperty(v)&&(h[v]=f[v])})(S,o)};return function(S,o){function h(){this.constructor=S}g(S,o),S.prototype=o===null?Object.create(o):(h.prototype=o.prototype,new h)}}(),c=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(i,"__esModule",{value:!0});var u=t("eventemitter3"),p=c(t("./logger")),_=function(g){function S(){var o=g.call(this)||this;return o.fileReader=new FileReader,o._queue=[],o._processing=!1,o.fileReader.onload=function(h){o._processing=!1,h.target&&o.emit("done",h.target.result),o.doNextTask()},o.fileReader.onerror=function(h){p.default.error("EncodingQueue error:",h),o._processing=!1,o.destroy(),o.emit("error",h)},o}return r(S,g),Object.defineProperty(S.prototype,"queue",{get:function(){return this._queue},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"size",{get:function(){return this.queue.length},enumerable:!0,configurable:!0}),Object.defineProperty(S.prototype,"processing",{get:function(){return this._processing},enumerable:!0,configurable:!0}),S.prototype.enque=function(o){this.queue.push(o),this.processing||this.doNextTask()},S.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},S.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},S}(u.EventEmitter);i.EncodingQueue=_},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(t,n,i){"use strict";var r=this&&this.__extends||function(){var v=function(x,T){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,y){w.__proto__=y}||function(w,y){for(var C in y)y.hasOwnProperty(C)&&(w[C]=y[C])})(x,T)};return function(x,T){function w(){this.constructor=x}v(x,T),x.prototype=T===null?Object.create(T):(w.prototype=T.prototype,new w)}}(),c=this&&this.__values||function(v){var x=typeof Symbol=="function"&&Symbol.iterator,T=x&&v[x],w=0;if(T)return T.call(v);if(v&&typeof v.length=="number")return{next:function(){return v&&w>=v.length&&(v=void 0),{value:v&&v[w++],done:!v}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},u=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(i,"__esModule",{value:!0});var p=t("./util"),_=u(t("./logger")),g=t("./negotiator"),S=t("./enums"),o=t("./baseconnection"),h=t("./encodingQueue"),f=function(v){function x(T,w,y){var C=v.call(this,T,w,y)||this;return C.stringify=JSON.stringify,C.parse=JSON.parse,C._buffer=[],C._bufferSize=0,C._buffering=!1,C._chunkedData={},C._encodingQueue=new h.EncodingQueue,C.connectionId=C.options.connectionId||x.ID_PREFIX+p.util.randomToken(),C.label=C.options.label||C.connectionId,C.serialization=C.options.serialization||S.SerializationType.Binary,C.reliable=!!C.options.reliable,C._encodingQueue.on("done",function(m){C._bufferedSend(m)}),C._encodingQueue.on("error",function(){_.default.error("DC#"+C.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),C.close()}),C._negotiator=new g.Negotiator(C),C._negotiator.startConnection(C.options._payload||{originator:!0}),C}return r(x,v),Object.defineProperty(x.prototype,"type",{get:function(){return S.ConnectionType.Data},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!0,configurable:!0}),x.prototype.initialize=function(T){this._dc=T,this._configureDataChannel()},x.prototype._configureDataChannel=function(){var T=this;p.util.supports.binaryBlob&&!p.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){_.default.log("DC#"+T.connectionId+" dc connection success"),T._open=!0,T.emit(S.ConnectionEventType.Open)},this.dataChannel.onmessage=function(w){_.default.log("DC#"+T.connectionId+" dc onmessage:",w.data),T._handleDataMessage(w)},this.dataChannel.onclose=function(){_.default.log("DC#"+T.connectionId+" dc closed for:",T.peer),T.close()}},x.prototype._handleDataMessage=function(T){var w=this,y=T.data,C=y.constructor,m=y;if(this.serialization===S.SerializationType.Binary||this.serialization===S.SerializationType.BinaryUTF8){if(C===Blob)return void p.util.blobToArrayBuffer(y,function(R){var I=p.util.unpack(R);w.emit(S.ConnectionEventType.Data,I)});if(C===ArrayBuffer)m=p.util.unpack(y);else if(C===String){var M=p.util.binaryStringToArrayBuffer(y);m=p.util.unpack(M)}}else this.serialization===S.SerializationType.JSON&&(m=this.parse(y));m.__peerData?this._handleChunk(m):v.prototype.emit.call(this,S.ConnectionEventType.Data,m)},x.prototype._handleChunk=function(T){var w=T.__peerData,y=this._chunkedData[w]||{data:[],count:0,total:T.total};if(y.data[T.n]=T.data,y.count++,this._chunkedData[w]=y,y.total===y.count){delete this._chunkedData[w];var C=new Blob(y.data);this._handleDataMessage({data:C})}},x.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,v.prototype.emit.call(this,S.ConnectionEventType.Close))},x.prototype.send=function(T,w){if(this.open)if(this.serialization===S.SerializationType.JSON)this._bufferedSend(this.stringify(T));else if(this.serialization===S.SerializationType.Binary||this.serialization===S.SerializationType.BinaryUTF8){var y=p.util.pack(T);if(!w&&y.size>p.util.chunkedMTU)return void this._sendChunks(y);p.util.supports.binaryBlob?this._bufferedSend(y):this._encodingQueue.enque(y)}else this._bufferedSend(T);else v.prototype.emit.call(this,S.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},x.prototype._bufferedSend=function(T){!this._buffering&&this._trySend(T)||(this._buffer.push(T),this._bufferSize=this._buffer.length)},x.prototype._trySend=function(T){var w=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>x.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){w._buffering=!1,w._tryBuffer()},50),!1;try{this.dataChannel.send(T)}catch(y){return _.default.error("DC#:"+this.connectionId+" Error when sending:",y),this._buffering=!0,this.close(),!1}return!0},x.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var T=this._buffer[0];this._trySend(T)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},x.prototype._sendChunks=function(T){var w,y,C=p.util.chunk(T);_.default.log("DC#"+this.connectionId+" Try to send "+C.length+" chunks...");try{for(var m=c(C),M=m.next();!M.done;M=m.next()){var R=M.value;this.send(R,!0)}}catch(I){w={error:I}}finally{try{M&&!M.done&&(y=m.return)&&y.call(m)}finally{if(w)throw w.error}}},x.prototype.handleMessage=function(T){var w=T.payload;switch(T.type){case S.ServerMessageType.Answer:this._negotiator.handleSDP(T.type,w.sdp);break;case S.ServerMessageType.Candidate:this._negotiator.handleCandidate(w.candidate);break;default:_.default.warn("Unrecognized message type:",T.type,"from peer:",this.peer)}},x.ID_PREFIX="dc_",x.MAX_BUFFERED_AMOUNT=8388608,x}(o.BaseConnection);i.DataConnection=f},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(t,n,i){"use strict";var r=this&&this.__awaiter||function(S,o,h,f){return new(h||(h=Promise))(function(v,x){function T(C){try{y(f.next(C))}catch(m){x(m)}}function w(C){try{y(f.throw(C))}catch(m){x(m)}}function y(C){var m;C.done?v(C.value):(m=C.value,m instanceof h?m:new h(function(M){M(m)})).then(T,w)}y((f=f.apply(S,o||[])).next())})},c=this&&this.__generator||function(S,o){var h,f,v,x,T={label:0,sent:function(){if(1&v[0])throw v[1];return v[1]},trys:[],ops:[]};return x={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function w(y){return function(C){return function(m){if(h)throw new TypeError("Generator is already executing.");for(;T;)try{if(h=1,f&&(v=2&m[0]?f.return:m[0]?f.throw||((v=f.return)&&v.call(f),0):f.next)&&!(v=v.call(f,m[1])).done)return v;switch(f=0,v&&(m=[2&m[0],v.value]),m[0]){case 0:case 1:v=m;break;case 4:return T.label++,{value:m[1],done:!1};case 5:T.label++,f=m[1],m=[0];continue;case 7:m=T.ops.pop(),T.trys.pop();continue;default:if(!(v=(v=T.trys).length>0&&v[v.length-1])&&(m[0]===6||m[0]===2)){T=0;continue}if(m[0]===3&&(!v||m[1]>v[0]&&m[1]<v[3])){T.label=m[1];break}if(m[0]===6&&T.label<v[1]){T.label=v[1],v=m;break}if(v&&T.label<v[2]){T.label=v[2],T.ops.push(m);break}v[2]&&T.ops.pop(),T.trys.pop();continue}m=o.call(S,T)}catch(M){m=[6,M],f=0}finally{h=v=0}if(5&m[0])throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}([y,C])}}},u=this&&this.__importDefault||function(S){return S&&S.__esModule?S:{default:S}};Object.defineProperty(i,"__esModule",{value:!0});var p=t("./util"),_=u(t("./logger")),g=function(){function S(o){this._options=o}return S.prototype._buildUrl=function(o){var h=(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+o;return h+="?ts="+new Date().getTime()+Math.random()},S.prototype.retrieveId=function(){return r(this,void 0,Promise,function(){var o,h,f,v;return c(this,function(x){switch(x.label){case 0:o=this._buildUrl("id"),x.label=1;case 1:return x.trys.push([1,3,,4]),[4,fetch(o)];case 2:if((h=x.sent()).status!==200)throw new Error("Error. Status:"+h.status);return[2,h.text()];case 3:throw f=x.sent(),_.default.error("Error retrieving ID",f),v="",this._options.path==="/"&&this._options.host!==p.util.CLOUD_HOST&&(v=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+v);case 4:return[2]}})})},S.prototype.listAllPeers=function(){return r(this,void 0,Promise,function(){var o,h,f,v;return c(this,function(x){switch(x.label){case 0:o=this._buildUrl("peers"),x.label=1;case 1:return x.trys.push([1,3,,4]),[4,fetch(o)];case 2:if((h=x.sent()).status!==200)throw h.status===401?(f="",f=this._options.host===p.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+f)):new Error("Error. Status:"+h.status);return[2,h.json()];case 3:throw v=x.sent(),_.default.error("Error retrieving list peers",v),new Error("Could not get list peers from the server."+v);case 4:return[2]}})})},S}();i.API=g},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(t,n,i){"use strict";var r=this&&this.__extends||function(){var C=function(m,M){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(R,I){R.__proto__=I}||function(R,I){for(var L in I)I.hasOwnProperty(L)&&(R[L]=I[L])})(m,M)};return function(m,M){function R(){this.constructor=m}C(m,M),m.prototype=M===null?Object.create(M):(R.prototype=M.prototype,new R)}}(),c=this&&this.__assign||function(){return(c=Object.assign||function(C){for(var m,M=1,R=arguments.length;M<R;M++)for(var I in m=arguments[M])Object.prototype.hasOwnProperty.call(m,I)&&(C[I]=m[I]);return C}).apply(this,arguments)},u=this&&this.__values||function(C){var m=typeof Symbol=="function"&&Symbol.iterator,M=m&&C[m],R=0;if(M)return M.call(C);if(C&&typeof C.length=="number")return{next:function(){return C&&R>=C.length&&(C=void 0),{value:C&&C[R++],done:!C}}};throw new TypeError(m?"Object is not iterable.":"Symbol.iterator is not defined.")},p=this&&this.__read||function(C,m){var M=typeof Symbol=="function"&&C[Symbol.iterator];if(!M)return C;var R,I,L=M.call(C),q=[];try{for(;(m===void 0||m-- >0)&&!(R=L.next()).done;)q.push(R.value)}catch(z){I={error:z}}finally{try{R&&!R.done&&(M=L.return)&&M.call(L)}finally{if(I)throw I.error}}return q},_=this&&this.__importDefault||function(C){return C&&C.__esModule?C:{default:C}};Object.defineProperty(i,"__esModule",{value:!0});var g=t("eventemitter3"),S=t("./util"),o=_(t("./logger")),h=t("./socket"),f=t("./mediaconnection"),v=t("./dataconnection"),x=t("./enums"),T=t("./api"),w=function(){return function(){}}(),y=function(C){function m(M,R){var I,L=C.call(this)||this;return L._id=null,L._lastServerId=null,L._destroyed=!1,L._disconnected=!1,L._open=!1,L._connections=new Map,L._lostMessages=new Map,M&&M.constructor==Object?R=M:M&&(I=M.toString()),R=c({debug:0,host:S.util.CLOUD_HOST,port:S.util.CLOUD_PORT,path:"/",key:m.DEFAULT_KEY,token:S.util.randomToken(),config:S.util.defaultConfig},R),L._options=R,L._options.host==="/"&&(L._options.host=window.location.hostname),L._options.path&&(L._options.path[0]!=="/"&&(L._options.path="/"+L._options.path),L._options.path[L._options.path.length-1]!=="/"&&(L._options.path+="/")),L._options.secure===void 0&&L._options.host!==S.util.CLOUD_HOST?L._options.secure=S.util.isSecure():L._options.host==S.util.CLOUD_HOST&&(L._options.secure=!0),L._options.logFunction&&o.default.setLogFunction(L._options.logFunction),o.default.logLevel=L._options.debug||0,L._api=new T.API(R),L._socket=L._createServerConnection(),S.util.supports.audioVideo||S.util.supports.data?I&&!S.util.validateId(I)?(L._delayedAbort(x.PeerErrorType.InvalidID,'ID "'+I+'" is invalid'),L):(I?L._initialize(I):L._api.retrieveId().then(function(q){return L._initialize(q)}).catch(function(q){return L._abort(x.PeerErrorType.ServerError,q)}),L):(L._delayedAbort(x.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),L)}return r(m,C),Object.defineProperty(m.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"socket",{get:function(){return this._socket},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"connections",{get:function(){var M,R,I=Object.create(null);try{for(var L=u(this._connections),q=L.next();!q.done;q=L.next()){var z=p(q.value,2),U=z[0],H=z[1];I[U]=H}}catch(ee){M={error:ee}}finally{try{q&&!q.done&&(R=L.return)&&R.call(L)}finally{if(M)throw M.error}}return I},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(m.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!0,configurable:!0}),m.prototype._createServerConnection=function(){var M=this,R=new h.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return R.on(x.SocketEventType.Message,function(I){M._handleMessage(I)}),R.on(x.SocketEventType.Error,function(I){M._abort(x.PeerErrorType.SocketError,I)}),R.on(x.SocketEventType.Disconnected,function(){M.disconnected||(M.emitError(x.PeerErrorType.Network,"Lost connection to server."),M.disconnect())}),R.on(x.SocketEventType.Close,function(){M.disconnected||M._abort(x.PeerErrorType.SocketClosed,"Underlying socket is already closed.")}),R},m.prototype._initialize=function(M){this._id=M,this.socket.start(M,this._options.token)},m.prototype._handleMessage=function(M){var R,I,L=M.type,q=M.payload,z=M.src;switch(L){case x.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(x.PeerEventType.Open,this.id);break;case x.ServerMessageType.Error:this._abort(x.PeerErrorType.ServerError,q.msg);break;case x.ServerMessageType.IdTaken:this._abort(x.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case x.ServerMessageType.InvalidKey:this._abort(x.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case x.ServerMessageType.Leave:o.default.log("Received leave message from "+z),this._cleanupPeer(z),this._connections.delete(z);break;case x.ServerMessageType.Expire:this.emitError(x.PeerErrorType.PeerUnavailable,"Could not connect to peer "+z);break;case x.ServerMessageType.Offer:var U=q.connectionId;if(($=this.getConnection(z,U))&&($.close(),o.default.warn("Offer received for existing Connection ID:"+U)),q.type===x.ConnectionType.Media)$=new f.MediaConnection(z,this,{connectionId:U,_payload:q,metadata:q.metadata}),this._addConnection(z,$),this.emit(x.PeerEventType.Call,$);else{if(q.type!==x.ConnectionType.Data)return void o.default.warn("Received malformed connection type:"+q.type);$=new v.DataConnection(z,this,{connectionId:U,_payload:q,metadata:q.metadata,label:q.label,serialization:q.serialization,reliable:q.reliable}),this._addConnection(z,$),this.emit(x.PeerEventType.Connection,$)}var H=this._getMessages(U);try{for(var ee=u(H),ie=ee.next();!ie.done;ie=ee.next()){var ae=ie.value;$.handleMessage(ae)}}catch(ce){R={error:ce}}finally{try{ie&&!ie.done&&(I=ee.return)&&I.call(ee)}finally{if(R)throw R.error}}break;default:if(!q)return void o.default.warn("You received a malformed message from "+z+" of type "+L);var $;U=q.connectionId,($=this.getConnection(z,U))&&$.peerConnection?$.handleMessage(M):U?this._storeMessage(U,M):o.default.warn("You received an unrecognized message:",M)}},m.prototype._storeMessage=function(M,R){this._lostMessages.has(M)||this._lostMessages.set(M,[]),this._lostMessages.get(M).push(R)},m.prototype._getMessages=function(M){var R=this._lostMessages.get(M);return R?(this._lostMessages.delete(M),R):[]},m.prototype.connect=function(M,R){if(R===void 0&&(R={}),this.disconnected)return o.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(x.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var I=new v.DataConnection(M,this,R);return this._addConnection(M,I),I},m.prototype.call=function(M,R,I){if(I===void 0&&(I={}),this.disconnected)return o.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(x.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(R){I._stream=R;var L=new f.MediaConnection(M,this,I);return this._addConnection(M,L),L}o.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},m.prototype._addConnection=function(M,R){o.default.log("add connection "+R.type+":"+R.connectionId+" to peerId:"+M),this._connections.has(M)||this._connections.set(M,[]),this._connections.get(M).push(R)},m.prototype._removeConnection=function(M){var R=this._connections.get(M.peer);if(R){var I=R.indexOf(M);I!==-1&&R.splice(I,1)}this._lostMessages.delete(M.connectionId)},m.prototype.getConnection=function(M,R){var I,L,q=this._connections.get(M);if(!q)return null;try{for(var z=u(q),U=z.next();!U.done;U=z.next()){var H=U.value;if(H.connectionId===R)return H}}catch(ee){I={error:ee}}finally{try{U&&!U.done&&(L=z.return)&&L.call(z)}finally{if(I)throw I.error}}return null},m.prototype._delayedAbort=function(M,R){var I=this;setTimeout(function(){I._abort(M,R)},0)},m.prototype._abort=function(M,R){o.default.error("Aborting!"),this.emitError(M,R),this._lastServerId?this.disconnect():this.destroy()},m.prototype.emitError=function(M,R){var I;o.default.error("Error:",R),(I=typeof R=="string"?new Error(R):R).type=M,this.emit(x.PeerEventType.Error,I)},m.prototype.destroy=function(){this.destroyed||(o.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(x.PeerEventType.Close))},m.prototype._cleanup=function(){var M,R;try{for(var I=u(this._connections.keys()),L=I.next();!L.done;L=I.next()){var q=L.value;this._cleanupPeer(q),this._connections.delete(q)}}catch(z){M={error:z}}finally{try{L&&!L.done&&(R=I.return)&&R.call(I)}finally{if(M)throw M.error}}this.socket.removeAllListeners()},m.prototype._cleanupPeer=function(M){var R,I,L=this._connections.get(M);if(L)try{for(var q=u(L),z=q.next();!z.done;z=q.next())z.value.close()}catch(U){R={error:U}}finally{try{z&&!z.done&&(I=q.return)&&I.call(q)}finally{if(R)throw R.error}}},m.prototype.disconnect=function(){if(!this.disconnected){var M=this.id;o.default.log("Disconnect peer with ID:"+M),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=M,this._id=null,this.emit(x.PeerEventType.Disconnected,M)}},m.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)o.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");o.default.error("In a hurry? We're still trying to make the initial connection!")}},m.prototype.listAllPeers=function(M){var R=this;M===void 0&&(M=function(I){}),this._api.listAllPeers().then(function(I){return M(I)}).catch(function(I){return R._abort(x.PeerErrorType.ServerError,I)})},m.DEFAULT_KEY="peerjs",m}(g.EventEmitter);i.Peer=y},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(t,n,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=t("./util"),c=t("./peer");i.peerjs={Peer:c.Peer,util:r.util},i.default=c.Peer,window.peerjs=i.peerjs,window.Peer=c.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"],null)});var Hl={};cf(Hl,{Alignment:()=>mf,Animation:()=>vs,AnimationComponent:()=>ka,AnimationState:()=>vf,Collider:()=>ff,CollisionComponent:()=>Us,CollisionEventType:()=>yf,Component:()=>wn,ForceMode:()=>ba,InputComponent:()=>Sa,InputType:()=>Mi,Justification:()=>_f,LightComponent:()=>Ca,LightType:()=>gf,Material:()=>Ai,Mesh:()=>Oa,MeshComponent:()=>Ma,MeshIndexType:()=>Hs,Object:()=>rt,PhysXComponent:()=>uo,Physics:()=>Aa,RayHit:()=>po,Scene:()=>xa,Shape:()=>bf,Skin:()=>ho,TextComponent:()=>Ta,Texture:()=>Gs,Type:()=>pf,ViewComponent:()=>lo,_images:()=>_s,_initPhysics:()=>kf,_sceneLoadedCallback:()=>wa,arSupported:()=>Ll,canvas:()=>jl,init:()=>Cf,math:()=>Ul,onSceneLoaded:()=>Sf,onXRSessionEnd:()=>xf,onXRSessionStart:()=>wf,onXRSupported:()=>Tf,physics:()=>ms,registerComponent:()=>df,scene:()=>ql,textures:()=>zl,updateTempMemory:()=>Bl,vrSupported:()=>Fl,xrSession:()=>Bs});function df(t,n,i){_WL.registerComponent(t,n,i)}function Cf(){ql=new xa,jl=typeof document=="undefined"?null:document.getElementById("canvas"),va={},ya=[],Wl(1024)}function kf(){ms=new Aa}function Wl(t){console.log("Allocating temp mem:",t),hn=t,Re&&_free(Re),Re=_malloc(hn),Bl()}function Mf(t){hn<t&&Wl(Math.ceil(t/1024)*1024)}function Bl(){de=new Float32Array(HEAP8.buffer,Re,hn>>2),co=new Int32Array(HEAP8.buffer,Re,hn>>2),Vl=new Uint32Array(HEAP8.buffer,Re,hn>>2),zs=new Uint16Array(HEAP8.buffer,Re,hn>>1),Nl=new Uint8Array(HEAP8.buffer,Re,hn)}var uf,va,ya,hf,pf,ff,mf,_f,Mi,gf,vf,ba,yf,bf,jl,Bs,wf,xf,Tf,Sf,Ll,Fl,ql,ms,_s,wa,Re,hn,de,co,Vl,zs,Nl,xa,wn,Us,Ta,lo,Sa,Ca,ka,Ma,uo,Aa,Oa,Hs,Ai,gs,Gs,zl,vs,rt,ho,po,Ul,Gl=bn(()=>{uf="Misaligned pointer: please report a bug",va={},ya=[],hf=["_id","_manager","type","_type","active"];pf={Bool:1<<1,Int:1<<2,Float:1<<3,String:1<<4,Enum:1<<5,Object:1<<6,Mesh:1<<7,Texture:1<<8,Material:1<<9,Animation:1<<10,Skin:1<<11},ff={Sphere:0,AxisAlignedBox:1,Box:2},mf={Left:1,Center:2,Right:3},_f={Line:1,Middle:2,Top:3},Mi={Head:0,EyeLeft:1,EyeRight:2,ControllerLeft:3,ControllerRight:4,RayLeft:5,RayRight:6},gf={Point:1,Sun:2},vf={Playing:1,Paused:2,Stopped:3},ba={Force:0,Impulse:1,VelocityChange:2,Acceleration:3},yf={Touch:0,TouchLost:1,TriggerTouch:2,TriggerTouchLost:3},bf={None:0,Sphere:1,Capsule:2,Box:3,Plane:4,ConvexMesh:5,TriangleMesh:6},jl=null,Bs=null,wf=[t=>{Bs=t}],xf=[()=>{Bs=null}],Tf=[(t,n)=>{t=="ar"&&(Ll=n),t=="vr"&&(Fl=n)}],Sf=[],_s=[],wa=[],Re=null,hn=0,de=null,co=null,Vl=null,zs=null,Nl=null;xa=class{constructor(){this._rayHit=_malloc(4*(3*4+3*4+4+2)+4),this._hit=new po(this._rayHit),this.onPreRender=[],this.onPostRender=[]}get activeViews(){let n=_wl_scene_get_active_views(Re,16),i=[],r=rt._typeIndexFor("view");for(let c=0;c<n;++c)i.push(new lo(r,co[c]));return i}rayCast(n,i,r){return _wl_scene_ray_cast(n[0],n[1],n[2],i[0],i[1],i[2],r,this._rayHit),this._hit}addObject(n){let i=n?n.objectId:0,r=_wl_scene_add_object(i);return rt._wrapObject(r)}addObjects(n,i,r){let c=i?i.objectId:0;Mf(n*2);let u=_wl_scene_add_objects(c,n,r||0,Re,hn>>1),p=zs.subarray(0,u);return Array.from(p,rt._wrapObject)}set clearColor(n){_wl_scene_set_clearColor(n[0],n[1],n[2],n[3])}load(n){let i=lengthBytesUTF8(n)+1,r=_malloc(i);stringToUTF8(n,r,i),_wl_load_scene(r),_free(r)}append(n){let i=lengthBytesUTF8(n)+1,r=_malloc(i);stringToUTF8(n,r,i);let c=wa.length,u=new Promise((p,_)=>{wa[c]={success:g=>p(rt._wrapObject(g)),error:()=>_()}});return _wl_append_scene(r,c),_free(r),u}},wn=class{constructor(n,i){this._id=i,this._manager=n}get type(){return this._type||rt._typeNameFor(this._manager)}get object(){let n=_wl_component_get_object(this._manager,this._id);return rt._wrapObject(n)}set active(n){_wl_component_setActive(this._manager,this._id,n)}get active(){return _wl_component_isActive(this._manager,this._id)!=0}equals(n){return n?this._manager==n._manager&&this._id==n._id:!1}},Us=class extends wn{get collider(){return _wl_collision_component_get_collider(this._id)}set collider(n){_wl_collision_component_set_collider(this._id,n)}get extents(){return new Float32Array(HEAPF32.buffer,_wl_collision_component_get_extents(this._id),3)}set extents(n){this.extents.set(n)}get group(){return _wl_collision_component_get_group(this._id)}set group(n){_wl_collision_component_set_group(this._id,n)}queryOverlaps(){let n=_wl_collision_component_query_overlaps(this._id,Re,hn>>1),i=new Array(n);for(let r=0;r<n;++r)i[r]=new Us(this._manager,zs[r]);return i}},Ta=class extends wn{get alignment(){return _wl_text_component_get_alignment(this._id)&7}set alignment(n){_wl_text_component_set_alignment(this._id,this.justification<<3|n)}get justification(){return _wl_text_component_get_alignment(this._id)>>3}set justification(n){_wl_text_component_set_alignment(this._id,n<<3|this.alignment)}get text(){return UTF8ToString(_wl_text_component_get_text(this._id))}set text(n){let i=lengthBytesUTF8(n)+1,r=_malloc(i);stringToUTF8(n,r,i),_wl_text_component_set_text(this._id,r),_free(r)}set material(n){_wl_text_component_set_material(this._id,n._index)}get material(){return Ai.wrap(_wl_text_component_get_material(this._id))}},lo=class extends wn{get projectionMatrix(){return new Float32Array(HEAPF32.buffer,_wl_view_component_get_projection_matrix(this._id),16)}},Sa=class extends wn{get inputType(){return _wl_input_component_get_type(this._id)}set inputType(n){_wl_input_component_set_type(this._id,n)}get xrInputSource(){if(Bs){for(let n of Bs.inputSources)if(n.handedness==this.handedness)return n}return null}get handedness(){let n=this.inputType;return n==Mi.ControllerRight||n==Mi.RayRight||n==Mi.EyeRight?"right":n==Mi.ControllerLeft||n==Mi.RayLeft||n==Mi.EyeLeft?"left":null}},Ca=class extends wn{get color(){return new Float32Array(HEAPF32.buffer,_wl_light_component_get_color(this._id),4)}get lightType(){return _wl_light_component_get_type(this._id)}set lightType(n){return _wl_light_component_set_type(this._id,n)}},ka=class extends wn{set animation(n){_wl_animation_component_set_animation(this._id,n._index)}get animation(){return new vs(_wl_animation_component_get_animation(this._id))}set playCount(n){_wl_animation_component_set_playCount(this._id,n)}get playCount(){return _wl_animation_component_get_playCount(this._id)}play(){_wl_animation_component_play(this._id)}stop(){_wl_animation_component_stop(this._id)}pause(){_wl_animation_component_pause(this._id)}get state(){return _wl_animation_component_state(this._id)}},Ma=class extends wn{set material(n){_wl_mesh_component_set_material(this._id,n._index)}get material(){return Ai.wrap(_wl_mesh_component_get_material(this._id))}get mesh(){return new Oa(_wl_mesh_component_get_mesh(this._id))}set mesh(n){_wl_mesh_component_set_mesh(this._id,n._index)}get skin(){return new ho(_wl_mesh_component_get_skin(this._id))}set skin(n){_wl_mesh_component_set_skin(this._id,n._index)}},uo=class extends wn{set static(n){_wl_physx_component_set_static(this._id,n)}get static(){return!!_wl_physx_component_get_static(this._id)}set kinematic(n){_wl_physx_component_set_kinematic(this._id,n)}get kinematic(){return!!_wl_physx_component_get_kinematic(this._id)}set shape(n){_wl_physx_component_set_shape(this._id,n)}get shape(){return _wl_physx_component_get_shape(this._id)}set extents(n){this.extents.set(n)}get extents(){let n=_wl_physx_component_get_extents(this._id);return new Float32Array(HEAPF32.buffer,n,3)}get staticFriction(){return _wl_physx_component_get_staticFriction(this._id)}set staticFriction(n){_wl_physx_component_set_staticFriction(this._id,n)}get dynamicFriction(){return _wl_physx_component_get_dynamicFriction(this._id)}set dynamicFriction(n){_wl_physx_component_set_dynamicFriction(this._id,n)}get restitution(){return _wl_physx_component_get_restitution(this._id)}set restitution(n){_wl_physx_component_set_restitution(this._id,n)}get linearDamping(){return _wl_physx_component_get_linearDamping(this._id)}set linearDamping(n){_wl_physx_component_set_linearDamping(this._id,n)}get angularDamping(){return _wl_physx_component_get_angularDamping(this._id)}set angularDamping(n){_wl_physx_component_set_angularDamping(this._id,n)}set linearVelocity(n){_wl_physx_component_set_linearVelocity(this._id,n[0],n[1],n[2])}get linearVelocity(){return _wl_physx_component_get_linearVelocity(this._id,Re),new Float32Array(HEAPF32.buffer,Re,3)}set angularVelocity(n){_wl_physx_component_set_angularVelocity(this._id,n[0],n[1],n[2])}get angularVelocity(){return _wl_physx_component_get_angularVelocity(this._id,Re),new Float32Array(HEAPF32.buffer,Re,3)}set mass(n){_wl_physx_component_set_mass(this._id,n)}get mass(){return _wl_physx_component_get_mass(this._id)}set massSpaceInteriaTensor(n){_wl_physx_component_set_massSpaceInertiaTensor(this._id,n[0],n[1],n[2])}addForce(n,i,r,c,u){i=i||ba.Force,c?_wl_physx_component_addForceAt(this._id,n[0],n[1],n[2],i,!!r,c[0],c[1],c[2],!!u):_wl_physx_component_addForce(this._id,n[0],n[1],n[2],i,!!r)}addTorque(n,i){i=i||ba.Force,_wl_physx_component_addTorque(this._id,n[0],n[1],n[2],i)}onCollision(n){this.onCollisionWith(this,n)}onCollisionWith(n,i){ms._callbacks[this._id]=ms._callbacks[this._id]||[],ms._callbacks[this._id].push(i),_wl_physx_component_addCallback(this._id,n._id||this._id)}},Aa=class{constructor(){this._rayHit=_malloc(4*(3*4+3*4+4+2)+4),this._hit=new po(this._rayHit),this._callbacks={}}rayCast(n,i,r,c){return typeof c=="undefined"&&(c=100),_wl_physx_ray_cast(n[0],n[1],n[2],i[0],i[1],i[2],r,c||100,this._rayHit),this._hit}_callCollisionCallback(n,i,r,c){ms._callbacks[n][i](r,new uo(rt._typeIndexFor("physx"),c))}},Oa=class{static get VERTEX_FLOAT_SIZE(){return 3+3+2}static get VERTEX_SIZE(){return this.VERTEX_FLOAT_SIZE*4}static get POS(){return{X:0,Y:1,Z:2}}static get TEXCOORD(){return{U:3,V:4}}static get NORMAL(){return{X:5,Y:6,Z:7}}constructor(n){if(typeof n=="object"){n.indexType=n.indexType||Hs.UnsignedShort;let i=_malloc(n.indexData.length*n.indexType),r=_malloc(n.vertexData.length*4);switch(n.indexType){case Hs.UnsignedByte:HEAPU8.set(n.indexData,i);break;case Hs.UnsignedShort:HEAPU16.set(n.indexData,i>>1);break;case Hs.UnsignedInt:HEAPU32.set(n.indexData,i>>2);break}HEAPF32.set(n.vertexData,r>>2),this._index=_wl_mesh_create(i,n.indexData.length*n.indexType,n.indexType,r,n.vertexData.length*4)}else this._index=n}get vertexData(){let n=_wl_mesh_get_vertexData(this._index,Re);return new Float32Array(HEAPF32.buffer,n,WL.Mesh.VERTEX_FLOAT_SIZE*HEAPU32[Re/4])}get indexData(){let n=_wl_mesh_get_indexData(this._index,Re,Re+4),i=HEAPU32[Re/4];switch(HEAPU32[Re/4+1]){case UnsignedByte:return new Uint8Array(HEAPU8.buffer,n,i);case UnsignedShort:return new Uint16Array(HEAPU16.buffer,n,i);case UnsignedInt:return new Uint32Array(HEAPU32.buffer,n,i)}}},Hs={UnsignedByte:1,UnsignedShort:2,UnsignedInt:4},Ai=class{constructor(n){this._index=n}get shader(){return UTF8ToString(_wl_material_get_shader(this._index))}clone(){return Ai.wrap(_wl_material_clone(this._index))}_paramIndex(n){let i=lengthBytesUTF8(n)+1,r=_malloc(i);stringToUTF8(n,r,i);let c=_wl_material_get_param_index(this._index,r);return _free(r),c}_paramType(n){let i=_wl_material_get_param_type(this._index,n);return{type:i&255,componentCount:i>>8&255,metaType:i>>16&255}}static wrap(n){if(n<=0)return null;let i=new Ai(n);return new Proxy(i,{get(r,c){let u=r._paramIndex(c);if(u!=-1){let p=r._paramType(u);if(_wl_material_get_param_value(r._index,u,Re)){if(p.type==0)return p.componentCount==1?Vl[0]:new Uint32Array(HEAPF32.buffer,Re,p.componentCount);if(p.type==1)return p.componentCount==1?co[0]:new Int32Array(HEAPF32.buffer,Re,p.componentCount);if(p.type==2)return p.componentCount==1?de[0]:new Float32Array(HEAPF32.buffer,Re,p.componentCount);if(p.type==3)return new Gs(co[0])}throw new Error(`Invalid type ${p} on parameter ${u} for material ${r._index}`)}else return r[c]},set(r,c,u){let p=r._paramIndex(c);if(p>=0)if(u instanceof Gs)_wl_material_set_param_value_uint(r._index,p,u._id);else if(typeof u=="number")de[0]=u,_wl_material_set_param_value_float(r._index,p,Re,1);else{let _=u.length;for(let g=0;g<_;++g)de[g]=u[g];_wl_material_set_param_value_float(r._index,p,Re,_)}else r[c]=u;return!0}})}},gs=null,Gs=class{constructor(n){if(n instanceof HTMLImageElement||n instanceof HTMLVideoElement||n instanceof HTMLCanvasElement){let i=_s.length;_s.push(n),this._imageIndex=i,this._id=_wl_renderer_addImage(i)}else this._id=n;zl[this._id]=this}get valid(){return this._id>=0}update(){!this.valid||_wl_renderer_updateImage(this._id,this._imageIndex)}updateSubImage(n,i,r,c){if(!this.valid)return;gs||(gs=document.createElement("canvas"));let u=_s[this._imageIndex];gs.width=r,gs.height=c,gs.getContext("2d").drawImage(u,n,i,r,c,0,0,r,c),_s[this._imageIndex]=gs;try{_wl_renderer_updateImage(this._id,this._imageIndex,n,(u.videoHeight||u.height)-i-c)}finally{_s[this._imageIndex]=u}}},zl={load:function(t,n){let i=new Image;return n!==void 0&&(i.crossOrigin=n),i.src=t,new Promise((r,c)=>{i.onload=function(){let u=new Gs(i);u.valid||c("Failed to add image "+i.src+" to texture atlas. Probably incompatible format."),r(u)}})}},vs=class{constructor(n){this._index=n}get duration(){return _wl_animation_get_duration(this._index)}get trackCount(){return _wl_animation_get_trackCount(this._index)}retarget(n){if(n instanceof ho){let c=_wl_animation_retargetToSkin(this._index,n._index);return new vs(c)}if(n.length!=this.trackCount)throw Error("Expected "+this.trackCount.toString()+" targets, but got "+n.length.toString());let i=_malloc(2*n.length);for(let c=0;c<n.length;++c)HEAPU16[i>>1+c]=n[c].objectId;let r=_wl_animation_retarget(this._index,i);return _free(i),new vs(r)}},rt=class{constructor(n){this.objectId=n}get name(){return UTF8ToString(_wl_object_name(this.objectId))}set name(n){let i=lengthBytesUTF8(n)+1,r=_malloc(i);stringToUTF8(n,r,i),_wl_object_set_name(this.objectId,r),_free(r)}get parent(){let n=_wl_object_parent(this.objectId);return n==0?null:rt._wrapObject(n)}get children(){let n=_wl_object_get_children(this.objectId,Re,hn>>1);if(n==0)return[];let i=new Array(n);for(let r=0;r<n;++r)i[r]=rt._wrapObject(zs[r]);return i}set parent(n){_wl_object_set_parent(this.objectId,n==null?0:n.objectId)}resetTransform(){_wl_object_reset_translation_rotation(this.objectId),_wl_object_reset_scaling(this.objectId)}resetTranslationRotation(){_wl_object_reset_translation_rotation(this.objectId)}resetRotation(){_wl_object_reset_rotation(this.objectId)}resetTranslation(){_wl_object_reset_translation(this.objectId)}resetScaling(){_wl_object_reset_scaling(this.objectId)}translate(n){_wl_object_translate(this.objectId,n[0],n[1],n[2])}translateObject(n){_wl_object_translate_obj(this.objectId,n[0],n[1],n[2])}translateWorld(n){_wl_object_translate_world(this.objectId,n[0],n[1],n[2])}rotateAxisAngleDeg(n,i){_wl_object_rotate_axis_angle(this.objectId,n[0],n[1],n[2],i)}rotateAxisAngleRad(n,i){_wl_object_rotate_axis_angle_rad(this.objectId,n[0],n[1],n[2],i)}rotateAxisAngleDegObject(n,i){_wl_object_rotate_axis_angle_obj(this.objectId,n[0],n[1],n[2],i)}rotateAxisAngleRadObject(n,i){_wl_object_rotate_axis_angle_rad_obj(this.objectId,n[0],n[1],n[2],i)}rotate(n){_wl_object_rotate_quat(this.objectId,n[0],n[1],n[2],n[3])}rotateObject(n){_wl_object_rotate_quat_obj(this.objectId,n[0],n[1],n[2],n[3])}scale(n){_wl_object_scale(this.objectId,n[0],n[1],n[2])}get transformLocal(){return new Float32Array(HEAPF32.buffer,_wl_object_trans_local(this.objectId),8)}set transformLocal(n){this.transformLocal.set(n),this.setDirty()}getTranslationLocal(n){return _wl_object_get_translation_local(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}getTranslationWorld(n){return _wl_object_get_translation_world(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}setTranslationLocal(n){_wl_object_set_translation_local(this.objectId,n[0],n[1],n[2])}setTranslationWorld(n){_wl_object_set_translation_world(this.objectId,n[0],n[1],n[2])}get transformWorld(){return new Float32Array(HEAPF32.buffer,_wl_object_trans_world(this.objectId),8)}set transformWorld(n){this.transformWorld.set(n),_wl_object_trans_world_to_local(this.objectId)}get scalingLocal(){return new Float32Array(HEAPF32.buffer,_wl_object_scaling_local(this.objectId),3)}set scalingLocal(n){this.scalingLocal.set(n),this.setDirty()}get scalingWorld(){return new Float32Array(HEAPF32.buffer,_wl_object_scaling_world(this.objectId),3)}set scalingWorld(n){this.scalingWorld.set(n),_wl_object_scaling_world_to_local(this.objectId)}get rotationLocal(){return this.transformLocal.subarray(0,4)}get rotationWorld(){return this.transformWorld.subarray(0,4)}set rotationLocal(n){_wl_object_set_rotation_local(this.objectId,n[0],n[1],n[2],n[3])}set rotationWorld(n){_wl_object_set_rotation_world(this.objectId,n[0],n[1],n[2],n[3])}getForward(n){return n[0]=0,n[1]=0,n[2]=-1,this.transformVectorWorld(n),n}getUp(n){return n[0]=0,n[1]=1,n[2]=0,this.transformVectorWorld(n),n}getRight(n){return n[0]=1,n[1]=0,n[2]=0,this.transformVectorWorld(n),n}transformVectorWorld(n,i){return i=i||n,de[0]=i[0],de[1]=i[1],de[2]=i[2],_wl_object_transformVectorWorld(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}transformVectorLocal(n,i){return i=i||n,de[0]=i[0],de[1]=i[1],de[2]=i[2],_wl_object_transformVectorLocal(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}transformPointWorld(n,i){return i=i||n,de[0]=i[0],de[1]=i[1],de[2]=i[2],_wl_object_transformPointWorld(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}transformPointLocal(n,i){return i=i||n,de[0]=i[0],de[1]=i[1],de[2]=i[2],_wl_object_transformPointLocal(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}transformVectorInverseWorld(n,i){return i=i||n,de[0]=i[0],de[1]=i[1],de[2]=i[2],_wl_object_transformVectorInverseWorld(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}transformVectorInverseLocal(n,i){return i=i||n,de[0]=i[0],de[1]=i[1],de[2]=i[2],_wl_object_transformVectorInverseLocal(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}transformPointInverseWorld(n,i){return i=i||n,de[0]=i[0],de[1]=i[1],de[2]=i[2],_wl_object_transformPointInverseWorld(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}transformPointInverseLocal(n,i){return i=i||n,de.set(i),_wl_object_transformPointInverseLocal(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n}toWorldSpaceTransform(n,i){return i=i||n,de.set(i),_wl_object_toWorldSpaceTransform(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n[3]=de[3],n[4]=de[4],n[5]=de[5],n[6]=de[6],n[7]=de[7],n}toLocalSpaceTransform(n,i){let r=this.parent;return r?r.toObjectSpaceTransform(i):(n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7]),n}toObjectSpaceTransform(n,i){return i=i||n,de.set(i),_wl_object_toObjectSpaceTransform(this.objectId,Re),n[0]=de[0],n[1]=de[1],n[2]=de[2],n[3]=de[3],n[4]=de[4],n[5]=de[5],n[6]=de[6],n[7]=de[7],n}lookAt(n,i=[0,1,0]){_wl_object_lookAt(this.objectId,n[0],n[1],n[2],i[0],i[1],i[2])}destroy(){_wl_scene_remove_object(this.objectId),this.objectId=null}setDirty(){_wl_object_set_dirty(this.objectId)}set active(n){let i=this.getComponents();for(let r of i)r.active=n}getComponent(n,i){let r=lengthBytesUTF8(n)+1,c=_malloc(r);stringToUTF8(n,c,r);let u=_wl_get_component_manager_index(c);if(u<0){let _=_wl_get_js_component_index(this.objectId,c,i||0);return _free(c),_<0?null:_WL._components[_]}_free(c);let p=_wl_get_component_id(this.objectId,u,i||0);return rt._wrapComponent(n,u,p)}getComponents(n){let i=n?rt._typeIndexFor(n):null,r=[],c=Math.floor(hn/3*2),u=_wl_object_get_components(this.objectId,Re,c),p=2*u;_wl_object_get_component_types(this.objectId,Re+p,c);let _=rt._typeIndexFor("js");for(let g=0;g<u;++g){let S=Nl[g+p],o=zs[g];if(S==_){let h=_WL._components[_wl_get_js_component_index_for_id(o)];(i===null||h.type==n)&&r.push(h);continue}if(i===null){let h=rt._typeNameFor(S);r.push(rt._wrapComponent(h,S,o))}else S==i&&r.push(rt._wrapComponent(n,i,o))}return r}addComponent(n,i){let r=rt._typeIndexFor(n),c=null,u=null;if(r<0){if(!(n in _WL._componentTypeIndices))throw new TypeError("Unknown component type '"+n+"'");let p=_wl_object_add_js_component(this.objectId,_WL._componentTypeIndices[n]);u=_wl_get_js_component_index_for_id(p),c=_WL._components[u]}else{let p=_wl_object_add_component(this.objectId,r);c=rt._wrapComponent(n,r,p)}if(i!==void 0)for(let p in i)!i.hasOwnProperty(p)||hf.includes(p)||(c[p]=i[p]);return r<0&&_wljs_component_init(u),(!i||!("active"in i&&!i.active))&&(c.active=!0),c}equals(n){return n?this.objectId==n.objectId:!1}static _typeIndexFor(n){let i=lengthBytesUTF8(n)+1,r=_malloc(i);stringToUTF8(n,r,i);let c=_wl_get_component_manager_index(r);return _free(r),c}static _typeNameFor(n){return UTF8ToString(_wl_component_manager_name(n))}static _wrapComponent(n,i,r){if(r<0)return null;let c=va[i]||(va[i]=[]);return n=="collision"?c[r]||(c[r]=new Us(i,r)):n=="text"?c[r]||(c[r]=new Ta(i,r)):n=="view"?c[r]||(c[r]=new lo(i,r)):n=="mesh"?c[r]||(c[r]=new Ma(i,r)):n=="input"?c[r]||(c[r]=new Sa(i,r)):n=="light"?c[r]||(c[r]=new Ca(i,r)):n=="animation"?c[r]||(c[r]=new ka(i,r)):n=="physx"?c[r]||(c[r]=new uo(i,r)):c[r]||(c[r]=new wn(i,r))}static _wrapObject(n){let i=ya[n]||(ya[n]=new rt(n));return i.objectId=n,i}},ho=class{constructor(n){this._index=n}get jointCount(){return _wl_skin_get_joint_count(this._index)}get jointIds(){return new Uint16Array(HEAPU16.buffer,_wl_skin_joint_ids(this._index),this.jointCount)}get inverseBindTransforms(){return new Float32Array(HEAPF32.buffer,_wl_skin_inverse_bind_transforms(this._index),8*this.jointCount)}get inverseBindScalings(){return new Float32Array(HEAPF32.buffer,_wl_skin_inverse_bind_scalings(this._index),3*this.jointCount)}},po=class{constructor(n){assert((this._ptr&3)==0,uf),this._ptr=n}get locations(){let n=this._ptr,i=[];for(let r=0;r<this.hitCount;++r)i.push(new Float32Array(HEAPF32.buffer,n+12*r,3));return i}get normals(){let n=this._ptr+48,i=[];for(let r=0;r<this.hitCount;++r)i.push(new Float32Array(HEAPF32.buffer,n+12*r,3));return i}get distances(){let n=this._ptr+48*2;return new Float32Array(HEAPF32.buffer,n,this.hitCount)}get objects(){let n=this._ptr+(48*2+16),i=new Uint16Array(HEAPU16.buffer,n,this.hitCount);return[i[0]<=0?null:rt._wrapObject(i[0]),i[1]<=0?null:rt._wrapObject(i[1]),i[2]<=0?null:rt._wrapObject(i[2]),i[3]<=0?null:rt._wrapObject(i[3])]}get hitCount(){return Math.min(HEAPU32[this._ptr/4+30],4)}},Ul=class{static cubicHermite(n,i,r,c,u,p){de.subarray(0).set(i),de.subarray(4).set(r),de.subarray(8).set(c),de.subarray(12).set(u);let _=i.length==4;return _wl_math_cubicHermite(Re+4*16,Re+4*0,Re+4*4,Re+4*8,Re+4*12,p,_),n[0]=de[16],n[1]=de[17],n[2]=de[18],_&&(n[3]=de[19]),n}}});var xn=Ye(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.setMatrixArrayType=Of;dn.toRadian=Ef;dn.equals=Pf;dn.RANDOM=dn.ARRAY_TYPE=dn.EPSILON=void 0;var Yl=1e-6;dn.EPSILON=Yl;var Xl=typeof Float32Array!="undefined"?Float32Array:Array;dn.ARRAY_TYPE=Xl;var Af=Math.random;dn.RANDOM=Af;function Of(t){dn.ARRAY_TYPE=Xl=t}var Rf=Math.PI/180;function Ef(t){return t*Rf}function Pf(t,n){return Math.abs(t-n)<=Yl*Math.max(1,Math.abs(t),Math.abs(n))}Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)})});var $l=Ye(Ge=>{"use strict";function fo(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?fo=function(i){return typeof i}:fo=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},fo(t)}Object.defineProperty(Ge,"__esModule",{value:!0});Ge.create=If;Ge.clone=jf;Ge.copy=Lf;Ge.identity=Ff;Ge.fromValues=qf;Ge.set=Vf;Ge.transpose=Nf;Ge.invert=Wf;Ge.adjoint=Bf;Ge.determinant=zf;Ge.multiply=Zl;Ge.rotate=Uf;Ge.scale=Hf;Ge.fromRotation=Gf;Ge.fromScaling=Yf;Ge.str=Xf;Ge.frob=Qf;Ge.LDU=Zf;Ge.add=Jf;Ge.subtract=Jl;Ge.exactEquals=$f;Ge.equals=Kf;Ge.multiplyScalar=em;Ge.multiplyScalarAndAdd=tm;Ge.sub=Ge.mul=void 0;var pi=Df(xn());function Ql(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(Ql=function(c){return c?i:n})(t)}function Df(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||fo(t)!=="object"&&typeof t!="function")return{default:t};var i=Ql(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function If(){var t=new pi.ARRAY_TYPE(4);return pi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function jf(t){var n=new pi.ARRAY_TYPE(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function Lf(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Ff(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function qf(t,n,i,r){var c=new pi.ARRAY_TYPE(4);return c[0]=t,c[1]=n,c[2]=i,c[3]=r,c}function Vf(t,n,i,r,c){return t[0]=n,t[1]=i,t[2]=r,t[3]=c,t}function Nf(t,n){if(t===n){var i=n[1];t[1]=n[2],t[2]=i}else t[0]=n[0],t[1]=n[2],t[2]=n[1],t[3]=n[3];return t}function Wf(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=i*u-c*r;return p?(p=1/p,t[0]=u*p,t[1]=-r*p,t[2]=-c*p,t[3]=i*p,t):null}function Bf(t,n){var i=n[0];return t[0]=n[3],t[1]=-n[1],t[2]=-n[2],t[3]=i,t}function zf(t){return t[0]*t[3]-t[2]*t[1]}function Zl(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=i[0],g=i[1],S=i[2],o=i[3];return t[0]=r*_+u*g,t[1]=c*_+p*g,t[2]=r*S+u*o,t[3]=c*S+p*o,t}function Uf(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=Math.sin(i),g=Math.cos(i);return t[0]=r*g+u*_,t[1]=c*g+p*_,t[2]=r*-_+u*g,t[3]=c*-_+p*g,t}function Hf(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=i[0],g=i[1];return t[0]=r*_,t[1]=c*_,t[2]=u*g,t[3]=p*g,t}function Gf(t,n){var i=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function Yf(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t}function Xf(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Qf(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Zf(t,n,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,n,i]}function Jf(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t[3]=n[3]+i[3],t}function Jl(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2],t[3]=n[3]-i[3],t}function $f(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function Kf(t,n){var i=t[0],r=t[1],c=t[2],u=t[3],p=n[0],_=n[1],g=n[2],S=n[3];return Math.abs(i-p)<=pi.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-_)<=pi.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(c-g)<=pi.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(u-S)<=pi.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))}function em(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=n[3]*i,t}function tm(t,n,i,r){return t[0]=n[0]+i[0]*r,t[1]=n[1]+i[1]*r,t[2]=n[2]+i[2]*r,t[3]=n[3]+i[3]*r,t}var nm=Zl;Ge.mul=nm;var im=Jl;Ge.sub=im});var nu=Ye(Xe=>{"use strict";function mo(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?mo=function(i){return typeof i}:mo=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},mo(t)}Object.defineProperty(Xe,"__esModule",{value:!0});Xe.create=rm;Xe.clone=om;Xe.copy=am;Xe.identity=cm;Xe.fromValues=lm;Xe.set=um;Xe.invert=hm;Xe.determinant=dm;Xe.multiply=eu;Xe.rotate=pm;Xe.scale=fm;Xe.translate=mm;Xe.fromRotation=_m;Xe.fromScaling=gm;Xe.fromTranslation=vm;Xe.str=ym;Xe.frob=bm;Xe.add=wm;Xe.subtract=tu;Xe.multiplyScalar=xm;Xe.multiplyScalarAndAdd=Tm;Xe.exactEquals=Sm;Xe.equals=Cm;Xe.sub=Xe.mul=void 0;var Dn=sm(xn());function Kl(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(Kl=function(c){return c?i:n})(t)}function sm(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||mo(t)!=="object"&&typeof t!="function")return{default:t};var i=Kl(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function rm(){var t=new Dn.ARRAY_TYPE(6);return Dn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function om(t){var n=new Dn.ARRAY_TYPE(6);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function am(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t}function cm(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function lm(t,n,i,r,c,u){var p=new Dn.ARRAY_TYPE(6);return p[0]=t,p[1]=n,p[2]=i,p[3]=r,p[4]=c,p[5]=u,p}function um(t,n,i,r,c,u,p){return t[0]=n,t[1]=i,t[2]=r,t[3]=c,t[4]=u,t[5]=p,t}function hm(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=n[4],_=n[5],g=i*u-r*c;return g?(g=1/g,t[0]=u*g,t[1]=-r*g,t[2]=-c*g,t[3]=i*g,t[4]=(c*_-u*p)*g,t[5]=(r*p-i*_)*g,t):null}function dm(t){return t[0]*t[3]-t[1]*t[2]}function eu(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=n[4],g=n[5],S=i[0],o=i[1],h=i[2],f=i[3],v=i[4],x=i[5];return t[0]=r*S+u*o,t[1]=c*S+p*o,t[2]=r*h+u*f,t[3]=c*h+p*f,t[4]=r*v+u*x+_,t[5]=c*v+p*x+g,t}function pm(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=n[4],g=n[5],S=Math.sin(i),o=Math.cos(i);return t[0]=r*o+u*S,t[1]=c*o+p*S,t[2]=r*-S+u*o,t[3]=c*-S+p*o,t[4]=_,t[5]=g,t}function fm(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=n[4],g=n[5],S=i[0],o=i[1];return t[0]=r*S,t[1]=c*S,t[2]=u*o,t[3]=p*o,t[4]=_,t[5]=g,t}function mm(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=n[4],g=n[5],S=i[0],o=i[1];return t[0]=r,t[1]=c,t[2]=u,t[3]=p,t[4]=r*S+u*o+_,t[5]=c*S+p*o+g,t}function _m(t,n){var i=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function gm(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=n[1],t[4]=0,t[5]=0,t}function vm(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0],t[5]=n[1],t}function ym(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function bm(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function wm(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t[3]=n[3]+i[3],t[4]=n[4]+i[4],t[5]=n[5]+i[5],t}function tu(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2],t[3]=n[3]-i[3],t[4]=n[4]-i[4],t[5]=n[5]-i[5],t}function xm(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=n[3]*i,t[4]=n[4]*i,t[5]=n[5]*i,t}function Tm(t,n,i,r){return t[0]=n[0]+i[0]*r,t[1]=n[1]+i[1]*r,t[2]=n[2]+i[2]*r,t[3]=n[3]+i[3]*r,t[4]=n[4]+i[4]*r,t[5]=n[5]+i[5]*r,t}function Sm(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]}function Cm(t,n){var i=t[0],r=t[1],c=t[2],u=t[3],p=t[4],_=t[5],g=n[0],S=n[1],o=n[2],h=n[3],f=n[4],v=n[5];return Math.abs(i-g)<=Dn.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(r-S)<=Dn.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(c-o)<=Dn.EPSILON*Math.max(1,Math.abs(c),Math.abs(o))&&Math.abs(u-h)<=Dn.EPSILON*Math.max(1,Math.abs(u),Math.abs(h))&&Math.abs(p-f)<=Dn.EPSILON*Math.max(1,Math.abs(p),Math.abs(f))&&Math.abs(_-v)<=Dn.EPSILON*Math.max(1,Math.abs(_),Math.abs(v))}var km=eu;Xe.mul=km;var Mm=tu;Xe.sub=Mm});var Ra=Ye(Ve=>{"use strict";function _o(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_o=function(i){return typeof i}:_o=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_o(t)}Object.defineProperty(Ve,"__esModule",{value:!0});Ve.create=Om;Ve.fromMat4=Rm;Ve.clone=Em;Ve.copy=Pm;Ve.fromValues=Dm;Ve.set=Im;Ve.identity=jm;Ve.transpose=Lm;Ve.invert=Fm;Ve.adjoint=qm;Ve.determinant=Vm;Ve.multiply=su;Ve.translate=Nm;Ve.rotate=Wm;Ve.scale=Bm;Ve.fromTranslation=zm;Ve.fromRotation=Um;Ve.fromScaling=Hm;Ve.fromMat2d=Gm;Ve.fromQuat=Ym;Ve.normalFromMat4=Xm;Ve.projection=Qm;Ve.str=Zm;Ve.frob=Jm;Ve.add=$m;Ve.subtract=ru;Ve.multiplyScalar=Km;Ve.multiplyScalarAndAdd=e_;Ve.exactEquals=t_;Ve.equals=n_;Ve.sub=Ve.mul=void 0;var nn=Am(xn());function iu(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(iu=function(c){return c?i:n})(t)}function Am(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||_o(t)!=="object"&&typeof t!="function")return{default:t};var i=iu(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function Om(){var t=new nn.ARRAY_TYPE(9);return nn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Rm(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[4],t[4]=n[5],t[5]=n[6],t[6]=n[8],t[7]=n[9],t[8]=n[10],t}function Em(t){var n=new nn.ARRAY_TYPE(9);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function Pm(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function Dm(t,n,i,r,c,u,p,_,g){var S=new nn.ARRAY_TYPE(9);return S[0]=t,S[1]=n,S[2]=i,S[3]=r,S[4]=c,S[5]=u,S[6]=p,S[7]=_,S[8]=g,S}function Im(t,n,i,r,c,u,p,_,g,S){return t[0]=n,t[1]=i,t[2]=r,t[3]=c,t[4]=u,t[5]=p,t[6]=_,t[7]=g,t[8]=S,t}function jm(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Lm(t,n){if(t===n){var i=n[1],r=n[2],c=n[5];t[1]=n[3],t[2]=n[6],t[3]=i,t[5]=n[7],t[6]=r,t[7]=c}else t[0]=n[0],t[1]=n[3],t[2]=n[6],t[3]=n[1],t[4]=n[4],t[5]=n[7],t[6]=n[2],t[7]=n[5],t[8]=n[8];return t}function Fm(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=n[4],_=n[5],g=n[6],S=n[7],o=n[8],h=o*p-_*S,f=-o*u+_*g,v=S*u-p*g,x=i*h+r*f+c*v;return x?(x=1/x,t[0]=h*x,t[1]=(-o*r+c*S)*x,t[2]=(_*r-c*p)*x,t[3]=f*x,t[4]=(o*i-c*g)*x,t[5]=(-_*i+c*u)*x,t[6]=v*x,t[7]=(-S*i+r*g)*x,t[8]=(p*i-r*u)*x,t):null}function qm(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=n[4],_=n[5],g=n[6],S=n[7],o=n[8];return t[0]=p*o-_*S,t[1]=c*S-r*o,t[2]=r*_-c*p,t[3]=_*g-u*o,t[4]=i*o-c*g,t[5]=c*u-i*_,t[6]=u*S-p*g,t[7]=r*g-i*S,t[8]=i*p-r*u,t}function Vm(t){var n=t[0],i=t[1],r=t[2],c=t[3],u=t[4],p=t[5],_=t[6],g=t[7],S=t[8];return n*(S*u-p*g)+i*(-S*c+p*_)+r*(g*c-u*_)}function su(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=n[4],g=n[5],S=n[6],o=n[7],h=n[8],f=i[0],v=i[1],x=i[2],T=i[3],w=i[4],y=i[5],C=i[6],m=i[7],M=i[8];return t[0]=f*r+v*p+x*S,t[1]=f*c+v*_+x*o,t[2]=f*u+v*g+x*h,t[3]=T*r+w*p+y*S,t[4]=T*c+w*_+y*o,t[5]=T*u+w*g+y*h,t[6]=C*r+m*p+M*S,t[7]=C*c+m*_+M*o,t[8]=C*u+m*g+M*h,t}function Nm(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=n[4],g=n[5],S=n[6],o=n[7],h=n[8],f=i[0],v=i[1];return t[0]=r,t[1]=c,t[2]=u,t[3]=p,t[4]=_,t[5]=g,t[6]=f*r+v*p+S,t[7]=f*c+v*_+o,t[8]=f*u+v*g+h,t}function Wm(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=n[4],g=n[5],S=n[6],o=n[7],h=n[8],f=Math.sin(i),v=Math.cos(i);return t[0]=v*r+f*p,t[1]=v*c+f*_,t[2]=v*u+f*g,t[3]=v*p-f*r,t[4]=v*_-f*c,t[5]=v*g-f*u,t[6]=S,t[7]=o,t[8]=h,t}function Bm(t,n,i){var r=i[0],c=i[1];return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=c*n[3],t[4]=c*n[4],t[5]=c*n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t}function zm(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=n[0],t[7]=n[1],t[8]=1,t}function Um(t,n){var i=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Hm(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=n[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Gm(t,n){return t[0]=n[0],t[1]=n[1],t[2]=0,t[3]=n[2],t[4]=n[3],t[5]=0,t[6]=n[4],t[7]=n[5],t[8]=1,t}function Ym(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=i+i,_=r+r,g=c+c,S=i*p,o=r*p,h=r*_,f=c*p,v=c*_,x=c*g,T=u*p,w=u*_,y=u*g;return t[0]=1-h-x,t[3]=o-y,t[6]=f+w,t[1]=o+y,t[4]=1-S-x,t[7]=v-T,t[2]=f-w,t[5]=v+T,t[8]=1-S-h,t}function Xm(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=n[4],_=n[5],g=n[6],S=n[7],o=n[8],h=n[9],f=n[10],v=n[11],x=n[12],T=n[13],w=n[14],y=n[15],C=i*_-r*p,m=i*g-c*p,M=i*S-u*p,R=r*g-c*_,I=r*S-u*_,L=c*S-u*g,q=o*T-h*x,z=o*w-f*x,U=o*y-v*x,H=h*w-f*T,ee=h*y-v*T,ie=f*y-v*w,ae=C*ie-m*ee+M*H+R*U-I*z+L*q;return ae?(ae=1/ae,t[0]=(_*ie-g*ee+S*H)*ae,t[1]=(g*U-p*ie-S*z)*ae,t[2]=(p*ee-_*U+S*q)*ae,t[3]=(c*ee-r*ie-u*H)*ae,t[4]=(i*ie-c*U+u*z)*ae,t[5]=(r*U-i*ee-u*q)*ae,t[6]=(T*L-w*I+y*R)*ae,t[7]=(w*M-x*L-y*m)*ae,t[8]=(x*I-T*M+y*C)*ae,t):null}function Qm(t,n,i){return t[0]=2/n,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function Zm(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Jm(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function $m(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t[3]=n[3]+i[3],t[4]=n[4]+i[4],t[5]=n[5]+i[5],t[6]=n[6]+i[6],t[7]=n[7]+i[7],t[8]=n[8]+i[8],t}function ru(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2],t[3]=n[3]-i[3],t[4]=n[4]-i[4],t[5]=n[5]-i[5],t[6]=n[6]-i[6],t[7]=n[7]-i[7],t[8]=n[8]-i[8],t}function Km(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=n[3]*i,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*i,t}function e_(t,n,i,r){return t[0]=n[0]+i[0]*r,t[1]=n[1]+i[1]*r,t[2]=n[2]+i[2]*r,t[3]=n[3]+i[3]*r,t[4]=n[4]+i[4]*r,t[5]=n[5]+i[5]*r,t[6]=n[6]+i[6]*r,t[7]=n[7]+i[7]*r,t[8]=n[8]+i[8]*r,t}function t_(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]}function n_(t,n){var i=t[0],r=t[1],c=t[2],u=t[3],p=t[4],_=t[5],g=t[6],S=t[7],o=t[8],h=n[0],f=n[1],v=n[2],x=n[3],T=n[4],w=n[5],y=n[6],C=n[7],m=n[8];return Math.abs(i-h)<=nn.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-f)<=nn.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(c-v)<=nn.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(u-x)<=nn.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(p-T)<=nn.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(_-w)<=nn.EPSILON*Math.max(1,Math.abs(_),Math.abs(w))&&Math.abs(g-y)<=nn.EPSILON*Math.max(1,Math.abs(g),Math.abs(y))&&Math.abs(S-C)<=nn.EPSILON*Math.max(1,Math.abs(S),Math.abs(C))&&Math.abs(o-m)<=nn.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))}var i_=su;Ve.mul=i_;var s_=ru;Ve.sub=s_});var Ea=Ye(we=>{"use strict";function go(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?go=function(i){return typeof i}:go=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},go(t)}Object.defineProperty(we,"__esModule",{value:!0});we.create=o_;we.clone=a_;we.copy=c_;we.fromValues=l_;we.set=u_;we.identity=au;we.transpose=h_;we.invert=d_;we.adjoint=p_;we.determinant=f_;we.multiply=cu;we.translate=m_;we.scale=__;we.rotate=g_;we.rotateX=v_;we.rotateY=y_;we.rotateZ=b_;we.fromTranslation=w_;we.fromScaling=x_;we.fromRotation=T_;we.fromXRotation=S_;we.fromYRotation=C_;we.fromZRotation=k_;we.fromRotationTranslation=lu;we.fromQuat2=M_;we.getTranslation=A_;we.getScaling=uu;we.getRotation=O_;we.fromRotationTranslationScale=R_;we.fromRotationTranslationScaleOrigin=E_;we.fromQuat=P_;we.frustum=D_;we.perspectiveNO=hu;we.perspectiveZO=j_;we.perspectiveFromFieldOfView=L_;we.orthoNO=du;we.orthoZO=q_;we.lookAt=V_;we.targetTo=N_;we.str=W_;we.frob=B_;we.add=z_;we.subtract=pu;we.multiplyScalar=U_;we.multiplyScalarAndAdd=H_;we.exactEquals=G_;we.equals=Y_;we.sub=we.mul=we.ortho=we.perspective=void 0;var Ke=r_(xn());function ou(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(ou=function(c){return c?i:n})(t)}function r_(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||go(t)!=="object"&&typeof t!="function")return{default:t};var i=ou(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function o_(){var t=new Ke.ARRAY_TYPE(16);return Ke.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function a_(t){var n=new Ke.ARRAY_TYPE(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function c_(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function l_(t,n,i,r,c,u,p,_,g,S,o,h,f,v,x,T){var w=new Ke.ARRAY_TYPE(16);return w[0]=t,w[1]=n,w[2]=i,w[3]=r,w[4]=c,w[5]=u,w[6]=p,w[7]=_,w[8]=g,w[9]=S,w[10]=o,w[11]=h,w[12]=f,w[13]=v,w[14]=x,w[15]=T,w}function u_(t,n,i,r,c,u,p,_,g,S,o,h,f,v,x,T,w){return t[0]=n,t[1]=i,t[2]=r,t[3]=c,t[4]=u,t[5]=p,t[6]=_,t[7]=g,t[8]=S,t[9]=o,t[10]=h,t[11]=f,t[12]=v,t[13]=x,t[14]=T,t[15]=w,t}function au(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h_(t,n){if(t===n){var i=n[1],r=n[2],c=n[3],u=n[6],p=n[7],_=n[11];t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=i,t[6]=n[9],t[7]=n[13],t[8]=r,t[9]=u,t[11]=n[14],t[12]=c,t[13]=p,t[14]=_}else t[0]=n[0],t[1]=n[4],t[2]=n[8],t[3]=n[12],t[4]=n[1],t[5]=n[5],t[6]=n[9],t[7]=n[13],t[8]=n[2],t[9]=n[6],t[10]=n[10],t[11]=n[14],t[12]=n[3],t[13]=n[7],t[14]=n[11],t[15]=n[15];return t}function d_(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=n[4],_=n[5],g=n[6],S=n[7],o=n[8],h=n[9],f=n[10],v=n[11],x=n[12],T=n[13],w=n[14],y=n[15],C=i*_-r*p,m=i*g-c*p,M=i*S-u*p,R=r*g-c*_,I=r*S-u*_,L=c*S-u*g,q=o*T-h*x,z=o*w-f*x,U=o*y-v*x,H=h*w-f*T,ee=h*y-v*T,ie=f*y-v*w,ae=C*ie-m*ee+M*H+R*U-I*z+L*q;return ae?(ae=1/ae,t[0]=(_*ie-g*ee+S*H)*ae,t[1]=(c*ee-r*ie-u*H)*ae,t[2]=(T*L-w*I+y*R)*ae,t[3]=(f*I-h*L-v*R)*ae,t[4]=(g*U-p*ie-S*z)*ae,t[5]=(i*ie-c*U+u*z)*ae,t[6]=(w*M-x*L-y*m)*ae,t[7]=(o*L-f*M+v*m)*ae,t[8]=(p*ee-_*U+S*q)*ae,t[9]=(r*U-i*ee-u*q)*ae,t[10]=(x*I-T*M+y*C)*ae,t[11]=(h*M-o*I-v*C)*ae,t[12]=(_*z-p*H-g*q)*ae,t[13]=(i*H-r*z+c*q)*ae,t[14]=(T*m-x*R-w*C)*ae,t[15]=(o*R-h*m+f*C)*ae,t):null}function p_(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=n[4],_=n[5],g=n[6],S=n[7],o=n[8],h=n[9],f=n[10],v=n[11],x=n[12],T=n[13],w=n[14],y=n[15];return t[0]=_*(f*y-v*w)-h*(g*y-S*w)+T*(g*v-S*f),t[1]=-(r*(f*y-v*w)-h*(c*y-u*w)+T*(c*v-u*f)),t[2]=r*(g*y-S*w)-_*(c*y-u*w)+T*(c*S-u*g),t[3]=-(r*(g*v-S*f)-_*(c*v-u*f)+h*(c*S-u*g)),t[4]=-(p*(f*y-v*w)-o*(g*y-S*w)+x*(g*v-S*f)),t[5]=i*(f*y-v*w)-o*(c*y-u*w)+x*(c*v-u*f),t[6]=-(i*(g*y-S*w)-p*(c*y-u*w)+x*(c*S-u*g)),t[7]=i*(g*v-S*f)-p*(c*v-u*f)+o*(c*S-u*g),t[8]=p*(h*y-v*T)-o*(_*y-S*T)+x*(_*v-S*h),t[9]=-(i*(h*y-v*T)-o*(r*y-u*T)+x*(r*v-u*h)),t[10]=i*(_*y-S*T)-p*(r*y-u*T)+x*(r*S-u*_),t[11]=-(i*(_*v-S*h)-p*(r*v-u*h)+o*(r*S-u*_)),t[12]=-(p*(h*w-f*T)-o*(_*w-g*T)+x*(_*f-g*h)),t[13]=i*(h*w-f*T)-o*(r*w-c*T)+x*(r*f-c*h),t[14]=-(i*(_*w-g*T)-p*(r*w-c*T)+x*(r*g-c*_)),t[15]=i*(_*f-g*h)-p*(r*f-c*h)+o*(r*g-c*_),t}function f_(t){var n=t[0],i=t[1],r=t[2],c=t[3],u=t[4],p=t[5],_=t[6],g=t[7],S=t[8],o=t[9],h=t[10],f=t[11],v=t[12],x=t[13],T=t[14],w=t[15],y=n*p-i*u,C=n*_-r*u,m=n*g-c*u,M=i*_-r*p,R=i*g-c*p,I=r*g-c*_,L=S*x-o*v,q=S*T-h*v,z=S*w-f*v,U=o*T-h*x,H=o*w-f*x,ee=h*w-f*T;return y*ee-C*H+m*U+M*z-R*q+I*L}function cu(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=n[4],g=n[5],S=n[6],o=n[7],h=n[8],f=n[9],v=n[10],x=n[11],T=n[12],w=n[13],y=n[14],C=n[15],m=i[0],M=i[1],R=i[2],I=i[3];return t[0]=m*r+M*_+R*h+I*T,t[1]=m*c+M*g+R*f+I*w,t[2]=m*u+M*S+R*v+I*y,t[3]=m*p+M*o+R*x+I*C,m=i[4],M=i[5],R=i[6],I=i[7],t[4]=m*r+M*_+R*h+I*T,t[5]=m*c+M*g+R*f+I*w,t[6]=m*u+M*S+R*v+I*y,t[7]=m*p+M*o+R*x+I*C,m=i[8],M=i[9],R=i[10],I=i[11],t[8]=m*r+M*_+R*h+I*T,t[9]=m*c+M*g+R*f+I*w,t[10]=m*u+M*S+R*v+I*y,t[11]=m*p+M*o+R*x+I*C,m=i[12],M=i[13],R=i[14],I=i[15],t[12]=m*r+M*_+R*h+I*T,t[13]=m*c+M*g+R*f+I*w,t[14]=m*u+M*S+R*v+I*y,t[15]=m*p+M*o+R*x+I*C,t}function m_(t,n,i){var r=i[0],c=i[1],u=i[2],p,_,g,S,o,h,f,v,x,T,w,y;return n===t?(t[12]=n[0]*r+n[4]*c+n[8]*u+n[12],t[13]=n[1]*r+n[5]*c+n[9]*u+n[13],t[14]=n[2]*r+n[6]*c+n[10]*u+n[14],t[15]=n[3]*r+n[7]*c+n[11]*u+n[15]):(p=n[0],_=n[1],g=n[2],S=n[3],o=n[4],h=n[5],f=n[6],v=n[7],x=n[8],T=n[9],w=n[10],y=n[11],t[0]=p,t[1]=_,t[2]=g,t[3]=S,t[4]=o,t[5]=h,t[6]=f,t[7]=v,t[8]=x,t[9]=T,t[10]=w,t[11]=y,t[12]=p*r+o*c+x*u+n[12],t[13]=_*r+h*c+T*u+n[13],t[14]=g*r+f*c+w*u+n[14],t[15]=S*r+v*c+y*u+n[15]),t}function __(t,n,i){var r=i[0],c=i[1],u=i[2];return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=n[3]*r,t[4]=n[4]*c,t[5]=n[5]*c,t[6]=n[6]*c,t[7]=n[7]*c,t[8]=n[8]*u,t[9]=n[9]*u,t[10]=n[10]*u,t[11]=n[11]*u,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function g_(t,n,i,r){var c=r[0],u=r[1],p=r[2],_=Math.hypot(c,u,p),g,S,o,h,f,v,x,T,w,y,C,m,M,R,I,L,q,z,U,H,ee,ie,ae,$;return _<Ke.EPSILON?null:(_=1/_,c*=_,u*=_,p*=_,g=Math.sin(i),S=Math.cos(i),o=1-S,h=n[0],f=n[1],v=n[2],x=n[3],T=n[4],w=n[5],y=n[6],C=n[7],m=n[8],M=n[9],R=n[10],I=n[11],L=c*c*o+S,q=u*c*o+p*g,z=p*c*o-u*g,U=c*u*o-p*g,H=u*u*o+S,ee=p*u*o+c*g,ie=c*p*o+u*g,ae=u*p*o-c*g,$=p*p*o+S,t[0]=h*L+T*q+m*z,t[1]=f*L+w*q+M*z,t[2]=v*L+y*q+R*z,t[3]=x*L+C*q+I*z,t[4]=h*U+T*H+m*ee,t[5]=f*U+w*H+M*ee,t[6]=v*U+y*H+R*ee,t[7]=x*U+C*H+I*ee,t[8]=h*ie+T*ae+m*$,t[9]=f*ie+w*ae+M*$,t[10]=v*ie+y*ae+R*$,t[11]=x*ie+C*ae+I*$,n!==t&&(t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t)}function v_(t,n,i){var r=Math.sin(i),c=Math.cos(i),u=n[4],p=n[5],_=n[6],g=n[7],S=n[8],o=n[9],h=n[10],f=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=u*c+S*r,t[5]=p*c+o*r,t[6]=_*c+h*r,t[7]=g*c+f*r,t[8]=S*c-u*r,t[9]=o*c-p*r,t[10]=h*c-_*r,t[11]=f*c-g*r,t}function y_(t,n,i){var r=Math.sin(i),c=Math.cos(i),u=n[0],p=n[1],_=n[2],g=n[3],S=n[8],o=n[9],h=n[10],f=n[11];return n!==t&&(t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=u*c-S*r,t[1]=p*c-o*r,t[2]=_*c-h*r,t[3]=g*c-f*r,t[8]=u*r+S*c,t[9]=p*r+o*c,t[10]=_*r+h*c,t[11]=g*r+f*c,t}function b_(t,n,i){var r=Math.sin(i),c=Math.cos(i),u=n[0],p=n[1],_=n[2],g=n[3],S=n[4],o=n[5],h=n[6],f=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=u*c+S*r,t[1]=p*c+o*r,t[2]=_*c+h*r,t[3]=g*c+f*r,t[4]=S*c-u*r,t[5]=o*c-p*r,t[6]=h*c-_*r,t[7]=f*c-g*r,t}function w_(t,n){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function x_(t,n){return t[0]=n[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T_(t,n,i){var r=i[0],c=i[1],u=i[2],p=Math.hypot(r,c,u),_,g,S;return p<Ke.EPSILON?null:(p=1/p,r*=p,c*=p,u*=p,_=Math.sin(n),g=Math.cos(n),S=1-g,t[0]=r*r*S+g,t[1]=c*r*S+u*_,t[2]=u*r*S-c*_,t[3]=0,t[4]=r*c*S-u*_,t[5]=c*c*S+g,t[6]=u*c*S+r*_,t[7]=0,t[8]=r*u*S+c*_,t[9]=c*u*S-r*_,t[10]=u*u*S+g,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function S_(t,n){var i=Math.sin(n),r=Math.cos(n);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C_(t,n){var i=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function k_(t,n){var i=Math.sin(n),r=Math.cos(n);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lu(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=r+r,g=c+c,S=u+u,o=r*_,h=r*g,f=r*S,v=c*g,x=c*S,T=u*S,w=p*_,y=p*g,C=p*S;return t[0]=1-(v+T),t[1]=h+C,t[2]=f-y,t[3]=0,t[4]=h-C,t[5]=1-(o+T),t[6]=x+w,t[7]=0,t[8]=f+y,t[9]=x-w,t[10]=1-(o+v),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function M_(t,n){var i=new Ke.ARRAY_TYPE(3),r=-n[0],c=-n[1],u=-n[2],p=n[3],_=n[4],g=n[5],S=n[6],o=n[7],h=r*r+c*c+u*u+p*p;return h>0?(i[0]=(_*p+o*r+g*u-S*c)*2/h,i[1]=(g*p+o*c+S*r-_*u)*2/h,i[2]=(S*p+o*u+_*c-g*r)*2/h):(i[0]=(_*p+o*r+g*u-S*c)*2,i[1]=(g*p+o*c+S*r-_*u)*2,i[2]=(S*p+o*u+_*c-g*r)*2),lu(t,n,i),t}function A_(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function uu(t,n){var i=n[0],r=n[1],c=n[2],u=n[4],p=n[5],_=n[6],g=n[8],S=n[9],o=n[10];return t[0]=Math.hypot(i,r,c),t[1]=Math.hypot(u,p,_),t[2]=Math.hypot(g,S,o),t}function O_(t,n){var i=new Ke.ARRAY_TYPE(3);uu(i,n);var r=1/i[0],c=1/i[1],u=1/i[2],p=n[0]*r,_=n[1]*c,g=n[2]*u,S=n[4]*r,o=n[5]*c,h=n[6]*u,f=n[8]*r,v=n[9]*c,x=n[10]*u,T=p+o+x,w=0;return T>0?(w=Math.sqrt(T+1)*2,t[3]=.25*w,t[0]=(h-v)/w,t[1]=(f-g)/w,t[2]=(_-S)/w):p>o&&p>x?(w=Math.sqrt(1+p-o-x)*2,t[3]=(h-v)/w,t[0]=.25*w,t[1]=(_+S)/w,t[2]=(f+g)/w):o>x?(w=Math.sqrt(1+o-p-x)*2,t[3]=(f-g)/w,t[0]=(_+S)/w,t[1]=.25*w,t[2]=(h+v)/w):(w=Math.sqrt(1+x-p-o)*2,t[3]=(_-S)/w,t[0]=(f+g)/w,t[1]=(h+v)/w,t[2]=.25*w),t}function R_(t,n,i,r){var c=n[0],u=n[1],p=n[2],_=n[3],g=c+c,S=u+u,o=p+p,h=c*g,f=c*S,v=c*o,x=u*S,T=u*o,w=p*o,y=_*g,C=_*S,m=_*o,M=r[0],R=r[1],I=r[2];return t[0]=(1-(x+w))*M,t[1]=(f+m)*M,t[2]=(v-C)*M,t[3]=0,t[4]=(f-m)*R,t[5]=(1-(h+w))*R,t[6]=(T+y)*R,t[7]=0,t[8]=(v+C)*I,t[9]=(T-y)*I,t[10]=(1-(h+x))*I,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function E_(t,n,i,r,c){var u=n[0],p=n[1],_=n[2],g=n[3],S=u+u,o=p+p,h=_+_,f=u*S,v=u*o,x=u*h,T=p*o,w=p*h,y=_*h,C=g*S,m=g*o,M=g*h,R=r[0],I=r[1],L=r[2],q=c[0],z=c[1],U=c[2],H=(1-(T+y))*R,ee=(v+M)*R,ie=(x-m)*R,ae=(v-M)*I,$=(1-(f+y))*I,ce=(w+C)*I,re=(x+m)*L,qe=(w-C)*L,he=(1-(f+T))*L;return t[0]=H,t[1]=ee,t[2]=ie,t[3]=0,t[4]=ae,t[5]=$,t[6]=ce,t[7]=0,t[8]=re,t[9]=qe,t[10]=he,t[11]=0,t[12]=i[0]+q-(H*q+ae*z+re*U),t[13]=i[1]+z-(ee*q+$*z+qe*U),t[14]=i[2]+U-(ie*q+ce*z+he*U),t[15]=1,t}function P_(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=i+i,_=r+r,g=c+c,S=i*p,o=r*p,h=r*_,f=c*p,v=c*_,x=c*g,T=u*p,w=u*_,y=u*g;return t[0]=1-h-x,t[1]=o+y,t[2]=f-w,t[3]=0,t[4]=o-y,t[5]=1-S-x,t[6]=v+T,t[7]=0,t[8]=f+w,t[9]=v-T,t[10]=1-S-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D_(t,n,i,r,c,u,p){var _=1/(i-n),g=1/(c-r),S=1/(u-p);return t[0]=u*2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u*2*g,t[6]=0,t[7]=0,t[8]=(i+n)*_,t[9]=(c+r)*g,t[10]=(p+u)*S,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*u*2*S,t[15]=0,t}function hu(t,n,i,r,c){var u=1/Math.tan(n/2),p;return t[0]=u/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(p=1/(r-c),t[10]=(c+r)*p,t[14]=2*c*r*p):(t[10]=-1,t[14]=-2*r),t}var I_=hu;we.perspective=I_;function j_(t,n,i,r,c){var u=1/Math.tan(n/2),p;return t[0]=u/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,c!=null&&c!==1/0?(p=1/(r-c),t[10]=c*p,t[14]=c*r*p):(t[10]=-1,t[14]=-r),t}function L_(t,n,i,r){var c=Math.tan(n.upDegrees*Math.PI/180),u=Math.tan(n.downDegrees*Math.PI/180),p=Math.tan(n.leftDegrees*Math.PI/180),_=Math.tan(n.rightDegrees*Math.PI/180),g=2/(p+_),S=2/(c+u);return t[0]=g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=-((p-_)*g*.5),t[9]=(c-u)*S*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function du(t,n,i,r,c,u,p){var _=1/(n-i),g=1/(r-c),S=1/(u-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*S,t[11]=0,t[12]=(n+i)*_,t[13]=(c+r)*g,t[14]=(p+u)*S,t[15]=1,t}var F_=du;we.ortho=F_;function q_(t,n,i,r,c,u,p){var _=1/(n-i),g=1/(r-c),S=1/(u-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=S,t[11]=0,t[12]=(n+i)*_,t[13]=(c+r)*g,t[14]=u*S,t[15]=1,t}function V_(t,n,i,r){var c,u,p,_,g,S,o,h,f,v,x=n[0],T=n[1],w=n[2],y=r[0],C=r[1],m=r[2],M=i[0],R=i[1],I=i[2];return Math.abs(x-M)<Ke.EPSILON&&Math.abs(T-R)<Ke.EPSILON&&Math.abs(w-I)<Ke.EPSILON?au(t):(o=x-M,h=T-R,f=w-I,v=1/Math.hypot(o,h,f),o*=v,h*=v,f*=v,c=C*f-m*h,u=m*o-y*f,p=y*h-C*o,v=Math.hypot(c,u,p),v?(v=1/v,c*=v,u*=v,p*=v):(c=0,u=0,p=0),_=h*p-f*u,g=f*c-o*p,S=o*u-h*c,v=Math.hypot(_,g,S),v?(v=1/v,_*=v,g*=v,S*=v):(_=0,g=0,S=0),t[0]=c,t[1]=_,t[2]=o,t[3]=0,t[4]=u,t[5]=g,t[6]=h,t[7]=0,t[8]=p,t[9]=S,t[10]=f,t[11]=0,t[12]=-(c*x+u*T+p*w),t[13]=-(_*x+g*T+S*w),t[14]=-(o*x+h*T+f*w),t[15]=1,t)}function N_(t,n,i,r){var c=n[0],u=n[1],p=n[2],_=r[0],g=r[1],S=r[2],o=c-i[0],h=u-i[1],f=p-i[2],v=o*o+h*h+f*f;v>0&&(v=1/Math.sqrt(v),o*=v,h*=v,f*=v);var x=g*f-S*h,T=S*o-_*f,w=_*h-g*o;return v=x*x+T*T+w*w,v>0&&(v=1/Math.sqrt(v),x*=v,T*=v,w*=v),t[0]=x,t[1]=T,t[2]=w,t[3]=0,t[4]=h*w-f*T,t[5]=f*x-o*w,t[6]=o*T-h*x,t[7]=0,t[8]=o,t[9]=h,t[10]=f,t[11]=0,t[12]=c,t[13]=u,t[14]=p,t[15]=1,t}function W_(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function B_(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function z_(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t[3]=n[3]+i[3],t[4]=n[4]+i[4],t[5]=n[5]+i[5],t[6]=n[6]+i[6],t[7]=n[7]+i[7],t[8]=n[8]+i[8],t[9]=n[9]+i[9],t[10]=n[10]+i[10],t[11]=n[11]+i[11],t[12]=n[12]+i[12],t[13]=n[13]+i[13],t[14]=n[14]+i[14],t[15]=n[15]+i[15],t}function pu(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2],t[3]=n[3]-i[3],t[4]=n[4]-i[4],t[5]=n[5]-i[5],t[6]=n[6]-i[6],t[7]=n[7]-i[7],t[8]=n[8]-i[8],t[9]=n[9]-i[9],t[10]=n[10]-i[10],t[11]=n[11]-i[11],t[12]=n[12]-i[12],t[13]=n[13]-i[13],t[14]=n[14]-i[14],t[15]=n[15]-i[15],t}function U_(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=n[3]*i,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=n[11]*i,t[12]=n[12]*i,t[13]=n[13]*i,t[14]=n[14]*i,t[15]=n[15]*i,t}function H_(t,n,i,r){return t[0]=n[0]+i[0]*r,t[1]=n[1]+i[1]*r,t[2]=n[2]+i[2]*r,t[3]=n[3]+i[3]*r,t[4]=n[4]+i[4]*r,t[5]=n[5]+i[5]*r,t[6]=n[6]+i[6]*r,t[7]=n[7]+i[7]*r,t[8]=n[8]+i[8]*r,t[9]=n[9]+i[9]*r,t[10]=n[10]+i[10]*r,t[11]=n[11]+i[11]*r,t[12]=n[12]+i[12]*r,t[13]=n[13]+i[13]*r,t[14]=n[14]+i[14]*r,t[15]=n[15]+i[15]*r,t}function G_(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]&&t[8]===n[8]&&t[9]===n[9]&&t[10]===n[10]&&t[11]===n[11]&&t[12]===n[12]&&t[13]===n[13]&&t[14]===n[14]&&t[15]===n[15]}function Y_(t,n){var i=t[0],r=t[1],c=t[2],u=t[3],p=t[4],_=t[5],g=t[6],S=t[7],o=t[8],h=t[9],f=t[10],v=t[11],x=t[12],T=t[13],w=t[14],y=t[15],C=n[0],m=n[1],M=n[2],R=n[3],I=n[4],L=n[5],q=n[6],z=n[7],U=n[8],H=n[9],ee=n[10],ie=n[11],ae=n[12],$=n[13],ce=n[14],re=n[15];return Math.abs(i-C)<=Ke.EPSILON*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(r-m)<=Ke.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(c-M)<=Ke.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(u-R)<=Ke.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(p-I)<=Ke.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(_-L)<=Ke.EPSILON*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(g-q)<=Ke.EPSILON*Math.max(1,Math.abs(g),Math.abs(q))&&Math.abs(S-z)<=Ke.EPSILON*Math.max(1,Math.abs(S),Math.abs(z))&&Math.abs(o-U)<=Ke.EPSILON*Math.max(1,Math.abs(o),Math.abs(U))&&Math.abs(h-H)<=Ke.EPSILON*Math.max(1,Math.abs(h),Math.abs(H))&&Math.abs(f-ee)<=Ke.EPSILON*Math.max(1,Math.abs(f),Math.abs(ee))&&Math.abs(v-ie)<=Ke.EPSILON*Math.max(1,Math.abs(v),Math.abs(ie))&&Math.abs(x-ae)<=Ke.EPSILON*Math.max(1,Math.abs(x),Math.abs(ae))&&Math.abs(T-$)<=Ke.EPSILON*Math.max(1,Math.abs(T),Math.abs($))&&Math.abs(w-ce)<=Ke.EPSILON*Math.max(1,Math.abs(w),Math.abs(ce))&&Math.abs(y-re)<=Ke.EPSILON*Math.max(1,Math.abs(y),Math.abs(re))}var X_=cu;we.mul=X_;var Q_=pu;we.sub=Q_});var Pa=Ye(ve=>{"use strict";function vo(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vo=function(i){return typeof i}:vo=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},vo(t)}Object.defineProperty(ve,"__esModule",{value:!0});ve.create=mu;ve.clone=J_;ve.length=_u;ve.fromValues=$_;ve.copy=K_;ve.set=eg;ve.add=tg;ve.subtract=gu;ve.multiply=vu;ve.divide=yu;ve.ceil=ng;ve.floor=ig;ve.min=sg;ve.max=rg;ve.round=og;ve.scale=ag;ve.scaleAndAdd=cg;ve.distance=bu;ve.squaredDistance=wu;ve.squaredLength=xu;ve.negate=lg;ve.inverse=ug;ve.normalize=hg;ve.dot=Tu;ve.cross=dg;ve.lerp=pg;ve.hermite=fg;ve.bezier=mg;ve.random=_g;ve.transformMat4=gg;ve.transformMat3=vg;ve.transformQuat=yg;ve.rotateX=bg;ve.rotateY=wg;ve.rotateZ=xg;ve.angle=Tg;ve.zero=Sg;ve.str=Cg;ve.exactEquals=kg;ve.equals=Mg;ve.forEach=ve.sqrLen=ve.len=ve.sqrDist=ve.dist=ve.div=ve.mul=ve.sub=void 0;var Xn=Z_(xn());function fu(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(fu=function(c){return c?i:n})(t)}function Z_(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||vo(t)!=="object"&&typeof t!="function")return{default:t};var i=fu(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function mu(){var t=new Xn.ARRAY_TYPE(3);return Xn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function J_(t){var n=new Xn.ARRAY_TYPE(3);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n}function _u(t){var n=t[0],i=t[1],r=t[2];return Math.hypot(n,i,r)}function $_(t,n,i){var r=new Xn.ARRAY_TYPE(3);return r[0]=t,r[1]=n,r[2]=i,r}function K_(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function eg(t,n,i,r){return t[0]=n,t[1]=i,t[2]=r,t}function tg(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t}function gu(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2],t}function vu(t,n,i){return t[0]=n[0]*i[0],t[1]=n[1]*i[1],t[2]=n[2]*i[2],t}function yu(t,n,i){return t[0]=n[0]/i[0],t[1]=n[1]/i[1],t[2]=n[2]/i[2],t}function ng(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t}function ig(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t}function sg(t,n,i){return t[0]=Math.min(n[0],i[0]),t[1]=Math.min(n[1],i[1]),t[2]=Math.min(n[2],i[2]),t}function rg(t,n,i){return t[0]=Math.max(n[0],i[0]),t[1]=Math.max(n[1],i[1]),t[2]=Math.max(n[2],i[2]),t}function og(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t}function ag(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t}function cg(t,n,i,r){return t[0]=n[0]+i[0]*r,t[1]=n[1]+i[1]*r,t[2]=n[2]+i[2]*r,t}function bu(t,n){var i=n[0]-t[0],r=n[1]-t[1],c=n[2]-t[2];return Math.hypot(i,r,c)}function wu(t,n){var i=n[0]-t[0],r=n[1]-t[1],c=n[2]-t[2];return i*i+r*r+c*c}function xu(t){var n=t[0],i=t[1],r=t[2];return n*n+i*i+r*r}function lg(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function ug(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t}function hg(t,n){var i=n[0],r=n[1],c=n[2],u=i*i+r*r+c*c;return u>0&&(u=1/Math.sqrt(u)),t[0]=n[0]*u,t[1]=n[1]*u,t[2]=n[2]*u,t}function Tu(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function dg(t,n,i){var r=n[0],c=n[1],u=n[2],p=i[0],_=i[1],g=i[2];return t[0]=c*g-u*_,t[1]=u*p-r*g,t[2]=r*_-c*p,t}function pg(t,n,i,r){var c=n[0],u=n[1],p=n[2];return t[0]=c+r*(i[0]-c),t[1]=u+r*(i[1]-u),t[2]=p+r*(i[2]-p),t}function fg(t,n,i,r,c,u){var p=u*u,_=p*(2*u-3)+1,g=p*(u-2)+u,S=p*(u-1),o=p*(3-2*u);return t[0]=n[0]*_+i[0]*g+r[0]*S+c[0]*o,t[1]=n[1]*_+i[1]*g+r[1]*S+c[1]*o,t[2]=n[2]*_+i[2]*g+r[2]*S+c[2]*o,t}function mg(t,n,i,r,c,u){var p=1-u,_=p*p,g=u*u,S=_*p,o=3*u*_,h=3*g*p,f=g*u;return t[0]=n[0]*S+i[0]*o+r[0]*h+c[0]*f,t[1]=n[1]*S+i[1]*o+r[1]*h+c[1]*f,t[2]=n[2]*S+i[2]*o+r[2]*h+c[2]*f,t}function _g(t,n){n=n||1;var i=Xn.RANDOM()*2*Math.PI,r=Xn.RANDOM()*2-1,c=Math.sqrt(1-r*r)*n;return t[0]=Math.cos(i)*c,t[1]=Math.sin(i)*c,t[2]=r*n,t}function gg(t,n,i){var r=n[0],c=n[1],u=n[2],p=i[3]*r+i[7]*c+i[11]*u+i[15];return p=p||1,t[0]=(i[0]*r+i[4]*c+i[8]*u+i[12])/p,t[1]=(i[1]*r+i[5]*c+i[9]*u+i[13])/p,t[2]=(i[2]*r+i[6]*c+i[10]*u+i[14])/p,t}function vg(t,n,i){var r=n[0],c=n[1],u=n[2];return t[0]=r*i[0]+c*i[3]+u*i[6],t[1]=r*i[1]+c*i[4]+u*i[7],t[2]=r*i[2]+c*i[5]+u*i[8],t}function yg(t,n,i){var r=i[0],c=i[1],u=i[2],p=i[3],_=n[0],g=n[1],S=n[2],o=c*S-u*g,h=u*_-r*S,f=r*g-c*_,v=c*f-u*h,x=u*o-r*f,T=r*h-c*o,w=p*2;return o*=w,h*=w,f*=w,v*=2,x*=2,T*=2,t[0]=_+o+v,t[1]=g+h+x,t[2]=S+f+T,t}function bg(t,n,i,r){var c=[],u=[];return c[0]=n[0]-i[0],c[1]=n[1]-i[1],c[2]=n[2]-i[2],u[0]=c[0],u[1]=c[1]*Math.cos(r)-c[2]*Math.sin(r),u[2]=c[1]*Math.sin(r)+c[2]*Math.cos(r),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function wg(t,n,i,r){var c=[],u=[];return c[0]=n[0]-i[0],c[1]=n[1]-i[1],c[2]=n[2]-i[2],u[0]=c[2]*Math.sin(r)+c[0]*Math.cos(r),u[1]=c[1],u[2]=c[2]*Math.cos(r)-c[0]*Math.sin(r),t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function xg(t,n,i,r){var c=[],u=[];return c[0]=n[0]-i[0],c[1]=n[1]-i[1],c[2]=n[2]-i[2],u[0]=c[0]*Math.cos(r)-c[1]*Math.sin(r),u[1]=c[0]*Math.sin(r)+c[1]*Math.cos(r),u[2]=c[2],t[0]=u[0]+i[0],t[1]=u[1]+i[1],t[2]=u[2]+i[2],t}function Tg(t,n){var i=t[0],r=t[1],c=t[2],u=n[0],p=n[1],_=n[2],g=Math.sqrt(i*i+r*r+c*c),S=Math.sqrt(u*u+p*p+_*_),o=g*S,h=o&&Tu(t,n)/o;return Math.acos(Math.min(Math.max(h,-1),1))}function Sg(t){return t[0]=0,t[1]=0,t[2]=0,t}function Cg(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function kg(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function Mg(t,n){var i=t[0],r=t[1],c=t[2],u=n[0],p=n[1],_=n[2];return Math.abs(i-u)<=Xn.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-p)<=Xn.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(c-_)<=Xn.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))}var Ag=gu;ve.sub=Ag;var Og=vu;ve.mul=Og;var Rg=yu;ve.div=Rg;var Eg=bu;ve.dist=Eg;var Pg=wu;ve.sqrDist=Pg;var Dg=_u;ve.len=Dg;var Ig=xu;ve.sqrLen=Ig;var jg=function(){var t=mu();return function(n,i,r,c,u,p){var _,g;for(i||(i=3),r||(r=0),c?g=Math.min(c*i+r,n.length):g=n.length,_=r;_<g;_+=i)t[0]=n[_],t[1]=n[_+1],t[2]=n[_+2],u(t,t,p),n[_]=t[0],n[_+1]=t[1],n[_+2]=t[2];return n}}();ve.forEach=jg});var Da=Ye(ke=>{"use strict";function yo(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?yo=function(i){return typeof i}:yo=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},yo(t)}Object.defineProperty(ke,"__esModule",{value:!0});ke.create=Cu;ke.clone=Fg;ke.fromValues=qg;ke.copy=Vg;ke.set=Ng;ke.add=Wg;ke.subtract=ku;ke.multiply=Mu;ke.divide=Au;ke.ceil=Bg;ke.floor=zg;ke.min=Ug;ke.max=Hg;ke.round=Gg;ke.scale=Yg;ke.scaleAndAdd=Xg;ke.distance=Ou;ke.squaredDistance=Ru;ke.length=Eu;ke.squaredLength=Pu;ke.negate=Qg;ke.inverse=Zg;ke.normalize=Jg;ke.dot=$g;ke.cross=Kg;ke.lerp=ev;ke.random=tv;ke.transformMat4=nv;ke.transformQuat=iv;ke.zero=sv;ke.str=rv;ke.exactEquals=ov;ke.equals=av;ke.forEach=ke.sqrLen=ke.len=ke.sqrDist=ke.dist=ke.div=ke.mul=ke.sub=void 0;var pn=Lg(xn());function Su(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(Su=function(c){return c?i:n})(t)}function Lg(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||yo(t)!=="object"&&typeof t!="function")return{default:t};var i=Su(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function Cu(){var t=new pn.ARRAY_TYPE(4);return pn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Fg(t){var n=new pn.ARRAY_TYPE(4);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n}function qg(t,n,i,r){var c=new pn.ARRAY_TYPE(4);return c[0]=t,c[1]=n,c[2]=i,c[3]=r,c}function Vg(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function Ng(t,n,i,r,c){return t[0]=n,t[1]=i,t[2]=r,t[3]=c,t}function Wg(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t[3]=n[3]+i[3],t}function ku(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t[2]=n[2]-i[2],t[3]=n[3]-i[3],t}function Mu(t,n,i){return t[0]=n[0]*i[0],t[1]=n[1]*i[1],t[2]=n[2]*i[2],t[3]=n[3]*i[3],t}function Au(t,n,i){return t[0]=n[0]/i[0],t[1]=n[1]/i[1],t[2]=n[2]/i[2],t[3]=n[3]/i[3],t}function Bg(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t[2]=Math.ceil(n[2]),t[3]=Math.ceil(n[3]),t}function zg(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t[2]=Math.floor(n[2]),t[3]=Math.floor(n[3]),t}function Ug(t,n,i){return t[0]=Math.min(n[0],i[0]),t[1]=Math.min(n[1],i[1]),t[2]=Math.min(n[2],i[2]),t[3]=Math.min(n[3],i[3]),t}function Hg(t,n,i){return t[0]=Math.max(n[0],i[0]),t[1]=Math.max(n[1],i[1]),t[2]=Math.max(n[2],i[2]),t[3]=Math.max(n[3],i[3]),t}function Gg(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t[2]=Math.round(n[2]),t[3]=Math.round(n[3]),t}function Yg(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=n[3]*i,t}function Xg(t,n,i,r){return t[0]=n[0]+i[0]*r,t[1]=n[1]+i[1]*r,t[2]=n[2]+i[2]*r,t[3]=n[3]+i[3]*r,t}function Ou(t,n){var i=n[0]-t[0],r=n[1]-t[1],c=n[2]-t[2],u=n[3]-t[3];return Math.hypot(i,r,c,u)}function Ru(t,n){var i=n[0]-t[0],r=n[1]-t[1],c=n[2]-t[2],u=n[3]-t[3];return i*i+r*r+c*c+u*u}function Eu(t){var n=t[0],i=t[1],r=t[2],c=t[3];return Math.hypot(n,i,r,c)}function Pu(t){var n=t[0],i=t[1],r=t[2],c=t[3];return n*n+i*i+r*r+c*c}function Qg(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=-n[3],t}function Zg(t,n){return t[0]=1/n[0],t[1]=1/n[1],t[2]=1/n[2],t[3]=1/n[3],t}function Jg(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=i*i+r*r+c*c+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=i*p,t[1]=r*p,t[2]=c*p,t[3]=u*p,t}function $g(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]}function Kg(t,n,i,r){var c=i[0]*r[1]-i[1]*r[0],u=i[0]*r[2]-i[2]*r[0],p=i[0]*r[3]-i[3]*r[0],_=i[1]*r[2]-i[2]*r[1],g=i[1]*r[3]-i[3]*r[1],S=i[2]*r[3]-i[3]*r[2],o=n[0],h=n[1],f=n[2],v=n[3];return t[0]=h*S-f*g+v*_,t[1]=-(o*S)+f*p-v*u,t[2]=o*g-h*p+v*c,t[3]=-(o*_)+h*u-f*c,t}function ev(t,n,i,r){var c=n[0],u=n[1],p=n[2],_=n[3];return t[0]=c+r*(i[0]-c),t[1]=u+r*(i[1]-u),t[2]=p+r*(i[2]-p),t[3]=_+r*(i[3]-_),t}function tv(t,n){n=n||1;var i,r,c,u,p,_;do i=pn.RANDOM()*2-1,r=pn.RANDOM()*2-1,p=i*i+r*r;while(p>=1);do c=pn.RANDOM()*2-1,u=pn.RANDOM()*2-1,_=c*c+u*u;while(_>=1);var g=Math.sqrt((1-p)/_);return t[0]=n*i,t[1]=n*r,t[2]=n*c*g,t[3]=n*u*g,t}function nv(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3];return t[0]=i[0]*r+i[4]*c+i[8]*u+i[12]*p,t[1]=i[1]*r+i[5]*c+i[9]*u+i[13]*p,t[2]=i[2]*r+i[6]*c+i[10]*u+i[14]*p,t[3]=i[3]*r+i[7]*c+i[11]*u+i[15]*p,t}function iv(t,n,i){var r=n[0],c=n[1],u=n[2],p=i[0],_=i[1],g=i[2],S=i[3],o=S*r+_*u-g*c,h=S*c+g*r-p*u,f=S*u+p*c-_*r,v=-p*r-_*c-g*u;return t[0]=o*S+v*-p+h*-g-f*-_,t[1]=h*S+v*-_+f*-p-o*-g,t[2]=f*S+v*-g+o*-_-h*-p,t[3]=n[3],t}function sv(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function rv(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function ov(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function av(t,n){var i=t[0],r=t[1],c=t[2],u=t[3],p=n[0],_=n[1],g=n[2],S=n[3];return Math.abs(i-p)<=pn.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-_)<=pn.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(c-g)<=pn.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(u-S)<=pn.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))}var cv=ku;ke.sub=cv;var lv=Mu;ke.mul=lv;var uv=Au;ke.div=uv;var hv=Ou;ke.dist=hv;var dv=Ru;ke.sqrDist=dv;var pv=Eu;ke.len=pv;var fv=Pu;ke.sqrLen=fv;var mv=function(){var t=Cu();return function(n,i,r,c,u,p){var _,g;for(i||(i=4),r||(r=0),c?g=Math.min(c*i+r,n.length):g=n.length,_=r;_<g;_+=i)t[0]=n[_],t[1]=n[_+1],t[2]=n[_+2],t[3]=n[_+3],u(t,t,p),n[_]=t[0],n[_+1]=t[1],n[_+2]=t[2],n[_+3]=t[3];return n}}();ke.forEach=mv});var La=Ye(ge=>{"use strict";function bo(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?bo=function(i){return typeof i}:bo=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},bo(t)}Object.defineProperty(ge,"__esModule",{value:!0});ge.create=Ia;ge.identity=gv;ge.setAxisAngle=Iu;ge.getAxisAngle=vv;ge.getAngle=yv;ge.multiply=ju;ge.rotateX=bv;ge.rotateY=wv;ge.rotateZ=xv;ge.calculateW=Tv;ge.exp=Lu;ge.ln=Fu;ge.pow=Sv;ge.slerp=xo;ge.random=Cv;ge.invert=kv;ge.conjugate=Mv;ge.fromMat3=qu;ge.fromEuler=Av;ge.str=Ov;ge.setAxes=ge.sqlerp=ge.rotationTo=ge.equals=ge.exactEquals=ge.normalize=ge.sqrLen=ge.squaredLength=ge.len=ge.length=ge.lerp=ge.dot=ge.scale=ge.mul=ge.add=ge.set=ge.copy=ge.fromValues=ge.clone=void 0;var Oi=wo(xn()),_v=wo(Ra()),Qn=wo(Pa()),sn=wo(Da());function Du(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(Du=function(c){return c?i:n})(t)}function wo(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||bo(t)!=="object"&&typeof t!="function")return{default:t};var i=Du(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function Ia(){var t=new Oi.ARRAY_TYPE(4);return Oi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function gv(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Iu(t,n,i){i=i*.5;var r=Math.sin(i);return t[0]=r*n[0],t[1]=r*n[1],t[2]=r*n[2],t[3]=Math.cos(i),t}function vv(t,n){var i=Math.acos(n[3])*2,r=Math.sin(i/2);return r>Oi.EPSILON?(t[0]=n[0]/r,t[1]=n[1]/r,t[2]=n[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function yv(t,n){var i=Nu(t,n);return Math.acos(2*i*i-1)}function ju(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=i[0],g=i[1],S=i[2],o=i[3];return t[0]=r*o+p*_+c*S-u*g,t[1]=c*o+p*g+u*_-r*S,t[2]=u*o+p*S+r*g-c*_,t[3]=p*o-r*_-c*g-u*S,t}function bv(t,n,i){i*=.5;var r=n[0],c=n[1],u=n[2],p=n[3],_=Math.sin(i),g=Math.cos(i);return t[0]=r*g+p*_,t[1]=c*g+u*_,t[2]=u*g-c*_,t[3]=p*g-r*_,t}function wv(t,n,i){i*=.5;var r=n[0],c=n[1],u=n[2],p=n[3],_=Math.sin(i),g=Math.cos(i);return t[0]=r*g-u*_,t[1]=c*g+p*_,t[2]=u*g+r*_,t[3]=p*g-c*_,t}function xv(t,n,i){i*=.5;var r=n[0],c=n[1],u=n[2],p=n[3],_=Math.sin(i),g=Math.cos(i);return t[0]=r*g+c*_,t[1]=c*g-r*_,t[2]=u*g+p*_,t[3]=p*g-u*_,t}function Tv(t,n){var i=n[0],r=n[1],c=n[2];return t[0]=i,t[1]=r,t[2]=c,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-c*c)),t}function Lu(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=Math.sqrt(i*i+r*r+c*c),_=Math.exp(u),g=p>0?_*Math.sin(p)/p:0;return t[0]=i*g,t[1]=r*g,t[2]=c*g,t[3]=_*Math.cos(p),t}function Fu(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=Math.sqrt(i*i+r*r+c*c),_=p>0?Math.atan2(p,u)/p:0;return t[0]=i*_,t[1]=r*_,t[2]=c*_,t[3]=.5*Math.log(i*i+r*r+c*c+u*u),t}function Sv(t,n,i){return Fu(t,n),Vu(t,t,i),Lu(t,t),t}function xo(t,n,i,r){var c=n[0],u=n[1],p=n[2],_=n[3],g=i[0],S=i[1],o=i[2],h=i[3],f,v,x,T,w;return v=c*g+u*S+p*o+_*h,v<0&&(v=-v,g=-g,S=-S,o=-o,h=-h),1-v>Oi.EPSILON?(f=Math.acos(v),x=Math.sin(f),T=Math.sin((1-r)*f)/x,w=Math.sin(r*f)/x):(T=1-r,w=r),t[0]=T*c+w*g,t[1]=T*u+w*S,t[2]=T*p+w*o,t[3]=T*_+w*h,t}function Cv(t){var n=Oi.RANDOM(),i=Oi.RANDOM(),r=Oi.RANDOM(),c=Math.sqrt(1-n),u=Math.sqrt(n);return t[0]=c*Math.sin(2*Math.PI*i),t[1]=c*Math.cos(2*Math.PI*i),t[2]=u*Math.sin(2*Math.PI*r),t[3]=u*Math.cos(2*Math.PI*r),t}function kv(t,n){var i=n[0],r=n[1],c=n[2],u=n[3],p=i*i+r*r+c*c+u*u,_=p?1/p:0;return t[0]=-i*_,t[1]=-r*_,t[2]=-c*_,t[3]=u*_,t}function Mv(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t}function qu(t,n){var i=n[0]+n[4]+n[8],r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(n[5]-n[7])*r,t[1]=(n[6]-n[2])*r,t[2]=(n[1]-n[3])*r;else{var c=0;n[4]>n[0]&&(c=1),n[8]>n[c*3+c]&&(c=2);var u=(c+1)%3,p=(c+2)%3;r=Math.sqrt(n[c*3+c]-n[u*3+u]-n[p*3+p]+1),t[c]=.5*r,r=.5/r,t[3]=(n[u*3+p]-n[p*3+u])*r,t[u]=(n[u*3+c]+n[c*3+u])*r,t[p]=(n[p*3+c]+n[c*3+p])*r}return t}function Av(t,n,i,r){var c=.5*Math.PI/180;n*=c,i*=c,r*=c;var u=Math.sin(n),p=Math.cos(n),_=Math.sin(i),g=Math.cos(i),S=Math.sin(r),o=Math.cos(r);return t[0]=u*g*o-p*_*S,t[1]=p*_*o+u*g*S,t[2]=p*g*S-u*_*o,t[3]=p*g*o+u*_*S,t}function Ov(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var Rv=sn.clone;ge.clone=Rv;var Ev=sn.fromValues;ge.fromValues=Ev;var Pv=sn.copy;ge.copy=Pv;var Dv=sn.set;ge.set=Dv;var Iv=sn.add;ge.add=Iv;var jv=ju;ge.mul=jv;var Vu=sn.scale;ge.scale=Vu;var Nu=sn.dot;ge.dot=Nu;var Lv=sn.lerp;ge.lerp=Lv;var Wu=sn.length;ge.length=Wu;var Fv=Wu;ge.len=Fv;var Bu=sn.squaredLength;ge.squaredLength=Bu;var qv=Bu;ge.sqrLen=qv;var ja=sn.normalize;ge.normalize=ja;var Vv=sn.exactEquals;ge.exactEquals=Vv;var Nv=sn.equals;ge.equals=Nv;var Wv=function(){var t=Qn.create(),n=Qn.fromValues(1,0,0),i=Qn.fromValues(0,1,0);return function(r,c,u){var p=Qn.dot(c,u);return p<-.999999?(Qn.cross(t,n,c),Qn.len(t)<1e-6&&Qn.cross(t,i,c),Qn.normalize(t,t),Iu(r,t,Math.PI),r):p>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Qn.cross(t,c,u),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+p,ja(r,r))}}();ge.rotationTo=Wv;var Bv=function(){var t=Ia(),n=Ia();return function(i,r,c,u,p,_){return xo(t,r,p,_),xo(n,c,u,_),xo(i,t,n,2*_*(1-_)),i}}();ge.sqlerp=Bv;var zv=function(){var t=_v.create();return function(n,i,r,c){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=c[0],t[4]=c[1],t[7]=c[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],ja(n,qu(n,t))}}();ge.setAxes=zv});var Zu=Ye(Oe=>{"use strict";function To(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?To=function(i){return typeof i}:To=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},To(t)}Object.defineProperty(Oe,"__esModule",{value:!0});Oe.create=Uv;Oe.clone=Hv;Oe.fromValues=Gv;Oe.fromRotationTranslationValues=Yv;Oe.fromRotationTranslation=Hu;Oe.fromTranslation=Xv;Oe.fromRotation=Qv;Oe.fromMat4=Zv;Oe.copy=Gu;Oe.identity=Jv;Oe.set=$v;Oe.getDual=ey;Oe.setDual=ny;Oe.getTranslation=iy;Oe.translate=sy;Oe.rotateX=ry;Oe.rotateY=oy;Oe.rotateZ=ay;Oe.rotateByQuatAppend=cy;Oe.rotateByQuatPrepend=ly;Oe.rotateAroundAxis=uy;Oe.add=hy;Oe.multiply=Yu;Oe.scale=py;Oe.lerp=fy;Oe.invert=my;Oe.conjugate=_y;Oe.normalize=yy;Oe.str=by;Oe.exactEquals=wy;Oe.equals=xy;Oe.sqrLen=Oe.squaredLength=Oe.len=Oe.length=Oe.dot=Oe.mul=Oe.setReal=Oe.getReal=void 0;var Nt=Fa(xn()),Zn=Fa(La()),zu=Fa(Ea());function Uu(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(Uu=function(c){return c?i:n})(t)}function Fa(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||To(t)!=="object"&&typeof t!="function")return{default:t};var i=Uu(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function Uv(){var t=new Nt.ARRAY_TYPE(8);return Nt.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function Hv(t){var n=new Nt.ARRAY_TYPE(8);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n}function Gv(t,n,i,r,c,u,p,_){var g=new Nt.ARRAY_TYPE(8);return g[0]=t,g[1]=n,g[2]=i,g[3]=r,g[4]=c,g[5]=u,g[6]=p,g[7]=_,g}function Yv(t,n,i,r,c,u,p){var _=new Nt.ARRAY_TYPE(8);_[0]=t,_[1]=n,_[2]=i,_[3]=r;var g=c*.5,S=u*.5,o=p*.5;return _[4]=g*r+S*i-o*n,_[5]=S*r+o*t-g*i,_[6]=o*r+g*n-S*t,_[7]=-g*t-S*n-o*i,_}function Hu(t,n,i){var r=i[0]*.5,c=i[1]*.5,u=i[2]*.5,p=n[0],_=n[1],g=n[2],S=n[3];return t[0]=p,t[1]=_,t[2]=g,t[3]=S,t[4]=r*S+c*g-u*_,t[5]=c*S+u*p-r*g,t[6]=u*S+r*_-c*p,t[7]=-r*p-c*_-u*g,t}function Xv(t,n){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=n[0]*.5,t[5]=n[1]*.5,t[6]=n[2]*.5,t[7]=0,t}function Qv(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Zv(t,n){var i=Zn.create();zu.getRotation(i,n);var r=new Nt.ARRAY_TYPE(3);return zu.getTranslation(r,n),Hu(t,i,r),t}function Gu(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t}function Jv(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function $v(t,n,i,r,c,u,p,_,g){return t[0]=n,t[1]=i,t[2]=r,t[3]=c,t[4]=u,t[5]=p,t[6]=_,t[7]=g,t}var Kv=Zn.copy;Oe.getReal=Kv;function ey(t,n){return t[0]=n[4],t[1]=n[5],t[2]=n[6],t[3]=n[7],t}var ty=Zn.copy;Oe.setReal=ty;function ny(t,n){return t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3],t}function iy(t,n){var i=n[4],r=n[5],c=n[6],u=n[7],p=-n[0],_=-n[1],g=-n[2],S=n[3];return t[0]=(i*S+u*p+r*g-c*_)*2,t[1]=(r*S+u*_+c*p-i*g)*2,t[2]=(c*S+u*g+i*_-r*p)*2,t}function sy(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=i[0]*.5,g=i[1]*.5,S=i[2]*.5,o=n[4],h=n[5],f=n[6],v=n[7];return t[0]=r,t[1]=c,t[2]=u,t[3]=p,t[4]=p*_+c*S-u*g+o,t[5]=p*g+u*_-r*S+h,t[6]=p*S+r*g-c*_+f,t[7]=-r*_-c*g-u*S+v,t}function ry(t,n,i){var r=-n[0],c=-n[1],u=-n[2],p=n[3],_=n[4],g=n[5],S=n[6],o=n[7],h=_*p+o*r+g*u-S*c,f=g*p+o*c+S*r-_*u,v=S*p+o*u+_*c-g*r,x=o*p-_*r-g*c-S*u;return Zn.rotateX(t,n,i),r=t[0],c=t[1],u=t[2],p=t[3],t[4]=h*p+x*r+f*u-v*c,t[5]=f*p+x*c+v*r-h*u,t[6]=v*p+x*u+h*c-f*r,t[7]=x*p-h*r-f*c-v*u,t}function oy(t,n,i){var r=-n[0],c=-n[1],u=-n[2],p=n[3],_=n[4],g=n[5],S=n[6],o=n[7],h=_*p+o*r+g*u-S*c,f=g*p+o*c+S*r-_*u,v=S*p+o*u+_*c-g*r,x=o*p-_*r-g*c-S*u;return Zn.rotateY(t,n,i),r=t[0],c=t[1],u=t[2],p=t[3],t[4]=h*p+x*r+f*u-v*c,t[5]=f*p+x*c+v*r-h*u,t[6]=v*p+x*u+h*c-f*r,t[7]=x*p-h*r-f*c-v*u,t}function ay(t,n,i){var r=-n[0],c=-n[1],u=-n[2],p=n[3],_=n[4],g=n[5],S=n[6],o=n[7],h=_*p+o*r+g*u-S*c,f=g*p+o*c+S*r-_*u,v=S*p+o*u+_*c-g*r,x=o*p-_*r-g*c-S*u;return Zn.rotateZ(t,n,i),r=t[0],c=t[1],u=t[2],p=t[3],t[4]=h*p+x*r+f*u-v*c,t[5]=f*p+x*c+v*r-h*u,t[6]=v*p+x*u+h*c-f*r,t[7]=x*p-h*r-f*c-v*u,t}function cy(t,n,i){var r=i[0],c=i[1],u=i[2],p=i[3],_=n[0],g=n[1],S=n[2],o=n[3];return t[0]=_*p+o*r+g*u-S*c,t[1]=g*p+o*c+S*r-_*u,t[2]=S*p+o*u+_*c-g*r,t[3]=o*p-_*r-g*c-S*u,_=n[4],g=n[5],S=n[6],o=n[7],t[4]=_*p+o*r+g*u-S*c,t[5]=g*p+o*c+S*r-_*u,t[6]=S*p+o*u+_*c-g*r,t[7]=o*p-_*r-g*c-S*u,t}function ly(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=i[0],g=i[1],S=i[2],o=i[3];return t[0]=r*o+p*_+c*S-u*g,t[1]=c*o+p*g+u*_-r*S,t[2]=u*o+p*S+r*g-c*_,t[3]=p*o-r*_-c*g-u*S,_=i[4],g=i[5],S=i[6],o=i[7],t[4]=r*o+p*_+c*S-u*g,t[5]=c*o+p*g+u*_-r*S,t[6]=u*o+p*S+r*g-c*_,t[7]=p*o-r*_-c*g-u*S,t}function uy(t,n,i,r){if(Math.abs(r)<Nt.EPSILON)return Gu(t,n);var c=Math.hypot(i[0],i[1],i[2]);r=r*.5;var u=Math.sin(r),p=u*i[0]/c,_=u*i[1]/c,g=u*i[2]/c,S=Math.cos(r),o=n[0],h=n[1],f=n[2],v=n[3];t[0]=o*S+v*p+h*g-f*_,t[1]=h*S+v*_+f*p-o*g,t[2]=f*S+v*g+o*_-h*p,t[3]=v*S-o*p-h*_-f*g;var x=n[4],T=n[5],w=n[6],y=n[7];return t[4]=x*S+y*p+T*g-w*_,t[5]=T*S+y*_+w*p-x*g,t[6]=w*S+y*g+x*_-T*p,t[7]=y*S-x*p-T*_-w*g,t}function hy(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t[2]=n[2]+i[2],t[3]=n[3]+i[3],t[4]=n[4]+i[4],t[5]=n[5]+i[5],t[6]=n[6]+i[6],t[7]=n[7]+i[7],t}function Yu(t,n,i){var r=n[0],c=n[1],u=n[2],p=n[3],_=i[4],g=i[5],S=i[6],o=i[7],h=n[4],f=n[5],v=n[6],x=n[7],T=i[0],w=i[1],y=i[2],C=i[3];return t[0]=r*C+p*T+c*y-u*w,t[1]=c*C+p*w+u*T-r*y,t[2]=u*C+p*y+r*w-c*T,t[3]=p*C-r*T-c*w-u*y,t[4]=r*o+p*_+c*S-u*g+h*C+x*T+f*y-v*w,t[5]=c*o+p*g+u*_-r*S+f*C+x*w+v*T-h*y,t[6]=u*o+p*S+r*g-c*_+v*C+x*y+h*w-f*T,t[7]=p*o-r*_-c*g-u*S+x*C-h*T-f*w-v*y,t}var dy=Yu;Oe.mul=dy;function py(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=n[3]*i,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=n[7]*i,t}var Xu=Zn.dot;Oe.dot=Xu;function fy(t,n,i,r){var c=1-r;return Xu(n,i)<0&&(r=-r),t[0]=n[0]*c+i[0]*r,t[1]=n[1]*c+i[1]*r,t[2]=n[2]*c+i[2]*r,t[3]=n[3]*c+i[3]*r,t[4]=n[4]*c+i[4]*r,t[5]=n[5]*c+i[5]*r,t[6]=n[6]*c+i[6]*r,t[7]=n[7]*c+i[7]*r,t}function my(t,n){var i=So(n);return t[0]=-n[0]/i,t[1]=-n[1]/i,t[2]=-n[2]/i,t[3]=n[3]/i,t[4]=-n[4]/i,t[5]=-n[5]/i,t[6]=-n[6]/i,t[7]=n[7]/i,t}function _y(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t[3]=n[3],t[4]=-n[4],t[5]=-n[5],t[6]=-n[6],t[7]=n[7],t}var Qu=Zn.length;Oe.length=Qu;var gy=Qu;Oe.len=gy;var So=Zn.squaredLength;Oe.squaredLength=So;var vy=So;Oe.sqrLen=vy;function yy(t,n){var i=So(n);if(i>0){i=Math.sqrt(i);var r=n[0]/i,c=n[1]/i,u=n[2]/i,p=n[3]/i,_=n[4],g=n[5],S=n[6],o=n[7],h=r*_+c*g+u*S+p*o;t[0]=r,t[1]=c,t[2]=u,t[3]=p,t[4]=(_-r*h)/i,t[5]=(g-c*h)/i,t[6]=(S-u*h)/i,t[7]=(o-p*h)/i}return t}function by(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function wy(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]&&t[4]===n[4]&&t[5]===n[5]&&t[6]===n[6]&&t[7]===n[7]}function xy(t,n){var i=t[0],r=t[1],c=t[2],u=t[3],p=t[4],_=t[5],g=t[6],S=t[7],o=n[0],h=n[1],f=n[2],v=n[3],x=n[4],T=n[5],w=n[6],y=n[7];return Math.abs(i-o)<=Nt.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-h)<=Nt.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(c-f)<=Nt.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(u-v)<=Nt.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(p-x)<=Nt.EPSILON*Math.max(1,Math.abs(p),Math.abs(x))&&Math.abs(_-T)<=Nt.EPSILON*Math.max(1,Math.abs(_),Math.abs(T))&&Math.abs(g-w)<=Nt.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(S-y)<=Nt.EPSILON*Math.max(1,Math.abs(S),Math.abs(y))}});var oh=Ye(Ce=>{"use strict";function Co(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Co=function(i){return typeof i}:Co=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Co(t)}Object.defineProperty(Ce,"__esModule",{value:!0});Ce.create=$u;Ce.clone=Sy;Ce.fromValues=Cy;Ce.copy=ky;Ce.set=My;Ce.add=Ay;Ce.subtract=Ku;Ce.multiply=eh;Ce.divide=th;Ce.ceil=Oy;Ce.floor=Ry;Ce.min=Ey;Ce.max=Py;Ce.round=Dy;Ce.scale=Iy;Ce.scaleAndAdd=jy;Ce.distance=nh;Ce.squaredDistance=ih;Ce.length=sh;Ce.squaredLength=rh;Ce.negate=Ly;Ce.inverse=Fy;Ce.normalize=qy;Ce.dot=Vy;Ce.cross=Ny;Ce.lerp=Wy;Ce.random=By;Ce.transformMat2=zy;Ce.transformMat2d=Uy;Ce.transformMat3=Hy;Ce.transformMat4=Gy;Ce.rotate=Yy;Ce.angle=Xy;Ce.zero=Qy;Ce.str=Zy;Ce.exactEquals=Jy;Ce.equals=$y;Ce.forEach=Ce.sqrLen=Ce.sqrDist=Ce.dist=Ce.div=Ce.mul=Ce.sub=Ce.len=void 0;var Ri=Ty(xn());function Ju(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(Ju=function(c){return c?i:n})(t)}function Ty(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||Co(t)!=="object"&&typeof t!="function")return{default:t};var i=Ju(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}function $u(){var t=new Ri.ARRAY_TYPE(2);return Ri.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Sy(t){var n=new Ri.ARRAY_TYPE(2);return n[0]=t[0],n[1]=t[1],n}function Cy(t,n){var i=new Ri.ARRAY_TYPE(2);return i[0]=t,i[1]=n,i}function ky(t,n){return t[0]=n[0],t[1]=n[1],t}function My(t,n,i){return t[0]=n,t[1]=i,t}function Ay(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t}function Ku(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t}function eh(t,n,i){return t[0]=n[0]*i[0],t[1]=n[1]*i[1],t}function th(t,n,i){return t[0]=n[0]/i[0],t[1]=n[1]/i[1],t}function Oy(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t}function Ry(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t}function Ey(t,n,i){return t[0]=Math.min(n[0],i[0]),t[1]=Math.min(n[1],i[1]),t}function Py(t,n,i){return t[0]=Math.max(n[0],i[0]),t[1]=Math.max(n[1],i[1]),t}function Dy(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t}function Iy(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t}function jy(t,n,i,r){return t[0]=n[0]+i[0]*r,t[1]=n[1]+i[1]*r,t}function nh(t,n){var i=n[0]-t[0],r=n[1]-t[1];return Math.hypot(i,r)}function ih(t,n){var i=n[0]-t[0],r=n[1]-t[1];return i*i+r*r}function sh(t){var n=t[0],i=t[1];return Math.hypot(n,i)}function rh(t){var n=t[0],i=t[1];return n*n+i*i}function Ly(t,n){return t[0]=-n[0],t[1]=-n[1],t}function Fy(t,n){return t[0]=1/n[0],t[1]=1/n[1],t}function qy(t,n){var i=n[0],r=n[1],c=i*i+r*r;return c>0&&(c=1/Math.sqrt(c)),t[0]=n[0]*c,t[1]=n[1]*c,t}function Vy(t,n){return t[0]*n[0]+t[1]*n[1]}function Ny(t,n,i){var r=n[0]*i[1]-n[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function Wy(t,n,i,r){var c=n[0],u=n[1];return t[0]=c+r*(i[0]-c),t[1]=u+r*(i[1]-u),t}function By(t,n){n=n||1;var i=Ri.RANDOM()*2*Math.PI;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t}function zy(t,n,i){var r=n[0],c=n[1];return t[0]=i[0]*r+i[2]*c,t[1]=i[1]*r+i[3]*c,t}function Uy(t,n,i){var r=n[0],c=n[1];return t[0]=i[0]*r+i[2]*c+i[4],t[1]=i[1]*r+i[3]*c+i[5],t}function Hy(t,n,i){var r=n[0],c=n[1];return t[0]=i[0]*r+i[3]*c+i[6],t[1]=i[1]*r+i[4]*c+i[7],t}function Gy(t,n,i){var r=n[0],c=n[1];return t[0]=i[0]*r+i[4]*c+i[12],t[1]=i[1]*r+i[5]*c+i[13],t}function Yy(t,n,i,r){var c=n[0]-i[0],u=n[1]-i[1],p=Math.sin(r),_=Math.cos(r);return t[0]=c*_-u*p+i[0],t[1]=c*p+u*_+i[1],t}function Xy(t,n){var i=t[0],r=t[1],c=n[0],u=n[1],p=Math.sqrt(i*i+r*r)*Math.sqrt(c*c+u*u),_=p&&(i*c+r*u)/p;return Math.acos(Math.min(Math.max(_,-1),1))}function Qy(t){return t[0]=0,t[1]=0,t}function Zy(t){return"vec2("+t[0]+", "+t[1]+")"}function Jy(t,n){return t[0]===n[0]&&t[1]===n[1]}function $y(t,n){var i=t[0],r=t[1],c=n[0],u=n[1];return Math.abs(i-c)<=Ri.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-u)<=Ri.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))}var Ky=sh;Ce.len=Ky;var e0=Ku;Ce.sub=e0;var t0=eh;Ce.mul=t0;var n0=th;Ce.div=n0;var i0=nh;Ce.dist=i0;var s0=ih;Ce.sqrDist=s0;var r0=rh;Ce.sqrLen=r0;var o0=function(){var t=$u();return function(n,i,r,c,u,p){var _,g;for(i||(i=2),r||(r=0),c?g=Math.min(c*i+r,n.length):g=n.length,_=r;_<g;_+=i)t[0]=n[_],t[1]=n[_+1],u(t,t,p),n[_]=t[0],n[_+1]=t[1];return n}}();Ce.forEach=o0});var jn=Ye(pt=>{"use strict";function ko(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ko=function(i){return typeof i}:ko=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},ko(t)}Object.defineProperty(pt,"__esModule",{value:!0});pt.vec4=pt.vec3=pt.vec2=pt.quat2=pt.quat=pt.mat4=pt.mat3=pt.mat2d=pt.mat2=pt.glMatrix=void 0;var a0=In(xn());pt.glMatrix=a0;var c0=In($l());pt.mat2=c0;var l0=In(nu());pt.mat2d=l0;var u0=In(Ra());pt.mat3=u0;var h0=In(Ea());pt.mat4=h0;var d0=In(La());pt.quat=d0;var p0=In(Zu());pt.quat2=p0;var f0=In(oh());pt.vec2=f0;var m0=In(Pa());pt.vec3=m0;var _0=In(Da());pt.vec4=_0;function ah(t){if(typeof WeakMap!="function")return null;var n=new WeakMap,i=new WeakMap;return(ah=function(c){return c?i:n})(t)}function In(t,n){if(!n&&t&&t.__esModule)return t;if(t===null||ko(t)!=="object"&&typeof t!="function")return{default:t};var i=ah(n);if(i&&i.has(t))return i.get(t);var r={},c=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var p=c?Object.getOwnPropertyDescriptor(t,u):null;p&&(p.get||p.set)?Object.defineProperty(r,u,p):r[u]=t[u]}return r.default=t,i&&i.set(t,r),r}});var ch=Ye(()=>{WL.registerComponent("8thwall-camera",{camera:{type:WL.Type.Enum,values:["auto","back","front"],default:"auto"}},{name:"wonderland-engine",init:function(){this.position=[0,0,0,0],this.rotation=[0,0,0,0],this.started=!1;let t=["auto","back","front"];this.camera=t[this.camera],this.camera=="auto"&&(this.camera="back"),this.onStart=this.onStart.bind(this),this.onUpdate=this.onUpdate.bind(this),XR8.addCameraPipelineModules([XR8.GlTextureRenderer.pipelineModule(),XR8.XrController.pipelineModule(),this]),this.camera=="back"?XR8.run({canvas:Module.canvas,ownRunLoop:!1}):this.camera=="back"?(XR8.XrController.configure({disableWorldTracking:!0}),XR8.run({canvas:Module.canvas,ownRunLoop:!1,cameraConfig:{direction:XR8.XrConfig.camera().FRONT}})):console.error("[8thwall-camera] Invalid camera setting:",this.camera)},update:function(){if(this.started){if(WL.scene.onPostRender.length==0&&(WL.scene.onPreRender.push(function(){XR8.runPreRender(Date.now()),_wl_reset_context()}),WL.scene.onPostRender.push(function(){XR8.runPostRender(Date.now())})),this.rotation[0]==0&&this.rotation[1]==0&&this.rotation[2]==0&&this.rotation[3]==0)return;this.object.resetTransform(),this.object.rotate(this.rotation),this.object.translate(this.position)}},onUpdate:function(t){if(!t.processCpuResult.reality)return;let n=t.processCpuResult.reality.rotation;this.rotation[0]=n.x,this.rotation[1]=n.y,this.rotation[2]=n.z,this.rotation[3]=n.w;let i=t.processCpuResult.reality.position;this.position[0]=i.x,this.position[1]=i.y,this.position[2]=i.z},onStart:function(){this.started=!0}})});var lh=Ye(()=>{WL.registerComponent("cursor-target",{},{init:function(){this.hoverFunctions=[],this.unHoverFunctions=[],this.clickFunctions=[],this.moveFunctions=[],this.downFunctions=[],this.upFunctions=[]},onHover:function(t,n){for(let i of this.hoverFunctions)i(t,n)},onUnhover:function(t,n){for(let i of this.unHoverFunctions)i(t,n)},onClick:function(t,n){for(let i of this.clickFunctions)i(t,n)},onMove:function(t,n){for(let i of this.moveFunctions)i(t,n)},onDown:function(t,n){for(let i of this.downFunctions)i(t,n)},onUp:function(t,n){for(let i of this.upFunctions)i(t,n)},addHoverFunction:function(t){this._validateCallback(t),this.hoverFunctions.push(t)},removeHoverFunction:function(t){this._validateCallback(t),this._removeItemOnce(this.hoverFunctions,t)},addUnHoverFunction:function(t){this._validateCallback(t),this.unHoverFunctions.push(t)},removeUnHoverFunction:function(t){this._validateCallback(t),this._removeItemOnce(this.unHoverFunctions,t)},addClickFunction:function(t){this._validateCallback(t),this.clickFunctions.push(t)},removeClickFunction:function(t){this._validateCallback(t),this._removeItemOnce(this.clickFunctions,t)},addMoveFunction:function(t){this._validateCallback(t),this.moveFunctions.push(t)},removeMoveFunction:function(t){this._validateCallback(t),this._removeItemOnce(this.moveFunctions,t)},addDownFunction:function(t){this._validateCallback(t),this.downFunctions.push(t)},removeDownFunction:function(t){this._validateCallback(t),this._removeItemOnce(this.downFunctions,t)},addUpFunction:function(t){this._validateCallback(t),this.upFunctions.push(t)},removeUpFunction:function(t){this._validateCallback(t),this._removeItemOnce(this.upFunctions,t)},_removeItemOnce:function(t,n){var i=t.indexOf(n);return i>-1&&t.splice(i,1),t},_validateCallback:function(t){if(typeof t!="function")throw new TypeError(this.object.name+".cursor-target: Argument needs to be a function")}})});var uh={};un(uh);var fi,hh=bn(()=>{fi=Pn(jn());WL.registerComponent("cursor",{collisionGroup:{type:WL.Type.Int,default:1},cursorRayObject:{type:WL.Type.Object},cursorRayScalingAxis:{type:WL.Type.Enum,values:["x","y","z","none"],default:"z"},cursorObject:{type:WL.Type.Object},handedness:{type:WL.Type.Enum,values:["input component","left","right","none"],default:"input component"},rayCastMode:{type:WL.Type.Enum,values:["collision","physx"],default:"collision"},styleCursor:{type:WL.Type.Bool,default:!0}},{init:function(){this.session=null,this.collisionMask=1<<this.collisionGroup,this.maxDistance=100;let t=this.onDestroy.bind(this);WL.onSceneLoaded.push(t),this.onDestroyCallbacks=[()=>{let n=WL.onSceneLoaded.indexOf(t);n>=0&&WL.onSceneLoaded.splice(n,1)}]},start:function(){if(this.handedness==0){let n=this.object.getComponent("input");n?(this.handedness=n.handedness,this.input=n):console.warn("cursor component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right"][this.handedness-1];if(this.globalTarget=this.object.addComponent("cursor-target"),this.origin=new Float32Array(3),this.cursorObjScale=new Float32Array(3),this.direction=[0,0,0],this.tempQuat=new Float32Array(4),this.viewComponent=this.object.getComponent("view"),this.viewComponent!=null){let n=this.onClick.bind(this);WL.canvas.addEventListener("click",n);let i=this.onPointerMove.bind(this);WL.canvas.addEventListener("pointermove",i);let r=this.onPointerDown.bind(this);WL.canvas.addEventListener("pointerdown",r);let c=this.onPointerUp.bind(this);WL.canvas.addEventListener("pointerup",c),this.projectionMatrix=new Float32Array(16),fi.mat4.invert(this.projectionMatrix,this.viewComponent.projectionMatrix);let u=this.onViewportResize.bind(this);window.addEventListener("resize",u),this.onDestroyCallbacks.push(()=>{WL.canvas.removeEventListener("click",n),WL.canvas.removeEventListener("pointermove",i),WL.canvas.removeEventListener("pointerdown",r),WL.canvas.removeEventListener("pointerup",c),window.removeEventListener("resize",u)})}this.isHovering=!1,this.visible=!0,this.isDown=!1,this.lastIsDown=!1,this.cursorPos=new Float32Array(3),this.hoveringObject=null;let t=this.setupVREvents.bind(this);WL.onXRSessionStart.push(t),this.onDestroyCallbacks.push(()=>{let n=WL.onXRSessionStart.indexOf(t);n>=0&&WL.onXRSessionStart.splice(n,1)}),this.cursorRayObject&&(this.cursorRayScale=new Float32Array(3),this.cursorRayScale.set(this.cursorRayObject.scalingLocal),this.object.getTranslationWorld(this.origin),this.object.getForward(this.direction),this._setCursorRayTransform([this.origin[0]+this.direction[0],this.origin[1]+this.direction[1],this.origin[2]+this.direction[2]]))},onViewportResize:function(){!this.viewComponent||fi.mat4.invert(this.projectionMatrix,this.viewComponent.projectionMatrix)},_setCursorRayTransform:function(t){if(!this.cursorRayObject)return;let n=fi.vec3.dist(this.origin,t);this.cursorRayObject.setTranslationLocal([0,0,-n/2]),this.cursorRayScalingAxis!=4&&(this.cursorRayObject.resetScaling(),this.cursorRayScale[this.cursorRayScalingAxis]=n/2,this.cursorRayObject.scale(this.cursorRayScale))},_setCursorVisibility:function(t){this.visible!=t&&(this.visible=t,!!this.cursorObject&&(t?(this.cursorObject.resetScaling(),this.cursorObject.scale(this.cursorObjScale)):(this.cursorObjScale.set(this.cursorObject.scalingLocal),this.cursorObject.scale([0,0,0]))))},update:function(){this.doUpdate(!1)},doUpdate:function(t){if(this.session){if(this.arTouchDown&&this.input&&WL.xrSession.inputSources[0].handedness==="none"&&WL.xrSession.inputSources[0].gamepad){let i=WL.xrSession.inputSources[0].gamepad.axes;this.direction=[i[0],-i[1],-1],this.updateDirection()}else this.object.getTranslationWorld(this.origin),this.object.getForward(this.direction);let n=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(this.origin,this.direction,this.collisionMask):WL.physics.rayCast(this.origin,this.direction,this.collisionMask,this.maxDistance);n.hitCount>0?this.cursorPos.set(n.locations[0]):this.cursorPos.fill(0),this.hoverBehaviour(n,t)}this.cursorObject&&(this.hoveringObject&&(this.cursorPos[0]!=0||this.cursorPos[1]!=0||this.cursorPos[2]!=0)?(this._setCursorVisibility(!0),this.cursorObject.setTranslationWorld(this.cursorPos),this._setCursorRayTransform(this.cursorPos)):this._setCursorVisibility(!1))},hoverBehaviour:function(t,n){if(t.hitCount>0){if(!this.hoveringObject||!this.hoveringObject.equals(t.objects[0])){if(this.hoveringObject){let c=this.hoveringObject.getComponent("cursor-target");c&&c.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this)}this.hoveringObject=t.objects[0],this.styleCursor&&(WL.canvas.style.cursor="pointer");let r=this.hoveringObject.getComponent("cursor-target");r&&(this.hoveringObjectTarget=r,r.onHover(this.hoveringObject,this)),this.globalTarget.onHover(this.hoveringObject,this)}this.hoveringObjectTarget&&this.hoveringObjectTarget.onMove(this.hoveringObject,this);let i=this.hoveringObject.getComponent("cursor-target");this.isDown!==this.lastIsDown&&(this.isDown?(i&&i.onDown(this.hoveringObject,this),this.globalTarget.onDown(this.hoveringObject,this)):(i&&i.onUp(this.hoveringObject,this),this.globalTarget.onUp(this.hoveringObject,this))),n&&(i&&i.onClick(this.hoveringObject,this),this.globalTarget.onClick(this.hoveringObject,this))}else if(this.hoveringObject&&t.hitCount==0){let i=this.hoveringObject.getComponent("cursor-target");i&&i.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this),this.hoveringObject=null,this.hoveringObjectTarget=null,this.styleCursor&&(WL.canvas.style.cursor="default")}this.lastIsDown=this.isDown},setupVREvents:function(t){this.session=t;let n=function(u){this.session=null}.bind(this);t.addEventListener("end",n);let i=this.onSelect.bind(this);t.addEventListener("select",i);let r=this.onSelectStart.bind(this);t.addEventListener("selectstart",r);let c=this.onSelectEnd.bind(this);t.addEventListener("selectend",c),this.onDestroyCallbacks.push(()=>{!this.session||(t.removeEventListener("end",n),t.removeEventListener("select",i),t.removeEventListener("selectstart",r),t.removeEventListener("selectend",c))}),this.onViewportResize()},onSelect:function(t){t.inputSource.handedness==this.handedness&&this.doUpdate(!0)},onSelectStart:function(t){this.arTouchDown=!0,t.inputSource.handedness==this.handedness&&(this.isDown=!0)},onSelectEnd:function(t){this.arTouchDown=!1,t.inputSource.handedness==this.handedness&&(this.isDown=!1)},onPointerMove:function(t){if(!t.isPrimary)return;let n=t.target.getBoundingClientRect(),i=this.updateMousePos(t.clientX,t.clientY,n.width,n.height);this.hoverBehaviour(i,!1)},onClick:function(t){let n=t.target.getBoundingClientRect(),i=this.updateMousePos(t.clientX,t.clientY,n.width,n.height);this.hoverBehaviour(i,!0)},onPointerDown:function(t){if(!t.isPrimary||t.button!==0)return;let n=t.target.getBoundingClientRect(),i=this.updateMousePos(t.clientX,t.clientY,n.width,n.height);this.isDown=!0,this.hoverBehaviour(i,!1)},onPointerUp:function(t){if(!t.isPrimary||t.button!==0)return;let n=t.target.getBoundingClientRect(),i=this.updateMousePos(t.clientX,t.clientY,n.width,n.height);this.isDown=!1,this.hoverBehaviour(i,!1)},updateMousePos:function(t,n,i,r){let c=t/i,u=n/r;return this.direction=[c*2-1,-u*2+1,-1],this.updateDirection()},updateDirection:function(){this.object.getTranslationWorld(this.origin),fi.vec3.transformMat4(this.direction,this.direction,this.projectionMatrix),fi.vec3.normalize(this.direction,this.direction),fi.vec3.transformQuat(this.direction,this.direction,this.object.transformWorld);let t=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(this.origin,this.direction,this.collisionMask):WL.physics.rayCast(this.origin,this.direction,this.collisionMask,this.maxDistance);return t.hitCount>0?this.cursorPos.set(t.locations[0]):this.cursorPos.fill(0),t},onDeactivate:function(){if(this._setCursorVisibility(!1),this.hoveringObject){let t=this.hoveringObject.getComponent("cursor-target");t&&t.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this)}this.cursorRayObject&&this.cursorRayObject.scale([0,0,0])},onActivate:function(){this._setCursorVisibility(!0)},onDestroy:function(){for(let t of this.onDestroyCallbacks)t()}})});var dh=Ye(()=>{WL.registerComponent("debug-object",{obj:{type:WL.Type.Object}},{start:function(){},init:function(){let t=[0,0,0];glMatrix.quat2.getTranslation(t,this.object.transformWorld),console.log("Debug Object:",this.object.name),console.log("Other object:",this.obj.name),console.log("	translation",t),console.log("	transformWorld",this.object.transformWorld),console.log("	transformLocal",this.object.transformLocal)},update:function(){}})});var ph=Ye(()=>{function g0(t,n,i,r){let c=Math.cos(n/2),u=Math.cos(i/2),p=Math.cos(r/2),_=Math.sin(n/2),g=Math.sin(i/2),S=Math.sin(r/2);t[0]=_*u*p+c*g*S,t[1]=c*g*p-_*u*S,t[2]=c*u*S-_*g*p,t[3]=c*u*p+_*g*S}WL.registerComponent("device-orientation-look",{},{start:function(){this.rotationX=0,this.rotationY=0,this.lastClientX=-1,this.lastClientY=-1},init:function(){this.deviceOrientation=[0,0,0,1],this.screenOrientation=0,this._origin=[0,0,0],window.addEventListener("deviceorientation",function(t){let n=t.alpha||0,i=t.beta||0,r=t.gamma||0,c=Math.PI/180;g0(this.deviceOrientation,i*c,n*c,-r*c)}.bind(this)),window.addEventListener("orientationchange",function(t){this.screenOrientation=window.orientation||0}.bind(this),!1)},update:function(){Module.webxr_session==null&&(glMatrix.quat2.getTranslation(this._origin,this.object.transformLocal),this.object.resetTransform(),this.screenOrientation!=0&&this.object.rotateAxisAngleDeg([0,0,1],this.screenOrientation),this.object.rotate([-Math.sqrt(.5),0,0,Math.sqrt(.5)]),this.object.rotate(this.deviceOrientation),this.object.translate(this._origin))}})});var fh=Ye(()=>{WL.registerComponent("finger-cursor",{},{init:function(){this.lastTarget=null},start:function(){this.tip=this.object.getComponent("collision")},update:function(){let t=this.tip.queryOverlaps(),n=null;for(let i=0;i<t.length;++i){let r=t[i].object,c=r.getComponent("cursor-target");if(c){c.equals(this.lastTarget)||(c.onHover(r,this),c.onClick(r,this)),n=c;break}}if(n)this.lastTarget=n;else{this.lastTarget&&this.lastTarget.onUnhover(this.lastTarget.object,this),this.lastTarget=null;return}}})});var mh=Ye(()=>{WL.registerComponent("fixed-foveation",{fixedFoveation:{type:WL.Type.Float,default:.5}},{start:function(){WL.xrSession?this.setFixedFoveation():WL.onXRSessionStart.push(this.setFixedFoveation.bind(this))},setFixedFoveation:function(){"webxr_baseLayer"in Module&&(Module.webxr_baseLayer.fixedFoveation=this.fixedFoveation)}})});var _h={};un(_h);var Ei,gh=bn(()=>{Ei=Pn(jn());WL.registerComponent("hand-tracking",{handedness:{type:WL.Type.Enum,default:"left",values:["left","right"]},jointMesh:{type:WL.Type.Mesh,default:null},jointMaterial:{type:WL.Type.Material,default:null},handSkin:{type:WL.Type.Skin,default:null},deactivateChildrenWithoutPose:{type:WL.Type.Bool,default:!0},controllerToDeactivate:{type:WL.Type.Object}},{ORDERED_JOINTS:["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],init:function(){this.handedness=["left","right"][this.handedness]},start:function(){if(this.joints=[],this.session=null,this.hasPose=!1,this._childrenActive=!0,!("XRHand"in window)){console.warn("WebXR Hand Tracking not supported by this browser."),this.active=!1;return}if(this.handSkin){let n=this.handSkin.jointIds;this.joints[this.ORDERED_JOINTS[0]]=new WL.Object(n[0]);for(let i=0;i<n.length;++i){let r=new WL.Object(n[i]);this.joints[r.name]=r}return}for(let t=0;t<=this.ORDERED_JOINTS.length;++t){let n=WL.scene.addObject(this.object.parent),i=n.addComponent("mesh");i.mesh=this.jointMesh,i.material=this.jointMaterial,this.joints[this.ORDERED_JOINTS[t]]=n}},update:function(t){if(this.session||WL.xrSession&&this.setupVREvents(WL.xrSession),!!this.session){if(this.hasPose=!1,this.session&&this.session.inputSources)for(let n=0;n<=this.session.inputSources.length;++n){let i=this.session.inputSources[n];if(!i||!i.hand||i.handedness!=this.handedness)continue;if(this.hasPose=!0,i.hand.get("wrist")!==null){let u=Module.webxr_frame.getJointPose(i.hand.get("wrist"),WebXR.refSpaces[WebXR.refSpace]);u&&(this.object.resetTranslationRotation(),this.object.transformLocal.set([u.transform.orientation.x,u.transform.orientation.y,u.transform.orientation.z,u.transform.orientation.w]),this.object.translate([u.transform.position.x,u.transform.position.y,u.transform.position.z]))}let r=new Float32Array(3),c=new Float32Array(4);Ei.quat.invert(c,this.object.transformLocal),this.object.getTranslationLocal(r);for(let u=0;u<this.ORDERED_JOINTS.length;++u){let p=this.ORDERED_JOINTS[u],_=this.joints[p];if(_==null)continue;let g=null;if(i.hand.get(p)!==null&&(g=Module.webxr_frame.getJointPose(i.hand.get(p),WebXR.refSpaces[WebXR.refSpace])),g!==null)if(this.handSkin)_.resetTranslationRotation(),_.translate([g.transform.position.x-r[0],g.transform.position.y-r[1],g.transform.position.z-r[2]]),_.rotate(c),_.rotateObject([g.transform.orientation.x,g.transform.orientation.y,g.transform.orientation.z,g.transform.orientation.w]);else{_.resetTransform(),_.transformLocal.set([g.transform.orientation.x,g.transform.orientation.y,g.transform.orientation.z,g.transform.orientation.w]),_.translate([g.transform.position.x,g.transform.position.y,g.transform.position.z]);let S=g.radius||.007;_.scale([S,S,S])}else this.handSkin||_.scale([0,0,0])}}!this.hasPose&&this._childrenActive?(this._childrenActive=!1,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!1),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!0,this.setChildrenActive(!0,this.controllerToDeactivate))):this.hasPose&&!this._childrenActive&&(this._childrenActive=!0,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!0),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!1,this.setChildrenActive(!1,this.controllerToDeactivate)))}},setChildrenActive:function(t,n){n=n||this.object;let i=n.children;for(let r of i)r.active=t,this.setChildrenActive(t,r)},isGrabbing:function(){let t=[0,0,0];Ei.quat2.getTranslation(t,this.joints["index-finger-tip"].transformLocal);let n=[0,0,0];return Ei.quat2.getTranslation(n,this.joints["thumb-tip"].transformLocal),Ei.vec3.sqrDist(n,t)<.001},setupVREvents:function(t){this.session=t}})});var yh={};un(yh);var vh,bh=bn(()=>{vh=Pn(jn());WL.registerComponent("hit-test-location",{},{init:function(){WL.onXRSessionStart.push(this.xrSessionStart.bind(this)),WL.onXRSessionStart.push(this.xrSessionEnd.bind(this)),this.tempScaling=new Float32Array(3),this.tempScaling.set(this.object.scalingLocal),this.visible=!1,this.object.scale([0,0,0])},update:function(t){let n=this.visible;if(this.xrHitTestSource){let i=Module.webxr_frame;if(!i)return;let r=i.getHitTestResults(this.xrHitTestSource);if(r.length>0){let c=r[0].getPose(this.xrViewerSpace);this.visible=!0,vh.quat2.fromMat4(this.object.transformLocal,c.transform.matrix),this.object.setDirty()}else this.visible=!1}this.visible!=n&&(this.visible?(this.object.scalingLocal.set(this.tempScaling),this.object.setDirty()):(this.tempScaling.set(this.object.scalingLocal),this.object.scale([0,0,0])))},xrSessionStart:function(t){t.requestReferenceSpace("viewer").then(function(n){this.xrViewerSpace=n,t.requestHitTestSource({space:this.xrViewerSpace}).then(function(i){this.xrHitTestSource=i}.bind(this)).catch(console.error)}.bind(this)).catch(console.error)},xrSessionEnd:function(){!this.xrHitTestSource||(this.xrHitTestSource.cancel(),this.xrHitTestSource=null)}})});var qa=Ye(Mo=>{(function(){"use strict";var t=function(){this.init()};t.prototype={init:function(){var o=this||n;return o._counter=1e3,o._html5AudioPool=[],o.html5PoolSize=10,o._codecs={},o._howls=[],o._muted=!1,o._volume=1,o._canPlayEvent="canplaythrough",o._navigator=typeof window!="undefined"&&window.navigator?window.navigator:null,o.masterGain=null,o.noAudio=!1,o.usingWebAudio=!0,o.autoSuspend=!0,o.ctx=null,o.autoUnlock=!0,o._setup(),o},volume:function(o){var h=this||n;if(o=parseFloat(o),h.ctx||S(),typeof o!="undefined"&&o>=0&&o<=1){if(h._volume=o,h._muted)return h;h.usingWebAudio&&h.masterGain.gain.setValueAtTime(o,n.ctx.currentTime);for(var f=0;f<h._howls.length;f++)if(!h._howls[f]._webAudio)for(var v=h._howls[f]._getSoundIds(),x=0;x<v.length;x++){var T=h._howls[f]._soundById(v[x]);T&&T._node&&(T._node.volume=T._volume*o)}return h}return h._volume},mute:function(o){var h=this||n;h.ctx||S(),h._muted=o,h.usingWebAudio&&h.masterGain.gain.setValueAtTime(o?0:h._volume,n.ctx.currentTime);for(var f=0;f<h._howls.length;f++)if(!h._howls[f]._webAudio)for(var v=h._howls[f]._getSoundIds(),x=0;x<v.length;x++){var T=h._howls[f]._soundById(v[x]);T&&T._node&&(T._node.muted=o?!0:T._muted)}return h},stop:function(){for(var o=this||n,h=0;h<o._howls.length;h++)o._howls[h].stop();return o},unload:function(){for(var o=this||n,h=o._howls.length-1;h>=0;h--)o._howls[h].unload();return o.usingWebAudio&&o.ctx&&typeof o.ctx.close!="undefined"&&(o.ctx.close(),o.ctx=null,S()),o},codecs:function(o){return(this||n)._codecs[o.replace(/^x-/,"")]},_setup:function(){var o=this||n;if(o.state=o.ctx&&o.ctx.state||"suspended",o._autoSuspend(),!o.usingWebAudio)if(typeof Audio!="undefined")try{var h=new Audio;typeof h.oncanplaythrough=="undefined"&&(o._canPlayEvent="canplay")}catch(f){o.noAudio=!0}else o.noAudio=!0;try{var h=new Audio;h.muted&&(o.noAudio=!0)}catch(f){}return o.noAudio||o._setupCodecs(),o},_setupCodecs:function(){var o=this||n,h=null;try{h=typeof Audio!="undefined"?new Audio:null}catch(m){return o}if(!h||typeof h.canPlayType!="function")return o;var f=h.canPlayType("audio/mpeg;").replace(/^no$/,""),v=o._navigator?o._navigator.userAgent:"",x=v.match(/OPR\/([0-6].)/g),T=x&&parseInt(x[0].split("/")[1],10)<33,w=v.indexOf("Safari")!==-1&&v.indexOf("Chrome")===-1,y=v.match(/Version\/(.*?) /),C=w&&y&&parseInt(y[1],10)<15;return o._codecs={mp3:!!(!T&&(f||h.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!f,opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(h.canPlayType('audio/wav; codecs="1"')||h.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!h.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!h.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(h.canPlayType("audio/x-m4b;")||h.canPlayType("audio/m4b;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(h.canPlayType("audio/x-mp4;")||h.canPlayType("audio/mp4;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!C&&h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!C&&h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!h.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(h.canPlayType("audio/x-flac;")||h.canPlayType("audio/flac;")).replace(/^no$/,"")},o},_unlockAudio:function(){var o=this||n;if(!(o._audioUnlocked||!o.ctx)){o._audioUnlocked=!1,o.autoUnlock=!1,!o._mobileUnloaded&&o.ctx.sampleRate!==44100&&(o._mobileUnloaded=!0,o.unload()),o._scratchBuffer=o.ctx.createBuffer(1,1,22050);var h=function(f){for(;o._html5AudioPool.length<o.html5PoolSize;)try{var v=new Audio;v._unlocked=!0,o._releaseHtml5Audio(v)}catch(m){o.noAudio=!0;break}for(var x=0;x<o._howls.length;x++)if(!o._howls[x]._webAudio)for(var T=o._howls[x]._getSoundIds(),w=0;w<T.length;w++){var y=o._howls[x]._soundById(T[w]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}o._autoResume();var C=o.ctx.createBufferSource();C.buffer=o._scratchBuffer,C.connect(o.ctx.destination),typeof C.start=="undefined"?C.noteOn(0):C.start(0),typeof o.ctx.resume=="function"&&o.ctx.resume(),C.onended=function(){C.disconnect(0),o._audioUnlocked=!0,document.removeEventListener("touchstart",h,!0),document.removeEventListener("touchend",h,!0),document.removeEventListener("click",h,!0),document.removeEventListener("keydown",h,!0);for(var m=0;m<o._howls.length;m++)o._howls[m]._emit("unlock")}};return document.addEventListener("touchstart",h,!0),document.addEventListener("touchend",h,!0),document.addEventListener("click",h,!0),document.addEventListener("keydown",h,!0),o}},_obtainHtml5Audio:function(){var o=this||n;if(o._html5AudioPool.length)return o._html5AudioPool.pop();var h=new Audio().play();return h&&typeof Promise!="undefined"&&(h instanceof Promise||typeof h.then=="function")&&h.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(o){var h=this||n;return o._unlocked&&h._html5AudioPool.push(o),h},_autoSuspend:function(){var o=this;if(!(!o.autoSuspend||!o.ctx||typeof o.ctx.suspend=="undefined"||!n.usingWebAudio)){for(var h=0;h<o._howls.length;h++)if(o._howls[h]._webAudio){for(var f=0;f<o._howls[h]._sounds.length;f++)if(!o._howls[h]._sounds[f]._paused)return o}return o._suspendTimer&&clearTimeout(o._suspendTimer),o._suspendTimer=setTimeout(function(){if(!!o.autoSuspend){o._suspendTimer=null,o.state="suspending";var v=function(){o.state="suspended",o._resumeAfterSuspend&&(delete o._resumeAfterSuspend,o._autoResume())};o.ctx.suspend().then(v,v)}},3e4),o}},_autoResume:function(){var o=this;if(!(!o.ctx||typeof o.ctx.resume=="undefined"||!n.usingWebAudio))return o.state==="running"&&o.ctx.state!=="interrupted"&&o._suspendTimer?(clearTimeout(o._suspendTimer),o._suspendTimer=null):o.state==="suspended"||o.state==="running"&&o.ctx.state==="interrupted"?(o.ctx.resume().then(function(){o.state="running";for(var h=0;h<o._howls.length;h++)o._howls[h]._emit("resume")}),o._suspendTimer&&(clearTimeout(o._suspendTimer),o._suspendTimer=null)):o.state==="suspending"&&(o._resumeAfterSuspend=!0),o}};var n=new t,i=function(o){var h=this;if(!o.src||o.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}h.init(o)};i.prototype={init:function(o){var h=this;return n.ctx||S(),h._autoplay=o.autoplay||!1,h._format=typeof o.format!="string"?o.format:[o.format],h._html5=o.html5||!1,h._muted=o.mute||!1,h._loop=o.loop||!1,h._pool=o.pool||5,h._preload=typeof o.preload=="boolean"||o.preload==="metadata"?o.preload:!0,h._rate=o.rate||1,h._sprite=o.sprite||{},h._src=typeof o.src!="string"?o.src:[o.src],h._volume=o.volume!==void 0?o.volume:1,h._xhr={method:o.xhr&&o.xhr.method?o.xhr.method:"GET",headers:o.xhr&&o.xhr.headers?o.xhr.headers:null,withCredentials:o.xhr&&o.xhr.withCredentials?o.xhr.withCredentials:!1},h._duration=0,h._state="unloaded",h._sounds=[],h._endTimers={},h._queue=[],h._playLock=!1,h._onend=o.onend?[{fn:o.onend}]:[],h._onfade=o.onfade?[{fn:o.onfade}]:[],h._onload=o.onload?[{fn:o.onload}]:[],h._onloaderror=o.onloaderror?[{fn:o.onloaderror}]:[],h._onplayerror=o.onplayerror?[{fn:o.onplayerror}]:[],h._onpause=o.onpause?[{fn:o.onpause}]:[],h._onplay=o.onplay?[{fn:o.onplay}]:[],h._onstop=o.onstop?[{fn:o.onstop}]:[],h._onmute=o.onmute?[{fn:o.onmute}]:[],h._onvolume=o.onvolume?[{fn:o.onvolume}]:[],h._onrate=o.onrate?[{fn:o.onrate}]:[],h._onseek=o.onseek?[{fn:o.onseek}]:[],h._onunlock=o.onunlock?[{fn:o.onunlock}]:[],h._onresume=[],h._webAudio=n.usingWebAudio&&!h._html5,typeof n.ctx!="undefined"&&n.ctx&&n.autoUnlock&&n._unlockAudio(),n._howls.push(h),h._autoplay&&h._queue.push({event:"play",action:function(){h.play()}}),h._preload&&h._preload!=="none"&&h.load(),h},load:function(){var o=this,h=null;if(n.noAudio){o._emit("loaderror",null,"No audio support.");return}typeof o._src=="string"&&(o._src=[o._src]);for(var f=0;f<o._src.length;f++){var v,x;if(o._format&&o._format[f])v=o._format[f];else{if(x=o._src[f],typeof x!="string"){o._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}v=/^data:audio\/([^;,]+);/i.exec(x),v||(v=/\.([^.]+)$/.exec(x.split("?",1)[0])),v&&(v=v[1].toLowerCase())}if(v||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),v&&n.codecs(v)){h=o._src[f];break}}if(!h){o._emit("loaderror",null,"No codec support for selected audio sources.");return}return o._src=h,o._state="loading",window.location.protocol==="https:"&&h.slice(0,5)==="http:"&&(o._html5=!0,o._webAudio=!1),new r(o),o._webAudio&&u(o),o},play:function(o,h){var f=this,v=null;if(typeof o=="number")v=o,o=null;else{if(typeof o=="string"&&f._state==="loaded"&&!f._sprite[o])return null;if(typeof o=="undefined"&&(o="__default",!f._playLock)){for(var x=0,T=0;T<f._sounds.length;T++)f._sounds[T]._paused&&!f._sounds[T]._ended&&(x++,v=f._sounds[T]._id);x===1?o=null:v=null}}var w=v?f._soundById(v):f._inactiveSound();if(!w)return null;if(v&&!o&&(o=w._sprite||"__default"),f._state!=="loaded"){w._sprite=o,w._ended=!1;var y=w._id;return f._queue.push({event:"play",action:function(){f.play(y)}}),y}if(v&&!w._paused)return h||f._loadQueue("play"),w._id;f._webAudio&&n._autoResume();var C=Math.max(0,w._seek>0?w._seek:f._sprite[o][0]/1e3),m=Math.max(0,(f._sprite[o][0]+f._sprite[o][1])/1e3-C),M=m*1e3/Math.abs(w._rate),R=f._sprite[o][0]/1e3,I=(f._sprite[o][0]+f._sprite[o][1])/1e3;w._sprite=o,w._ended=!1;var L=function(){w._paused=!1,w._seek=C,w._start=R,w._stop=I,w._loop=!!(w._loop||f._sprite[o][2])};if(C>=I){f._ended(w);return}var q=w._node;if(f._webAudio){var z=function(){f._playLock=!1,L(),f._refreshBuffer(w);var ie=w._muted||f._muted?0:w._volume;q.gain.setValueAtTime(ie,n.ctx.currentTime),w._playStart=n.ctx.currentTime,typeof q.bufferSource.start=="undefined"?w._loop?q.bufferSource.noteGrainOn(0,C,86400):q.bufferSource.noteGrainOn(0,C,m):w._loop?q.bufferSource.start(0,C,86400):q.bufferSource.start(0,C,m),M!==1/0&&(f._endTimers[w._id]=setTimeout(f._ended.bind(f,w),M)),h||setTimeout(function(){f._emit("play",w._id),f._loadQueue()},0)};n.state==="running"&&n.ctx.state!=="interrupted"?z():(f._playLock=!0,f.once("resume",z),f._clearTimer(w._id))}else{var U=function(){q.currentTime=C,q.muted=w._muted||f._muted||n._muted||q.muted,q.volume=w._volume*n.volume(),q.playbackRate=w._rate;try{var ie=q.play();if(ie&&typeof Promise!="undefined"&&(ie instanceof Promise||typeof ie.then=="function")?(f._playLock=!0,L(),ie.then(function(){f._playLock=!1,q._unlocked=!0,h?f._loadQueue():f._emit("play",w._id)}).catch(function(){f._playLock=!1,f._emit("playerror",w._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),w._ended=!0,w._paused=!0})):h||(f._playLock=!1,L(),f._emit("play",w._id)),q.playbackRate=w._rate,q.paused){f._emit("playerror",w._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}o!=="__default"||w._loop?f._endTimers[w._id]=setTimeout(f._ended.bind(f,w),M):(f._endTimers[w._id]=function(){f._ended(w),q.removeEventListener("ended",f._endTimers[w._id],!1)},q.addEventListener("ended",f._endTimers[w._id],!1))}catch(ae){f._emit("playerror",w._id,ae)}};q.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(q.src=f._src,q.load());var H=window&&window.ejecta||!q.readyState&&n._navigator.isCocoonJS;if(q.readyState>=3||H)U();else{f._playLock=!0,f._state="loading";var ee=function(){f._state="loaded",U(),q.removeEventListener(n._canPlayEvent,ee,!1)};q.addEventListener(n._canPlayEvent,ee,!1),f._clearTimer(w._id)}}return w._id},pause:function(o){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"pause",action:function(){h.pause(o)}}),h;for(var f=h._getSoundIds(o),v=0;v<f.length;v++){h._clearTimer(f[v]);var x=h._soundById(f[v]);if(x&&!x._paused&&(x._seek=h.seek(f[v]),x._rateSeek=0,x._paused=!0,h._stopFade(f[v]),x._node))if(h._webAudio){if(!x._node.bufferSource)continue;typeof x._node.bufferSource.stop=="undefined"?x._node.bufferSource.noteOff(0):x._node.bufferSource.stop(0),h._cleanBuffer(x._node)}else(!isNaN(x._node.duration)||x._node.duration===1/0)&&x._node.pause();arguments[1]||h._emit("pause",x?x._id:null)}return h},stop:function(o,h){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"stop",action:function(){f.stop(o)}}),f;for(var v=f._getSoundIds(o),x=0;x<v.length;x++){f._clearTimer(v[x]);var T=f._soundById(v[x]);T&&(T._seek=T._start||0,T._rateSeek=0,T._paused=!0,T._ended=!0,f._stopFade(v[x]),T._node&&(f._webAudio?T._node.bufferSource&&(typeof T._node.bufferSource.stop=="undefined"?T._node.bufferSource.noteOff(0):T._node.bufferSource.stop(0),f._cleanBuffer(T._node)):(!isNaN(T._node.duration)||T._node.duration===1/0)&&(T._node.currentTime=T._start||0,T._node.pause(),T._node.duration===1/0&&f._clearSound(T._node))),h||f._emit("stop",T._id))}return f},mute:function(o,h){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"mute",action:function(){f.mute(o,h)}}),f;if(typeof h=="undefined")if(typeof o=="boolean")f._muted=o;else return f._muted;for(var v=f._getSoundIds(h),x=0;x<v.length;x++){var T=f._soundById(v[x]);T&&(T._muted=o,T._interval&&f._stopFade(T._id),f._webAudio&&T._node?T._node.gain.setValueAtTime(o?0:T._volume,n.ctx.currentTime):T._node&&(T._node.muted=n._muted?!0:o),f._emit("mute",T._id))}return f},volume:function(){var o=this,h=arguments,f,v;if(h.length===0)return o._volume;if(h.length===1||h.length===2&&typeof h[1]=="undefined"){var x=o._getSoundIds(),T=x.indexOf(h[0]);T>=0?v=parseInt(h[0],10):f=parseFloat(h[0])}else h.length>=2&&(f=parseFloat(h[0]),v=parseInt(h[1],10));var w;if(typeof f!="undefined"&&f>=0&&f<=1){if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"volume",action:function(){o.volume.apply(o,h)}}),o;typeof v=="undefined"&&(o._volume=f),v=o._getSoundIds(v);for(var y=0;y<v.length;y++)w=o._soundById(v[y]),w&&(w._volume=f,h[2]||o._stopFade(v[y]),o._webAudio&&w._node&&!w._muted?w._node.gain.setValueAtTime(f,n.ctx.currentTime):w._node&&!w._muted&&(w._node.volume=f*n.volume()),o._emit("volume",w._id))}else return w=v?o._soundById(v):o._sounds[0],w?w._volume:0;return o},fade:function(o,h,f,v){var x=this;if(x._state!=="loaded"||x._playLock)return x._queue.push({event:"fade",action:function(){x.fade(o,h,f,v)}}),x;o=Math.min(Math.max(0,parseFloat(o)),1),h=Math.min(Math.max(0,parseFloat(h)),1),f=parseFloat(f),x.volume(o,v);for(var T=x._getSoundIds(v),w=0;w<T.length;w++){var y=x._soundById(T[w]);if(y){if(v||x._stopFade(T[w]),x._webAudio&&!y._muted){var C=n.ctx.currentTime,m=C+f/1e3;y._volume=o,y._node.gain.setValueAtTime(o,C),y._node.gain.linearRampToValueAtTime(h,m)}x._startFadeInterval(y,o,h,f,T[w],typeof v=="undefined")}}return x},_startFadeInterval:function(o,h,f,v,x,T){var w=this,y=h,C=f-h,m=Math.abs(C/.01),M=Math.max(4,m>0?v/m:v),R=Date.now();o._fadeTo=f,o._interval=setInterval(function(){var I=(Date.now()-R)/v;R=Date.now(),y+=C*I,y=Math.round(y*100)/100,C<0?y=Math.max(f,y):y=Math.min(f,y),w._webAudio?o._volume=y:w.volume(y,o._id,!0),T&&(w._volume=y),(f<h&&y<=f||f>h&&y>=f)&&(clearInterval(o._interval),o._interval=null,o._fadeTo=null,w.volume(f,o._id),w._emit("fade",o._id))},M)},_stopFade:function(o){var h=this,f=h._soundById(o);return f&&f._interval&&(h._webAudio&&f._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(f._interval),f._interval=null,h.volume(f._fadeTo,o),f._fadeTo=null,h._emit("fade",o)),h},loop:function(){var o=this,h=arguments,f,v,x;if(h.length===0)return o._loop;if(h.length===1)if(typeof h[0]=="boolean")f=h[0],o._loop=f;else return x=o._soundById(parseInt(h[0],10)),x?x._loop:!1;else h.length===2&&(f=h[0],v=parseInt(h[1],10));for(var T=o._getSoundIds(v),w=0;w<T.length;w++)x=o._soundById(T[w]),x&&(x._loop=f,o._webAudio&&x._node&&x._node.bufferSource&&(x._node.bufferSource.loop=f,f&&(x._node.bufferSource.loopStart=x._start||0,x._node.bufferSource.loopEnd=x._stop,o.playing(T[w])&&(o.pause(T[w],!0),o.play(T[w],!0)))));return o},rate:function(){var o=this,h=arguments,f,v;if(h.length===0)v=o._sounds[0]._id;else if(h.length===1){var x=o._getSoundIds(),T=x.indexOf(h[0]);T>=0?v=parseInt(h[0],10):f=parseFloat(h[0])}else h.length===2&&(f=parseFloat(h[0]),v=parseInt(h[1],10));var w;if(typeof f=="number"){if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"rate",action:function(){o.rate.apply(o,h)}}),o;typeof v=="undefined"&&(o._rate=f),v=o._getSoundIds(v);for(var y=0;y<v.length;y++)if(w=o._soundById(v[y]),w){o.playing(v[y])&&(w._rateSeek=o.seek(v[y]),w._playStart=o._webAudio?n.ctx.currentTime:w._playStart),w._rate=f,o._webAudio&&w._node&&w._node.bufferSource?w._node.bufferSource.playbackRate.setValueAtTime(f,n.ctx.currentTime):w._node&&(w._node.playbackRate=f);var C=o.seek(v[y]),m=(o._sprite[w._sprite][0]+o._sprite[w._sprite][1])/1e3-C,M=m*1e3/Math.abs(w._rate);(o._endTimers[v[y]]||!w._paused)&&(o._clearTimer(v[y]),o._endTimers[v[y]]=setTimeout(o._ended.bind(o,w),M)),o._emit("rate",w._id)}}else return w=o._soundById(v),w?w._rate:o._rate;return o},seek:function(){var o=this,h=arguments,f,v;if(h.length===0)o._sounds.length&&(v=o._sounds[0]._id);else if(h.length===1){var x=o._getSoundIds(),T=x.indexOf(h[0]);T>=0?v=parseInt(h[0],10):o._sounds.length&&(v=o._sounds[0]._id,f=parseFloat(h[0]))}else h.length===2&&(f=parseFloat(h[0]),v=parseInt(h[1],10));if(typeof v=="undefined")return 0;if(typeof f=="number"&&(o._state!=="loaded"||o._playLock))return o._queue.push({event:"seek",action:function(){o.seek.apply(o,h)}}),o;var w=o._soundById(v);if(w)if(typeof f=="number"&&f>=0){var y=o.playing(v);y&&o.pause(v,!0),w._seek=f,w._ended=!1,o._clearTimer(v),!o._webAudio&&w._node&&!isNaN(w._node.duration)&&(w._node.currentTime=f);var C=function(){y&&o.play(v,!0),o._emit("seek",v)};if(y&&!o._webAudio){var m=function(){o._playLock?setTimeout(m,0):C()};setTimeout(m,0)}else C()}else if(o._webAudio){var M=o.playing(v)?n.ctx.currentTime-w._playStart:0,R=w._rateSeek?w._rateSeek-w._seek:0;return w._seek+(R+M*Math.abs(w._rate))}else return w._node.currentTime;return o},playing:function(o){var h=this;if(typeof o=="number"){var f=h._soundById(o);return f?!f._paused:!1}for(var v=0;v<h._sounds.length;v++)if(!h._sounds[v]._paused)return!0;return!1},duration:function(o){var h=this,f=h._duration,v=h._soundById(o);return v&&(f=h._sprite[v._sprite][1]/1e3),f},state:function(){return this._state},unload:function(){for(var o=this,h=o._sounds,f=0;f<h.length;f++)h[f]._paused||o.stop(h[f]._id),o._webAudio||(o._clearSound(h[f]._node),h[f]._node.removeEventListener("error",h[f]._errorFn,!1),h[f]._node.removeEventListener(n._canPlayEvent,h[f]._loadFn,!1),h[f]._node.removeEventListener("ended",h[f]._endFn,!1),n._releaseHtml5Audio(h[f]._node)),delete h[f]._node,o._clearTimer(h[f]._id);var v=n._howls.indexOf(o);v>=0&&n._howls.splice(v,1);var x=!0;for(f=0;f<n._howls.length;f++)if(n._howls[f]._src===o._src||o._src.indexOf(n._howls[f]._src)>=0){x=!1;break}return c&&x&&delete c[o._src],n.noAudio=!1,o._state="unloaded",o._sounds=[],o=null,null},on:function(o,h,f,v){var x=this,T=x["_on"+o];return typeof h=="function"&&T.push(v?{id:f,fn:h,once:v}:{id:f,fn:h}),x},off:function(o,h,f){var v=this,x=v["_on"+o],T=0;if(typeof h=="number"&&(f=h,h=null),h||f)for(T=0;T<x.length;T++){var w=f===x[T].id;if(h===x[T].fn&&w||!h&&w){x.splice(T,1);break}}else if(o)v["_on"+o]=[];else{var y=Object.keys(v);for(T=0;T<y.length;T++)y[T].indexOf("_on")===0&&Array.isArray(v[y[T]])&&(v[y[T]]=[])}return v},once:function(o,h,f){var v=this;return v.on(o,h,f,1),v},_emit:function(o,h,f){for(var v=this,x=v["_on"+o],T=x.length-1;T>=0;T--)(!x[T].id||x[T].id===h||o==="load")&&(setTimeout(function(w){w.call(this,h,f)}.bind(v,x[T].fn),0),x[T].once&&v.off(o,x[T].fn,x[T].id));return v._loadQueue(o),v},_loadQueue:function(o){var h=this;if(h._queue.length>0){var f=h._queue[0];f.event===o&&(h._queue.shift(),h._loadQueue()),o||f.action()}return h},_ended:function(o){var h=this,f=o._sprite;if(!h._webAudio&&o._node&&!o._node.paused&&!o._node.ended&&o._node.currentTime<o._stop)return setTimeout(h._ended.bind(h,o),100),h;var v=!!(o._loop||h._sprite[f][2]);if(h._emit("end",o._id),!h._webAudio&&v&&h.stop(o._id,!0).play(o._id),h._webAudio&&v){h._emit("play",o._id),o._seek=o._start||0,o._rateSeek=0,o._playStart=n.ctx.currentTime;var x=(o._stop-o._start)*1e3/Math.abs(o._rate);h._endTimers[o._id]=setTimeout(h._ended.bind(h,o),x)}return h._webAudio&&!v&&(o._paused=!0,o._ended=!0,o._seek=o._start||0,o._rateSeek=0,h._clearTimer(o._id),h._cleanBuffer(o._node),n._autoSuspend()),!h._webAudio&&!v&&h.stop(o._id,!0),h},_clearTimer:function(o){var h=this;if(h._endTimers[o]){if(typeof h._endTimers[o]!="function")clearTimeout(h._endTimers[o]);else{var f=h._soundById(o);f&&f._node&&f._node.removeEventListener("ended",h._endTimers[o],!1)}delete h._endTimers[o]}return h},_soundById:function(o){for(var h=this,f=0;f<h._sounds.length;f++)if(o===h._sounds[f]._id)return h._sounds[f];return null},_inactiveSound:function(){var o=this;o._drain();for(var h=0;h<o._sounds.length;h++)if(o._sounds[h]._ended)return o._sounds[h].reset();return new r(o)},_drain:function(){var o=this,h=o._pool,f=0,v=0;if(!(o._sounds.length<h)){for(v=0;v<o._sounds.length;v++)o._sounds[v]._ended&&f++;for(v=o._sounds.length-1;v>=0;v--){if(f<=h)return;o._sounds[v]._ended&&(o._webAudio&&o._sounds[v]._node&&o._sounds[v]._node.disconnect(0),o._sounds.splice(v,1),f--)}}},_getSoundIds:function(o){var h=this;if(typeof o=="undefined"){for(var f=[],v=0;v<h._sounds.length;v++)f.push(h._sounds[v]._id);return f}else return[o]},_refreshBuffer:function(o){var h=this;return o._node.bufferSource=n.ctx.createBufferSource(),o._node.bufferSource.buffer=c[h._src],o._panner?o._node.bufferSource.connect(o._panner):o._node.bufferSource.connect(o._node),o._node.bufferSource.loop=o._loop,o._loop&&(o._node.bufferSource.loopStart=o._start||0,o._node.bufferSource.loopEnd=o._stop||0),o._node.bufferSource.playbackRate.setValueAtTime(o._rate,n.ctx.currentTime),h},_cleanBuffer:function(o){var h=this,f=n._navigator&&n._navigator.vendor.indexOf("Apple")>=0;if(n._scratchBuffer&&o.bufferSource&&(o.bufferSource.onended=null,o.bufferSource.disconnect(0),f))try{o.bufferSource.buffer=n._scratchBuffer}catch(v){}return o.bufferSource=null,h},_clearSound:function(o){var h=/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent);h||(o.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(o){this._parent=o,this.init()};r.prototype={init:function(){var o=this,h=o._parent;return o._muted=h._muted,o._loop=h._loop,o._volume=h._volume,o._rate=h._rate,o._seek=0,o._paused=!0,o._ended=!0,o._sprite="__default",o._id=++n._counter,h._sounds.push(o),o.create(),o},create:function(){var o=this,h=o._parent,f=n._muted||o._muted||o._parent._muted?0:o._volume;return h._webAudio?(o._node=typeof n.ctx.createGain=="undefined"?n.ctx.createGainNode():n.ctx.createGain(),o._node.gain.setValueAtTime(f,n.ctx.currentTime),o._node.paused=!0,o._node.connect(n.masterGain)):n.noAudio||(o._node=n._obtainHtml5Audio(),o._errorFn=o._errorListener.bind(o),o._node.addEventListener("error",o._errorFn,!1),o._loadFn=o._loadListener.bind(o),o._node.addEventListener(n._canPlayEvent,o._loadFn,!1),o._endFn=o._endListener.bind(o),o._node.addEventListener("ended",o._endFn,!1),o._node.src=h._src,o._node.preload=h._preload===!0?"auto":h._preload,o._node.volume=f*n.volume(),o._node.load()),o},reset:function(){var o=this,h=o._parent;return o._muted=h._muted,o._loop=h._loop,o._volume=h._volume,o._rate=h._rate,o._seek=0,o._rateSeek=0,o._paused=!0,o._ended=!0,o._sprite="__default",o._id=++n._counter,o},_errorListener:function(){var o=this;o._parent._emit("loaderror",o._id,o._node.error?o._node.error.code:0),o._node.removeEventListener("error",o._errorFn,!1)},_loadListener:function(){var o=this,h=o._parent;h._duration=Math.ceil(o._node.duration*10)/10,Object.keys(h._sprite).length===0&&(h._sprite={__default:[0,h._duration*1e3]}),h._state!=="loaded"&&(h._state="loaded",h._emit("load"),h._loadQueue()),o._node.removeEventListener(n._canPlayEvent,o._loadFn,!1)},_endListener:function(){var o=this,h=o._parent;h._duration===1/0&&(h._duration=Math.ceil(o._node.duration*10)/10,h._sprite.__default[1]===1/0&&(h._sprite.__default[1]=h._duration*1e3),h._ended(o)),o._node.removeEventListener("ended",o._endFn,!1)}};var c={},u=function(o){var h=o._src;if(c[h]){o._duration=c[h].duration,g(o);return}if(/^data:[^;]+;base64,/.test(h)){for(var f=atob(h.split(",")[1]),v=new Uint8Array(f.length),x=0;x<f.length;++x)v[x]=f.charCodeAt(x);_(v.buffer,o)}else{var T=new XMLHttpRequest;T.open(o._xhr.method,h,!0),T.withCredentials=o._xhr.withCredentials,T.responseType="arraybuffer",o._xhr.headers&&Object.keys(o._xhr.headers).forEach(function(w){T.setRequestHeader(w,o._xhr.headers[w])}),T.onload=function(){var w=(T.status+"")[0];if(w!=="0"&&w!=="2"&&w!=="3"){o._emit("loaderror",null,"Failed loading audio file with status: "+T.status+".");return}_(T.response,o)},T.onerror=function(){o._webAudio&&(o._html5=!0,o._webAudio=!1,o._sounds=[],delete c[h],o.load())},p(T)}},p=function(o){try{o.send()}catch(h){o.onerror()}},_=function(o,h){var f=function(){h._emit("loaderror",null,"Decoding audio data failed.")},v=function(x){x&&h._sounds.length>0?(c[h._src]=x,g(h,x)):f()};typeof Promise!="undefined"&&n.ctx.decodeAudioData.length===1?n.ctx.decodeAudioData(o).then(v).catch(f):n.ctx.decodeAudioData(o,v,f)},g=function(o,h){h&&!o._duration&&(o._duration=h.duration),Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue())},S=function(){if(!!n.usingWebAudio){try{typeof AudioContext!="undefined"?n.ctx=new AudioContext:typeof webkitAudioContext!="undefined"?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(x){n.usingWebAudio=!1}n.ctx||(n.usingWebAudio=!1);var o=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),h=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),f=h?parseInt(h[1],10):null;if(o&&f&&f<9){var v=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());n._navigator&&!v&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=typeof n.ctx.createGain=="undefined"?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.setValueAtTime(n._muted?0:n._volume,n.ctx.currentTime),n.masterGain.connect(n.ctx.destination)),n._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:n,Howl:i}}),typeof Mo!="undefined"&&(Mo.Howler=n,Mo.Howl=i),typeof global!="undefined"?(global.HowlerGlobal=t,global.Howler=n,global.Howl=i,global.Sound=r):typeof window!="undefined"&&(window.HowlerGlobal=t,window.Howler=n,window.Howl=i,window.Sound=r)})();(function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(n){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var r=i._howls.length-1;r>=0;r--)i._howls[r].stereo(n);return i},HowlerGlobal.prototype.pos=function(n,i,r){var c=this;if(!c.ctx||!c.ctx.listener)return c;if(i=typeof i!="number"?c._pos[1]:i,r=typeof r!="number"?c._pos[2]:r,typeof n=="number")c._pos=[n,i,r],typeof c.ctx.listener.positionX!="undefined"?(c.ctx.listener.positionX.setTargetAtTime(c._pos[0],Howler.ctx.currentTime,.1),c.ctx.listener.positionY.setTargetAtTime(c._pos[1],Howler.ctx.currentTime,.1),c.ctx.listener.positionZ.setTargetAtTime(c._pos[2],Howler.ctx.currentTime,.1)):c.ctx.listener.setPosition(c._pos[0],c._pos[1],c._pos[2]);else return c._pos;return c},HowlerGlobal.prototype.orientation=function(n,i,r,c,u,p){var _=this;if(!_.ctx||!_.ctx.listener)return _;var g=_._orientation;if(i=typeof i!="number"?g[1]:i,r=typeof r!="number"?g[2]:r,c=typeof c!="number"?g[3]:c,u=typeof u!="number"?g[4]:u,p=typeof p!="number"?g[5]:p,typeof n=="number")_._orientation=[n,i,r,c,u,p],typeof _.ctx.listener.forwardX!="undefined"?(_.ctx.listener.forwardX.setTargetAtTime(n,Howler.ctx.currentTime,.1),_.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),_.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),_.ctx.listener.upX.setTargetAtTime(c,Howler.ctx.currentTime,.1),_.ctx.listener.upY.setTargetAtTime(u,Howler.ctx.currentTime,.1),_.ctx.listener.upZ.setTargetAtTime(p,Howler.ctx.currentTime,.1)):_.ctx.listener.setOrientation(n,i,r,c,u,p);else return g;return _},Howl.prototype.init=function(n){return function(i){var r=this;return r._orientation=i.orientation||[1,0,0],r._stereo=i.stereo||null,r._pos=i.pos||null,r._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle!="undefined"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle!="undefined"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain!="undefined"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel!="undefined"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance!="undefined"?i.maxDistance:1e4,panningModel:typeof i.panningModel!="undefined"?i.panningModel:"HRTF",refDistance:typeof i.refDistance!="undefined"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor!="undefined"?i.rolloffFactor:1},r._onstereo=i.onstereo?[{fn:i.onstereo}]:[],r._onpos=i.onpos?[{fn:i.onpos}]:[],r._onorientation=i.onorientation?[{fn:i.onorientation}]:[],n.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(n,i){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(n,i)}}),r;var c=typeof Howler.ctx.createStereoPanner=="undefined"?"spatial":"stereo";if(typeof i=="undefined")if(typeof n=="number")r._stereo=n,r._pos=[n,0,0];else return r._stereo;for(var u=r._getSoundIds(i),p=0;p<u.length;p++){var _=r._soundById(u[p]);if(_)if(typeof n=="number")_._stereo=n,_._pos=[n,0,0],_._node&&(_._pannerAttr.panningModel="equalpower",(!_._panner||!_._panner.pan)&&t(_,c),c==="spatial"?typeof _._panner.positionX!="undefined"?(_._panner.positionX.setValueAtTime(n,Howler.ctx.currentTime),_._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),_._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):_._panner.setPosition(n,0,0):_._panner.pan.setValueAtTime(n,Howler.ctx.currentTime)),r._emit("stereo",_._id);else return _._stereo}return r},Howl.prototype.pos=function(n,i,r,c){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"pos",action:function(){u.pos(n,i,r,c)}}),u;if(i=typeof i!="number"?0:i,r=typeof r!="number"?-.5:r,typeof c=="undefined")if(typeof n=="number")u._pos=[n,i,r];else return u._pos;for(var p=u._getSoundIds(c),_=0;_<p.length;_++){var g=u._soundById(p[_]);if(g)if(typeof n=="number")g._pos=[n,i,r],g._node&&((!g._panner||g._panner.pan)&&t(g,"spatial"),typeof g._panner.positionX!="undefined"?(g._panner.positionX.setValueAtTime(n,Howler.ctx.currentTime),g._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),g._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):g._panner.setPosition(n,i,r)),u._emit("pos",g._id);else return g._pos}return u},Howl.prototype.orientation=function(n,i,r,c){var u=this;if(!u._webAudio)return u;if(u._state!=="loaded")return u._queue.push({event:"orientation",action:function(){u.orientation(n,i,r,c)}}),u;if(i=typeof i!="number"?u._orientation[1]:i,r=typeof r!="number"?u._orientation[2]:r,typeof c=="undefined")if(typeof n=="number")u._orientation=[n,i,r];else return u._orientation;for(var p=u._getSoundIds(c),_=0;_<p.length;_++){var g=u._soundById(p[_]);if(g)if(typeof n=="number")g._orientation=[n,i,r],g._node&&(g._panner||(g._pos||(g._pos=u._pos||[0,0,-.5]),t(g,"spatial")),typeof g._panner.orientationX!="undefined"?(g._panner.orientationX.setValueAtTime(n,Howler.ctx.currentTime),g._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),g._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):g._panner.setOrientation(n,i,r)),u._emit("orientation",g._id);else return g._orientation}return u},Howl.prototype.pannerAttr=function(){var n=this,i=arguments,r,c,u;if(!n._webAudio)return n;if(i.length===0)return n._pannerAttr;if(i.length===1)if(typeof i[0]=="object")r=i[0],typeof c=="undefined"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),n._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle!="undefined"?r.pannerAttr.coneInnerAngle:n._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle!="undefined"?r.pannerAttr.coneOuterAngle:n._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain!="undefined"?r.pannerAttr.coneOuterGain:n._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel!="undefined"?r.pannerAttr.distanceModel:n._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance!="undefined"?r.pannerAttr.maxDistance:n._maxDistance,refDistance:typeof r.pannerAttr.refDistance!="undefined"?r.pannerAttr.refDistance:n._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor!="undefined"?r.pannerAttr.rolloffFactor:n._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel!="undefined"?r.pannerAttr.panningModel:n._panningModel});else return u=n._soundById(parseInt(i[0],10)),u?u._pannerAttr:n._pannerAttr;else i.length===2&&(r=i[0],c=parseInt(i[1],10));for(var p=n._getSoundIds(c),_=0;_<p.length;_++)if(u=n._soundById(p[_]),u){var g=u._pannerAttr;g={coneInnerAngle:typeof r.coneInnerAngle!="undefined"?r.coneInnerAngle:g.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle!="undefined"?r.coneOuterAngle:g.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain!="undefined"?r.coneOuterGain:g.coneOuterGain,distanceModel:typeof r.distanceModel!="undefined"?r.distanceModel:g.distanceModel,maxDistance:typeof r.maxDistance!="undefined"?r.maxDistance:g.maxDistance,refDistance:typeof r.refDistance!="undefined"?r.refDistance:g.refDistance,rolloffFactor:typeof r.rolloffFactor!="undefined"?r.rolloffFactor:g.rolloffFactor,panningModel:typeof r.panningModel!="undefined"?r.panningModel:g.panningModel};var S=u._panner;S?(S.coneInnerAngle=g.coneInnerAngle,S.coneOuterAngle=g.coneOuterAngle,S.coneOuterGain=g.coneOuterGain,S.distanceModel=g.distanceModel,S.maxDistance=g.maxDistance,S.refDistance=g.refDistance,S.rolloffFactor=g.rolloffFactor,S.panningModel=g.panningModel):(u._pos||(u._pos=n._pos||[0,0,-.5]),t(u,"spatial"))}return n},Sound.prototype.init=function(n){return function(){var i=this,r=i._parent;i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,n.call(this),i._stereo?r.stereo(i._stereo):i._pos&&r.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(n){return function(){var i=this,r=i._parent;return i._orientation=r._orientation,i._stereo=r._stereo,i._pos=r._pos,i._pannerAttr=r._pannerAttr,i._stereo?r.stereo(i._stereo):i._pos?r.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,r._refreshBuffer(i)),n.call(this)}}(Sound.prototype.reset);var t=function(n,i){i=i||"spatial",i==="spatial"?(n._panner=Howler.ctx.createPanner(),n._panner.coneInnerAngle=n._pannerAttr.coneInnerAngle,n._panner.coneOuterAngle=n._pannerAttr.coneOuterAngle,n._panner.coneOuterGain=n._pannerAttr.coneOuterGain,n._panner.distanceModel=n._pannerAttr.distanceModel,n._panner.maxDistance=n._pannerAttr.maxDistance,n._panner.refDistance=n._pannerAttr.refDistance,n._panner.rolloffFactor=n._pannerAttr.rolloffFactor,n._panner.panningModel=n._pannerAttr.panningModel,typeof n._panner.positionX!="undefined"?(n._panner.positionX.setValueAtTime(n._pos[0],Howler.ctx.currentTime),n._panner.positionY.setValueAtTime(n._pos[1],Howler.ctx.currentTime),n._panner.positionZ.setValueAtTime(n._pos[2],Howler.ctx.currentTime)):n._panner.setPosition(n._pos[0],n._pos[1],n._pos[2]),typeof n._panner.orientationX!="undefined"?(n._panner.orientationX.setValueAtTime(n._orientation[0],Howler.ctx.currentTime),n._panner.orientationY.setValueAtTime(n._orientation[1],Howler.ctx.currentTime),n._panner.orientationZ.setValueAtTime(n._orientation[2],Howler.ctx.currentTime)):n._panner.setOrientation(n._orientation[0],n._orientation[1],n._orientation[2])):(n._panner=Howler.ctx.createStereoPanner(),n._panner.pan.setValueAtTime(n._stereo,Howler.ctx.currentTime)),n._panner.connect(n._node),n._paused||n._parent.pause(n._id,!0).play(n._id,!0)}})()});var wh={};un(wh);var K0,xh=bn(()=>{K0=Pn(qa());WL.registerComponent("howler-audio-listener",{spatial:{type:WL.Type.Bool,default:!0}},{init:function(){this.origin=new Float32Array(3),this.fwd=new Float32Array(3),this.up=new Float32Array(3)},update:function(){!this.spatial||(this.object.getTranslationWorld(this.origin),this.object.getForward(this.fwd),this.object.getUp(this.up),Howler.pos(this.origin[0],this.origin[1],this.origin[2]),Howler.orientation(this.fwd[0],this.fwd[1],this.fwd[2],this.up[0],this.up[1],this.up[2]))}})});var Sh={};un(Sh);var Th,Ch=bn(()=>{Th=Pn(qa());WL.registerComponent("howler-audio-source",{volume:{type:WL.Type.Float,default:1},spatial:{type:WL.Type.Bool,default:!0},loop:{type:WL.Type.Bool,default:!1},autoplay:{type:WL.Type.Bool,default:!1},src:{type:WL.Type.String,default:""}},{start:function(){this.audio=new Th.Howl({src:[this.src],loop:this.loop,volume:this.volume,autoplay:this.autoplay}),this.lastPlayedAudioId=null,this.origin=new Float32Array(3),this.lastOrigin=new Float32Array(3),this.spatial&&this.autoplay&&(this.updatePosition(),this.play());let t=()=>{this.stop();let n=WL.onSceneLoaded.indexOf(t);n>=0&&WL.onSceneLoaded.splice(n,1)};WL.onSceneLoaded.push(t)},update:function(){!this.spatial||!this.lastPlayedAudioId||(this.object.getTranslationWorld(this.origin),(Math.abs(this.lastOrigin[0]-this.origin[0])>.005||Math.abs(this.lastOrigin[1]-this.origin[1])>.005||Math.abs(this.lastOrigin[2]-this.origin[2])>.005)&&this.updatePosition())},updatePosition:function(){this.audio.pos(this.origin[0],this.origin[1],this.origin[2],this.lastPlayedAudioId),this.lastOrigin.set(this.origin)},play:function(){this.lastPlayedAudioId&&this.audio.stop(this.lastPlayedAudioId),this.lastPlayedAudioId=this.audio.play(),this.spatial&&this.updatePosition()},stop:function(){!this.lastPlayedAudioId||(this.audio.stop(this.lastPlayedAudioId),this.lastPlayedAudioId=null)}})});var kh=Ye(()=>{WL.registerComponent("image-texture",{url:{type:WL.Type.String,default:""},meshIndex:{type:WL.Type.Int,default:0}},{init:function(){let t=this.object;WL.textures.load(this.url,"anonymous").then(function(n){let i=t.getComponent("mesh",this.meshIndex).material;i.shader=="Flat Opaque Textured"?i.flatTexture=n:i.shader=="Phong Opaque Textured"?i.diffuseTexture=n:console.error("Shader",i.shader,"not supported by image-texture")}).catch(console.err)}})});var Ah={};un(Ah);var Mh,Oh=bn(()=>{Mh=Pn(jn());WL.registerComponent("mouse-look",{sensitity:{type:WL.Type.Float,default:.25},requireMouseDown:{type:WL.Type.Bool,default:!0},mouseButtonIndex:{type:WL.Type.Int,default:0}},{init:function(){this.currentRotationY=0,this.currentRotationX=0,this.origin=new Float32Array(3),this.parentOrigin=new Float32Array(3),document.addEventListener("mousemove",function(t){this.active&&(this.mouseDown||!this.requireMouseDown)&&(this.rotationY=-this.sensitity*t.movementX/100,this.rotationX=-this.sensitity*t.movementY/100,this.currentRotationX+=this.rotationX,this.currentRotationY+=this.rotationY,this.currentRotationX=Math.min(1.507,this.currentRotationX),this.currentRotationX=Math.max(-1.507,this.currentRotationX),this.object.getTranslationWorld(this.origin),this.object.parent.getTranslationWorld(this.parentOrigin),Mh.vec3.sub(this.origin,this.origin,this.parentOrigin),this.object.resetTranslationRotation(),this.object.rotateAxisAngleRad([1,0,0],this.currentRotationX),this.object.rotateAxisAngleRad([0,1,0],this.currentRotationY),this.object.translate(this.origin))}.bind(this)),this.requireMouseDown&&(this.mouseButtonIndex==2&&WL.canvas.addEventListener("contextmenu",function(t){t.preventDefault()},!1),WL.canvas.addEventListener("mousedown",function(t){if(t.button==this.mouseButtonIndex&&(this.mouseDown=!0,document.body.style.cursor="grabbing",t.button==1))return t.preventDefault(),!1}.bind(this)),WL.canvas.addEventListener("mouseup",function(t){t.button==this.mouseButtonIndex&&(this.mouseDown=!1,document.body.style.cursor="initial")}.bind(this)))},start:function(){this.rotationX=0,this.rotationY=0}})});var Rh=Ye(()=>{WL.registerComponent("target-framerate",{framerate:{type:WL.Type.Float,default:90}},{start:function(){WL.xrSession?this.setTargetFramerate(WL.xrSession):WL.onXRSessionStart.push(this.setTargetFramerate.bind(this))},setTargetFramerate:function(t){if(t.supportedFrameRates&&t.updateTargetFrameRate){let n=WL.xrSession.supportedFrameRates;n.sort((i,r)=>Math.abs(i-this.framerate)-Math.abs(r-this.framerate)),WL.xrSession.updateTargetFrameRate(n[0])}}})});var Eh={};un(Eh);var Jn,Ph=bn(()=>{Jn=Pn(jn());WL.registerComponent("teleport",{teleportIndicatorMeshObject:{type:WL.Type.Object},camRoot:{type:WL.Type.Object},cam:{type:WL.Type.Object},eyeLeft:{type:WL.Type.Object},eyeRight:{type:WL.Type.Object},handedness:{type:WL.Type.Enum,values:["input component","left","right","none"],default:"input component"},floorGroup:{type:WL.Type.Int,default:1},thumbstickActivationThreshhold:{type:WL.Type.Float,default:-.7},thumbstickDeactivationThreshhold:{type:WL.Type.Float,default:.3},indicatorYOffset:{type:WL.Type.Float,default:.01},rayCastMode:{type:WL.Type.Enum,values:["collision","physx"],default:"collision"},maxDistance:{type:WL.Type.Float,default:100}},{init:function(){if(this._prevThumbstickAxis=new Float32Array(2),this._tempVec=new Float32Array(3),this._tempVec0=new Float32Array(3),this._currentIndicatorRotation=0,this.input=this.object.getComponent("input"),!this.input){console.error(this.object.name,"generic-teleport-component.js: input component is required on the object");return}if(!this.teleportIndicatorMeshObject){console.error(this.object.name,"generic-teleport-component.js: Teleport indicator mesh is missing");return}if(!this.camRoot){console.error(this.object.name,"generic-teleport-component.js: camRoot not set");return}this.isIndicating=!1,this.cam&&(this.isMouseIndicating=!1,WL.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),WL.canvas.addEventListener("mouseup",this.onMouseUp.bind(this))),this.indicatorHidden=!0,this.hitSpot=new Float32Array(3),this._hasHit=!1,this._extraRotation=0,this._currentStickAxes=new Float32Array(2)},start:function(){if(this.handedness==0){let t=this.object.getComponent("input");t?(this.handedness=t.handedness,this.input=t):console.warn("teleport component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right"][this.handedness-1];WL.onXRSessionStart.push(this.setupVREvents.bind(this)),this.teleportIndicatorMeshObject.active=!1},_getCamRotation:function(){return this.eyeLeft.getForward(this._tempVec),this._tempVec[1]=0,Jn.vec3.normalize(this._tempVec,this._tempVec),Math.atan2(this._tempVec[0],this._tempVec[2])},update:function(){let t=0;if(this.gamepad&&this.gamepad.axes&&(this._currentStickAxes[0]=this.gamepad.axes[2],this._currentStickAxes[1]=this.gamepad.axes[3],t=Math.abs(this._currentStickAxes[0])+Math.abs(this._currentStickAxes[1])),!this.isIndicating&&this._prevThumbstickAxis[1]>=this.thumbstickActivationThreshhold&&this._currentStickAxes[1]<this.thumbstickActivationThreshhold?this.isIndicating=!0:this.isIndicating&&t<this.thumbstickDeactivationThreshhold&&(this.isIndicating=!1,this.teleportIndicatorMeshObject.active=!1,this._hasHit&&this._teleportPlayer(this.hitSpot,this._extraRotation)),this.isIndicating&&this.teleportIndicatorMeshObject&&this.input){let n=this._tempVec0;Jn.quat2.getTranslation(n,this.object.transformWorld);let i=this.object.getForward(this._tempVec),r=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(n,i,1<<this.floorGroup):WL.physics.rayCast(n,i,1<<this.floorGroup,this.maxDistance);r.hitCount>0?(this.indicatorHidden=!1,this._extraRotation=Math.PI+Math.atan2(this._currentStickAxes[0],this._currentStickAxes[1]),this._currentIndicatorRotation=this._getCamRotation()+(this._extraRotation-Math.PI),this.teleportIndicatorMeshObject.resetTranslationRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(r.locations[0]),this.teleportIndicatorMeshObject.translate([0,this.indicatorYOffset,0]),this.teleportIndicatorMeshObject.active=!0,this.hitSpot.set(r.locations[0]),this._hasHit=!0):(this.indicatorHidden||(this.teleportIndicatorMeshObject.active=!1,this.indicatorHidden=!0),this._hasHit=!1)}else this.teleportIndicatorMeshObject&&this.isMouseIndicating&&this.onMousePressed();this._prevThumbstickAxis.set(this._currentStickAxes)},setupVREvents:function(t){if(this.session=t,t.addEventListener("end",function(){this.gamepad=null,this.session=null}.bind(this)),t.inputSources&&t.inputSources.length)for(let n=0;n<t.inputSources.length;n++){let i=t.inputSources[n];i.handedness==this.handedness&&(this.gamepad=i.gamepad)}t.addEventListener("inputsourceschange",function(n){if(n.added&&n.added.length)for(let i=0;i<n.added.length;i++){let r=n.added[i];r.handedness==this.handedness&&(this.gamepad=r.gamepad)}}.bind(this))},onMouseDown:function(){this.isMouseIndicating=!0},onMouseUp:function(){this.isMouseIndicating=!1,this.teleportIndicatorMeshObject.active=!1,this._hasHit&&this._teleportPlayer(this.hitSpot,0)},onMousePressed:function(){let t=[0,0,0];Jn.quat2.getTranslation(t,this.cam.transformWorld);let n=this.cam.getForward(this._tempVec),i=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(t,n,1<<this.floorGroup):WL.physics.rayCast(t,n,1<<this.floorGroup,this.maxDistance);i.hitCount>0?(this.indicatorHidden=!1,n[1]=0,Jn.vec3.normalize(n,n),this._currentIndicatorRotation=-Math.sign(n[2])*Math.acos(n[0])-Math.PI*.5,this.teleportIndicatorMeshObject.resetTranslationRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(i.locations[0]),this.teleportIndicatorMeshObject.active=!0,this.hitSpot=i.locations[0],this._hasHit=!0):(this.indicatorHidden||(this.teleportIndicatorMeshObject.active=!1,this.indicatorHidden=!0),this._hasHit=!1)},_teleportPlayer:function(t,n){this.camRoot.rotateAxisAngleRad([0,1,0],n);let i=this._tempVec,r=this._tempVec0;this.session?(this.eyeLeft.getTranslationWorld(i),this.eyeRight.getTranslationWorld(r),Jn.vec3.add(i,i,r),Jn.vec3.scale(i,i,.5)):this.cam.getTranslationWorld(i),this.camRoot.getTranslationWorld(r),Jn.vec3.sub(i,r,i),i[0]+=t[0],i[1]=t[1],i[2]+=t[2],this.camRoot.setTranslationWorld(i)}});WL.registerComponent("player-height",{height:{type:WL.Type.Float,default:1.75}},{init:function(){WL.onXRSessionStart.push(this.onXRSessionStart.bind(this)),WL.onXRSessionEnd.push(this.onXRSessionEnd.bind(this))},start:function(){this.object.resetTranslationRotation(),this.object.translate([0,this.height,0])},onXRSessionStart:function(){["local","viewer"].includes(WebXR.refSpace)||this.object.resetTranslationRotation()},onXRSessionEnd:function(){["local","viewer"].includes(WebXR.refSpace)||(this.object.resetTranslationRotation(),this.object.translate([0,this.height,0]))}})});var Dh={};un(Dh);var De,v0,Ih=bn(()=>{De=Pn(jn());Math.clamp=function(t,n,i){return Math.max(n,Math.min(t,i))};v0=function(){let t=new Float32Array(3),n=new Float32Array(3),i=new Float32Array(3),r=new Float32Array(3),c=new Float32Array(3),u=new Float32Array(3),p=new Float32Array(3),_=new Float32Array(4),g=new Float32Array(4),S=new Float32Array(4),o=new Float32Array(4);return function(h,f,v,x,T,w,y,C,m,M){De.vec3.sub(i,x,v);let R=De.vec3.length(i);De.vec3.sub(t,x,T);let I=De.vec3.length(t);De.vec3.sub(t,w,v);let L=Math.clamp(De.vec3.length(t),y,R+I-y);De.vec3.sub(n,T,v),De.vec3.sub(r,v,x),De.vec3.sub(c,T,x),De.vec3.normalize(n,n),De.vec3.normalize(i,i),De.vec3.normalize(r,r),De.vec3.normalize(c,c),De.vec3.normalize(t,t);let q=Math.acos(Math.clamp(De.vec3.dot(n,i),-1,1)),z=Math.acos(Math.clamp(De.vec3.dot(r,c),-1,1)),U=Math.acos(Math.clamp(De.vec3.dot(n,t),-1,1)),H=Math.acos(Math.clamp((I*I-R*R-L*L)/(-2*R*L),-1,1)),ee=Math.acos(Math.clamp((L*L-R*R-I*I)/(-2*R*I),-1,1));De.vec3.sub(n,T,v),De.vec3.sub(i,x,v),De.vec3.sub(t,w,v),De.vec3.cross(u,n,i),De.vec3.cross(p,n,t),M?(De.vec3.sub(i,M,x),De.vec3.transformQuat(i,[0,0,-1],m)):De.vec3.sub(i,x,v);let ie=De.vec3.length(u);ie==0?u.set([1,0,0]):De.vec3.scale(u,u,1/ie),De.vec3.normalize(p,p),De.quat.conjugate(C,C),De.quat.setAxisAngle(g,De.vec3.transformQuat(_,u,C),H-q),De.quat.setAxisAngle(o,De.vec3.transformQuat(_,p,C),U),De.quat.mul(h,h,De.quat.mul(_,g,o)),De.quat.normalize(h,h),De.quat.conjugate(m,m),De.quat.setAxisAngle(S,De.vec3.transformQuat(_,u,m),ee-z),De.quat.mul(f,f,S),De.quat.normalize(f,f)}}();WL.registerComponent("two-joint-ik-solver",{root:{type:WL.Type.Object},middle:{type:WL.Type.Object},end:{type:WL.Type.Object},target:{type:WL.Type.Object},helper:{type:WL.Type.Object}},{init:function(){this.pos=new Float32Array(3*7),this.p=[this.pos.subarray(0,3),this.pos.subarray(3,6),this.pos.subarray(6,9),this.pos.subarray(9,12),this.pos.subarray(12,15),this.pos.subarray(15,18),this.pos.subarray(18,21)]},update:function(){let t=this.p;this.root.getTranslationWorld(t[0]),this.middle.getTranslationWorld(t[1]),this.end.getTranslationWorld(t[2]),this.target.getTranslationWorld(t[3]);let n=t[4],i=t[5];this.root.getTranslationLocal(n),this.middle.getTranslationLocal(i),this.helper&&this.helper.getTranslationWorld(t[6]),v0(this.root.transformLocal,this.middle.transformLocal,t[0],t[1],t[2],t[3],.01,this.root.transformWorld.subarray(0,4),this.middle.transformWorld.subarray(0,4),this.helper?t[6]:null),this.root.setTranslationLocal(n),this.middle.setTranslationLocal(i),this.root.setDirty(),this.middle.setDirty()}})});var jh=Ye(()=>{WL.registerComponent("video-texture",{url:{type:WL.Type.String,default:""},material:{type:WL.Type.Material},loop:{type:WL.Type.Bool,default:!0},autoplay:{type:WL.Type.Bool,default:!0},muted:{type:WL.Type.Bool,default:!0}},{init:function(){if(!this.material){console.error("video-texture: material property not set");return}this.loaded=!1,this.frameUpdateRequested=!0,this.video=document.createElement("video"),this.video.src=this.url,this.video.crossorigin="anonymous",this.video.autoplay=this.autoplay,this.video.loop=this.loop,this.video.muted=this.muted,this.video.addEventListener("playing",function(){this.loaded=!0}.bind(this)),this.video.play()},applyTexture:function(){let t=this.material;this.texture=new WL.Texture(this.video),t.shader=="Flat Opaque Textured"?t.flatTexture=this.texture:t.shader=="Phong Opaque Textured"?t.diffuseTexture=this.texture:console.error("Shader",t.shader,"not supported by video-texture"),"requestVideoFrameCallback"in this.video?this.video.requestVideoFrameCallback(this.updateVideo.bind(this)):this.video.addEventListener("timeupdate",function(){this.frameUpdateRequested=!0}.bind(this))},update:function(t){this.loaded&&this.frameUpdateRequested&&(this.texture?this.texture.update():this.applyTexture(),this.frameUpdateRequested=!1)},updateVideo:function(){this.frameUpdateRequested=!0,this.video.requestVideoFrameCallback(this.updateVideo.bind(this))}})});var Lh=Ye(()=>{WL.registerComponent("vr-mode-active-switch",{activateComponents:{type:WL.Type.Enum,values:["in VR","in non-VR"],default:"in VR"},affectChildren:{type:WL.Type.Bool,default:!0}},{start:function(){this.components=[],this.getComponents(this.object),this.onXRSessionEnd(),WL.onXRSessionStart.push(this.onXRSessionStart.bind(this)),WL.onXRSessionEnd.push(this.onXRSessionEnd.bind(this))},getComponents:function(t){let n=t.getComponents().filter(i=>i.type!="vr-mode-active-switch");if(this.components=this.components.concat(n),this.affectChildren){let i=t.children;for(let r=0;r<i.length;++r)this.getComponents(i[r])}},setComponentsActive:function(t){let n=this.components;for(let i=0;i<n.length;++i)n[i].active=t},onXRSessionStart:function(){!this.active||this.setComponentsActive(this.activateComponents==0)},onXRSessionEnd:function(){!this.active||this.setComponentsActive(this.activateComponents!=0)}})});var Fh={};un(Fh);var Va,qh=bn(()=>{Va=Pn(jn());WL.registerComponent("wasd-controls",{speed:{type:WL.Type.Float,default:.1},headObject:{type:WL.Type.Object}},{init:function(){this.up=!1,this.right=!1,this.down=!1,this.left=!1,window.addEventListener("keydown",this.press.bind(this)),window.addEventListener("keyup",this.release.bind(this))},start:function(){this.headObject=this.headObject||this.object},update:function(){let t=[0,0,0];this.up&&(t[2]-=1),this.down&&(t[2]+=1),this.left&&(t[0]-=1),this.right&&(t[0]+=1),Va.vec3.normalize(t,t),t[0]*=this.speed,t[2]*=this.speed,Va.vec3.transformQuat(t,t,this.headObject.transformWorld),this.object.translate(t)},press:function(t){t.keyCode===38||t.keyCode===87||t.keyCode===90?this.up=!0:t.keyCode===39||t.keyCode===68?this.right=!0:t.keyCode===40||t.keyCode===83?this.down=!0:(t.keyCode===37||t.keyCode===65||t.keyCode===81)&&(this.left=!0)},release:function(t){t.keyCode===38||t.keyCode===87||t.keyCode===90?this.up=!1:t.keyCode===39||t.keyCode===68?this.right=!1:t.keyCode===40||t.keyCode===83?this.down=!1:(t.keyCode===37||t.keyCode===65||t.keyCode===81)&&(this.left=!1)}})});var Vh={};un(Vh);var Ao,Nh=bn(()=>{Ao=Pn(jn());WL.registerComponent("wonderleap-ad",{auId:{type:WL.Type.String,default:"ce6f68fc-4809-4409-8f57-c631283ce5a3"},adId:{type:WL.Type.String}},{init:function(){this.mesh=this.object.getComponent("mesh",0),this.collision=this.object.addComponent("collision"),this.collision.collider=WL.Collider.Box,this.collision.group=2,this.cursorTarget=this.object.addComponent("cursor-target"),this.timeSinceLastVizCheck=0,this.visibleDuration=0,this.durationThreshold=10},start:function(){Wonderleap.fetchAd(this.auId).then(function(t){this.ad=t,WL.textures.load(t.asset,"").then(function(n){let i=WL._images[n._imageIndex];this.collision.extents=[i.width/i.height,1,.1],this.object.scale([i.width/i.height,1,1]),this.mesh.material.shader=="Phong Textured"?this.mesh.material.diffuseTexture=n:this.mesh.material.flatTexture=n}.bind(this)).catch(console.err)}.bind(this)),this.cursorTarget.addClickFunction(this.click.bind(this))},update:function(t){if(this.timeSinceLastVizCheck+=t,this.timeSinceLastVizCheck>.5){let n=this.isVisible();n&&(this.visibleDuration+=this.timeSinceLastVizCheck),this.timeSinceLastVizCheck=0,(!n&&this.visibleDuration>0||this.visibleDuration>this.durationThreshold)&&(Wonderleap.sendMetric("gaze",this.visibleDuration,this.ad.adId,this.ad.auId),this.visibleDuration=0)}},isVisible:function(){let t=WL.scene.activeViews[0];if(!t||!t.active)return console.warn("wonderleap-ad: camera object does not have an active view"),!1;let n=t.object.transformWorld,i=[0,0,0];Ao.quat2.getTranslation(i,n);let r=[0,0,-1];Ao.vec3.transformQuat(r,r,n);let c=WL.scene.rayCast(i,r,2);for(let u=0;u<c.hitCount;++u)if(c.objects[u].objectId==this.object.objectId)return!0;return!1},click:function(){let t=Module.webxr_session;if(t){t.end().then(this.click.bind(this));return}Wonderleap.sendMetric("click",0,this.ad.adId,this.ad.auId),this.ad.url&&window.open(this.ad.url,"_blank")}})});var Wh=Ye(()=>{window.glMatrix=jn();ch();lh();hh();dh();ph();fh();mh();gh();bh();xh();Ch();kh();Oh();Rh();Ph();Ih();jh();Lh();qh();Nh()});var u1=bundle=()=>{Cl(),kl(),Ml(),Ol(),Pl(),Il(),Gl(),Hl,Wh()};})();
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */
//# sourceMappingURL=canvas-ui-bundle.js.map
